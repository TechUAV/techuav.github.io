<html>
<head>
    <title>Ивасенков Твой первый квадрокоптер</title>
    <link href="../../resources/bootstrap.css" type="text/css"  rel="stylesheet" >
    <link href="../../resources/style.css" type="text/css"  rel="stylesheet" >
</head>
<body>
<div class="container">
    <div class='row header'>
        <div class="col-xs-12">
            
<div class='header-notice'>Скачай <a href='https://disk.yandex.ru/d/t5iYS0yvsaIT2g'>оффлайн-версию</a> работает без интернета.</div>
        </div>
    </div>
    <div class="row">
        <div class="left-menu col-xs-4 col-sm-3 col-lg-3">
            
<a href='../../index.html' class='mainlink'>Главная страница</a><hr/><ol class='articles-list'>
<li><a href='./Боевая_работа_подразделений_беспилотных_комплексов_Народный_.html'>Боевая работа подразделений беспилотных комплексов Народный </a></li>
<li><a href='./Борьба_с_БПЛА_метотдичка_для_ВСУ_перевод.html'>Борьба с БПЛА метотдичка для ВСУ перевод</a></li>
<li><a href='./Борьба_с_иранскими_БПЛА_Shahed_136_Народныи_перевод.html'>Борьба с иранскими БПЛА Shahed 136 Народный перевод</a></li>
<li><a href='./Временное_руководство_по_боевои_работе_подразделении_беспилотных.html'>Временное руководство по боевой работе подразделений беспилотных</a></li>
<li><a href='./Временное_руководство_по_боевои_работе_подразделении_беспилотныхвсу.html'>Временное руководство по боевой работе подразделений беспилотныхвсу</a></li>
<li><a href='./ВСУ_Доктрина_БПЛА_РУС.html'>ВСУ Доктрина БПЛА РУС</a></li>
<li><a href='./Методы_РЭБ_Наставление_АТР_3_12_3_СВ_США_Народный_перевод.html'>Методы РЭБ Наставление АТР 3 12 3 СВ США Народный перевод</a></li>
<li><a href='./Мониторинг_БПЛА_Флеш_народныи_перевод.html'>Мониторинг БПЛА Флеш народный перевод</a></li>
<li><a href='./Оптическая_и_оптико_электронная_разведка_Народныи_перевод.html'>Оптическая и оптико электронная разведка Народный перевод</a></li>
<li><a href='./Охотник_FPV.html'>Охотник FPV</a></li>
<li><a href='./Программа_для_инструкторов_пилотов_БПЛА_Народныи_перевод.html'>Программа для инструкторов пилотов БПЛА Народный перевод</a></li>
<li><a href='./Противодеиствие_БПЛА_Ланцет_Народныи_перевод.html'>Противодействие БПЛА Ланцет Народный перевод</a></li>
<li><a href='./Противодеиствие_БПЛА_Наставление_АТР_3_01_81_СВ_США_Народныи_перевод.html'>Противодействие БПЛА Наставление АТР 3 01 81 СВ США Народный перевод</a></li>
<li><a href='./РЭБ_против_россииских_БПЛА.html'>РЭБ против российских БПЛА</a></li>
<li><a href='./Теория_и_практика_применения_БЛА_дронов_Народныи_перевод_4.html'>Теория и практика применения БЛА дронов Народный перевод 4</a></li>
<li><a href='./Теория_и_практика_применения_БЛА_дронов_Народныи_перевод.html'>Теория и практика применения БЛА дронов Народный перевод</a></li>
<li><a href='./Инструкция.html'>Инструкция</a></li>
<li><a href='./CRON_RM_(rev.1.3)_ru_WM_(1).html'>CRON RM (rev.1.3) ru WM (1)</a></li>
<li><a href='./CRON_RM_(rev.1.4.3)_ru_WM.html'>CRON RM (rev.1.4.3) ru WM</a></li>
<li><a href='./Cron_RM(rev_1.5.2)_ru_WM.html'>Cron RM(rev 1.5.2) ru WM</a></li>
<li><a href='./ICARUS_(1).html'>ICARUS (1)</a></li>
<li><a href='./Johnny-K(E)_v_(1).4.html'>Johnny-K(E) v (1).4</a></li>
<li><a href='./Johnny-M_v_(1).6.html'>Johnny-M v (1).6</a></li>
<li><a href='./OEM719-Product-Sheet.html'>OEM719-Product-Sheet</a></li>
<li><a href='./EVO2_UCO_GNSS_Off.html'>EVO2 UCO GNSS Off</a></li>
<li><a href='./Определяем_координаты_полета_Бабы_Яги_(3).html'>Определяем координаты полета Бабы Яги (3)</a></li>
<li><a href='./Октокоптер_Вампир_ВСУ_переведён.html'>Октокоптер Вампир ВСУ переведён</a></li>
<li><a href='./БпЛА_Вампир.html'>БпЛА «Вампир»</a></li>
<li><a href='./Справочник_БпАК_1_класса_ВСУ.html'>Справочник БпАК 1 класса ВСУ</a></li>
<li><a href='./Презентация_Техно_Тарас.html'>Презентация «Техно Тарас»</a></li>
<li><a href='./Большои_каталог_роботов.html'>Большой каталог роботов</a></li>
<li><a href='./ADEX25_ukrexp_(1).html'>ADEX25 ukrexp (1)</a></li>
<li><a href='./Классификатор_БПЛА_ВСУ.html'>Классификатор БПЛА ВСУ</a></li>
<li><a href='./Классификатор_БПЛА_ВСУ_(1).html'>Классификатор БПЛА ВСУ (1)</a></li>
<li><a href='./c_Классификатор_БПЛА_ВСУ._2024.html'>c Классификатор БПЛА ВСУ. 2024</a></li>
<li><a href='./Классификатор_БПЛА_ВСУ_(2).html'>Классификатор БПЛА ВСУ (2)</a></li>
<li><a href='./Комплекс_Тарас_П_БПЛА_НСУ_Презентация_Техно_Тарас.html'>Комплекс Тарас П БПЛА НСУ Презентация Техно Тарас</a></li>
<li><a href='./Копия_Альбом_БпЛА_БЭК_и_наземные_боевые_платформы_ВСУ.html'>Копия Альбом БпЛА, БЭК и наземные боевые платформы ВСУ</a></li>
<li><a href='./Определяем_координаты_полета_Бабы_Яги_(2).html'>Определяем координаты полета Бабы Яги (2)</a></li>
<li><a href='./Evil_UAV.html'>Evil UAV</a></li>
<li><a href='./НОВА_ЛАБС_МОЛОТ_ДОП.html'>НОВА ЛАБС МОЛОТ ДОП</a></li>
<li><a href='./Разведывательные_БПЛА_коптерного_типа_2025_г_.html'>Разведывательные БПЛА коптерного типа 2025 г </a></li>
<li><a href='./ПИ_SHRIKE_(1).html'>ПИ SHRIKE (1)</a></li>
<li><a href='./ПИ_SHRIKE_инструкция_(1).html'>ПИ SHRIKE инструкция (1)</a></li>
<li><a href='./ПИ_SHRIKE_инструкция_(2).html'>ПИ SHRIKE инструкция (2)</a></li>
<li><a href='./ПИ_SHRIKE_(2).html'>ПИ SHRIKE (2)</a></li>
<li><a href='./Устройство_инициации_T202ADJ_v1_05.html'>Устройство инициации T202ADJ v1 05</a></li>
<li><a href='./Плата_нцац_нструкця_ru_(1).html'>Плата ініціації інструкція ru (1)</a></li>
<li><a href='./leap1.html'>leap1</a></li>
<li><a href='./Как_подключиться_к_приемнику_на_MILERLS_по_Wi_Fi_(1).html'>Как подключиться к приемнику на MILERLS по Wi Fi (1)</a></li>
<li><a href='./Октокоптер_Вампир_ВСУ_переведён_(1).html'>Октокоптер Вампир ВСУ переведён (1)</a></li>
<li><a href='./Классификатор_БПЛА_ВСУ_(3).html'>Классификатор БПЛА ВСУ (3)</a></li>
<li><a href='./Октокоптер_Вампир_ВСУ_переведён_(2).html'>Октокоптер Вампир ВСУ переведён (2)</a></li>
<li><a href='./13inch-fpv-3_250219_160417.html'>13inch-fpv-3 250219 160417</a></li>
<li><a href='./CRON_RM_(rev.1.3)_ru_WM.html'>CRON RM (rev.1.3) ru WM</a></li>
<li><a href='./CRON_RM_(rev.1.4.3)_ru_WM.html'>CRON RM (rev.1.4.3) ru WM</a></li>
<li><a href='./Cron_RM(rev_1.5.2)_ru_WM.html'>Cron RM(rev 1.5.2) ru WM</a></li>
<li><a href='./Паспорт_Горн_v2.0.html'>Паспорт Горн v2.0</a></li>
<li><a href='./Украинская_методичка_по_антидроновой_защите.html'>Украинская методичка по антидроновой защите</a></li>
<li><a href='./Атлас_профилей_крыльев.html'>Атлас профилей крыльев</a></li>
<li><a href='./Беспроводнои_оптическии_канал_связи_управления_БПЛА.html'>Беспроводной оптический канал связи управления БПЛА</a></li>
<li><a href='./Каталог_ворожих_безпiлотних_лiтальних_аппаратiв.html'>Каталог ворожих безпiлотних лiтальних аппаратiв</a></li>
<li><a href='./Определяем_координаты_полета_Бабы_Яги.html'>Определяем координаты полета Бабы Яги</a></li>
<li><a href='./FT_155_AM_3_1_ru.html'>FT 155 AM 3 1 ru</a></li>
<li><a href='./FT_155_AM_3_1.html'>FT 155 AM 3 1</a></li>
<li><a href='./Двойная_акб_мавик3_2.html'>Двойная акб мавик3 2</a></li>
<li><a href='./Тренировка_реагирования_пехотой_на_появление_БПЛА.html'>Тренировка реагирования пехотой на появление БПЛА</a></li>
<li><a href='./Тренировка_реагирования_колонны_техники_на_появление_БПЛА.html'>Тренировка реагирования колонны техники на появление БПЛА</a></li>
<li><a href='./ICARUS.html'>ICARUS</a></li>
<li><a href='./Руководство_по_эксплуатации_Модуль_Искра_4_2_5_v2_1.html'>Руководство по эксплуатации Модуль Искра 4 2 5 v2 1</a></li>
<li><a href='./Обозначения_коннекторов.html'>Обозначения коннекторов</a></li>
<li><a href='./Жуков_К.А._Воздушные_винты_1993.html'>Жуков К.А. Воздушные винты 1993</a></li>
<li><a href='./Справочник_-_Тактика_FPV.html'>Справочник - Тактика FPV</a></li>
<li>Ивасенков Твой первый квадрокоптер</li>
<li><a href='./ТАПИКАТОР_Руководство_по_эксплуатации.html'>ТАПИКАТОР Руководство по эксплуатации</a></li>
<li><a href='./Инструкция_для_операторов_дронов_с_1001_версией_прошивки_для_Mavic3.html'>Инструкция для операторов дронов с 1001, версией прошивки для Mavic3</a></li>
<li><a href='./Инструкция_TLRS9v1.html'>Инструкция TLRS9v1</a></li>
<li><a href='./Интерференция_воздушных_винтов_с_элементами_планера_самолёта_.html'>Интерференция воздушных винтов с элементами планера самолёта </a></li>
<li><a href='./Как_подключиться_к_приемнику_на_MILERLS_по_Wi_Fi.html'>Как подключиться к приемнику на MILERLS по Wi Fi</a></li>
<li><a href='./Основы_защиты_от_РЭБ.html'>Основы защиты от РЭБ</a></li>
<li><a href='./Двоиная_акб_мавик3.html'>Двойная акб мавик3</a></li>
<li><a href='./004546.html'>004546</a></li>
<li><a href='./004547.html'>004547</a></li>
<li><a href='./Гармонки_на_1.2_Частоти.html'>Гармоніки на 1.2  Частоти</a></li>
<li><a href='./Гармонки_на_1.2_Гармонки_(1).html'>Гармоніки на 1.2 Гармоніки (1)</a></li>
<li><a href='./Мак_дак.html'>Мак дак</a></li>
<li><a href='./Малые_беспилотные_летательные_аппараты_теория_и_практика_2015.html'>Малые беспилотные летательные аппараты теория и практика 2015</a></li>
<li><a href='./Меры_защиты_от_OSINT_противника.html'>Меры защиты от OSINT противника</a></li>
<li><a href='./ЗАЩИТF_STARLINK_ОТ_РЭБ_.html'>ЗАЩИТF STARLINK ОТ РЭБ </a></li>
<li><a href='./Модернизация_аккумуляторов_для_М3_3Т_3Е.html'>Модернизация аккумуляторов для М3 3Т 3Е</a></li>
<li><a href='./Модуль_контактного_замыкателя_(1).html'>Модуль контактного замыкателя (1)</a></li>
<li><a href='./НСУ_Скрутка.html'>НСУ Скрутка</a></li>
<li><a href='./1.-ТТХ-Sensor-ЦМТР.464327.html'>1.-ТТХ-Sensor-ЦМТР.464327</a></li>
<li><a href='./Обмен_боевым_опытом_Подразделения_БпЛА_перевод.html'>Обмен боевым опытом Подразделения БпЛА перевод</a></li>
<li><a href='./Модуль_контактного_замыкателя.html'>Модуль контактного замыкателя</a></li>
<li><a href='./Определяем_координаты_полета_Бабы_Яги_(1).html'>Определяем координаты полета Бабы Яги (1)</a></li>
<li><a href='./Организация_вооружения_и_боевая_техника_армии_иностранных_государств.html'>Организация вооружения и боевая техника армий иностранных государств</a></li>
<li><a href='./Основы_3D_печати_Курс_молодого_бойца.html'>Основы 3D печати Курс молодого бойца</a></li>
<li><a href='./Основы_авиации_Часть_2_Конструкция_и_основные_функциональные_системы.html'>Основы авиации Часть 2 Конструкция и основные функциональные системы</a></li>
<li><a href='./Chameleon_3.1_User_Manual_ru.html'>Chameleon 3.1 User Manual ru</a></li>
<li><a href='./Руководство_по_летной_эксплуатации_БпЛА_Vampire_перевод.html'>Руководство по летной эксплуатации БпЛА «Vampire» перевод</a></li>
<li><a href='./ПИ_SHRIKE.html'>ПИ SHRIKE</a></li>
<li><a href='./ПИ_SHRIKE_инструкция.html'>ПИ SHRIKE инструкция</a></li>
<li><a href='./Плата_нцац_нструкця_ru.html'>Плата ініціації інструкція ru</a></li>
<li><a href='./Инструкция_Инкубатор_3_0_онлайн_версия_5.html'>Инструкция Инкубатор 3 0 онлайн версия 5</a></li>
<li><a href='./Разблокировка_перекалибровка_батареи.html'>Разблокировка, перекалибровка батареи</a></li>
<li><a href='./Полимерные_композиционные_материалы_в_конструкциях_летательных_аппаратов.html'>Полимерные композиционные материалы в конструкциях летательных аппаратов</a></li>
<li><a href='./как_выбрать.html'>как выбрать</a></li>
<li><a href='./НСУ_22_и_24.html'>НСУ 2,2 и 2,4</a></li>
<li><a href='./Проектирование_лонжеронов_крыла_самолёта_Капитанова_Л_В_2006.html'>Проектирование лонжеронов крыла самолёта Капитанова Л В 2006</a></li>
<li><a href='./РЭБ_-_памятка-учебник_2025_(1).html'>РЭБ - памятка-учебник 2025 (1)</a></li>
<li><a href='./Прочность_конструкций_летательных_аппаратов_И_В_Чепурных_2013.html'>Прочность конструкций летательных аппаратов И В Чепурных 2013</a></li>
<li><a href='./Путеводитель_Прандтля_по_гидроаэродинамике_ред_Эртель_Герберт_пер.html'>Путеводитель Прандтля по гидроаэродинамике ред Эртель Герберт, пер</a></li>
<li><a href='./Частотный_модуль_Метла-гермес.html'>Частотный модуль Метла-гермес</a></li>
<li><a href='./Решения_для_борьбы_с_обледенением_БПЛА_2.html'>Решения для борьбы с обледенением БПЛА 2</a></li>
<li><a href='./РЭБ_-_памятка-учебник_2025.html'>РЭБ - памятка-учебник 2025</a></li>
<li><a href='./Johnny-K(E)_v.4.html'>Johnny-K(E) v.4</a></li>
<li><a href='./Johnny-M_v.6.html'>Johnny-M v.6</a></li>
<li><a href='./Сборка_электроники_Курьер.html'>Сборка электроники Курьер</a></li>
<li><a href='./Сборка_и_печать_пластика_Курьер.html'>Сборка и печать пластика Курьер</a></li>
<li><a href='./Око.html'>Око</a></li>
<li><a href='./Современная_беспилотная_техника_2023.html'>Современная беспилотная техника 2023</a></li>
<li><a href='./Таблица_металлических_резьб_m0_25_m600_full_1.html'>Таблица металлических резьб m0 25 m600 full 1</a></li>
<li><a href='./Справочник_-_Тактика_FPV_в_схемах.html'>Справочник - Тактика FPV в схемах</a></li>
<li><a href='./Технологии_из_окопов.html'>Технологии  из окопов</a></li>\n</ol><hr/>Список сформирован из темы<br/><a href='./index.html'>Все pdf файлы</a>
<br/><br/>Источник темы<br/><a href='../index.html'>ТЭЧ БпЛА | FPV</a>
        </div>
        <div class="content col-xs-8 cols-sm-9 col-lg-9">
            <h1>Ивасенков Твой первый квадрокоптер</h1>
            <div class="breadcrumbs">Из темы <a href='./index.html'>Все pdf файлы</a><br/>
Из источника <a href='../index.html'>ТЭЧ БпЛА | FPV</a><br/></div>
            <hr/>
            <div class="content-body">
<div class='file-group'>
<div class='file-attachment icon-cloud'>Файл <a href='https://cloud.mail.ru/public/MCHn/u4VKqYVB9/Ивасенков_Твой_первый_квадрокоптер.pdf'>Ивасенков_Твой_первый_квадрокоптер.pdf</a></div>
<div class='file-attachment icon-telegram'>Файл <a href='https://t.me/techuav/1665'>Ивасенков_Твой_первый_квадрокоптер.pdf</a></div></div>
<div><br/><br/>Валерий Яценков <br/>Санкт-Петербург <br/>«БХВ-Петербург» <br/>2016 <br/><br/>УДК 629.735.4+379.826 <br/>ББК 39.55я92 <br/> Я92 <br/> <br/> Яценков В. С. <br/> Я92  Твой первый квадрокоптер: теория и практика. — СПб.: БХВ-Петербург, <br/>2016. — 256 с.: ил. — (Электроника) <br/>ISBN 978-5-9775-3586-1 <br/>Детально изложены практические аспекты самостоятельного изготовления и <br/>эксплуатации квадрокоптеров. Рассмотрены все этапы: от выбора конструкцион-<br/>ных материалов и подбора компонентов с минимизацией финансовых затрат до <br/>настройки программного обеспечения и ремонта после аварии. Уделено внимание <br/>ошибкам, которые часто совершают начинающие авиамоделисты. В доступной <br/>форме даны теоретические основы полета мультироторных систем и базовые по-<br/>нятия работы со средой Arduino IDE. Приведено краткое описание устройства и <br/>принципа работы систем GPS и Глонасс, а также современных импульсных источ-<br/>ников бортового питания и литий-полимерных батарей. Подробно изложен прин-<br/>цип работы и процесс настройки систем OSD, телеметрии, беспроводного канала <br/>Bluetooth и популярных навигационных модулей GPS Ublox. Рассказано об уст-<br/>ройстве и принципах работы интегральных сенсоров и полетного контроллера.  <br/>Даны рекомендации по подбору оборудования FPV начального уровня, приведен <br/>обзор программ для компьютеров и смартфонов, применяемых при настройке обо-<br/>рудования квадрокоптера. <br/>Для читателей,  <br/>интересующихся электроникой, робототехникой, авиамоделизмом  <br/>УДК 629.735.4+379.826 <br/>ББК 39.55я92 <br/> <br/>Группа подготовки издания: <br/> <br/>Главный редактор Екатерина Кондукова <br/>Зам. главного редактора Игорь Шишигин <br/>Зав. редакцией Екатерина Капалыгина <br/>Редактор Анна Кузьмина <br/>Компьютерная верстка Ольги Сергиенко <br/>Корректор Зинаида Дмитриева <br/>Дизайн обложки Марины Дамбиевой <br/> <br/> <br/> <br/>Подписано в печать 30.11.15. <br/>1 <br/>Формат 70 100 / . Печать офсетная. Усл. печ. л. 20,64. <br/>16<br/>Тираж 1500 экз. Заказ №         <br/>"БХВ-Петербург", 191036, Санкт-Петербург, Гончарная ул., 20. <br/>Первая Академическая типография "Наука" <br/>199034, Санкт-Петербург, 9 линия, 12/28 <br/> <br/> <br/>© Яценков В. С., 2016 <br/>ISBN 978-5-9775-3586-1 <br/>© Оформление, издательство "БХВ-Петербург", 2016 <br/> <br/><br/>Оглавление <br/>От автора ........................................................................................................................ 11<br/>ЧАСТЬ I. ТЕОРИЯ ....................................................................................................... 13<br/>Глава 1. Принцип работы квадрокоптера ............................................................... 15<br/>Глава 2. Обязательные компоненты квадрокоптера............................................. 19<br/>Рама ................................................................................................................................................. 19<br/>Полетный контроллер ................................................................................................................... 21<br/>Принцип работы интегрального гироскопа ......................................................................... 22<br/>Принцип работы интегрального акселерометра ................................................................. 24<br/>Принцип работы интегрального магнитометра (компаса) ................................................. 26<br/>Устройство интегрального барометра ................................................................................. 28<br/>Устройство ультразвукового сонара .................................................................................... 30<br/>Аппаратура радиоуправления ....................................................................................................... 33<br/>Функция Failsafe..................................................................................................................... 36<br/>Модуляция сигнала PPM ....................................................................................................... 37<br/>Формат сигналов PCM .......................................................................................................... 39<br/>Совместимость аппаратуры стандартов DSM2/DSMX ...................................................... 40<br/>Сопряжение приемника и передатчика (биндинг) .............................................................. 41<br/>Импульсы PWM, триммеры и субтриммеры ....................................................................... 41<br/>Расходы и экспоненты ........................................................................................................... 42<br/>Конвертер PPM-SUM ............................................................................................................ 44<br/>Приемник-сателлит ................................................................................................................ 46<br/>Встроенная телеметрия ......................................................................................................... 46<br/>Антенны .......................................................................................................................................... 46<br/>Ненаправленные антенны ..................................................................................................... 49<br/>Направленные антенны ......................................................................................................... 52<br/>Системы слежения за направлением .................................................................................... 53<br/>Диверсификация антенн ........................................................................................................ 55<br/>Двигатели ....................................................................................................................................... 56<br/>Воздушные винты .......................................................................................................................... 58<br/>Регуляторы оборотов ..................................................................................................................... 60<br/><br/>4 Оглавление <br/>Батарея и зарядное устройство ..................................................................................................... 62<br/>Обозначения параметров силовой литиевой батареи ......................................................... 63<br/>Зарядка литиевых батарей ..................................................................................................... 64<br/>Особенности эксплуатации и хранения ............................................................................... 67<br/>Подготовка батарей к хранению ........................................................................................... 68<br/>Источник бортового питания ........................................................................................................ 68<br/>Последовательный линейный стабилизатор ........................................................................ 69<br/>Импульсные стабилизаторы-преобразователи .................................................................... 70<br/>Индикатор разряда батареи .......................................................................................................... 72<br/>Глава 3. Дополнительные компоненты квадрокоптера........................................ 74<br/>Оборудование видеоканала FPV .................................................................................................. 74<br/>Видеокамеры .......................................................................................................................... 75<br/>Видеокоммутатор .................................................................................................................. 75<br/>Стабилизированный подвес .................................................................................................. 76<br/>Видеопередатчик и видеоприемник ..................................................................................... 78<br/>Видеомонитор и видеоочки .................................................................................................. 79<br/>Приемники GPS ............................................................................................................................. 80<br/>Принцип определения координат ......................................................................................... 81<br/>Геометрический фактор ........................................................................................................ 83<br/>Альманах и эфемериды ......................................................................................................... 83<br/>"Холодный" старт .................................................................................................................. 84<br/>"Теплый" старт ....................................................................................................................... 84<br/>"Горячий" старт ..................................................................................................................... 84<br/>Технология A-GPS ................................................................................................................. 85<br/>Антенны GPS.......................................................................................................................... 85<br/>Поток данных GPS, протокол NMEA .................................................................................. 86<br/>Протокол U-BLOX (UBX) ..................................................................................................... 87<br/>Адаптер Bluetooth .......................................................................................................................... 88<br/>Телеметрия и OSD ......................................................................................................................... 89<br/>Универсальный радиоканал (радиомодем) ................................................................................. 94<br/>Бустеры и репитеры ....................................................................................................................... 95<br/>Жидкокристаллические и OLED-дисплеи ................................................................................... 97<br/>Средства поиска: биперы, маячки, GPS-трекеры ........................................................................ 99<br/>Сервомашинки ............................................................................................................................. 101<br/>ЧАСТЬ II. ПРАКТИКА .............................................................................................. 105<br/>Глава 4. Подготовка к изготовлению квадрокоптера ......................................... 107<br/>Подбор силовых компонентов .................................................................................................... 108<br/>Расчеты и оптимизация ............................................................................................................... 108<br/>Стойкость конструкции к авариям ............................................................................................. 111<br/>Конструкционные материалы ..................................................................................................... 113<br/>Виброзащита ................................................................................................................................ 118<br/>Избыточное демпфирование ............................................................................................... 119<br/>Демпфирование подвеса камеры ........................................................................................ 120<br/>Фиксация резьбовых соединений ....................................................................................... 121<br/>Крепление моторов и винтов ...................................................................................................... 121<br/>Магнитоизоляция ......................................................................................................................... 124<br/><br/>Оглавление  5 <br/>Глава 5. Сборка и настройка квадрокоптера ........................................................ 126<br/>Изготовление рамы ...................................................................................................................... 126<br/>Балансировка воздушных винтов ............................................................................................... 129<br/>Балансировка моторов ................................................................................................................. 131<br/>Сборка квадрокоптера ................................................................................................................. 133<br/>Настройка опций и параметров прошивки ................................................................................ 134<br/>Подключение платы контроллера к компьютеру .............................................................. 135<br/>Среда разработки Arduino IDE ........................................................................................... 136<br/>Настройка базовых опций кода прошивки ........................................................................ 138<br/>Тип рамы .............................................................................................................................. 139<br/>Минимальный рабочий газ ................................................................................................. 139<br/>Максимальный рабочий газ ................................................................................................ 140<br/>Минимальный газ при включении ..................................................................................... 140<br/>2<br/>Скорость шины I C .............................................................................................................. 140<br/>Тип стандартной платы ....................................................................................................... 141<br/>Независимые сенсоры ......................................................................................................... 141<br/>Активация моторов (арминг) .............................................................................................. 141<br/>Модификации радиоприемника .......................................................................................... 141<br/>Скорость портов ................................................................................................................... 142<br/>Фильтр гироскопа ................................................................................................................ 143<br/>Функция Failsafe................................................................................................................... 144<br/>Мертвая зона и нейтральная зона ....................................................................................... 144<br/>Магнитное склонение .......................................................................................................... 145<br/>Альтернативная прошивка MahoWii .......................................................................................... 146<br/>Функциональные режимы контроллера ..................................................................................... 147<br/>Конфигуратор MultiWiiConf ....................................................................................................... 150<br/>Калибровка акселерометра ................................................................................................. 150<br/>Конфигуратор MultiWii WinGUI ................................................................................................ 154<br/>Терминал для работы с COM-портами ...................................................................................... 156<br/>Программы для мобильных устройств ...................................................................................... 157<br/>EZ-GUI Ground Station ......................................................................................................... 157<br/>NAZE32 Configurator ........................................................................................................... 158<br/>MultiWii Configuration Tool ................................................................................................. 159<br/>Калибровка регуляторов оборотов ............................................................................................. 159<br/>Настройка канала радиоуправления ........................................................................................... 160<br/>Первое включение и первый взлет ............................................................................................. 162<br/>Триммирование акселерометров ........................................................................................ 164<br/>Настройка PID .............................................................................................................................. 165<br/>Базовая настройка параметра P .......................................................................................... 166<br/>Настройка I и D для плавного стабильного полета ........................................................... 167<br/>Настройка I и D для активного пилотирования и акро ..................................................... 167<br/>Глава 6. Подключение и настройка внешних модулей ....................................... 168<br/>Подключение адаптера USB-COM ............................................................................................. 168<br/>Подключение источника питания .............................................................................................. 169<br/>Подключение звукоизлучателя ................................................................................................... 171<br/>Подключение ультразвукового сонара ...................................................................................... 173<br/>Подключение светодиодной подсветки ..................................................................................... 175<br/>Подключение посадочных огней ................................................................................................ 179<br/><br/>6 Оглавление <br/>Подключение приемника по шине S-BUS ................................................................................. 180 <br/>Подключение и настройка адаптера Bluetooth .......................................................................... 181 <br/>Настройка модулей HC-06 и HC-07 ................................................................................... 182 <br/>Настройка модулей HC-05 .................................................................................................. 184 <br/>Установка связи модуля с компьютером ........................................................................... 185 <br/>Подключение радиомодема ........................................................................................................ 186 <br/>Подключение модемов к компьютеру, проверка и настройка ......................................... 187 <br/>Подключение наземного модема к мобильным устройствам .......................................... 190 <br/>Подключение бортового модема к полетному контроллеру ............................................ 191 <br/>Подключение модема к порту SERIAL3 полетного контроллера ................................... 191 <br/>Подключение и настройка приемника GPS ............................................................................... 192 <br/>Подключение приемника к компьютеру ............................................................................ 193 <br/>Получение доступа к сервису AssistNow Online ............................................................... 195 <br/>Изменение текущих настроек ............................................................................................. 196 <br/>Подключение приемника к полетному контроллеру ........................................................ 199 <br/>Подключение приемника GPS с прошивкой MahoWii ..................................................... 200 <br/>Подключение дисплея ................................................................................................................. 201 <br/>Монохромный OLED дисплей CRIUS CO-16 ................................................................... 201 <br/>Настройка параметров через меню дисплея ...................................................................... 202 <br/>Проблемы с подключением дисплеев CRIUS OLED и их решение ................................ 202 <br/>Самодельный цветной дисплей .......................................................................................... 204 <br/>Запись прошивки в контроллер дисплея ............................................................................ 207 <br/>Настройка прошивки ........................................................................................................... 208 <br/>Монтаж и подключение оборудования FPV .............................................................................. 209 <br/>Видеокамера ......................................................................................................................... 210 <br/>Видеопередатчик и приемник ............................................................................................. 211 <br/>Видеоочки и монитор .......................................................................................................... 215 <br/>Подключение подвеса к контроллеру ................................................................................ 216 <br/>Настройка при помощи EZ-GUI Ground Station ................................................................ 217 <br/>Настройка подвеса при помощи конфигуратора MultiWiiConf ....................................... 218 <br/>Настройка подвеса в прошивке MahoWii .......................................................................... 219 <br/>Настройка модуля MinimOSD ............................................................................................ 219 <br/>Структура экрана KV_Team_OSD v.2.3 ............................................................................. 226 <br/>Служебное меню прошивки KV_Team_OSD .................................................................... 226 <br/>Подключение датчиков тока и напряжения к модулю OSD ............................................ 229 <br/>Подключение датчиков тока и напряжения к контроллеру ..................................................... 232 <br/>Настройка аппаратного измерителя тока и потребленной энергии ................................. 233 <br/>Настройка программного измерителя потребленной энергии ......................................... 234 <br/>Глава 7. Обслуживание и ремонт квадрокоптера ................................................ 235 <br/>Предполетная проверка ............................................................................................................... 235 <br/>Характерные неполадки .............................................................................................................. 235 <br/>Ремонт квадрокоптера после аварии .......................................................................................... 237 <br/>Осмотр и поиск дефектов .................................................................................................... 237 <br/>Ремонт двигателей ............................................................................................................... 238 <br/>Разборка двигателя ..................................................................................................... 239 <br/>Проверка и замена вала .............................................................................................. 240 <br/>Проверка и замена подшипников .............................................................................. 241 <br/>Чистка и смазка подшипников................................................................................... 242 <br/><br/>Оглавление  7 <br/>ПРИЛОЖЕНИЯ .......................................................................................................... 245 <br/>Приложение 1. Управление коптером со смартфона ........................................... 246 <br/>Приложение 2. Сетка частот каналов видеотракта ............................................. 249 <br/>Приложение 3. Команды управления и конфигурирования  <br/>при помощи рукояток пульта ................................................................................... 251 <br/>Приложение 4. Описание электронного архива .................................................... 252 <br/>Предметный указатель .............................................................................................. 253 <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/><br/>  <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/>Посвящаю эту книгу  <br/> <br/>самым дорогим для меня людям:  <br/> <br/>дочери Полине, супруге Ольге  <br/> <br/> <br/>и, конечно же, моей маме —  <br/> <br/>с любовью и благодарностью за поддержку <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/><br/>  <br/> <br/> <br/> <br/> <br/> <br/> <br/>От автора <br/> <br/>Уважаемый читатель! <br/>Автор не ставил перед собой задачу создать исчерпывающую энциклопедию или <br/>настольный справочник. Вы держите в руках руководство для новичков, назначе-<br/>ние которого — помочь вам построить свой первый квадрокоптер, обойдясь без <br/>нелепых технических ошибок и чрезмерных денежных затрат. Интеллектуальная <br/>цена вхождения в это сложное хобби весьма высока. Автор постарался сберечь для <br/>вас главную ценность — время. <br/>В книге плотно переплетаются теория и практика, иначе в авиамоделизме нельзя. <br/>Материал не обязательно читать по порядку. Обращайтесь к нужным главам и раз-<br/>делам по мере работы над своей конструкцией. Рекомендуем, прежде всего, озна-<br/>комиться с общими принципами работы квадрокоптера и определиться с набором <br/>компонентов, которые необходимо приобрести. Поскольку наиболее выгодный <br/>путь для покупки компонентов — это заказ в интернет-магазинах, то с момента за-<br/>каза до получения может пройти несколько недель. Пока заказанные компоненты <br/>находятся в пути, вы можете более подробно изучить теорию и установить на ком-<br/>пьютер необходимое программное обеспечение. <br/>Это важно: автору пришлось пойти на сознательные упрощения и сокращения не-<br/>которых сегментов информации, чтобы сделать ее более доступной. Далее вы само-<br/>стоятельно будете развиваться в наиболее интересном для вас направлении: видео-<br/>съемка, FPV, развлекательные полеты, маршрутные полеты по GPS и т. д. Все, <br/>о чем вы прочтете, проработано и проверено автором на практике. <br/>Подбор компонентов и программного обеспечения для первого квадрокоптера ос-<br/>нован на опыте тысяч ваших предшественников из разных стран и означает лишь, <br/>что собранный по нашим рекомендациям аппарат будет недорогим, надежным, <br/>простым в управлении и полетит сразу после окончания сборки. Зачастую выбор <br/>компонентов и программного обеспечения является поводом для ожесточенных <br/>"религиозных войн" на форумах. Пока воздержитесь от участия в них и не воспри-<br/>нимайте слишком серьезно противоречивые мнения сторон. <br/> <br/><br/>  <br/> <br/> <br/> <br/> <br/>ЧАСТЬ I <br/> <br/> <br/> <br/>ТЕОРИЯ <br/>Глава 1. Принцип работы квадрокоптера <br/>Глава 2. Обязательные компоненты квадрокоптера <br/>Глава 3. Дополнительные компоненты квадрокоптера <br/>  <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/><br/>  <br/> <br/> <br/>ГЛАВА 1 <br/> <br/> <br/> <br/>   <br/> <br/>Принцип работы квадрокоптера <br/> <br/>Квадрокоптеры, которым посвящена эта книга, являются частным случаем мульти-<br/>коптеров — многороторных устройств, которые держатся в воздухе, управляются <br/>и перемещаются только за счет несущих пропеллеров. В этом мультикоптеры  <br/>схожи с вертолетами. Для простоты и краткости в обиходной речи мультикоптеры <br/>часто называют просто коптерами. Мы тоже будем использовать этот термин <br/>в случаях, когда количество роторов не играет роли. <br/>Классический квадрокоптер представляет собой крестообразную раму, на концах <br/>лучей которой вертикально закреплены моторы (рис. 1.1). <br/> <br/>Рис. 1.1. Схема конструкции простейшего квадрокоптера <br/>Воздушные винты, расположенные на диагональных лучах рамы, создают суммар-<br/>ную вертикальную тягу. Синхронно регулируя обороты моторов, можно заставить <br/>квадрокоптер подниматься вверх, зависать или опускаться. Если изменить обороты <br/>моторов неравномерно, то квадрокоптер отклонится от горизонтального положения <br/>и полетит в сторону отклонения. Например, при увеличении оборотов двух задних <br/>моторов его задняя часть приподнимется и квадрокоптер полетит вперед. За счет <br/>неравномерного изменения оборотов всех моторов квадрокоптер способен лететь <br/>в произвольном направлении. <br/><br/>16 Часть I. Теория <br/>Очевидно, что при наклоне рамы за счет появления горизонтальной составляющей <br/>вектора тяги V уменьшится вертикальная составляющая V и квадрокоптер начнет <br/>x y<br/>терять высоту. Это явление иногда называют "соскальзыванием", потому что коп-<br/>тер начинает двигаться вниз по диагональной траектории (рис. 1.2), словно скользя <br/>по склону. Поэтому для поддержания высоты при наклоне квадрокоптера обороты <br/>всех моторов должны возрасти на некую одинаковую компенсирующую величину. <br/> <br/>Рис. 1.2. Векторы тяги квадрокоптера <br/>Вращающиеся винты создают реактивный крутящий момент, который старается <br/>развернуть квадрокоптер в сторону, противоположную вращению винта. Поэтому  <br/>в квадрокоптере два винта вращаются по часовой стрелке и два против часовой <br/>стрелки, взаимно уравновешивая реактивные моменты. Если увеличить обороты <br/>моторов, вращающихся по часовой стрелке, и в равной мере уменьшить обороты  <br/>у вращающихся против часовой стрелки, то суммарная вертикальная тяга не изме-<br/>нится, однако реактивный момент раскомпенсируется и рама начнет поворачивать-<br/>ся против часовой стрелки. Аналогично можно заставить квадрокоптер поворачи-<br/>ваться по часовой стрелке. <br/>Угловые отклонения по осям следовало бы называть "тангаж", "крен" и "рыскание", <br/>но на практике прижились англоязычные термины, которые читателю следует за-<br/>помнить: Pitch (наклон вперед-назад), Roll (наклон вправо-влево), Yaw (вращение <br/>в горизонтальной плоскости) и Throttle (общий газ) — рис. 1.3. <br/>Оборотами моторов в режиме реального времени управляет специальная вычисли-<br/>тельная система на основе достаточно быстродействующего микроконтроллера, так <br/>называемый полетный контроллер. Он постоянно опрашивает встроенные гиро-<br/>скопы, акселерометры, барометр, сигналы от приемника радиоуправления и на  <br/>основе полученных данных рассчитывает управляющие сигналы для каждого мо-<br/>тора в отдельности. <br/>Теперь, когда мы рассмотрели общие принципы работы квадрокоптера, можно про-<br/>анализировать достоинства и недостатки этого типа летательных аппаратов. <br/><br/>Глава 1. Принцип работы квадрокоптера 17 <br/> <br/>Рис. 1.3. Соответствие отклонений коптера рычагам на пульте <br/>Достоинства. <br/>� Простота конструкции и низкая стоимость ущерба при аварии. <br/>Как мы уже говорили, квадрокоптеры держатся в воздухе только за счет несу-<br/>щих пропеллеров и этим похожи на вертолет. Однако полноценная модель вер-<br/>толета имеет весьма сложную и точную механическую часть — автомат переко-<br/>са, позволяющий управлять положением вертолета в пространстве. Кроме этого, <br/>вертолет оснащен механизмом отбора мощности на хвостовой винт и узлом пе-<br/>ременного шага этого винта. Только простые и дешевые маленькие модели вер-<br/>толетов не имеют автомата перекоса, но и управляются они намного хуже. По <br/>сравнению с вертолетом механическая часть даже у большого профессиональ- <br/>ного квадрокоптера предельно проста и не зависит от размеров модели. Это  <br/>жестко закрепленные на лучах рамы моторы, на валы которых надеты воздуш-<br/>ные винты. <br/>Автомат перекоса вертолета требует сложной и длительной регулировки даже <br/>при наличии опыта. Каждая авария вертолета, даже незначительная, как прави-<br/>ло, дорого обходится владельцу (автор убедился в этом на собственном опыте). <br/>Причем в запасе приходится держать широкий ассортимент различных запча-<br/>стей. Самодельный квадрокоптер можно разбить почти полностью и восстано-<br/>вить за один выходной день, пользуясь в основном подручными материалами.  <br/>В запасе достаточно иметь пару запасных валов и подшипников для моторов, <br/>один-два регулятора оборотов, десяток винтов правого и левого вращения и ма-<br/>териал для изготовления лучей рамы. <br/>� Простота управления и обучения. <br/>Несмотря на то, что квадрокоптер, как и вертолет, управляется за счет смещения <br/>вектора тяги, он более стабилен в воздухе (чем крупнее, тем стабильнее). <br/>Управление квадрокоптером интуитивно более понятно и легче осваивается. <br/>Кроме того, благодаря наличию полетного контроллера, правильно собранный и <br/>минимально настроенный квадрокоптер способен висеть в воздухе практически <br/>без участия пилота. <br/>� Простота самостоятельного изготовления. <br/>Если заранее приобрести минимальный набор необходимых компонентов и <br/>иметь обычные инструменты, то изготовить простой, но качественный квадро-<br/><br/>18 Часть I. Теория <br/>коптер можно за один-два выходных дня. При создании рамы можно обойтись <br/>парой кусков фанеры и несколькими деревянными рейками, и это не ухудшит <br/>летные качества устройства. <br/>� Возможности для творчества. <br/>К сожалению, в последнее время радиолюбителям все труднее найти приклад-<br/>ную область для своего хобби. Многое из того, что можно было бы изготовить <br/>своими руками, проще и дешевле купить в готовом виде, с промышленным ка-<br/>чеством. В схожей ситуации сейчас и программисты-любители. Писать люби-<br/>тельские прикладные программы стало либо слишком сложно, либо незачем. <br/>Квадрокоптеры придают новый смысл многим увлечениям. Можно участвовать <br/>в разработке открытого программного обеспечения или создавать свое; разраба-<br/>тывать с нуля и изготавливать на самодельном станке с ЧПУ сложные детали <br/>конструкции; экспериментировать с аэровидеосъемкой или работать паяльни-<br/>ком. Менять и развивать конструкцию самодельного квадрокоптера можно <br/>практически бесконечно. <br/>Недостатки. <br/>� Полное отсутствие летучести. <br/>Квадрокоптер хорошо летает, только пока полностью исправен. Стоит выйти из <br/>строя одному из моторов или полетному контроллеру, как летательный аппарат <br/>потеряет управление и рухнет, беспорядочно кувыркаясь. В аналогичной ситуа-<br/>ции вертолет способен к авторотации, т. е. тормозит падение за счет вращения <br/>несущего винта набегающим потоком воздуха, а самолет способен планировать. <br/>Даже наличие шести или восьми несущих винтов не спасает мультикоптеры от <br/>крушения. Некоторым опытным пилотам удавалось спасти гекса- и октакоптеры <br/>при отказе одного из моторов, но это исключение из правила. <br/>� Высокий порог знаний. <br/>Можно купить готовый квадрокоптер и запускать его, не задумываясь, как он <br/>работает. Но если вы решили сами строить квадрокоптер или модернизировать <br/>покупной, то придется хотя бы на начальном уровне научиться понимать радио-<br/>схемы, паять, прошивать микроконтроллеры, читать технические тексты на анг-<br/>лийском языке, разбираться в принципе работы GPS и т. д. <br/>� Низкая динамика и управляемость. <br/>Обратная сторона стабильности квадрокоптеров — вялость и инерционность  <br/>в управлении. Особенно вяло квадрокоптеры управляются по курсу (Yaw). По-<br/>этому на квадрокоптере невозможно исполнить традиционные фигуры высшего <br/>пилотажа самолетов или инверсный полет, как на модели вертолета. Впрочем, <br/>при наличии опыта на коптере можно эффектно исполнить переворот или про-<br/>лет по кругу с вращением вокруг оси. Но здесь надо понимать, что каждый лета-<br/>тельный аппарат хорош для своих целей, и вялость в управлении вряд ли являет-<br/>ся недостатком, когда речь идет о полетах по камере, видеосъемке или развлече-<br/>нии в выходной день. Для динамичных полетов имеет смысл приобрести или <br/>построить модель спортивного самолета, у которой, кстати, тоже будут специ-<br/>фичные недостатки. <br/><br/>  <br/> <br/> <br/>ГЛАВА 2 <br/> <br/> <br/> <br/>   <br/> <br/>Обязательные компоненты <br/>квадрокоптера <br/>Компоненты квадрокоптера можно условно разделить на две группы: основные, без <br/>которых эксплуатация устройства невозможна или опасна, и дополнительные, на-<br/>личие которых зависит от потребностей владельца. В этой главе мы рассмотрим <br/>основные компоненты. <br/>Рама <br/>На рис. 2.1 изображены основные варианты конструкции рамы. На практике воз-<br/>можны различные вариации и гибриды, но в любом случае рама состоит из лучей и, <br/>в большинстве случаев, центральной несущей части. Иногда встречаются рамы, <br/>состоящие только из трубчатых деталей, а также миниатюрные рамы, изготовлен-<br/>ные из листового текстолита, одновременно являющегося печатной платой для <br/>электронных компонентов. Моторы всегда крепятся на концах лучей. Основным <br/>показателем размера квадрокоптера является расстояние между осями моторов по <br/>диагонали. <br/>По расположению моторов относительно направления полета выделяют два основ-<br/>ных типа рам: "+" и "Х". Подвидом рамы типа "X" является рама типа "H". <br/>Наиболее популярны рамы типа "Х". Очевидное преимущество такой рамы — <br/>удобное расположение видеокамеры, когда лучи рамы не попадают в кадр. У рамы <br/>типа "Х" более высокая устойчивость к мелким авариям. Наиболее частой аварией, <br/>особенно в период обучения, является цепляние земли при быстром наклонном <br/>пролете или "заруливании", либо падение под углом. В случае "+"-образной рамы <br/>весь удар чаще приходится на один луч, который сильно страдает, тогда как при <br/>распределении удара на два луча ущерб обычно ограничивается сломанными про-<br/>пеллерами. Кроме того, большинству пилотов психологически комфортнее управ-<br/>лять именно типом "Х". В свою очередь, квадрокоптер с рамой типа "+" несколько <br/>быстрее и острее реагирует на команды "вправо-влево" и "вперед-назад", поэтому <br/>больше подходит любителям динамичного пилотирования. <br/>Рама типа "H" удобна при построении миниатюрных коптеров, а также полнораз-<br/>мерных конструкций из карбоновых трубок и часто используется при построении <br/><br/>20 Часть I. Теория <br/>специализированных коптеров для видеосъемки и полетов по GPS, т. к. предостав-<br/>ляет больше места для монтажа оборудования. <br/>Необходимо подчеркнуть, что для полетных контроллеров, с точки зрения системы <br/>стабилизации полета, конструкция рамы вообще не имеет значения. Достаточно <br/>лишь указать в настройках тип рамы и угол, под которым смонтирована плата кон-<br/>троллера относительно направления полета. <br/> <br/>Рис. 2.1. Варианты конструкции рамы квадрокоптера <br/>Рама, которую мы условно обозначили "Quad Xv", имеет несимметричные лучи. <br/>Такая рама часто используется при фото- и видеосъемке с воздуха. Дело в том, что <br/>для любого квадрокоптера должно соблюдаться условие симметрии по весу. Иначе <br/>говоря, центр тяжести конструкции должен находиться в точке пересечения <br/>диагоналей квадрата, образованного осями моторов. Если вы крепите в передней <br/>части рамы тяжелую фото- или видеокамеру, то удлиненные задние лучи играют <br/>роль противовеса. Однако и в этом случае моторы, как правило, расположены по <br/>диагоналям воображаемого квадрата. <br/>Что будет, если центр тяжести смещен? Разумеется, полетный контроллер постара-<br/>ется поддерживать раму в строго горизонтальном положении за счет различия  <br/>в оборотах моторов. Если дисбаланс невелик, то в статичном режиме, без внешних <br/>воздействий, квадрокоптер достаточно долго будет висеть ровно. Но при этом мо-<br/>торы будут работать в разных режимах нагрузки. У более нагруженных моторов <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 21 <br/>останется меньший динамический запас оборотов и мощности, чтобы отработать <br/>"команды" полетного контроллера на компенсацию порывов ветра или управляю-<br/>щие сигналы с пульта. В результате появится некомпенсированное отклонение от <br/>горизонтали и квадрокоптер начнет дрейфовать в сторону смещенного центра тя-<br/>жести. Подготовленные пользователи могут применить специальные настройки <br/>программы контроллера для компенсации негативного эффекта от смещенного <br/>центра тяжести, но в общем случае асимметрии следует избегать. <br/>Даже если рама полностью симметрична, у квадрокоптера всегда есть условное на-<br/>правление "вперед", в котором он по умолчанию полетит при отклонении рукоятки <br/>пульта по оси Pitch вперед. Это направление привязано к полетному контроллеру, <br/>который монтируется на раме в строго определенном положении. <br/>Рама может быть как со складными, так и с фиксированными лучами. На летные <br/>качества это не влияет, при выборе конструкции нужно исходить из соображений <br/>простоты изготовления, стоимости, удобства транспортировки, при условии со-<br/>блюдения достаточной прочности. Рамы миниатюрных "наладонных" квадрокопте-<br/>ров иногда представляют собой единое целое с печатной платой полетного кон-<br/>троллера и целиком изготавливаются из текстолита. <br/>Поскольку в случае квадрокоптеров аэродинамика корпуса или рамы не имеет зна-<br/>чения, на первый план выходят противоречивые требования минимального веса и <br/>максимальной прочности. Наиболее прочными и легкими являются цельноформо-<br/>ванные пустотелые рамы из карбона, так называемые "скорлупки" или "корки", но <br/>они и самые дорогие. На втором месте рамы, детали которых изготовлены из лис-<br/>тового карбона и карбоновых трубок. Далее идут рамы из всевозможных сочетаний <br/>различных материалов, включая сосновые рейки и фанеру. Обсуждению конструк-<br/>ционных материалов будет посвящен отдельный раздел, а сейчас настало время <br/>поговорить про "мозг" квадрокоптера. <br/>Полетный контроллер <br/>Зачем вообще нужен специальный полетный контроллер — вычислительная систе-<br/>ма, работающая в реальном времени по довольно сложным алгоритмам? Очевидно, <br/>что квадрокоптер необходимо непрерывно стабилизировать, парируя порывы ветра <br/>и неоднородность воздушных масс, а возможностей человеческого организма для <br/>этого недостаточно. Современный полетный контроллер оснащен набором миниа-<br/>тюрных интегральных сенсоров, непрерывно отслеживающих положение рамы  <br/>в пространстве, воздействующие на нее угловые ускорения, атмосферное давление <br/>и направление силовых линий магнитного поля. <br/>Классическим устройством для стабилизации объекта в пространстве либо измере-<br/>ния угловых ускорений является гироскоп. Все мы из школьных уроков физики <br/>знаем про механический гироскоп-волчок либо про вращающийся в свободном <br/>подвесе маховик. При попытке изменить угловое положение оси вращающегося <br/>маховика возникает противодействующая сила. В трехмерном пространстве произ-<br/>вольное изменение положения рамы квадрокоптера можно разложить на вращение <br/><br/>22 Часть I. Теория <br/>по трем взаимно ортогональным осям. Соответственно, возникают мгновенные  <br/>угловые ускорения по каждой из этих осей. Эти ускорения могут быть измерены и <br/>использованы для выработки компенсирующей реакции в системе с обратной  <br/>связью, которой в нашем случае является квадрокоптер, оснащенный полетным <br/>контроллером. <br/>Современные датчики положения и ускорений представляют собой интегральные <br/>микросхемы размерами в несколько миллиметров. Внутри у них находится сложная <br/>электромеханическая структура из упругих подвесов, грузиков, пружин, конденса-<br/>торов и электронной части для усиления и обработки сигналов. Такие устройства <br/>принято обозначать аббревиатурой МЭМС (MEMS — MicroElectroMechanical <br/>System). <br/>Принцип работы интегрального гироскопа <br/>Чувствительным элементом интегрального гироскопа обычно являются два миниа-<br/>тюрных грузика, колеблющихся на упругом подвесе в противоположных направле-<br/>ниях (рис. 2.2). Источником колебаний грузиков являются гребенчатые электроста-<br/>тические двигатели. Грузики, вместе с электродами, расположенными на подложке, <br/>образуют конденсаторы, входящие в состав дифференциальной схемы, вырабаты-<br/>вающей сигнал, пропорциональный разности емкостей конденсаторов. Линейное <br/>ускорение одинаково воздействует на оба грузика и подложку, поэтому сигнал на <br/>выходе дифференциальной схемы не появляется. Когда возникает вращательное <br/>ускорение по оси ω, то на грузики начинает действовать сила Кориолиса FC, от-<br/>клоняя грузики в противоположных направлениях. Соответственно, емкость одного <br/>конденсатора увеличивается, а другого уменьшается, что порождает разностный <br/>сигнал, пропорциональный величине углового ускорения. Изначально, при вклю-<br/>чении, разностный сигнал на выходе гироскопа не нулевой, поэтому требуется <br/>процедура стартовой калибровки, когда микроконтроллер опрашивает показания <br/>гироскопов в состоянии покоя и принимает их за нулевые. Во время прохождения <br/>калибровки нельзя двигать коптер. <br/>Но почему в конструкции квадрокоптера нельзя обойтись простейшей системой <br/>стабилизации на основе гироскопов, по одному на каждую ось вращения? Зачем  <br/> <br/> <br/> <br/>Рис. 2.2. Устройство интегрального гироскопа <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 23 <br/>нужны другие датчики и микроконтроллер со сложной программой? В реальных <br/>условиях квадрокоптер не отклоняется идеально лишь по одной оси. В общем слу-<br/>чае отклонение комбинированное, с неким соотношением между осями. По этой <br/>причине необходимо устройство, которое будет обрабатывать сигналы от всех ги-<br/>роскопов и формировать управляющие сигналы для регуляторов оборотов моторов. <br/>Например, под влиянием случайного порыва ветра квадрокоптер отклонился по <br/>диагонали назад вправо. Значит, управляющая система должна увеличить обороты <br/>правого заднего мотора и уменьшить левого переднего, отклоняя раму вперед вле-<br/>во. Но моторы, регуляторы и пропеллеры не идеально одинаковые, и команду они <br/>отработают по-разному. Возникнет нескомпенсированный реактивный крутящий <br/>момент. Следовательно, одновременно с выравниванием квадрокоптера в горизонт <br/>полетный контроллер должен оперативно внести коррективы в обороты другой па-<br/>ры моторов, чтобы скомпенсировать вращение по курсу. И это самый простой при-<br/>мер, в котором мы не учитываем, что в то же самое время с пульта могут поступать <br/>сигналы управления. Впрочем, с вычислительной задачей для системы с тремя ги-<br/>роскопами способен справиться недорогой микроконтроллер начального уровня. <br/>Сейчас по такому принципу устроены простые игрушечные квадрокоптеры-"НЛО". <br/>Такие игрушки неплохо летают в помещении, но для управления ими необходимо <br/>постоянно визуально контролировать, в каком положении находится квадрокоптер. <br/>Напомним, что интегральный гироскоп — это всего лишь датчик углового ускоре-<br/>ния. Для него нет понятия "верх" или "низ", и ему безразлично, в каком статиче-<br/>ском положении относительно горизонта он находится. Он лишь показывает мгно-<br/>венное угловое ускорение относительно начального положения. Как только внеш-<br/>нее воздействие начнет поворачивать раму квадрокоптера вокруг одной из осей, то <br/>от соответствующего гироскопа немедленно поступит сигнал на процессор полет-<br/>ного контроллера. В ответ контроллер скорректирует обороты моторов так, чтобы <br/>скомпенсировать ускорение. Но как только внешнее воздействие прекратится,  <br/>угловое ускорение станет равным нулю, и на основании сигналов одних лишь гиро-<br/>скопов контроллер не узнает, вернулся ли квадрокоптер в исходное положение. Это <br/>задача оператора, которую он может решать только при визуальном контроле. <br/>А теперь представьте, что вы командой с пульта отклонили квадрокоптер на пять <br/>градусов вправо, а затем вернули рукоятку пульта в нейтральное положение. В со-<br/>ответствии с сигналом пульта контроллер сделает обороты всех моторов одинако-<br/>выми, но это вовсе не означает, что квадрокоптер вернется в горизонтальное поло-<br/>жение. Гироскопам имеющийся статический наклон будет безразличен. Нет угло-<br/>вого ускорения — на выходе гироскопа нулевое значение. Кроме того, гироскоп <br/>имеет ограниченную чувствительность: медленное вращение он просто не заметит. <br/>При гироскопической стабилизации оператор должен выровнять коптер вручную. <br/>На практике, квадрокоптер, оснащенный только гироскопами, не может стабильно <br/>висеть более минуты даже в помещении. Далее нужно вручную парировать его <br/>дрейф. Свое влияние на показания гироскопов оказывают изменение температуры <br/>корпуса и угловые ускорения, возникающие при вращении Земли. <br/>Следовательно, для более продвинутой конструкции полетного контроллера необ-<br/>ходим датчик, показывающий положение квадрокоптера относительно земной по-<br/><br/>24 Часть I. Теория <br/>верхности (если точнее, то относительно вектора ускорения свободного падения, <br/>который всегда направлен перпендикулярно земной поверхности, к центру Земли). <br/>Такой датчик есть в каждом современном смартфоне или планшете и называется <br/>акселерометром. <br/>Принцип работы интегрального акселерометра <br/>Акселерометр — это МEМС-устройство, которое измеряет линейные ускорения.  <br/>В состав интегрального акселерометра входят чувствительный элемент и электрон-<br/>ная часть, осуществляющая предварительную обработку сигнала. <br/>В очень упрощенном виде чувствительный элемент представляет собой токопрово-<br/>дящий грузик на гибком подвесе, помещенный между двумя электродами (рис. 2.3). <br/> <br/>Рис. 2.3. Устройство чувствительного элемента акселерометра  <br/>и его эквивалентная электрическая схема <br/>Грузик и электроды образуют два конденсатора. При смещении грузика под дейст-<br/>вием ускорения емкость одного конденсатора уменьшается, а другого увеличивает-<br/>ся. Так как заряд конденсаторов постоянен, то изменяется напряжение на выводах <br/>конденсаторов. Это изменение измеряется встроенной электронной схемой, резуль-<br/>тат измерения в цифровом виде выдается в ответ на запрос внешнего вычислитель-<br/>ного устройства. Результат может быть как положительным, так и отрицательным <br/>в зависимости от направления вектора ускорения. <br/>Реальный сенсор акселерометра устроен значительно сложнее, в нем детали конст-<br/>рукции выполняют несколько функций одновременно. Но для понимания принципа <br/>работы упрощенной схемы достаточно. <br/>Все современные интегральные акселерометры, как правило, трехосевые. Три сен-<br/>сора расположены внутри одного корпуса микросхемы перпендикулярно осям x, y  <br/>и z. Вектор действующего на устройство ускорения вычисляется микроконтролле-<br/>ром через проекции вектора на три оси. Даже если устройство находится в покое, <br/>�<br/>на него действует ускорение свободного падения g. Вектор g направлен верти-<br/>кально вниз, к центру Земли. Если корпус акселерометра расположен строго гори-<br/>зонтально, то вектор земного тяготения совпадает с осью z и ускорение действует <br/>только на один сенсор. Но стоит наклонить акселерометр, как появятся составляю-<br/>�<br/>щие вектора g по осям x и y, а составляющая по оси z пропорционально умень-<br/>шится. На основании величин проекций вектора земного тяготения на оси и их зна-<br/><br/>Глава 2. Обязательные компоненты квадрокоптера 25 <br/>ка микроконтроллер вычисляет наклон квадрокоптера. Именно по такому принципу <br/>ваш смартфон или планшет определяет ориентацию экрана. <br/>Поскольку датчики акселерометра не идеально одинаковые и печатная плата может <br/>быть смонтирована не идеально ровно, перед началом эксплуатации акселерометр <br/>необходимо откалибровать: поместить устройство строго горизонтально и сооб-<br/>щить бортовому контроллеру, что текущие показания акселерометра соответствуют <br/>горизонтали. Соответствующие корректировочные константы записываются во <br/>встроенную память микроконтроллера. В этом состоит различие между процедура-<br/>ми калибровки гироскопа и акселерометра: гироскоп калибруют после каждого <br/>включения питания, а также при длительном перерыве между взлетами, а акселе-<br/>рометр однократно, после окончания сборки коптера. После смены версии прошив-<br/>ки контроллера или изменения конструкции квадрокоптера акселерометр необхо-<br/>димо откалибровать заново! <br/>Существенным недостатком MEMS-акселерометров является высокая чувстви-<br/>тельность к вибрациям. Но вибрации — неизменный спутник винтокрылых аппара-<br/>тов, поэтому необходимо принимать специальные меры по виброизоляции, а также <br/>балансировке воздушных винтов и моторов. <br/>Именно появление доступных по цене трехосевых акселерометров определило <br/>взрывной рост популярности квадрокоптеров. Еще несколько лет назад акселеро-<br/>метры были, в основном, двухосевыми, а трехосевые стоили весьма дорого и были <br/>редкостью. С появлением игровой приставки Nintendo Wii и игровых манипулято-<br/>ров WiiMotionPlus и Nunchak ситуация кардинально изменилась. Малогабаритные <br/>трехосевые интегральные акселерометры и гироскопы стали доступны по вполне <br/>разумным ценам. Первые энтузиасты покупали платы манипуляторов Nintendo и <br/>подключали их к вычислителю на основе модуля Arduino. Затем к процессу под-<br/>ключились китайские производители, начавшие массовое производство полетных <br/>контроллеров с полным наборов сенсоров "на борту". Отсюда исторически проис-<br/>ходит название одной из самых популярных открытых прошивок MultiWii и платы <br/>контроллера MultiWii All-In-One (MWI AIOP). <br/>Благодаря тому, что акселерометр определяет положение квадрокоптера относи-<br/>тельно горизонтали, становится возможным автоматическое выравнивание устрой-<br/>ства (автогоризонт). Как только ручки управления на пульте вернулись в нейтраль-<br/>ное положение, полетный контроллер воспринимает это как команду выровнять <br/>квадрокоптер в горизонтальное положение, которое вы задали при калибровке. <br/>Есть и другие положительные моменты в использовании акселерометра. Предпо-<br/>ложим, командой с пульта мы наклонили квадрокоптер для полета вперед. Чтобы <br/>компенсировать уменьшение вертикальной тяги, необходимо равномерно увели-<br/>чить обороты всех моторов пропорционально наклону. При отсутствии акселеро-<br/>метров можно приблизительно вычислить наклон квадрокоптера через угловое  <br/>ускорение, его продолжительность и величину управляющего сигнала с пульта. Но <br/>проще и точнее угол наклона вычисляется по данным с акселерометров. <br/>Разумеется, акселерометры измеряют не только ускорение свободного падения, но <br/>и линейные ускорения по любой из осей при движении квадрокоптера. В ряде слу-<br/>чаев эта информация тоже бывает полезна. <br/><br/>26 Часть I. Теория <br/>С другой стороны, когда надо быстро определить скорость и знак углового ускоре-<br/>ния, проще использовать гироскоп, который так же выдает эти данные более точно <br/>и в готовом виде. Таким образом, каждый сенсор хорош для своей задачи. В совре-<br/>менных MEMS-микросхемах трехосевые гироскопы и трехосевые акселерометры <br/>часто объединяют в одном корпусе с размерами около 3×3×1 мм. В этом же корпу-<br/>се находится электронная схема для предварительной цифровой обработки данных, <br/>2<br/>с внешним протоколом обмена SPI или I C. <br/>Чтобы определить курсовое направление рамы квадрокоптера, нужен еще один <br/>датчик — интегральный компас, или магнитометр. Квадрокоптер может лететь <br/>как угодно, вбок, назад, или по диагонали, поэтому "вперед" в нашем случае — это <br/>условное направление рамы и контроллера, относительно которого определяется <br/>фактическое направление полета. На плате контроллера направление "вперед" <br/>обычно обозначается стрелкой. <br/> <br/>Принцип работы интегрального магнитометра <br/>(компаса) <br/>В основе конструкции интегрального магнитометра (рис. 2.4) лежит анизотропный <br/>магниторезистивный эффект. Чувствительный элемент изготавливается из пермал-<br/>лоевой пленки, способной изменять свое сопротивление в зависимости от направ-<br/>ления протекающего через нее тока и направления вектора ее намагниченности.  <br/>В свою очередь, вектор намагниченности пленки определяется направлением сило-<br/>вых линий магнитного поля, в котором находится чувствительный элемент. <br/> <br/> <br/>Рис. 2.4. Устройство интегрального магнитометра <br/> <br/>Четыре пермаллоевых элемента соединяются в измерительный мост (см. рис. 2.4). <br/>При подаче постоянного напряжения на мост датчик начинает измерять интенсив-<br/>ность внешнего магнитного поля, направленного вдоль его чувствительной оси. <br/>Мостовой датчик имеет ось предпочтительного намагничивания, так называемую <br/>легкую ось, и наиболее чувствителен к полям, направленным перпендикулярно <br/>этой оси. В квадрокоптерах применяются трехосевые интегральные магнитометры, <br/>состоящие из трех независимых датчиков, ориентированных по трем ортогональ-<br/>ным осям и электронной схемы. В спецификации магнитометра всегда указывают <br/>направление осей относительно корпуса (рис. 2.5). <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 27 <br/> <br/>Рис. 2.5. Магнитометр HMC5883L на плате расширения <br/>Магнитометры не подвержены вибрации, но на их показания влияют внешние <br/>близко расположенные металлические предметы. Помехи можно разделить на три <br/>основных класса. <br/>� "Искажения твердого железа" (Hard Iron Distortion) — к магнитному полю земли <br/>добавляется постоянное магнитное поле от намагниченных предметов, например <br/>магнита звукоизлучателя. Намагниченными могут быть даже выводы радиоде-<br/>талей, изготовленные из луженого железа. Эта постоянная составляющая может <br/>быть исключена при калибровке. <br/>� "Искажения мягкого железа" (Soft Iron Distortion) — магнитное поле искажается <br/>посторонними предметами, не имеющими собственной намагниченности. На-<br/>пример, сплавы никеля, пермаллой искажают силовые линии поля. Такие иска-<br/>жения зависят от положения объекта в пространстве и труднее компенсируются. <br/>К счастью, в конструкции квадрокоптера обычно не бывает таких предметов. <br/>Детали из сплавов алюминия и меди не вносят искажения. <br/>� Динамические или вихревые помехи. Это специфическая особенность электри-<br/>ческих летательных аппаратов, особенно коптеров. Мощные токи, протекающие <br/>через проводники силовых цепей и батарею, порождают магнитные поля в ок-<br/>ружающем пространстве. Причем напряженность этих полей постоянно меняет-<br/>ся в зависимости от нагрузки на моторы. <br/>Иногда магнитные помехи настолько сильны, что делают невозможным использо-<br/>вание компаса и даже способны привести к аварии. К сожалению, переменные маг-<br/>нитные поля невозможно скомпенсировать программно и приходится применять <br/>специальные конструктивные меры. Для уменьшения наводок микросхему компаса <br/>стараются выносить с платы контроллера и поднимать вверх на 10–20 см над ра-<br/>мой. При укладке силовых проводов следует избегать образования петель, все про-<br/>вода должны иметь минимальную длину. Силовые провода рекомендуется пере-<br/>кручивать. Впрочем, в квадрокоптерах начального уровня вполне можно обходить-<br/>ся без компаса и при наличии магнитных помех просто отключать его в настройках. <br/><br/>28 Часть I. Теория <br/>Малогабаритные контроллеры, предназначенные для полетов внутри помещения, <br/>по очевидной причине компас не содержат. <br/>Перед началом полетов магнитометр необходимо откалибровать, проведя процеду-<br/>ру вращения коптера по всем осям. Детали этой процедуры могут зависеть от при-<br/>меняемой прошивки контроллера. <br/>Благодаря наличию компаса возможен интересный режим полета, именуемый <br/>Headfree. В этом режиме фиксируется курсовое положение квадрокоптера в момент <br/>активации моторов. Если в процессе полета развернуть раму квадрокоптера по <br/>Yaw, то условное направление "вперед", зафиксированное при взлете, не изменит-<br/>ся. При наклоне правого стика пульта вперед квадрокоптер всегда будет лететь <br/>вперед, при наклоне вправо — всегда вправо и т. д., независимо от того, как в дан-<br/>ный момент развернута рама. Считается, что этот режим удобен для начинающего <br/>пилота, а также при полетах на большом удалении, без видеоканала и средств теле-<br/>метрии, когда визуальный контроль над положением рамы затруднен. Если пилот <br/>случайно развернул квадрокоптер, то это не отразится на управлении и поможет <br/>избежать аварии. <br/>Используя компас, при настройке квадрокоптера не забудьте указать такой пара-<br/>метр, как магнитное склонение (не путайте с магнитным наклонением) для своей <br/>местности. Магнитное склонение — это угол между географическим и магнитным <br/>меридианами в точке земной поверхности. Магнитное склонение считается поло-<br/>жительным, если северный конец магнитной стрелки компаса отклонен к востоку <br/>от географического меридиана, и отрицательным — если к западу. Значение маг-<br/>нитного склонения используется для определения истинного меридиана по показа-<br/>нию магнитного компаса. Узнать значение магнитного склонения для своей мест-<br/>ности можно на сайте www.magnetic-declination.com или http://www.ngdc. <br/>noaa.gov/geomag-web/. Обратите внимание, что сервисы дают значение в градусах <br/>и минутах, но при настройке компаса используется значение в градусах и десятич-<br/>ных долях градуса. <br/>Остался еще один важный параметр полета — высота. Стабилизация высоты важна <br/>как для комфортного управления квадрокоптером, так и для безопасного полета, <br/>особенно в режиме автоматического возврата к точке старта по GPS. Для измере-<br/>ния высоты в квадрокоптерах используют либо интегральный барометр, либо <br/>внешний ультразвуковой сонар, либо оба устройства сразу. Поскольку они оба вы-<br/>полняют одинаковую задачу, мы немного забежим вперед и рассмотрим достоинст-<br/>ва и недостатки ультразвукового сонара в этой главе, хоть сонар и является допол-<br/>нительным оборудованием. <br/>Устройство интегрального барометра <br/>Измерение высоты полета барометрическим методом основано на зависимости ат-<br/>мосферного давления от высоты. Чем больше высота, тем ниже атмосферное дав-<br/>ление. В миниатюрных интегральных барометрах применяется, как правило, тензо-<br/>резисторный либо пьезорезонансный датчик. В первом случае чувствительным <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 29 <br/>элементом является тензорезистор (рис. 2.6), изменяющий свое сопротивление  <br/>в зависимости от степени деформации под воздействием атмосферного давления. <br/>Во втором случае на пьезоэлемент подают переменное электрическое напряжение, <br/>заставляя его колебаться под действием обратного пьезоэффекта. Собственная ре-<br/>зонансная частота элемента, при которой напряжение на электродах пьезоэлемента <br/>максимально, зависит от степени деформации элемента. <br/> <br/> <br/>Рис. 2.6. Устройство тензорезисторного датчика атмосферного давления <br/>Существенным недостатком этих датчиков является выраженная зависимость ре-<br/>зультатов измерения от температуры окружающей среды и большой разброс вы-<br/>ходных данных между экземплярами. Для термокомпенсации внутрь корпуса <br/>встраивают терморезистор и при измерениях учитывают его сопротивление в каче-<br/>стве компенсирующего параметра. Для устранения конструктивной неоднородно-<br/>сти каждый экземпляр интегрального барометра калибруют на заводе, записывая <br/>в его память калибровочные константы. <br/>На выходе барометра мы получаем не абсолютное значение давления, а некое "сы-<br/>рое" значение, из которого давление рассчитывается путем вычислений с плаваю-<br/>щей точкой, учитывая калибровочные константы и текущую температуру корпуса. <br/>Формулы для расчетов приводятся в спецификации микросхемы. <br/>Применительно к квадрокоптерам, нас обычно интересует не высота над уровнем <br/>моря, а высота относительно точки взлета. Поэтому в момент активации моторов <br/>перед взлетом текущее давление воздуха принимается соответствующим нулевой <br/>высоте. К сожалению, даже в течение одного 10-минутного полета атмосферное <br/>давление может измениться настолько сильно, что это будет соответствовать пере-<br/>паду высоты 2–3 м. Особенно это характерно для неустойчивой предгрозовой по- <br/>годы. <br/>Барометр следует защищать от воздействия прямых потоков воздуха. Обычно для <br/>этого используют кусочек крупнопористого поролона, которым прикрывают отвер-<br/>стие сенсора, или помещают полетный контроллер в защитный кожух. Также сле-<br/>дует защищать барометр от попадания прямых солнечных лучей на сенсор через <br/>отверстие в корпусе. Теоретически современные интегральные барометры способ-<br/>ны измерять высоту с точностью в несколько сантиметров, однако когда барометр <br/>смонтирован, на квадрокоптере и рядом с ним несущие винты прокачивают потоки <br/>воздуха, а на это накладываются флуктуации плотности воздушных масс разной <br/>температуры, такую точность реализовать практически невозможно. К вибрациям <br/>барометры не чувствительны. <br/><br/>30 Часть I. Теория <br/>Устройство ультразвукового сонара <br/>Ультразвуковой сонар (датчик расстояния) состоит из генератора ультразвука, из-<br/>лучателя, приемника и усилителя-формирователя выходного сигнала (рис. 2.7). <br/> <br/>Рис. 2.7. Устройство ультразвукового сонара <br/>Простейшие сонары не содержат собственный микроконтроллер и работают под <br/>управлением внешнего устройства. Когда на вход Trigger приходит пусковой им-<br/>пульс, электронная схема сонара генерирует короткий пакет колебаний ультразву-<br/>ковой частоты, поступающий на излучатель. Отразившись от твердой поверхности, <br/>колебания поступают на приемник и далее на усилитель-формирователь, на выходе <br/>которого формируется импульс Echo (эхо) с логическим уровнем. Внешнее устрой-<br/>ство вычисляет расстояние до поверхности через интервал времени между фронта-<br/>ми пускового импульса и эха по формуле <br/>1 ΔT<br/>H=⋅ , <br/>2 v<br/>где v — скорость звука, ∆T — разность времени между фронтами пуска и эха. По-<br/>скольку звук дважды проходит расстояние H, мы берем 1/2 вычисленного значения. <br/>Более сложные сонары содержат встроенный контроллер, самостоятельно выпол-<br/>няют процесс измерения, производят фильтрацию и усреднение результатов изме-<br/>2<br/>рения и выдают готовое значение расстояния по протоколу I C или SPI. <br/>Как барометр, так и сонар обладают специфическими недостатками. При полете на <br/>малой высоте квадрокоптер создает не только эффект воздушной подушки, но и <br/>зону завихрений и нестабильного давления вокруг себя. Чем крупнее квадрокоптер, <br/>тем заметнее этот эффект. Как показывает опыт, барометр квадрокоптера среднего <br/>размера начинает работать стабильно на высоте более пяти диагоналей рамы, т. е. <br/>более 2 м от земной поверхности. <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 31 <br/>Популярные ультразвуковые сонары измеряют дистанцию с точностью до одного-<br/>двух сантиметров, но работают на очень ограниченном расстоянии до отражающей <br/>поверхности, как правило, не более 3–4 м. Сонарам безразличны потоки воздуха, но <br/>они крайне чувствительны к качеству отражающей поверхности. Трава, вспаханная <br/>земля, снег, рябь на воде — такие поверхности рассеивают ультразвуковой импульс <br/>либо вносят большие искажения. Поэтому применение сонара оправдано при поле-<br/>тах в закрытых залах, где высота полета как раз соответствует рабочей дальности <br/>сонара, а пол хорошо отражает ультразвук. Нужно также учитывать, что сонар пра-<br/>вильно показывает высоту при горизонтальном положении коптера. Как только ра-<br/>ма наклоняется и импульс ультразвука отражается в сторону под углом к полу, со-<br/>нар становится бесполезен. <br/>В настоящее время даже в открытых прошивках решена проблема стабильного <br/>удержания высоты при помощи комбинации барометра и акселерометра. При <br/>удержании высоты логично предположить, что если показания барометра измени-<br/>лись, но акселерометр не показывает вертикальное ускорение, то наверняка это <br/>флуктуация показаний барометра. На самом деле, алгоритм достаточно сложен, <br/>надо учитывать конечную чувствительность акселерометра и барометра, продол-<br/>жительность и скорость изменения показаний сенсоров, правильно задать весовые <br/>коэффициенты влияния этих сенсоров при расчетах и т. д. Рассуждения на эту тему <br/>выходят за рамки книги, ограничимся лишь констатацией факта, что использование <br/>барометра позволяет в безветренную погоду "подвесить" правильно настроенный <br/>квадрокоптер, и он будет стабильно висеть без участия пилота, дрейфуя по высоте <br/>максимум ±20 см. <br/>Использование сонара оправдано для автоматического включения посадочных ог-<br/>ней при заходе на посадку. Обычно нужно, чтобы подсветка посадочной площадки <br/>включалась на высоте около 2–3 м. Барометр на этой высоте будет иметь большую <br/>погрешность, особенно если во время полета изменилось атмосферное давление, а <br/>точности сонара вполне достаточно для включения огней. <br/>В качестве примера использования полного набора сенсоров рассмотрим плату по-<br/>пулярного полетного контроллера CRIUS All-In-One Pro (AIOP) версия 2 (рис. 2.8). <br/>Микроконтроллер (1) выполняет обработку управляющих сигналов от радиоаппа-<br/>ратуры и показаний сенсоров и формирует управляющие сигналы для регуляторов <br/>оборотов моторов. Наиболее часто применяются микроконтроллеры Atmel, доста-<br/>точно быстродействующие, недорогие и c низким энергопотреблением. Однако в <br/>последнее время, с совершенствованием и усложнением вычислительных алгорит-<br/>мов, разработчики все чаще упираются в ограничения быстродействия процессора <br/>и объема программной памяти. Существуют более мощные решения, например <br/>на ARM-контроллерах от ST Microelectronics, и даже экзотические конструкции на <br/>базе микрокомпьютера Raspberry Pi. <br/>Встроенный стабилизатор напряжения 3,3 В (7) необходим для питания микро-<br/>контроллера и сенсоров. Как правило, источник бортового питания имеет напряже-<br/>ние 5 В, потому что именно это напряжение требуется для питания радиоприемни-<br/>ка и различных дополнительных модулей. <br/><br/>32 Часть I. Теория <br/>Рис. 2.8. Популярный полетный контроллер MultiWii AIOP v.2: <br/>2<br/>1 — микроконтроллер ATMEGA2560; 2 — конвертер логических уровней шины I C PCA9306DP1;  <br/>3 — барометр MS5611; 4 — магнитометр HMC5883L; 5 — гироскоп + акселерометр MPU6050;  <br/>6 — адаптер USB/UART FT232RQ; 7 — стабилизатор +3,3 В; 8 — флеш-память 16Mbit AT45DB161D <br/>Конвертер уровней шины I2C (2) используется для согласования логических <br/>уровней микроконтроллера и внешних устройств, подключенных к шине. Микро-<br/>контроллер питается напряжением 3,3 В и поддерживает соответствующие низко-<br/>вольтные логические уровни на шине. Но некоторые внешние устройства, такие <br/>как модули GPS, выносные компасы, дисплеи, могут питаться напряжением 5 В. <br/>Разница логических уровней между трех- и пятивольтовыми схемами может вывес-<br/>ти из строя микроконтроллер. <br/>Встроенный конвертер USB–UART (6) не нужен в процессе полета, но он позво-<br/>ляет подключить полетный контроллер непосредственно к разъему USB стацио-<br/>нарного компьютера или ноутбука для записи прошивки или настройки. Микро-<br/>контроллер обменивается данными с компьютером через протокол последователь-<br/>ной передачи данных UART, а компьютерный COM-порт — это одна из реализаций <br/>протокола UART, называемая RS-232. Но даже если в вашем компьютере еще ос-<br/>тался аппаратный COM-порт, то напрямую подключать к нему выводы микрокон-<br/>троллера нельзя! Электрические параметры порта RS-232 существенно отличаются <br/>от уровней стандартной трех- или пятивольтовой TTL-логики. В протоколе RS-232 <br/>логический ноль лежит в диапазоне от +3 до +12 В, а единица — от –3 до –12 В. <br/>Промежуток от –3 до +3 В считается зоной неопределенности. Бытовые ноутбуки <br/>вообще не содержат стандартные физические COM-порты. Общепринятым и наи-<br/>более удобным решением является использование специальных микросхем-кон-<br/><br/>Глава 2. Обязательные компоненты квадрокоптера 33 <br/>вертеров. При подключении такой микросхемы к порту USB операционная система <br/>компьютера создает виртуальный COM-порт, который с точки зрения прикладных <br/>программ ничем не отличается от физического. Через этот порт вы можете записы-<br/>вать прошивку в микроконтроллер или настраивать различные параметры. <br/>Использовать конвертер, встроенный на плату, удобнее, чем постоянно подключать <br/>внешний. Но есть важный нюанс: как показал опыт множества пользователей, если <br/>забыть отключить от контроллера провод USB, то можно легко вырвать с платы <br/>разъем microUSB. Это не означает необратимую поломку платы, в крайнем случае <br/>можно будет использовать внешний адаптер. Но все равно, будьте аккуратны и <br/>внимательны. <br/>Встроенная флеш-память для ведения логов (8) есть не на каждом полетном <br/>контроллере и для обычных полетов также не требуется. Но ее наличие удобно <br/>в более сложных случаях, когда надо проанализировать в динамике бортовое на-<br/>пряжение питания, маршрут и параметры полета или отладить прошивку. <br/>На плату контроллера могут быть также встроены приемник радиоуправления, <br/>приемник GPS, передатчики видеосигнала и/или телеметрии, LCD-дисплеи и т. д., <br/>но это уже комбинированные устройства. Мы рассмотрим дополнительные модули <br/>в отдельной главе. <br/>Аппаратура радиоуправления <br/>Комплект аппаратуры радиоуправления — это, зачастую, самый дорогой компо-<br/>нент радиоуправляемой системы. Но экономить на нем крайне нежелательно. В ра-<br/>диоаппаратуру обязательно должна быть заложена возможность развития конст-<br/>рукции вашего квадрокоптера, в противном случае сиюминутная экономия может <br/>обернуться дополнительными расходами спустя один-два года. Причем управление <br/>квадрокоптером высоко поднимает планку минимальных требований по сравнению <br/>с самолетами и даже вертолетами. <br/>В общем случае аппаратура радиоуправления состоит из пульта радиоуправления <br/>(передатчика) и приемника. Основными параметрами являются протокол кодиро-<br/>вания сигнала и количество каналов передачи команд. Рабочую частоту мы не рас-<br/>сматриваем, т. к. в настоящее время практически вся аппаратура работает на часто-<br/>те 2,4 ГГц, и другие варианты скорее относятся к экзотическим явлениям, хотя при <br/>дальних полетах по FPV применяется и аппаратура с рабочими частотами 40 <br/>и 72 МГц, сигналы которых меньше подвержены затуханию и интерференции на <br/>сложных рельефах. Протокол кодирования сигнала означает способ, которым <br/>команды, полученные с органов управления пульта, "упакованы" в поток данных, <br/>проходящий через радиоканал. При разработке протоколов руководствуются поме-<br/>хоустойчивостью и плотностью потока информации. Существуют как проприетар-<br/>ные протоколы, которые использует только один производитель аппаратуры, так и <br/>более массовые. Каждый из них имеет свои достоинства и недостатки. <br/>Подробный разбор и анализ протоколов вряд ли уместен в книге для начинающих. <br/>На первом этапе протокол, как таковой, вообще не будет иметь значения. Заострим <br/><br/>34 Часть I. Теория <br/>ваше внимание лишь на том, что протокол передатчика и протокол приемника <br/>должны быть одинаковыми. Это кажется очевидным, но по невнимательности <br/>вполне можно купить неподходящий приемник. Например, если ваш передатчик <br/>работает с протоколами DSM2/DSMX, нужно искать приемник именно для этих <br/>протоколов. Существуют передатчики со сменными передающими модулями, а <br/>также поддерживающие разные протоколы. Это особенно удобно, когда надо при-<br/>обрести передатчик, совместимый с уже имеющимся квадрокоптером заводского <br/>изготовления или разными приемниками. <br/>Параметр, который принципиально важен, — количество каналов. Для управления <br/>квадрокоптером их нужно как минимум четыре: <br/>� общий газ (Throttle); <br/>� тангаж (вперед-назад, Pitch); <br/>� крен (вправо-влево, Roll); <br/>� рыскание (вращение в плоскости полета, Yaw). <br/>На самом деле, этого очень мало и хватит вам лишь для пробного взлета. Во-<br/>первых, нужны каналы для управления включением сенсоров и режимов полетного <br/>контроллера. Например, удержание высоты по барометру, включение/выключение <br/>компаса, удержание позиции или возврат домой по GPS. Во-вторых, могут понадо-<br/>биться каналы для управления бортовой видеокамерой, бортовыми огнями или <br/>включения системы поиска упавшего аппарата. Комфортное управление квадро-<br/>коптером начинается при восьми и более каналах. Благо, сейчас даже недорогие <br/>передатчики и приемники способны поддерживать до 14 каналов. Количество ка-<br/>налов приемника и передатчика не обязательно должно совпадать. Если передатчик <br/>поддерживает двенадцать каналов, а приемник восемь, значит в вашем распоряже-<br/>нии только восемь каналов, остальные будут недоступны. <br/>Итак, пульт радиоуправления состоит из аналоговых (стики) и дискретных (пере-<br/>ключатели и тумблеры) органов управления, микроконтроллера, который оцифро-<br/>вывает и кодирует сигналы органов управления, радиопередающей части, дисплея <br/>и батареи питания. В качестве дополнительных модулей могут присутствовать при-<br/>емник-декодер сигналов телеметрии и дисплей для отображения данных телемет-<br/>рии и сигнала с бортовой видеокамеры. Благодаря наличию микроконтроллера, <br/>большинство пультов поддерживает гибкие настройки, позволяющие произвольно <br/>устанавливать связь между каналом и органом управления, инвертировать сигнал и <br/>устанавливать коэффициент пропорциональности между отклонением стика и из-<br/>менением сигнала, а также менять количество каналов и прочие параметры потока <br/>данных. <br/>В зависимости от расположения стиков управления различают передатчики типа <br/>Mode 1 и Mode 2. У передатчиков первого типа слева расположен стик Pitch-Roll, а <br/>справа Throttle-Yaw. У передатчиков второго типа, соответственно, наоборот. Более <br/>массовыми являются передатчики типа Mode 2, потому что большинству пользова-<br/>телей-правшей психологически удобнее интенсивно управлять положением лета-<br/>тельного аппарата правой рукой, а левой периодически регулировать газ. Это во-<br/><br/>Глава 2. Обязательные компоненты квадрокоптера 35 <br/>прос сугубо личного комфорта и привычки. На рис. 1.3 изображено расположение <br/>стиков для режима Mode 2. <br/>К выбору расположения стиков при покупке следует отнестись очень ответственно, <br/>т. к. недостаточно изменить назначение стиков в меню или переключить провода  <br/>в пульте. Узлы правого и левого стиков имеют разную конструкцию. Стик Pitch-Roll <br/>подпружинен по двум направлениям и при отпускании возвращается в централь-<br/>ную позицию. Стик Throttle-Yaw подпружинен только по оси Yaw, а газ при отпус-<br/>кании стика не уходит в центр. Поэтому для переделки Mode 1 в Mode 2 или наобо-<br/>рот необходимо поменять местами узлы стиков или переставить детали этих узлов. <br/>Не для каждого пульта это возможно. Предварительно ознакомьтесь с отзывами <br/>на тематических форумах или задайте вопрос продавцу. <br/>Важно, чтобы фабричное качество пульта соответствовало вашим потребностям на <br/>перспективу. Дешевым пультам китайских производителей присущи люфты меха-<br/>нической части, малая износостойкость и низкое качество переменных резисторов <br/>узла стиков, высокая погрешность оцифровки положения стиков. Вследствие низ-<br/>кого качества пульта могут возникнуть отрицательные явления. <br/>� Джиттер — "дрожание" значения управляющего сигнала при неподвижном сти-<br/>ке. Джиттер возникает как сумма погрешностей оцифровки, кодирования в пе-<br/>редатчике и обратного раскодирования в приемнике. <br/>� Температурный дрейф — значения управляющих сигналов сдвигаются вверх <br/>или вниз на некую величину при изменении температуры пульта. Соответствен-<br/>но, в нейтральном положении стиков управляющие сигналы перестают быть <br/>нейтральными. В дешевой аппаратуре дрейф иногда бывает настолько сильным, <br/>что мешает переключать режимы и управлять квадрокоптером в зимнее время. <br/>Экземпляры одной и той же марки из разных партий могут быть по-разному <br/>подвержены дрейфу. Для проверки рекомендуется охладить пульт в холодиль-<br/>нике до –10...–15 градусов и проверить параметры сигнала. Это можно сделать <br/>при помощи специальных программ для компьютера или смартфона, о которых <br/>мы расскажем далее. <br/>� Дискретность — значения управляющих сигналов при смещении стика изме-<br/>няются не плавно, а скачками. Это мешает точному пилотированию хорошо на-<br/>строенного аппарата. Разумеется, цифровой сигнал по определению меняется <br/>дискретно, однако в качественной аппаратуре с высокой разрядностью дискре-<br/>тизации шаг изменения небольшой и не мешает точному пилотированию. Вели-<br/>чина дискретности также влияет на джиттер. <br/>Для управления мультикоптерами начального и среднего уровня не требуются ка-<br/>кие-либо специальные приемники. Подойдет любой, совместимый с имеющимся <br/>пультом, приемник с числом каналов от шести и более. Четырехканальный прием-<br/>ник подойдет только для первого включения и пробных взлетов, далее количества <br/>каналов быстро станет недостаточно. <br/><br/>36 Часть I. Теория <br/>Функция Failsafe <br/>При внезапном пропадании управляющего сигнала вследствие достижения пре-<br/>дельной дальности, эфирной помехи или поломки аппаратуры система радиоуправ-<br/>ления должна отработать один из вариантов поведения: <br/>� либо сохранить последние принятые значения управляющих сигналов; <br/>� либо установить значения управляющих сигналов в некие заранее заданные зна-<br/>чения. <br/>Первый вариант довольно опасен для длительной защиты: если в момент потери <br/>управления аппарат перемещался с большой скоростью или набирал высоту, то он <br/>продолжит это делать и может улететь очень далеко и безнадежно потеряться или <br/>причинить ущерб окружающим. Поэтому такой вариант защиты встроен в логику <br/>работы цифрового приемника и автоматически срабатывает при кратковременном <br/>выпадении нескольких пакетов данных. <br/>Второй вариант более безопасен, лучше подходит при длительном пропадании сиг-<br/>нала и позволяет реализовать различные алгоритмы для минимизации ущерба. <br/>Применительно к квадрокоптеру реализация зависит от комплектации. <br/>� Без GPS-навигации. Сигнал газа выставляется в положение, соответствующее <br/>достаточно быстрому, но безопасному снижению, чтобы коптер не унесло дале-<br/>ко ветром, а ущерб от падения был минимальным. Сигналы управления положе-<br/>нием выставляются в среднее положение (горизонталь), включается режим авто-<br/>стабилизации горизонта. Режим удержания высоты по барометру отключается, <br/>либо включается режим удержания минимальной высоты, когда коптер зависает <br/>не ниже заданного значения. Рекомендуется также задать медленное вращение <br/>по Yaw, чтобы положение приемной антенны менялось в пространстве. Это дает <br/>шанс в каком-то положении принять неустойчивый сигнал и вернуть управле-<br/>ние. Если есть поисковый маячок, то включить его. В итоге при срабатывании <br/>Failsafe коптер должен остановиться, выровняться и относительно безопасно <br/>приземлиться. <br/>� При наличии GPS-навигации. Сигнал газа выставляется в положение, соот-<br/>ветствующее висению. Сигналы управления положением выставляются в сред-<br/>нее положение (горизонталь), включается режим автостабилизации горизонта. <br/>Включается функция "возврат домой". Включается барометр, в прошивке кон-<br/>троллера должно быть задано значение высоты, на которой происходит возврат <br/>к точке старта, и высоты, на которой квадрокоптер зависает после возвращения. <br/>Например, если полет может происходить над лесом, то квадрокоптер должен <br/>возвращаться, гарантированно пролетая выше самых высоких деревьев. В итоге <br/>при срабатывании Failsafe квадрокоптер должен сам вернуться к месту старта и <br/>зависнуть на заданной высоте. <br/>Даже если вы не планируете автоматические полеты по заданному маршруту, на-<br/>личие приемника GPS очень полезно с точки зрения сохранности квадрокоптера.  <br/>А если вы собираетесь использовать дорогую видеокамеру в комплекте с бескол-<br/>лекторным гироподвесом и качественным видеопередатчиком, то приемник GPS <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 37 <br/>является обязательным устройством, поскольку именно он вернет вам оборудова-<br/>ние общей стоимостью более тысячи долларов в случае потери управления. <br/>Функция Failsafe может быть реализована как приемником, так и полетным кон-<br/>троллером. Что лучше? Лучше не лениться и настроить оба варианта. Вероятность <br/>внезапного и полного отказа приемника во время полета невелика, но не равна ну-<br/>лю. В случае полного отказа приемника функцию Failsafe реализует полетный кон-<br/>троллер. Некоторые приемники не имеют встроенной защиты от потери связи, <br/>в этом случае вся надежда только на контроллер. <br/>Модуляция сигнала PPM <br/>Обычный многоканальный приемник получает по радиоканалу кодированный по-<br/>следовательный сигнал управления, декодирует его и "раскладывает" по отдельным <br/>выходам приемника для каждого канала. Параметры сигнала на выходе индивиду-<br/>ального канала определяются единым общепризнанным стандартом и не зависят от <br/>типа кодирования в передатчике или марки производителя. Статьи на тему попу-<br/>лярных стандартов кодирования в аппаратуре радиоуправления писали или перево-<br/>дили все, кому не лень. В том числе и люди, далекие от радиотехники, что породи-<br/>ло изрядную смысловую и терминологическую путаницу. Давайте разберемся по <br/>порядку. <br/>Стандарт кодирования PPM (Pulse Position Modulation — фазово-импульсная моду-<br/>ляция) очень старый и популярный, поскольку может формироваться и обрабаты-<br/>ваться без использования микроконтроллеров, при помощи обычных интегральных <br/>счетчиков и таймеров. Сейчас нечасто можно встретить передатчик с классической <br/>модуляцией сигнала PPM, разве что в китайских игрушках c инфракрасным пуль-<br/>том, но мы разберем этот стандарт подробно. Ведь каким бы способом сейчас не <br/>передавали информацию по радиоканалу, на выходе декодера обычного приемника <br/>мы имеем импульсы радиоуправления со строго определенными параметрами,  <br/>которые исторически происходят от PPM и не меняются для обеспечения совмес-<br/>тимости между оконечным (управляемым) оборудованием и массовой радиоаппа-<br/>ратурой разных производителей. <br/>Итак, обратимся к рис. 2.9, на котором схематично изображен стандартный сигнал <br/>PPM для четырех каналов. <br/>Сигнал PPM состоит из фреймов (frame) длительностью 20 мс. В свою очередь, <br/>фрейм состоит из стробирующих импульсов, которые разделяют каналы, и синхро-<br/>паузы, благодаря наличию которой приемник начинает ожидать следующий кадр. <br/>Как видно из диаграммы, расстояние tx между фронтами соседних синхроимпуль-<br/>сов соответствует длительности импульса в канале приемника. То есть, можно ска-<br/>зать, что в сигнале PPM информация канала содержится в положении (position) <br/>стробирующего импульса относительно начала фрейма или предыдущего строба. <br/>Длительность стробирующих импульсов лежит в диапазоне 100–400 мкс. <br/>При помощи синхропаузы приемник опознает начало следующего фрейма, затем, <br/>опираясь на стробирующие импульсы, распределяет импульсы управления по ка-<br/><br/>38 Часть I. Теория <br/>налам. Для надежного разделения фреймов длительность синхропаузы должна быть <br/>не менее 2500 мкс. В противном случае приемник может не опознать начало сле-<br/>дующего фрейма и отправить на выходы каналов непредсказуемые импульсы. <br/> <br/>Рис. 2.9. Сигнал PPM и его раскладка по каналам управления <br/>В свою очередь, импульсы на выходе отдельного канала следуют с периодом в <br/>20 мс (т. е. с частотой 50 Гц), и меняется их ширина. Такое кодирование информа-<br/>ции называют PWM (Pulse Width Modulation) или ШИМ (широтно-импульсная мо-<br/>дуляция). Иными словами, в приемнике сигнал PPM превращается в разделенные <br/>по каналам сигналы PWM. Именно эти импульсы PWM мы до сих пор получаем на <br/>канальных выходах приемников, даже самых современных. Исключение составля-<br/>ют приемники с последовательным выходным каналом, но об этом позже. <br/>Поскольку именно длительность импульса в канале несет в себе информацию, па-<br/>раметры этого импульса стандартизованы: минимальная — 1000 мкс, средняя — <br/>1500 мкс, максимальная — 2000 мкс. Обязательно запомните диапазон этих значе-<br/>ний, они фигурируют в настройках квадрокоптера и пригодятся вам в дальнейшем. <br/>Производители аппаратуры позволяют задать в настройках более широкий диапа-<br/>зон значений, порядка 800–2200 мкс, но в квадрокоптерах такие значения обычно <br/>не применяются. <br/>В стандартный сигнал PPM с фреймом длительностью 20 мс можно упаковать не <br/>более восьми каналов (обычно шесть-семь). Проблема в ограничении минимальной <br/>длительности синхропаузы. Давайте посчитаем вместе. Представьте ситуацию, ко-<br/>гда по восьми каналам надо передать импульсы максимальной длительности <br/>t<br/>...t = 2000 мкс. Тогда суммарная длительность канальных импульсов составит <br/>1 8<br/>8 ⋅ 2000 = 16 000 мкс, а для синхропаузы останется 20 000 – 16 000 = 4000 мкс. Это-<br/>го более чем достаточно для надежной работы приемника. Но если добавить девя-<br/>тый канал, то на долю синхропаузы останется 20 000 – 9 ⋅ 2000 = 2000 мкс. С такой <br/>синхропаузой декодер стандартного приемника не сможет опознавать начало <br/>фрейма и разделять каналы. Если же передатчик формирует канальные импульсы  <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 39 <br/>с максимальной длительностью 2200 мкс, то в стандартный фрейм не поместятся <br/>даже восемь каналов. <br/>Поэтому производители аппаратуры идут на ухищрения и увеличивают длину <br/>фрейма. Таким способом удается уместить в сигнал PPM до 14 каналов. Благо,  <br/>в большинстве современных пультов можно настраивать длину фрейма, длину <br/>строба и количество каналов. Чтобы приемник распознавал такой, не вполне стан-<br/>дартный, сигнал, его приходится прошивать соответствующей прошивкой. Недос-<br/>татком этого подхода является проблема совместимости приемников и передатчиков. <br/>Существенным недостатком формата PPM является отсутствие контроля над каче-<br/>ством принимаемых данных. Если помеха исказила импульсы внутри фрейма, то <br/>они в искаженном виде попадут на выход приемника. Некоторые современные <br/>приемники PPM, оснащенные микроконтроллерами, могут отфильтровывать заве-<br/>домо ошибочные импульсы в каждом канале управления по отдельности. Алгоритм <br/>фильтрации частично похож на алгоритм цифрового подавления помех в звуке или <br/>изображении. Приемник сохраняет в памяти параметры импульсов в каждом канале <br/>и сравнивает их с вновь поступившими. Считается, что в нормальной ситуации <br/>длительности импульсов от фрейма к фрейму могут измениться лишь в определен-<br/>ных разумных пределах. Если приемник обнаруживает аномально изменившиеся <br/>импульсы, он считает их недостоверными и заменяет их длительность значениями <br/>из предыдущего фрейма. Таким образом происходит отработка укороченной функ-<br/>ции Failsafe по каждому каналу в отдельности. Попутно приемник копит информа-<br/>цию о количестве "испорченных" импульсов, и когда оно превышает критический <br/>порог в единицу времени, приемник уходит в глубокий Failsafe, как описано в пре-<br/>дыдущем разделе. <br/>Формат сигналов PCM <br/>Импульсно-кодовая модуляция PCM (Pulse Code Modulation) применяется для по-<br/>вышения помехоустойчивости канала управления. Единого стандарта PCM не су-<br/>ществует, производители используют собственные несовместимые протоколы.  <br/>В итоге аппаратура PCM разных производителей взаимно несовместима, а соревно-<br/>вание протоколов по сути сводится к борьбе за кошельки покупателей, которых <br/>каждый производитель привязывает к своему оборудованию. <br/>В протоколах PCM данные также передаются стандартными блоками, или пакета-<br/>ми. Пакет состоит из цифровых значений для каждого канала управления, служеб-<br/>ной информации, контрольной суммы и синхроблока. Избыточность данных не <br/>предусмотрена. Если контрольная сумма не сходится, пакет отбрасывается, а на <br/>выходах приемника сохраняется предыдущее состояние (быстрый Failsafe). При <br/>накоплении количества ошибок выше критического предела или при полном про-<br/>падании пакетов включается глубокий Failsafe. <br/>Количество импульсов в пакете PCM существенно больше, чем во фрейме PPM. Но <br/>импульсы нельзя чрезмерно укорачивать, т. к. при этом увеличивается ширина <br/>спектра излучаемого радиосигнала, жестко ограниченная нормами. Поэтому в об-<br/>щем случае пакет данных PCM получается длиннее, а скорость по протоколу PCM <br/><br/>40 Часть I. Теория <br/>ниже. Применяя оптимизацию протокола, удается сократить длительность пакета <br/>до 20 мс и меньше. Например, в каждом пакете можно передавать информацию <br/>только о быстро меняющихся каналах или чередовать каналы, для которых переда-<br/>ется информация. <br/>В массовой современной аппаратуре применяется широкополосный сигнал и им-<br/>пульсно-кодовая модуляция. Иными словами, с переходом на аппаратуру диапазо-<br/>на 2,4 ГГц рядовому потребителю следует больше беспокоиться о совместимости <br/>приемников и передатчиков разных производителей, а также о соотношении цены  <br/>и качества аппаратуры, чем о тонкостях кодирования сигнала в радиотракте, по-<br/>скольку на выходе любого приемника все равно будут одни и те же сигналы, пода-<br/>ваемые на полетный контроллер или исполнительные устройства. <br/>Совместимость аппаратуры стандартов DSM2/DSMX <br/>О совместимости оборудования, использующего протоколы модуляции эфирного <br/>сигнала DSM2 и DSMX, следует поговорить особо, т. к. эти протоколы чрезвычай-<br/>но популярны у производителей аппаратуры среднего и низкого ценового сегмента. <br/>И, соответственно, пользуются широким спросом у авиамоделистов. <br/>Протоколы DSM2 и DSMX — это фирменные протоколы, разработанные компани-<br/>ей Horizon Hobby, которые используются не только во всех ее моделях, но и в пуль-<br/>тах JR и Spectrum нижнего ценового диапазона, а также в приемниках OrangeRx, <br/>которые стоят несколько долларов, но при этом работают без нареканий. <br/>Передатчики и приемники DSM2/DSMX работают в диапазоне 2,4 ГГц, разбитом <br/>на отдельные каналы. Спецификация современных протоколов определяет не толь-<br/>ко формат цифровой импульсной модуляции радиосигнала, но и алгоритм работы  <br/>с набором каналов. В протоколе DSM2 для связи используются два канала, а в про-<br/>токоле DSMX передатчик перебирает их по своему уникальному алгоритму. При <br/>этом вероятность наткнуться на помеху статистически выше, но воздействие этой <br/>помехи продлится меньшее время, что в целом повышает помехоустойчивость сис-<br/>темы. Поэтому DSMX позиционируется, как протокол для работы в сложных го-<br/>родских условиях. <br/>Протокол DSMX более новый. Аппаратура стандарта DSMX, как правило, может <br/>работать и по протоколу DSM2, что обеспечивает аппаратную совместимость свер-<br/>ху вниз. Например, если у вас есть старый приемник стандарта DSM2, то новый <br/>передатчик стандарта DSMX можно переключить в режим DSM2. И наоборот, при-<br/>емник стандарта DSMX может принимать сигналы от передатчика DSM2. Иными <br/>словами, если один из компонентов радиоканала работает в старом стандарте <br/>DSM2, то вся система переключается на этот стандарт. Особенно приятно, что эти <br/>два стандарта совместимы на уровне "железа": если приемник или передатчик <br/>DSM2 прошить новой прошивкой, то он начнет поддерживать протокол DSMX. <br/>Впрочем, соблюдать осторожность в вопросах совместимости все-таки надо. Ки-<br/>тайские производители иногда огорчают нас неприятными сюрпризами в виде вне-<br/>запной отмены совместимости того или иного оборудования. В сомнительных слу-<br/>чаях лучше посоветоваться с продавцом или на профильных форумах. <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 41 <br/>Сопряжение приемника и передатчика (биндинг) <br/>Прежде чем начать эксплуатацию радиоаппаратуры, необходимо провести специ-<br/>альную процедуру привязки приемника к передатчику (биндинг, binding). После <br/>привязки приемник запоминает уникальный кодовый номер передатчика, рабочие <br/>каналы или алгоритм перебора каналов и работает только с этим передатчиком. <br/>Нюансы процедуры биндинга зависят от оборудования, но в целом процедура <br/>очень проста. В специальный разъем приемника, помеченный надписью "BIND", <br/>вставляется перемычка и подается питание на приемник. Приемник переходит  <br/>в режим сопряжения, показывая это миганием светодиода. Затем включают пульт, <br/>держа нажатой специальную кнопку на передающем модуле, в течение нескольких <br/>секунд происходит обмен информацией, и процедура завершается. Можно отклю-<br/>чить питание, удалить перемычку из приемника и приступать к полетам. <br/>Большинство современных приемников на самом деле являются приемопередатчи-<br/>ками. Только передают они слабый сигнал на расстоянии в несколько метров и <br/>лишь для обмена служебной информацией с передатчиком в момент привязки. <br/>В свою очередь, в модуле передатчика есть еще и приемник. <br/>В процессе привязки приемник сообщает передатчику, сигналы каких стандартов <br/>он может принимать, и передатчик автоматически выбирает для работы подходя-<br/>щий. Но не все приемники поддерживают двусторонний обмен и автовыбор стан-<br/>дарта. Будьте готовы к тому, что придется вручную при помощи переключателя на <br/>радиомодуле или в меню настроек передатчика выбрать стандарт передачи, соот-<br/>ветствующий приемнику. <br/>Некоторые приемники, например в миниатюрных комнатных моделях, имеют <br/>функцию автобиндинга. При включении они всегда переходят в режим привязки и <br/>ждут сигнал от передатчика примерно в течение 10–15 с. Если за это время они <br/>принимают сигнал от "своего" передатчика, то сразу переходят в штатный режим. <br/>Если же во время ожидания поступает сигнал привязки от нового передатчика, то <br/>приемник запоминает уникальный код нового передатчика и затем переходит <br/>в штатный режим. <br/>Во время биндинга может также происходить настройка функции Failsafe. Обычно <br/>приемник запоминает для режима Failsafe положение органов управления в момент <br/>привязки. Благодаря этой опции можно обеспечить относительно мягкую посадку <br/>квадрокоптера или автоматический возврат по GPS к точке старта. Процедура на-<br/>стройки у разных приемников может отличаться. Некоторые приемники вообще  <br/>не имеют такой функции. Точные инструкции по настройке Failsafe и привязке <br/>в целом смотрите в документации производителя. <br/>Импульсы PWM, триммеры и субтриммеры <br/>Как мы уже говорили, независимо от протокола передачи информации и способа <br/>декодирования, у любого приемника с раздельными выходами каналов на каждом <br/>из выходов присутствуют стандартные импульсы PWM, длительность которых  <br/>является управляющим параметром для исполнительных устройств. <br/><br/>42 Часть I. Теория <br/>Напомним, что стандартные длительности импульсов PWM таковы: минималь-<br/>ная — 1000 мкс, средняя — 1500 мкс, максимальная — 2000 мкс. Эти значения со-<br/>ответствуют минимальному, среднему и максимальному положению рукоятки <br/>управления пульта. Но это идеальные базовые значения. На практике они могут <br/>быть иными. Для примера рассмотрим простейшую ситуацию: в среднем положе-<br/>нии рукоятки пульта вал сервомашинки слегка отклонен от среднего положения. <br/>Возможно, это погрешность сервомашинки, а может, погрешность пульта, который <br/>в среднем положении не обеспечивает 1500 мкс. Но сервомашинка не регулирует-<br/>ся, поэтому в любом случае надо настраивать пульт. Для этого существуют суб-<br/>триммеры и триммеры. Важно понимать разницу между ними. <br/>Субтриммер симметрично смещает в ту или иную сторону весь рабочий диапазон <br/>длительностей. Например, при смещении вверх на 100 мкс рабочий диапазон будет <br/>составлять 1100–2100 мкс со средней точкой 1600 мкс. Таким образом, сохраняется <br/>симметрия диапазона, но происходит некоторый выход за его стандартные пре- <br/>делы. <br/>Триммер смещает текущую рабочую точку внутри действующего диапазона. Но <br/>при этом выход за пределы диапазона при максимальных отклонениях не происхо-<br/>дит. Например, если мы триммером сместили рабочую точку относительно физиче-<br/>ского положения рукоятки на 50 мкс вверх, то при среднем положении рукоятки <br/>длительность импульса составит 1550 мкс, но границы диапазона останутся преж-<br/>ними — 1000–2000 мкс. <br/>Как видите, триммер вносит асимметрию в канал управления: максимальный рабо-<br/>чий ход вверх и вниз получается разным. Поэтому для центровки каналов исполь-<br/>зуют субтриммеры, доступные в меню настроек передатчика. Триммеры же при-<br/>меняют в тех случаях, когда необходимо сделать оперативную корректировку и <br/>целенаправленно привнести асимметрию в канал. Например, модель самолета име-<br/>ет слегка несимметричное крыло и заваливается влево. В этом случае асимметрия <br/>за счет триммирования канала элеронов скомпенсирует асимметрию крыла. Такие <br/>регулировки обычно выполняют в процессе полета, поэтому рычажки или кнопки <br/>триммеров вынесены на переднюю панель пульта и действуют без обращения к меню. <br/>Квадрокоптер не обладает собственными аэродинамическими качествами, симмет-<br/>рия его поведения в полете и управления по осям достигается автоматически, за <br/>счет полетного контроллера. Поэтому в случае с квадрокоптерами особенно важно <br/>соблюдать симметрию параметров управляющих импульсов. Категорически не <br/>рекомендуется при настройке пультов под квадрокоптер использовать тримме-<br/>ры! Центральные значения сигналов управления, которые должны максимально <br/>точно соответствовать 1500 мкс, достигаются только при помощи субтрим- <br/>меров. <br/>Расходы и экспоненты <br/>Часто бывает так, что выход за пределы стандартного рабочего диапазона недопус-<br/>тим (например, рычаг сервомашинки упирается во что-то) или желательно ограни-<br/>чить рабочий ход исполнительных механизмов для более мягкого и безопасного <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 43 <br/>управления. Рабочий ход в ту или иную сторону от центрального положения назы-<br/>вается расходом и бывает положительным или отрицательным в зависимости от <br/>направления отклонения. <br/>Расходы аппаратуры измеряются в процентах от стандартного отклонения и на-<br/>страиваются через меню пульта. Можно установить расходы как больше, так и <br/>меньше 100%. Например, если установить расходы вверх и вниз по 90%, то мини-<br/>мальная длительность импульса составит 1500 – 500 ⋅ 90% = 1050 мкс, а макси-<br/>мальная 1500 + 500 ⋅ 90% = 1950 мкс. Обычно рекомендуется "зажимать" расходы <br/>аппаратуры для новичков, т. к. им свойственно от волнения двигать стики пульта <br/>слишком сильно и резко. <br/>Обычно положительный и отрицательный расход канала можно регулировать по <br/>отдельности. Но, как мы уже говорили, для квадрокоптеров принципиально важна <br/>симметрия рабочего хода, поэтому и расходы следует подстраивать только симмет-<br/>рично. При настройке квадрокоптера расходами подгоняют минимальное и макси-<br/>мальное значение длительности импульса под необходимые для контроллера.  <br/>А остроту реакции коптера на управление задают при помощи специального коэф-<br/>фициента Rate в настройках полетного контроллера. <br/>Еще одним параметром, существенно влияющим на качество и комфорт пилотиро-<br/>вания, является экспонента — степень нелинейности отклика системы на измене-<br/>ние управляющего сигнала. Строго говоря, эта зависимость получила такое назва-<br/>x<br/>ние по причине визуальной похожести на график экспоненты ye= . На самом деле <br/>механизм формирования нелинейного отклика несколько сложнее. Чтобы не  <br/>загружать микроконтроллер пульта вычислениями степенной функции в режиме <br/>реального времени, в память микроконтроллера записывается готовая таблица зна-<br/>чений некой степенной функции вида <br/>kx<br/>−1<br/>e<br/>exp()x = , <br/>k<br/>−1<br/>e<br/>где х — это значение отклонения рукоятки; k — коэффициент пропорциональности. <br/>Во время работы пульта значения из этой таблицы накладываются на линейную <br/>зависимость по формуле <br/>YN=⋅expX+ 1−N⋅X, <br/>( ) ( )<br/>где N — это процент экспоненты в настройках пульта. Проще говоря, чем больше <br/>процент экспоненты N, тем сильнее "искривляется" линейная зависимость в соот-<br/>ветствии со значениями из таблицы (рис. 2.10). <br/>Наличие экспоненты позволяет мягко и комфортно управлять моделью в районе <br/>небольших отклонений рукояток, но в то же время при необходимости резко воз-<br/>действовать на модель, парируя порыв ветра или выполняя вираж. Глубину экспо-<br/>ненты каждый пилот настраивает под себя и для каждой модели в отдельности.  <br/>В общем случае рекомендуется увеличивать экспоненту для начинающих пилотов, <br/>склонных к нервным и суетным подергиваниям рукояток пульта, и уменьшать <br/>вплоть до полной линейности отклика для воздушной акробатики. <br/><br/>44 Часть I. Теория <br/> <br/>Рис. 2.10. Экспонента сигнала управления <br/>ПРИМЕЧАНИЕ <br/>Применительно к мультикоптерам, глубина экспоненты задается в настройках кон-<br/>троллера, а в настройках пульта экспоненты быть не должно. Экспоненты пульта и <br/>контроллера не должны накладываться на сигнал одновременно. <br/>Как вы уже поняли, общая концепция радиоуправления коптером такова: пульт <br/>должен передать максимально точные и стандартные "сырые" сигналы управления, <br/>а всю дальнейшую обработку будет выполнять полетный контроллер на основе <br/>своих настроек. <br/>Конвертер PPM-SUM <br/>У многоканальной системы с раздачей широтно-модулированных импульсов по <br/>раздельным выходным каналам есть принципиально неустранимые недостатки. Во-<br/>первых, отдельный сигнальный провод для каждого канала. Это особенно актуаль-<br/>но для 12- или 14-канальных систем. В этом случае миниатюрный приемник соеди-<br/>няется с полетным контроллером и прочими бортовыми устройствами толстым <br/>жгутом проводов, неэстетичным и весящим больше, чем сам приемник. Однако по-<br/>летный контроллер может и сам декодировать "сырой" PPM-сигнал, при условии, <br/>что он выведен на отдельный выход приемника. <br/>Во-вторых, низкая стабильность и точность управляющего сигнала, обусловленная <br/>необходимостью лишних преобразований из одного типа сигнала в другой. Было <br/>бы логично передать цифровое значение, соответствующее положению рукоятки <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 45 <br/>пульта, по радиоканалу и затем из приемника переслать в исполнительное устрой-<br/>ство без лишних преобразований. Однако для обработки цифрового сигнала испол-<br/>нительное устройство должно обладать собственными вычислительными ресурса-<br/>ми. Но возможность выпускать такие устройства массово и недорого возникла <br/>лишь относительно недавно, с появлением дешевых и миниатюрных микрокон-<br/>троллеров. Поэтому в традиционной системе приемник в любом случае преобразу-<br/>ет цифровой сигнал в импульсы определенной длительности на выходе канала. Не-<br/>смотря на то, что импульс представлен двоичными уровнями сигнала "0" и "1", фи-<br/>зическая длительность импульса — это аналоговый параметр. То есть, на этапе <br/>передачи-приема мы имеем преобразование из аналогового сигнала в цифровой и <br/>обратно в аналоговый. <br/>Если выход приемника подключен к обычной сервомашинке (принцип ее работы <br/>мы рассмотрим далее), то она использует непосредственно длительность импульса <br/>в качестве управляющего параметра. Если же мы подаем широтно-модулиро-<br/>ванный импульсный сигнал на вход полетного контроллера, то он должен измерить <br/>длительность импульса при помощи таймера и перевести ее в цифровое значение.  <br/>В итоге мы получаем в тракте управления цепочку преобразований, каждое из ко-<br/>торых вносит свою погрешность и задержку. <br/>Итак, очевидные недостатки традиционной системы радиоуправления — ограни-<br/>ченная пропускная способность, искажения и задержки сигналов управления, тол-<br/>стый пучок проводов от приемника к исполнительным устройствам. Чтобы изба-<br/>виться от пучка проводов, используют специальное устройство — кодер-конвертер <br/>PPM. С точки зрения инженерной логики это довольно забавное устройство. Оно <br/>подключается к выходам каналов приемника и преобразует раздельные командные <br/>импульсы обратно в последовательность пакетов импульсов. С выхода конвертера <br/>сигнал PPM поступает на специальный вход полетного контроллера. Такой вход <br/>обычно обозначают PPM-SUM, т. к. на него подается суммарный сигнал PPM. При-<br/>емник только что успешно "разложил" сигнал по каналам, а конвертер снова соби-<br/>рает их в последовательность, внося дополнительную погрешность и задержку. <br/>Пожалуй, основная польза от такого устройства — избавление от пучка проводов. <br/>Вполне логично, что появились приемники, оснащенные выходом последователь-<br/>ного сигнала. Это может быть как все тот же универсальный сигнал PPM-SUM, так <br/>и особый проприетарный последовательный сигнал S-BUS фирмы Futaba, похожий <br/>на протокол UART. Разные производители могут кодировать выходной сигнал по-<br/>разному. Последовательный протокол позволяет подключать все управляемые ис-<br/>полнительные устройства к одной общей шине. Каждое устройство, получив син-<br/>хроимпульс, считывает с шины "свой" пакет цифровых данных и декодирует его. <br/>Поскольку пакеты данных в последовательном канале следуют в определенном по-<br/>рядке, цифровое исполнительное устройство (сервомашинка, регулятор оборотов, <br/>радиоключ) должно быть предварительно запрограммировано на определенный <br/>номер канала, т. е. на извлечение "своего" блока данных из последовательного по-<br/>тока. Для этого применяются специальные программаторы. Если последовательный <br/>сигнал подается на специальный вход полетного контроллера, то дальнейшую об-<br/><br/>46 Часть I. Теория <br/>работку выполняет контроллер, а порядок следования каналов настраивается  <br/>в прошивке контроллера или в приемнике. В любом случае порядок следования <br/>каналов в передатчике и контроллере должен совпадать. <br/>Приемник-сателлит <br/>Надежность работы радиоканала можно повысить при помощи специального при-<br/>емника-сателлита. Он представляет собой обычный приемник, у которого отсутст-<br/>вует узел обработки принятого сигнала. Вместо этого на выход сателлита идет по-<br/>следовательный "сырой" поток. Этот поток поступает на специальный вход основ-<br/>ного приемника. Некоторые приемники допускают подключение двух сателлитов. <br/>Приемники монтируют так, чтобы антенны базового приемника и сателлита нахо-<br/>дились на максимальном расстоянии друг от друга. Антенны могут иметь разную <br/>конструкцию и ориентацию в пространстве. Если одна из приемных частей теряет <br/>сигнал, ее подстраховывает вторая часть. <br/>Поскольку полетный контроллер может самостоятельно обрабатывать последова-<br/>тельный управляющий сигнал, можно подключить маленький и легкий сателлит <br/>непосредственно к контроллеру и обойтись без основного приемника, уменьшив <br/>вес и энергопотребление. Такое решение популярно при разработке миниатюрных <br/>конструкций, которые обычно не улетают из зоны устойчивой связи. <br/>Встроенная телеметрия <br/>Поскольку почти все современные пульты управления, даже недорогие, оснащены <br/>матричным графическим дисплеем, вполне логично использовать этот дисплей для <br/>отображения данных телеметрии. Для этого можно заменить прошивку пульта вер-<br/>сией, поддерживающей вывод телеметрии, и внести изменения в конструкцию <br/>пульта, подключив к нему внешний приемник. Но проще приобрести готовый ком-<br/>плект модулей, например FrSky. Модуль, подключаемый к пульту, содержит не <br/>только передатчик радиоуправления, но и приемник сигналов телеметрии. Сущест-<br/>вуют также дорогие и сложные комплекты аппаратуры радиоуправления со встро-<br/>енной функцией телеметрии и даже с отдельным специальным дисплеем на пульте. <br/>Антенны <br/>Конструкции и типы антенн, применяемых в радиоуправлении, зависят от назначе-<br/>ния устройства. Чтобы понимать эту зависимость, необходимо иметь хотя бы об-<br/>щее представление об основных параметрах антенны. Эти параметры тесно взаимо-<br/>связаны, и рассматривать их следует в комплексе. <br/>Диаграмма направленности — это графически выраженная зависимость коэффи-<br/>циента усиления антенны в зависимости от направления в заданной плоскости.  <br/>Упрощенно говоря, это зависимость эффективности работы антенны от направле-<br/>ния в пространстве. Примером всенаправленной антенны является вертикальный <br/>штырь. Его диаграмма направленности в горизонтальной плоскости представляет <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 47 <br/>собой круг, т. е. направление излучения или приема не имеет значения. У направ-<br/>ленной антенны всплески коэффициента усиления на диаграмме называют лепест-<br/>ками. <br/>На рис. 2.11 показан пример диаграммы для узконаправленной антенны. На диа-<br/>грамме видны три характерные области — 1, 2 и 3. Область 1, которой соответству-<br/>ет наибольший уровень принятого сигнала, называют основным, или главным ле-<br/>пестком диаграммы направленности. Области 2 и 3, находящиеся со стороны реф-<br/>лектора антенны, называются задними и боковыми лепестками. Наличие этих <br/>лепестков свидетельствует о том, что антенна принимает радиоволны не только <br/>спереди (в рабочем направлении), но и сзади (со стороны рефлектора), что снижает <br/>помехоустойчивость приема. Аналогично, при передаче наличие побочных лепест-<br/>ков снижает эффективность излучения в рабочем направлении. В связи с этим при <br/>разработке и настройке антенны стремятся уменьшить число и уровень задних и <br/>боковых лепестков. <br/> <br/>Рис. 2.11. Пример диаграммы направленности антенны <br/>Поскольку в радиоуправлении мы имеем дело с объектом, свободно перемещаю-<br/>щимся в пространстве, необходимо принимать во внимание объемную диаграмму <br/>направленности. Например, для штыревой антенны это "бублик" с максимумом  <br/><br/>48 Часть I. Теория <br/>в направлениях, перпендикулярных штырю. В продольном направлении штыревая <br/>антенна не излучает и не принимает сигнал. <br/>Коэффициент усиления показывает, во сколько раз нужно изменить сигнал на <br/>входе антенны относительно сигнала на входе идеальной всенаправленной антен-<br/>ны, чтобы в точке приема напряженность электромагнитного поля не изменилась. <br/>Коэффициент усиления, выраженный в децибелах (дБ, dBi), может быть как поло-<br/>жительным, так и отрицательным. Отрицательное значение присуще антеннам  <br/>с низким КПД (коэффициентом полезного действия): укороченным, малогабарит-<br/>ным, широкополосным. Низкий КПД не означает низкую направленность антенны. <br/>Например, антенна с узкой диаграммой направленности может иметь низкий КПД <br/>и "плохо" излучать или принимать сигнал вследствие затуханий сигнала в элемен-<br/>тах конструкции. <br/>Рабочая частота (полоса частот) — это частотный диапазон, в котором антенна <br/>реализует не менее 90% от своего максимального КПД. Рабочая частота жестко <br/>связана с геометрическими размерами и конструкцией антенны. Чем больше длина <br/>волны, тем крупнее антенна. Поэтому увеличение рабочей частоты до 2,4 ГГц су-<br/>щественно снизило габариты и вес антенн. <br/>Поляризация — это направленность вектора электрической составляющей элек-<br/>тромагнитной волны в пространстве. Различают вертикальную, горизонтальную и <br/>круговую поляризацию. Этот параметр важен для учета взаимной ориентации ан-<br/>тенн в пространстве. Например, если штыревая антенна передатчика расположена <br/>вертикально, то и штыревая антенна приемника должна быть расположена верти-<br/>кально, иначе уровень принимаемого сигнала может существенно снизиться. Кроме <br/>того, радиосигнал может изменить поляризацию при прохождении через неодно-<br/>родности воздушных масс ("воздушные линзы"). Поэтому приемники авиамоделей <br/>часто снабжают дополнительными антеннами с разной ориентацией в простран- <br/>стве. <br/>Рабочая мощность — параметр, важный для передающей антенны. Превышение <br/>подводимой к антенне мощности может привести к выходу из строя не только ан-<br/>тенны, но и передатчика. Причем второе даже более вероятно. <br/>Принцип обратимости антенн гласит, что свойства антенны (диаграмма направ-<br/>ленности, коэффициент усиления, рабочая частота) не зависят от того, работает ли <br/>антенна на передачу или на прием. <br/>Существуют и другие параметры антенн, но для начинающего моделиста они не <br/>имеют принципиального значения. Что касается самостоятельной разработки ан-<br/>тенн, то это очень сложный процесс, требующий глубоких профессиональных зна-<br/>ний, а также наличия специального измерительного оборудования для тестирова-<br/>ния и настройки. Если вы этим набором не обладаете, то лучше не терять время зря <br/>и приобретать готовые антенны, либо изготавливать несложные и многократно <br/>проверенные конструкции. <br/>Рассмотрим основные типы антенн, применяемых в аппаратуре радиоуправления <br/>диапазона 2,4 ГГц и каналах видео- и телеметрии. <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 49 <br/>Ненаправленные антенны <br/>Наиболее распространенными ненаправленными антеннами являются штыревая и <br/>коллинеарная. В стандартной поставке передатчик радиоуправления комплектуется <br/>простейшей штыревой антенной, похожей на те, которые используются в недоро-<br/>гих Wi-Fi-роутерах. Антеннами такой же конструкции, но на диапазон 5,8 ГГц мо-<br/>гут быть оснащены передатчики и приемники видеоканала. <br/>Антенна этой конструкции является полуволновым вибратором, запитанным в се-<br/>редине (рис. 2.12). Одна часть вибратора состоит из четвертьволновой трубочки, <br/>через которую проходит кабель. Оплетка кабеля припаяна к концу этой трубочки. <br/>Второй частью вибратора является четвертьволновая центральная жила кабеля, <br/>свободная от оплетки экрана. <br/> <br/>Рис. 2.12. Штыревая антенна передатчика и ее внутреннее устройство <br/>Иногда в оборудовании применяются так называемые коллинеарные антенны,  <br/>состоящие из нескольких излучающих элементов, последовательно соединенных  <br/>через фазовращатели. В этом случае антенна занимает всю длину кожуха <br/>(рис. 2.13). Поэтому надо быть аккуратным при замене сломанной антенны и пред-<br/>варительно проверить внутреннее устройство заменяемой антенны, чтобы обеспе-<br/>чить полноценную замену. <br/>ПРИМЕЧАНИЕ <br/>Несмотря на то, что стандартные антенны от оборудования Wi-Fi визуально совпада-<br/>ют с антеннами для передатчиков радиоуправления, у них может различаться сопря-<br/>гаемая часть разъема. Различие показано на рис. 2.14. Однако даже в оборудовании <br/>Wi-Fi одного производителя могут применяться как прямые, так и обратные пары <br/>"штырь — гнездо" в антеннах! Например, в оборудовании Zyxel WiMAX MAX-206 ан-<br/>тенны со штыревой частью, совместимые с модулями передатчика Orange Tx, а в не-<br/>которых моделях Zyxel Keenetic разъемы инверсные. Поэтому, собираясь заменить <br/>сломанную антенну передатчика визуально похожей, убедитесь в совместимости <br/>разъемов. <br/>ПРИМЕЧАНИЕ <br/>Недобросовестные китайские поставщики зачастую злоупотребляют внешней схо- <br/>жестью антенн для роутеров и антенн для аппаратуры радиоуправления. Более того, <br/>иногда в такой же корпус помещают спиральные антенны диапазона 433 МГц для мо-<br/><br/>50 Часть I. Теория <br/>дулей телеметрии. Нельзя приобретать стандартные штыревые антенны, руковод-<br/>ствуясь только внешним видом. Лучше лишний раз спросить продавца о рабочем диа-<br/>пазоне. Однако и это не застрахует вас от недобросовестных китайских продавцов, <br/>которые стараются продать любую внешне похожую антенну из имеющихся в наличии <br/>и уверяют, что это нужный вариант. <br/> <br/>Рис. 2.13. Двухдиапазонная ненаправленная коллинеарная антенна  <br/>и ее внутреннее устройство <br/> <br/>Рис. 2.14. Разъемы типа SMA антенны с гнездовой (1) и штыревой частью (2) <br/> <br/> <br/>Чтобы определить рабочий диапазон без применения специального оборудования, <br/>можно аккуратно разобрать антенну и измерить длину четвертьволнового вибрато-<br/>ра: для диапазона 2,4 ГГц — 1/4λ = 31 мм; для диапазона 5,8 ГГц — 1/4λ = 13 мм. <br/>В бортовых приемниках радиоуправления для экономии веса обычно используются <br/>штыревые антенны в виде кусочка провода длиной 31 мм (1/4 длины волны <br/>2,4 ГГц) или в виде центральной жилы экранированного провода, очищенной от <br/>экрана на эту же длину. <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 51 <br/>Малогабаритные антенны на диапазон 433 МГц обычно представляют собой спи-<br/>раль, подключенную к центральной жиле кабеля, и не содержат встроенного про-<br/>тивовеса (рис. 2.15). <br/>Рис. 2.15. Внутреннее устройство антенны на частоту 433 МГц <br/>При построении видеоканала часто применяют антенны типа "клевер" (рис. 2.16). <br/>Они сочетают в себе круговую поляризацию излучения и почти шарообразную объ-<br/>емную диаграмму направленности. Это означает, что взаимное положение пере-<br/>дающей и приемной антенны почти не будет влиять на качество сигнала. Количест-<br/>во лепестков антенны определяет равномерность диаграммы направленности. Чем <br/>больше лепестков, тем больше диаграмма похожа на ровный шар. Однако четырех-<br/>лепестковая антенна тяжелее, поэтому ее ставят на наземное оборудование. Прак-<br/>тический опыт множества моделистов также говорит о том, что применение четы-<br/>рехлепестковой антенны на земле более эффективно. Иногда встречается ошибоч-<br/>ное мнение, что от количества лепестков зависит волновое сопротивление антенны, <br/>но это не так. <br/>Рис. 2.16. Передающая и принимающая антенны типа "клевер" <br/><br/>52 Часть I. Теория <br/>Направленные антенны <br/>Вариантов конструкции антенн направленного действия намного больше (рис. 2.17 <br/>и 2.18), чем ненаправленного. Причем, не всегда для создания направленной диа-<br/>граммы применяется рефлектор. Эффект направленности может быть образован за <br/>счет формирования фазовых сдвигов напряженности электромагнитного поля <br/>в элементах конструкции и/или в пространстве вокруг антенны. <br/> <br/>Рис. 2.17. Направленная портативная антенна диапазона 2,4 ГГц <br/> <br/>Рис. 2.18. Спиральная направленная антенна Helix для приемника видеоканала 5,8 ГГц <br/>При использовании антенн с круговой поляризацией крайне важно совпадение на-<br/>правления вращения вектора поляризации у передающей и принимающей антенны. <br/>Например, у спиральных антенн должно совпадать направление навивки спирали. <br/>В противном случае произойдет резкое снижение уровня принимаемого сигнала <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 53 <br/>даже при идеальной взаимной ориентации антенн. Особенно легко ошибиться <br/>с вектором поляризации при использовании антенн разного типа. Распространенной <br/>ошибкой является использование в видеоканале передающей бортовой антенны <br/>типа "клевер" и принимающей спиральной без учета направления вектора поляри-<br/>зации. <br/>С другой стороны, при отражении от препятствий (земная поверхность, стены зда-<br/>ний) сигнал с круговой поляризацией становится линейно поляризованным и эф-<br/>фективно подавляется принимающей антенной. Благодаря этому существенно сни-<br/>жается уровень помех на изображении в виде двоящегося изображения и шумов. <br/>Системы слежения за направлением <br/>Использование направленной антенны существенно повышает дальность радиока-<br/>нала, но возникает проблема удержания направления на движущийся объект. Если <br/>направленная антенна смонтирована на пульте или видеоочках, то проблема реша-<br/>ется за счет перемещения оператора. В остальных случаях требуется помощь асси-<br/>стента или специальная автоматическая система слежения за направлением (тре-<br/>кер). Трекеры используются в наземных антеннах приема видеосигнала и телемет-<br/>рии. Надо иметь в виду, что из-за неоднородностей окружающего пространства <br/>может происходить отражение и интерференция сигнала, и оптимальная ориента-<br/>ция антенны может слегка отличаться от фактического направления на объект. <br/>Для трекинга применяются два основных метода: координатный и сигнальный. <br/>В первом методе координаты модели, определенные по GPS, по каналу телеметрии <br/>или по каналу звука поступают на наземный трекер. Контроллер трекера на осно-<br/>вании собственных координат и координат объекта вычисляет направление. Пре-<br/>имуществом метода является простота радиоприемной части, в которой использу-<br/>ется только один приемник, устойчивость к захвату ложных источников сигнала. <br/>Недостатки: необходимость точно позиционировать приемную станцию по коор-<br/>динатам и азимуту, а для этого она должна иметь собственный компас и приемник <br/>GPS или возможность ручного ввода координат. Сложение погрешностей GPS при <br/>определении координат двух точек снижает точность наведения. Не учитывается <br/>возможность случайных пространственных искажений при распространении сигна-<br/>ла, из-за чего наведение по координатам не всегда оптимально. При потере связи <br/>теряются также и данные о координатах объекта, что усугубляет ситуацию. <br/>В сигнальном методе используется непрерывное измерение уровня принимаемого <br/>сигнала. В простых самодельных трекерах применяют 2–3 независимых приемника <br/>с антеннами, направленными под слегка различающимися углами. Контроллер тре-<br/>кера сравнивает уровни сигналов с приемников и поворачивает турель в сторону <br/>антенны с наилучшим сигналом (рис. 2.19). <br/>Достоинством системы является правильная ориентация в направлении наилучшего <br/>приема. Очевидный недостаток — использование нескольких приемников и антенн. <br/>В более простом, сканирующем, варианте используется один приемник и антенна. <br/>Контроллер непрерывно измеряет уровень сигнала с выхода RSSI приемника и при <br/>его снижении отклоняет антенну на несколько градусов в различных направлениях, <br/><br/>54 Часть I. Теория <br/>сканируя зону слежения и "отлавливая" новое оптимальное направление. Посколь-<br/>ку слежение происходит непрерывно, после нескольких циклов корректиров-<br/>ки/отслеживания контроллер начинает более-менее точно предсказывать направле-<br/>ние движения объекта. <br/> <br/>Рис. 2.19. Самодельный трекер сигнального типа с тремя приемниками <br/>(http://fpvlab.com/forums/showthread.php?8331) <br/> <br/>В дорогих профессиональных системах может применяться антенна с синтезиро-<br/>ванной апертурой и измерение сдвига фаз несущей частоты для уточнения направ-<br/>ления на объект. <br/>Очевидным недостатком трекеров, использующих слежение по уровню сигнала, <br/>является возможность ложного захвата постороннего источника более мощного <br/>сигнала, случайно работающего на этой же частоте. Но, к счастью, в открытом поле <br/>вероятность такого события невысока. <br/>Самой простой и недорогой альтернативой автоматическому трекеру является руч-<br/>ное управление антенной. Некоторые комплекты аппаратуры радиоуправления по-<br/>зволяют привязать к передатчику несколько приемников. В этом случае недорогой <br/>приемник ставят на трекер, подключают к нему сервомашинку трекера и управля-<br/>ют поворотом антенны, вращая потенциометр на пульте. <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 55 <br/>Диверсификация антенн <br/>Летающие модели интенсивно меняют свое положение в пространстве. Поэтому <br/>важно обеспечить устойчивый радиоканал при любом взаимном положении антенн. <br/>В приемниках радиоуправления иногда используют две антенны, расположенные <br/>под углом 90°, или дополнительные приемники-сателлиты, у которых тоже распо-<br/>лагают антенны в разных местах модели и под разными углами. Этот прием назы-<br/>вается пространственной диверсификацией антенн. <br/>Иногда возникает потребность в диверсификации по типу антенны (рис. 2.20). На-<br/>пример, антенны для приема видеосигнала могут обладать очень острой диаграм-<br/>мой направленности. Такое свойство существенно повышает эффективную даль- <br/> <br/> <br/> <br/>Рис. 2.20. Антенная система со следящей основной антенной  <br/>и диверсификацией за счет штыревой всенаправленной антенны (http://www.readymaderc.com) <br/><br/>56 Часть I. Теория <br/>ность приема и помехоустойчивость, но стоит отклонить антенну на несколько гра-<br/>дусов в сторону от направления на модель, и сигнал может резко и внезапно про-<br/>пасть. Поэтому в сочетании с остронаправленной антенной иногда применяют <br/>вторую антенну, имеющую более широкую или вообще круговую диаграмму на-<br/>правленности. При потере сигнала с основной антенны качество сигнала с дубли-<br/>рующей может быть заметно хуже, но в большинстве случаев оператору его будет <br/>достаточно, чтобы не потерять управление. <br/>Диверсификация по частотному диапазону (дублирование канала) в любительской <br/>практике применяется редко, т. к. требует наличия двойного комплекта приемопе-<br/>редающего оборудования на разные диапазоны. <br/>Двигатели <br/>Двигатели, применяемые в авиамоделях, делятся на два больших семейства: кол-<br/>лекторные и бесколлекторные. Устройство коллекторного двигателя вы должны <br/>знать из школьного курса физики. Для тех, кто забыл, очень кратко напомним. <br/>Коллекторный двигатель состоит из неподвижных магнитов, прикрепленных <br/>к корпусу (статор) с чередованием полюсов и нескольких катушек, смонтирован-<br/>ных на валу (ротор). Напряжение на катушки ротора поступает через скользящие <br/>контакты (коллектор и щетки). При подаче напряжения на катушку ротора, вокруг <br/>нее формируется магнитное поле. Катушка отталкивается от полюса одного из маг-<br/>нитов статора и притягивается к другому. В этот момент происходит переключение <br/>полярности питания за счет вращательного смещения контактов коллектора отно-<br/>сительно щеток и катушка начинает притягиваться к следующему магниту. Кол-<br/>лекторный двигатель — это классический пример самоуправляемой системы, он <br/>сам себе переключает полярность катушек в нужный момент во время вращения. <br/>Направление вращения зависит от полярности питающего напряжения, а частота <br/>вращения от величины напряжения. <br/>В бесколлекторных двигателях коммутация катушек происходит при помощи <br/>специальной электронной схемы — регулятора оборотов (Electronic Speed Cont-<br/>roller, ESC). Независимо от количества катушек и схемы их внутренней коммута-<br/>ции бесколлекторный двигатель авиамодели всегда имеет три вывода, подключае-<br/>мые к регулятору. Регулятор подает на эти выводы питающее напряжение со сдви-<br/>гом по фазе. Поскольку выводы катушек подключены к регулятору неразрывно, то <br/>катушки смонтированы неподвижно и являются статором, а вращается ротор с при-<br/>крепленными к нему постоянными магнитами. Направление вращения зависит от <br/>подключения выводов двигателя к регулятору. Для изменения направления враще-<br/>ния достаточно поменять местами два любых вывода. Существуют более сложные <br/>конструкции двигателей, оснащенные датчиком оборотов и подключаемые к спе-<br/>циальным регуляторам. В этом случае для изменения направления вращения необ-<br/>ходимо перепрограммировать регулятор. <br/>Если магниты расположены снаружи относительно катушек, такие двигатели назы-<br/>вают аутраннерами (outrunner); если катушки расположены снаружи, а внутри вра-<br/><br/>Глава 2. Обязательные компоненты квадрокоптера 57 <br/>щается намагниченный ротор — инраннерами (inrunner). В квадрокоптерах и <br/>большинстве авиамоделей применяют аутраннеры. Удельная мощность и КПД бес-<br/>коллекторного двигателя существенно зависит от мощности постоянных магнитов <br/>ротора, поэтому обычно используются неодимовые магниты. Они приклеены на <br/>внутреннюю сторону ротора. Если двигатель уронить на твердую поверхность, от <br/>удара магниты могут отклеиться или треснуть. <br/>ВНИМАНИЕ! <br/>Трещина может быть незаметна глазу, но приведет к снижению мощности двигателя и <br/>может вызвать пропуски фазы и даже заклинивание двигателя отвалившимся оскол-<br/>ком магнита прямо во время полета. <br/>Коллекторные двигатели имеют низкие КПД, удельную мощность и моторесурс. <br/>Но их конструкция проще, они дешевле и не требуют сложного регулятора для ра-<br/>боты. В свою очередь бесколлекторные двигатели практически не изнашиваются, <br/>если не считать выхода из строя дешевых китайских подшипников. При помощи <br/>регулятора оборотов можно организовать различные режимы: плавный разгон, <br/>торможение, ограничение по току, защиту от включения заблокированного двига-<br/>теля. <br/>Относительно недавно главным недостатком бесколлекторных двигателей была <br/>высокая цена, на 40–70% больше, чем у коллекторных двигателей аналогичной <br/>мощности, и моделисты были вынуждены изготавливать их самостоятельно, пере-<br/>матывая двигатели от приводов CD и видеомагнитофонов. Сейчас появились недо-<br/>рогие бесколлекторные двигатели в широчайшем ассортименте, поэтому выбор <br/>между коллекторными и бесколлекторными двигателями зависит от области при-<br/>менения. <br/>Коллекторные двигатели по-прежнему широко применяются в миниатюрных моде-<br/>лях, в том числе и в квадрокоптерах "наладонного" размера. В ситуации, когда идет <br/>борьба за каждый грамм веса, в миниатюрных коллекторных двигателях использу-<br/>ют бескаркасные (coreless) катушки ротора. Отсутствие отдельного регулятора обо-<br/>ротов также существенно снижает общий вес, поскольку для управления оборотами <br/>коллекторного двигателя достаточно одного транзистора, управляемого сигналом <br/>с полетного контроллера. Ограниченный ресурс примитивного коллекторно-ще-<br/>точного узла компенсируется дешевизной двигателя. Бесколлекторные двигатели <br/>для миниатюрных квадрокоптеров существуют, но дефицитны и стоят очень доро-<br/>го, поскольку столь ювелирную конструкцию сложно изготавливать серийно. <br/>С увеличением мощности двигателя возрастают коммутируемые токи в обмотках. <br/>Например, для двигателя квадрокоптера пиковые рабочие токи величиной 20–<br/>40 А — это обычное явление. Щеточный узел для таких токов должен иметь графи-<br/>товые щетки и мощный коллектор с большим пятном контакта, что существенно <br/>усложняет и утяжеляет конструкцию, сводя на нет выгоды бесколлекторного дви-<br/>гателя. Более того, сильнейшие помехи от искрящих щеточных узлов четырех мо-<br/>торов могут не только забить сигналы управления и GPS, но и вызвать сбои в рабо-<br/>те бортовой электроники. Поэтому в квадрокоптерах, начиная с диагонали 160 мм, <br/>коллекторные двигатели обычно не применяются. <br/><br/>58 Часть I. Теория <br/>Важным параметром бесколлекторного двигателя является его паспортная скорость <br/>вращения, измеряемая в оборотах на вольт питающего напряжения (обозначается <br/>как kV). В квадрокоптерах применяются низкооборотистые, по модельным меркам, <br/>двигатели с kV = 400–1200. Здесь мы плавно переходим к разговору о воздушных <br/>винтах, потому что двигатель и винт образуют единую винтомоторную пару, и <br/>правильнее будет рассуждать об оптимальном сочетании двух составляющих этой <br/>пары. <br/>Воздушные винты <br/>Не углубляясь в основы аэродинамики, рассмотрим общие принципы подбора вин-<br/>томоторной пары. Основными параметрами винта являются диаметр, шаг и количе-<br/>ство лопастей. Диаметр измеряется, как диаметр круга, образуемого при вращении <br/>винта. Шаг винта — это расстояние, пройденное винтом за один оборот при "ввин-<br/>чивании" в условную твердую среду. Увеличение шага винта повышает тягу при <br/>малых оборотах. Все винты, кроме совсем миниатюрных, имеют переменный шаг и <br/>профиль лопасти. Внимательно рассмотрев винт, вы увидите, что ближе к закон-<br/>цовке угол атаки лопасти уменьшается, а ее профиль становится более плоским. <br/>Зачем так делают? При движении точек по окружности с одинаковой угловой ско-<br/>ростью, чем дальше от центра вращения, тем выше линейная скорость точки. Кон-<br/>цевая часть лопасти движется со значительно большей линейной скоростью, чем <br/>корневая. Поэтому, чтобы сделать нагрузку на лопасть равномерной по всей длине <br/>(а точнее, дать больше нагрузки на прочную корневую часть), используют пере-<br/>менный профиль. В противном случае лопасти начнут выгибаться во время враще-<br/>ния даже при небольшой тяге, а также начнется срыв воздушного потока ближе <br/>к концам лопастей. <br/>При вращении винт создает подвижный воздушный поток, движущийся в направ-<br/>лении, противоположном направлению вектора тяги. Поскольку квадрокоптеры <br/>очень медленно перемещаются по вертикали, обычно применяется сочетание дви-<br/>гателей с низкими оборотами и винтов с большим шагом. <br/>Почему не рекомендуется использовать для квадрокоптеров моторы с высокими <br/>оборотами в паре с винтами малого шага? Для достижения максимального КПД <br/>скорость потока, создаваемого винтом, должна быть соотносима со скоростью пе-<br/>ремещения модели. В статическом состоянии, когда квадрокоптер висит, мощность <br/>"быстрой" винтомоторной пары расходуется крайне непродуктивно по причине <br/>возникающих завихрений и срывов потока в плоскости вращения винта. Упрощен-<br/>но говоря, при неподвижной или медленно движущейся модели "быстрый" винт <br/>вхолостую перемалывает воздух, находясь в неблагоприятной турбулентной среде. <br/>При этом резко возрастает потребляемый ток и возможен перегрев двигателя. <br/>На начальном этапе надо запомнить два простых интуитивных правила: <br/>� рабочие обороты двигателя и шаг винта находятся во взаимно обратной зависи-<br/>мости; <br/>� чем больше диаметр винта, тем меньше должны быть рабочие обороты двигателя. <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 59 <br/>Второе правило также нетрудно обосновать практическими соображениями. Ма-<br/>ленький винт даже при большом шаге не может создать достаточную удельную <br/>тягу, если обороты невелики. Если рассматривать квадрокоптер как единую массо-<br/>энергетическую систему, то чем крупнее квадрокоптер, тем выше КПД системы <br/>в целом. В маленьких "наладонниках" очень велика доля веса немасштабируемых <br/>или плохо масштабируемых элементов конструкции (микросхемы, провода, бата-<br/>рейка и т. д.) относительно развиваемой тяги. Кроме того, КПД малогабаритных <br/>винтов тоже невелик, т. к. плотность воздуха есть величина постоянная и при мас-<br/>штабировании винта не меняется. В силу этих причин наладонные нанокоптеры, <br/>как правило, могут нести в воздухе лишь самих себя, и то недолго. В то же время <br/>крупные коптеры могут летать существенно дольше и нести большую нагрузку. <br/>Одной из основных характеристик бесколлекторного двигателя является количест-<br/>во оборотов на один вольт питающего напряжения (kV). Для квадрокоптеров с диа-<br/>гональю 450–600 мм, как правило, оптимальными являются двигатели с kV 800–1200 <br/>и винты размера 8–11″ с шагом около 4,7″. В каждом конкретном случае потребу-<br/>ется произвести экспериментальный подбор оптимальных винтов под двигатель <br/>и нагрузку, т. к. винты даже одного размера, но от разных производителей, могут <br/>существенно различаться по динамическим характеристикам. Кроме того, произво-<br/>дители двигателей, особенно недорогих, зачастую грешат недостоверностью харак-<br/>теристик. <br/>Подбор оптимальной винтомоторной пары — это, по сути, параметрическая опти-<br/>мизация системы, где в качестве параметров участвуют также полетный вес систе-<br/>мы в сборе, максимальная токоотдача, вес батареи и т. д. Для удобства оптимиза-<br/>ции разработаны специальные программы и онлайн-приложения, о которых мы по-<br/>говорим позднее. <br/>При подборе винтов следует учитывать не только развиваемую тягу, но и способ-<br/>ность лопастей винта эту тягу удержать не деформируясь. Лопасти дешевых пла-<br/>стиковых винтов выгибаются под нагрузкой, теряя оптимальный профиль и КПД. <br/>Поэтому многие моделисты предпочитают использовать более дорогие, но прочные <br/>и легкие карбоновые винты. Кроме того, пластиковые винты склонны к флатте-<br/>ру — самовозбуждающимся колебаниям лопастей винта, которые происходят за <br/>счет энергии воздушного потока. Внешне флаттер выражается в появлении харак-<br/>терного "грязного" жужжащего звука при вращении винта и визуальном размытии <br/>краев плоскости вращения, если смотреть на вращающийся винт сбоку. Однако <br/>нужно уметь отличать флаттер от вибрации несбалансированной винтомоторной <br/>пары. Методы балансировки мы обсудим в части II книги. <br/>Надо особо отметить, что звук работающей винтомоторной пары для модели-<br/>ста очень важен и информативен. Опытному моделисту он без приборов говорит <br/>о многом: обороты, нагрузка на двигатель, качество балансировки, появление флат-<br/>тера на определенных оборотах, сбои в работе регулятора оборотов. Поэтому мно-<br/>гие пилоты, практикующие полеты по видеокамере (FPV), не ограничиваются ка-<br/>налом видео и добавляют канал звука, чтобы слышать двигатели в работе. <br/><br/>60 Часть I. Теория <br/>Регуляторы оборотов <br/>Как мы уже говорили ранее, регуляторы оборотов бесколлекторного двигателя <br/>представляют собой самостоятельное устройство на основе микроконтроллера. Не-<br/>смотря на внешнюю простоту решаемой задачи — коммутировать ток в обмотках <br/>бесколлекторного двигателя — микроконтроллер регулятора работает по весьма <br/>сложному алгоритму. Современный регулятор должен: <br/>� автоматически определять величину напряжения силовой батареи; <br/>� иметь защиту от перегрузки по току; <br/>� иметь защиту от запуска при механически заблокированном двигателе; <br/>� автоматически подстраиваться под количество полюсов конкретного двигателя; <br/>� иметь защиту от срыва синхронизации фазы. <br/>Последние два пункта, пожалуй, следует раскрыть подробнее. В зависимости от <br/>конструкции, двигатель может содержать различное количество полюсов катушек <br/>статора и магнитов ротора. Коммутация тока в обмотках должна происходить син-<br/>хронно (в фазе) с перемещением магнитов ротора, как бы "подгоняя" их. Если ал-<br/>горитм коммутации не соответствует числу полюсов или регулятор пытается при-<br/>дать двигателю ускорение, которое двигатель не может развить по причине слабых <br/>магнитов или неудачной конструкции, происходит срыв синхронизации, "проскок" <br/>фазы коммутации обмоток статора относительно реального положения магнитов <br/>ротора. При срыве синхронизации равномерный высокочастотный свист работаю-<br/>щего двигателя нарушается щелчками или хрипением, иногда можно визуально <br/>наблюдать рывки во вращении пропеллера. Срыв синхронизации может произойти <br/>также при просадке силового питающего напряжения в момент пиковой нагрузки. <br/>Кроме вышеупомянутых опций, регуляторы для квадрокоптеров должны обеспе-<br/>чивать особо острый отклик моторов на изменения управляющих сигналов, посту-<br/>пающих с контроллера. От этого напрямую зависит стабильность и управляемость <br/>мультикоптера. С другой стороны, квадрокоптеру не нужны самолетные режимы <br/>плавного разгона и торможения пропеллера. Напротив, такие режимы вредны. По-<br/>этому для использования на квадрокоптерах разработаны специальные регуляторы. <br/>Точнее, разработаны специальные прошивки для микроконтроллера в регуляторе. <br/>Из открытых проектов прошивок наиболее популярны SimonK и BLHeli. При же-<br/>лании и наличии опыта можно самостоятельно прошить подходящие регуляторы, <br/>однако в настоящее время можно без труда приобрести готовые, прошитые нужной <br/>прошивкой контроллеры (рис. 2.21). Это существенно сэкономит ваше время, а в <br/>случае неудачной прошивки и деньги. <br/>Регуляторы обычно крепят снаружи на лучи рамы, обеспечивая им хороший обдув. <br/>Отдельно следует упомянуть специальные комбо-регуляторы для квадрокоптеров, <br/>когда четыре регулятора и источник питания бортовой электроники смонтированы <br/>в одном корпусе (рис. 2.22). По сути, это четыре одинаковых независимых регуля-<br/>тора, которые объединены лишь общей печатной платой. Достоинствами такой <br/>конструкции являются отсутствие разветвителя силового питания и короткие сило- <br/> <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 61 <br/> <br/>Рис. 2.21. Регулятор оборотов бесколлекторного двигателя <br/> <br/> <br/>вые провода, что уменьшает магнитные наводки на компас, а также простота и эс-<br/>тетичность монтажа. Но есть и очень серьезный недостаток, перечеркивающий <br/>достоинства: невозможность замены сгоревшего регулятора. При аварии с замыка-<br/>нием проводки в цепи мотора регулятор зачастую перегорает, и для быстрого ре-<br/>монта достаточно иметь запасной регулятор, а перегоревший впоследствии можно <br/>не спеша наладить или приобрести еще один. В случае комбо-регулятора придется <br/>либо ремонтировать неисправный канал, что далеко не всегда осуществимо, либо <br/>покупать новый комбо-регулятор целиком. <br/> <br/> <br/> <br/>Рис. 2.22. Комбинированный четырехканальный регулятор <br/><br/>62 Часть I. Теория <br/>Батарея и зарядное устройство <br/>Суммарный пиковый ток, потребляемый моторами даже среднего мультикоптера, <br/>может достигать 70 А. Но при этом батарея должна быть как можно легче и иметь <br/>емкость, достаточную для полета как минимум 10 минут. Этим противоречивым <br/>требованиям лучше всего соответствуют литиевые аккумуляторы. <br/>Существуют две основные модификации литиевых аккумуляторов: литий-ионные <br/>(Li-Ion) и литий-полимерные (LiPo, Li-Pol), отличающиеся типом электролита. <br/>В литий-ионном аккумуляторе используется гелевый электролит, а в литий-поли-<br/>мерном — специальный полимер, насыщенный литийсодержащим раствором. <br/>В моделизме используются именно литий-полимерные батареи, т. к. они способны <br/>отдавать больший рабочий ток, что в нашем случае критически важно. Другим <br/>весомым преимуществом литий-полимерных батарей является отсутствие жидкого <br/>электролита и возможность изготавливать более прочные плоские аккумуляторы <br/>произвольного размера. В мобильных телефонах, планшетах, фотоаппаратах и про-<br/>чей бытовой электронике также используются литий-полимерные батареи, но они <br/>не рассчитаны на большой рабочий ток, поэтому от идеи использовать их в моде-<br/>лизме следует сразу отказаться. В остальном принципы работы, свойства и правила <br/>эксплуатации различных версий литиевых аккумуляторов не различаются. <br/>Литий-полимерные батареи собирают из отдельных аккумуляторных ячеек, кото-<br/>рые в обиходе традиционно называют "банками" (рис. 2.23). Ячейка представляет <br/>собой герметичный плоский пакет из очень прочного металлизированного пласти-<br/>ка, внутрь которого помещена слоеная структура из электродов, и сепараторов, <br/>пропитанных гелевым полимерным электролитом. Благодаря такой конструкции <br/>утечка электролита исключена, а сама батарея может иметь произвольную форму. <br/>Рабочее напряжение одной ячейки — 3,7 В. В зависимости от уровня заряда бата-<br/>реи напряжение может быть немного меньше или больше. Миниатюрные модели <br/>Рис. 2.23. Устройство литий-полимерной батареи <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 63 <br/>могут питаться от одной ячейки, наиболее распространенные батареи состоят из <br/>двух или трех последовательно соединенных ячеек. В особых случаях используют <br/>до восьми последовательных ячеек. Ячейки могут также соединяться параллельно <br/>для увеличения отдаваемого тока. <br/>Обозначения параметров силовой литиевой батареи <br/>� Емкость батареи (Capacity) выражается в миллиампер-часах (mAh) либо в ам-<br/>пер-часах (Ah), например "3300" или "3.3", и сокращенно обозначается бук-<br/>вой C. <br/>� Предельный разрядный ток в амперах принято обозначать величиной, кратной <br/>емкости C. Например, маркировка 20C при емкости 3300 mAh означает, что раз-<br/>рядный ток не должен превышать 20 ⋅ 3,3 = 66 А. Также иногда применяется <br/>маркировка Hi Discharge, обозначающая батарею с повышенным разрядным то-<br/>ком. При выборе батареи следует внимательно читать ее спецификацию. Произ-<br/>водители и продавцы высокого класса в описании батареи зачастую указывают <br/>два параметра: предельный длительный ток (continuous discharge), отдаваемый <br/>несколько минут подряд, и предельный пиковый ток (peak discharge) продолжи-<br/>тельностью не более 1–2 с. Значение предельного пикового тока может быть на <br/>15–20% больше, чем непрерывного. Разумеется, предельных пиковых нагрузок <br/>надо избегать, но несколько пиковых нагрузок за время эксплуатации не приве-<br/>дут к разрушению батареи или пожару. Однако китайские производители и про-<br/>давцы иногда слегка лукавят и указывают на этикетке батареи предельный пи-<br/>ковый ток. Поэтому, если вы не уверены, какой параметр указан на батарее и <br/>нигде это дополнительно не расшифровано, следует считать, что предельный <br/>длительный ток примерно на 20% меньше указанного на упаковке. <br/>� Предельный зарядный ток в амперах обычно ограничивается значением 1С. <br/>Например, батарею емкостью 3300 mAh можно заряжать током не более 3,3 А. <br/>Сейчас появились батареи с ускоренным зарядом (fast charge), которые можно <br/>заряжать током до 5C, что существенно сокращает время заряда, однако не сле-<br/>дует злоупотреблять этим режимом. При использовании ускоренного заряда ре-<br/>комендуется особенно внимательно следить за поддержанием баланса напряже-<br/>ния ячеек. <br/>� Схема соединения ячеек обозначается буквой S (serial) при последовательном <br/>соединении и буквой P (parallel) при параллельном соединении. Например, мар-<br/>кировка 3S обозначает три последовательно соединенные ячейки, что дает рабо-<br/>чее напряжение 3,7 ⋅ 3 = 11,1 В. Маркировка 3S2P означает, что ячейки соедине-<br/>ны параллельно по две для увеличения емкости и рабочего тока, затем три таких <br/>пары соединены последовательно. С появлением мощных силовых батарей па-<br/>раллельное соединение стало применяться реже. <br/>Литий-полимерные аккумуляторы имеют ограниченный срок службы. Причем да-<br/>же новый, ни разу не заряжавшийся аккумулятор теряет емкость при хранении. За <br/>2 года хранения нового аккумулятора теряется примерно 20% емкости. После пер-<br/>вого цикла заряда-разряда необратимые химические процессы старения резко уско-<br/><br/>64 Часть I. Теория <br/>ряются, и, как правило, за три календарных года аккумулятор теряет 40–60% емко-<br/>сти, даже если редко эксплуатируется. Силовые батареи с повышенной токоотдачей <br/>подвержены старению особенно сильно. Поэтому нет никакого смысла "экономить" <br/>литий-полимерную батарею после покупки. Наоборот, надо стараться сполна  <br/>исчерпать ее возможности, пока она еще новая. Также нежелательно покупать ста-<br/>рые батареи. Кроме естественного старения, батарея теряет емкость и токоотдачу  <br/>с каждым циклом заряда. Стандартный срок службы современного литий-<br/>полимерного аккумулятора составляет 600 циклов заряда-разряда. Но, как правило, <br/>у силовых батарей существенное снижение емкости и возрастание внутреннего со-<br/>противления происходит значительно раньше, что делает дальнейшую эксплуата-<br/>цию батареи нецелесообразной. <br/>Визуальным признаком деградации батареи является вздутие ячеек. Попытка вы-<br/>пустить газ через прокол оболочки, с последующей герметизацией липкой лентой, <br/>пользу не принесет, поскольку газ — это лишь следствие необратимых процессов <br/>химической деградации. Разгерметизация пакета приводит к ускорению окисли-<br/>тельных процессов внутри ячейки. Объективными признаками износа батареи  <br/>являются: <br/>� резкое падение емкости, батарея быстро заряжается и разряжается; <br/>� возрастание внутреннего сопротивления, из-за чего батарея сильнее нагревается <br/>и отдает меньший ток в нагрузку. <br/>Характерной особенностью литиевых батарей является разброс характеристик от-<br/>дельных ячеек, из которых она составлена. Производители качественных батарей <br/>осуществляют при сборке стендовый подбор и отбраковку ячеек, тогда как китай-<br/>ские фирмы могут собрать батарею не только из ячеек из разных фабричных пар-<br/>тий, но даже с разных фабрик. Часто бывает так, что лишь одна из последовательно <br/>включенных ячеек существенно состарилась, тогда как остальные могут послужить <br/>еще сезон. Поэтому полезно приобретать как минимум две одинаковые батареи, <br/>чтобы впоследствии иметь возможность собрать из двух батарей одну. Иметь запас <br/>полезно и на случай аварии, когда одна из ячеек может быть пробита. Чтобы вы-<br/>явить потенциально дефектную ячейку, достаточно регулярно измерять напряже-<br/>ние каждой ячейки на балансирном разъеме после полетов. Сниженное относи-<br/>тельно других ячеек напряжение укажет на "слабое звено". <br/>Зарядка литиевых батарей <br/>У литиевых батарей отсутствует так называемый "эффект памяти", поэтому их <br/>можно подзаряжать после частичной разрядки, и сколь угодно часто. Для них это <br/>будет даже полезно, тогда как хранение в разряженном состоянии, напротив, вред-<br/>но для батареи. Однако категорически запрещено повторно ставить на зарядку <br/>уже заряженную батарею! Это может привести к избыточному заряду с быстрым <br/>выходом батареи из строя или даже к пожару. <br/>Литий-полимерные батареи можно заряжать только при помощи специального <br/>зарядного устройства. Такое устройство может быть как специализированным, <br/>например, в комплекте с покупной моделью, так и универсальным, способным ра-<br/><br/>Глава 2. Обязательные компоненты квадрокоптера 65 <br/>ботать с разными типами батарей. Наиболее простую конструкцию имеет зарядное <br/>устройство для миниатюрных батареек, состоящих из одной ячейки. Такие бата-<br/>рейки используются в микрокоптерах наладонного размера и могут заряжаться от <br/>разъема USB. Универсальные зарядные устройства построены на основе микрокон-<br/>троллера (рис. 2.24 и 2.25) и позволяют настроить параметры заряда (напряжение и <br/>максимальный зарядный ток) под конкретную батарею, а также видеть на дисплее <br/>зарядного устройства количество энергии, "закачанной" в батарею, и продолжи-<br/>тельность заряда. Более продвинутые устройства также позволяют использовать <br/>термосенсор для контроля температуры батареи. Зарядные устройства, управ- <br/>ляемые микроконтроллером, иногда называют интеллектуальными (Intelligent <br/>Charger). <br/> <br/>Рис. 2.24. Зарядное устройство для миниатюрных аккумуляторов  <br/>на основе интегрального контроллера заряда <br/> <br/>Рис. 2.25. Универсальное зарядное устройство на основе микроконтроллера <br/>Как мы уже говорили, ячейкам, из которых состоит батарея, присущ разброс пара-<br/>метров. Обычно после разрядки напряжение на ячейках слегка различается. Но в <br/>процессе зарядки напряжение на ячейках необходимо уровнять с точностью не ме-<br/>нее 0,01 В. Если при каждом цикле заряда просто подавать зарядное напряжение на <br/>батарею, она, конечно же, зарядится до нужного напряжения, но при этом какие-то <br/><br/>66 Часть I. Теория <br/>ячейки останутся слегка недозаряженными, а какие-то будут регулярно испытывать <br/>перезаряд — возникнет так называемая разбалансировка батареи, приводящая к <br/>ускоренному выходу некоторых ячеек из строя. Для выравнивания напряжения на <br/>ячейках батареи оснащают отдельным балансирным разъемом, на который выведе-<br/>ны провода от контактов всех ячеек. Этот разъем подключают к специальному <br/>электронному устройству — балансиру (рис. 2.26), который в процессе заряда пе-<br/>рераспределяет зарядный ток между ячейками, выравнивая их заряд. Большинство <br/>современных зарядных устройств оснащено встроенным балансиром. <br/> <br/> <br/>Рис. 2.26. Специальный балансир/разрядник/тестер для литиевых батарей <br/>Нет острой нужды использовать балансир при каждой зарядке, особенно если бата-<br/>рея качественная. Но контроль напряжения ячеек необходимо вести постоянно. <br/>Категорически запрещается ставить на зарядку батарею, у которой напряжение <br/>между ячейками различается более, чем на 20%! Это чревато перезарядом тех яче-<br/>ек, у которых напряжение выше, перегревом с разгерметизацией и пожаром. Если <br/>вы хотите попытаться реанимировать батарею с большим разбросом напряжений <br/>на ячейках, необходимо сначала через балансирный разъем отдельно подзарядить <br/>самую разряженную ячейку (ячейки). <br/>Зарядка силовых литий-полимерных батарей производится фиксированным напря-<br/>жением из расчета 4,20 В на ячейку и заданным для данной батареи током. В про-<br/>цессе заряда батареи напряжение на ее клеммах постепенно повышается, а зарядное <br/>устройство не позволяет зарядному току превысить заданное значение. Этот режим <br/>называется режимом стабилизации тока. Через некоторое время напряжение на ба-<br/>тарее достигает значения 4,20 В на ячейку и далее не нарастает. Этот режим назы-<br/>вается режимом стабилизации напряжения. К моменту перехода в режим стабили-<br/>зации напряжения батарея набирает примерно 70–80% емкости и потребляемый <br/>батареей зарядный ток начинает снижаться. При снижении зарядного тока до 0,1–<br/>0,2C процесс заряда завершается. Длительный заряд малыми токами не применя-<br/>ется и, в отличие от никель-кадмиевых аккумуляторов, для литиевых аккумулято-<br/>ров вреден и грозит избыточным зарядом. <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 67 <br/>ПРИМЕЧАНИЕ <br/>При отрицательных температурах литиевые аккумуляторы вообще не заряжаются, а <br/>положительная температура не должна превышать 50 °C. <br/>Особенности эксплуатации и хранения <br/>Литиевые аккумуляторы чрезвычайно капризны и требуют очень аккуратного об-<br/>ращения. Глубокий разряд ячейки до напряжения 2,7–2,9 В приводит к быстрому <br/>снижению ресурса. При разряде до 2,5 В или ниже ячейка полностью выходит из <br/>строя в течение 20–30 минут. Если испорченная батарея состоит из нескольких яче-<br/>ек, следует проверить напряжение на каждой ячейке в отдельности. Зачастую вы-<br/>ходит из строя только одна ячейка и оставшиеся можно будет использовать в каче-<br/>стве запасных или собрать из них батарею на меньшее напряжение. <br/>ПРИМЕЧАНИЕ <br/>Избыточный заряд до напряжения выше 4,20 В приводит не только к выходу ячейки из <br/>строя. Возможно вздутие ячеек, перегрев, разгерметизация и пожар. <br/>При температуре ниже –5 °C батарея стремительно теряет накопленный заряд даже <br/>без нагрузки. Как показывает практика, при температуре батареи –5...–10 °C время <br/>полета сокращается вдвое. Вспомните, кстати, как быстро разряжаются на морозе <br/>смартфоны и прочие гаджеты, питаемые от литий-ионных батареек. Для защиты <br/>литиевых батарей от холода применяются специальные подогреваемые чехлы  <br/>с термостатом (рис. 2.27). Важно сохранить батарею в тепле до начала полета, а под <br/>нагрузкой она будет частично подогревать сама себя. <br/>Нагрев до температуры около 60 °C приводит к быстрой деградации батареи. При <br/>нагреве до 70 °C вследствие перегрузки или короткого замыкания начинается цеп- <br/> <br/> <br/> <br/>Рис. 2.27. Подогреваемый чехол с термостатом  <br/>для предполетной транспортировки литиевых батарей <br/><br/>68 Часть I. Теория <br/>ная реакция саморазогрева за счет накопленной энергии и последующий пожар. <br/>Разряженный аккумулятор при замыкании не загорится, а тихо выйдет из строя. <br/>Подготовка батарей к хранению <br/>По поводу хранения данные несколько противоречивы. С одной стороны, в регла-<br/>менте обслуживания и хранения литиевых аккумуляторов предписано хранение  <br/>с зарядом 75% от номинала. С другой стороны, экспериментальные данные пока-<br/>зывают, что силовые батареи лучше всего сохраняют свои параметры при хранении <br/>с зарядом 45–50% от номинального заряда и температуре около +10 °C. Вероятно, <br/>истина в том, что с фабрики новые батареи поступают заряженными на 75%, а по-<br/>сле начала эксплуатации их лучше хранить при заряде 50%. В любом случае, хра-<br/>нение полностью заряженных аккумуляторов приводит к быстрой потере емкости. <br/>Например, по опыту автора, хранение полностью заряженных батарей при комнат-<br/>ной температуре с ноября по март привело к сокращению полетного времени на <br/>35%. При этом емкость батарей, измеряемая зарядным устройством, уменьшилась <br/>лишь на 15%. Но резко возросло внутреннее сопротивление батарей, и существен-<br/>ная часть энергии стала расходоваться на их нагрев. <br/>Под длительным хранением мы подразумеваем перерыв в использовании батарей <br/>на срок более трех месяцев. Поэтому, если перерыв в полетах составит две-три не-<br/>дели, специально готовить батарею к хранению не надо. Но при подготовке к дли-<br/>тельному хранению все же лучше воспользоваться специальным балансиром-<br/>разрядником или интеллектуальным зарядным устройством, тщательно отбаланси-<br/>ровать ячейки и разрядить батарею приблизительно до 50% емкости. <br/>Если вы используете несколько одинаковых батарей, то рекомендуется наклеить на <br/>них липкие этикетки или кусочки малярного скотча и условными значками отме-<br/>чать каждый цикл "разряд/заряд", а также подозрительные ячейки. Это позволит <br/>распределить нагрузку между батареями и более качественно их обслуживать. <br/>Источник бортового питания <br/>От качества источника бортового питания (ВЕС, Battery Elimination Circuit) напря-<br/>мую зависит безопасность полетов, поскольку проблемы с источником могут <br/>стать причиной непонятных эпизодических сбоев в работе бортовой электроники, <br/>вплоть до внезапной перезагрузки полетного контроллера в воздухе. Поэтому ис-<br/>точники бортового питания заслуживают отдельного развернутого обсуждения. <br/>Некоторые дополнительные электронные модули, такие как видеокамера, видеопе-<br/>редатчик или передатчик сигнала телеметрии, могут питаться от напряжения +12 В <br/>и допускают прямое подключение к литий-полимерной батарее с напряжением 3S. <br/>В большинстве случаев для питания бортового оборудования коптера (полетный <br/>контроллер, радиоприемник, навигация и т. д.) требуется напряжение +5 В. Это ис-<br/>торически сложившееся напряжение питания еще с тех времен, когда стандартная <br/>цифровая электроника широкого применения была пятивольтовой. <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 69 <br/>Многие современные интегральные компоненты работают при напряжении пита-<br/>ния 3,3 В. В этом случае на плате устройства, как правило, присутствует дополни-<br/>тельная микросхема интегрального стабилизатора, преобразующего 5 В в 3,3 В. <br/>ВНИМАНИЕ! <br/>Надо быть особенно аккуратным и внимательным при использовании в своих разра-<br/>ботках миниатюрных модулей GPS, Bluetooth или мини-видеокамер. Зачастую эти мо-<br/>дули не содержат встроенный источник 3,3 В и должны быть смонтированы на мате-<br/>ринской плате, где такой источник установлен. Подача напряжения 5 В почти наверня-<br/>ка выведет низковольтный модуль из строя. И наоборот, при питании пятивольтового <br/>модуля от источника 3,3 В он будет либо работать очень нестабильно, либо не будет <br/>работать вовсе. Причем иногда модули выпускаются в двух вариантах питания, а не-<br/>добросовестные китайские продавцы не обращают на это внимание. Поэтому перед <br/>первым подключением питания тщательно убедитесь в том, на какое рабочее напря-<br/>жение рассчитан модуль. Допускается напрямую питать 3,3-вольтовые устройства от <br/>одноячеечной литий-полимерной батареи с рабочим напряжением 3,60–3,72 В. <br/>Источники бортового питания представляют собой стабилизатор напряжения и бы-<br/>вают двух видов: последовательные линейные и импульсные. <br/>Последовательный линейный стабилизатор <br/>Последовательный линейный стабилизатор включается в разрыв питающей це-<br/>пи (рис. 2.28). Падение напряжения происходит за счет внутреннего омического <br/>сопротивления стабилизатора, поэтому значительная часть драгоценной электриче-<br/>ской энергии батареи превращается в тепло и рассеивается в окружающем про-<br/>странстве. По сути, линейный стабилизатор представляет собой управляемое со-<br/>противление с обратной связью, реагирующее на колебания напряжения на входе и <br/>нагрузке. В соответствии с формулой WR = URI, чем больше падение напряжения <br/>на сопротивлении и ток в цепи нагрузки, тем больше тепла выделяется на сопро-<br/>тивлении. Очевидно, что при питании пятивольтовой нагрузки от батареи напряже-<br/>нием 12 В на регуляторе падает 7 В, т. е. больше половины. Соответственно, боль-<br/>ше половины потребляемой энергии будет напрасно рассеиваться на стабилизаторе <br/>в виде тепла. В этом и состоит главный недостаток линейных стабилизаторов — <br/>низкий КПД. <br/> <br/>Рис. 2.28. Схема включения линейного стабилизатора <br/>Достоинствами линейного стабилизатора являются простота конструкции (в боль-<br/>шинстве случаев это микросхема с тремя выводами), малый вес и габариты, деше-<br/>визна, универсальность, отсутствие внешних компонентов схемы. Большинство <br/><br/>70 Часть I. Теория <br/>современных микросхем стабилизаторов оснащены встроенной защитой от корот-<br/>кого замыкания и перегрева, иногда от переполюсовки. Поэтому линейные инте-<br/>гральные стабилизаторы по-прежнему широко применяются и во многих случаях <br/>незаменимы, поскольку для миниатюрных и маломощных устройств использование <br/>более сложных стабилизаторов технически и экономически нецелесообразно. Од-<br/>нако с ростом потребляемого тока или разности входного и выходного напряжений <br/>эффективность линейных стабилизаторов катастрофически снижается. <br/>Традиционно принято встраивать интегральные линейные стабилизаторы на плату <br/>регулятора оборотов бесколлекторного двигателя. Эта традиция пошла от самолет-<br/>ной практики, для упрощения конструкции и экономии места. В большинство регу-<br/>ляторов оборотов для мультикоптеров их также продолжают встраивать, в резуль-<br/>тате мы по умолчанию имеем на борту четыре одинаковых источника +5 В, по од-<br/>ному от каждого из регуляторов. <br/>К сожалению, использование этих источников для питания бортовой аппаратуры не <br/>всегда приемлемо. Во-первых, регулятор оборотов мотора является источником <br/>импульсных помех, проникающих за источник питания. И если для питания полет-<br/>ного контроллера это не критично, то при питании видеокамеры или видеопередат-<br/>чика эти помехи могут быть заметны на изображении и в канале звука. Во-вторых, <br/>регуляторы оборотов и без того нагреваются в полете, иногда довольно сильно.  <br/>И если нагрузить до предела один из встроенных стабилизаторов, то соответст-<br/>вующий регулятор может перегреться. <br/>Допускается соединять выходы всех встроенных стабилизаторов +5 В параллельно, <br/>тем самым равномерно распределяя нагрузку между ними. Это допустимо, если <br/>нужно питать только полетный контроллер и приемник. Видеокамеру и аппаратуру <br/>видео- и аудиоканала все-таки лучше питать от независимого стабилизатора на-<br/>пряжения, даже если он подключен к той же самой силовой батарее. <br/>ПРИМЕЧАНИЕ <br/>Еще один важный нюанс: некоторые полетные контроллеры требуют повышенного на-<br/>пряжения питания, не ниже 5,25 В (но не выше 5,6 В) из-за того, что напряжение пита-<br/>ния падает на последовательно включенных защитных диодах схемы контроллера. Но <br/>на выходе BEC, встроенных в регуляторы оборотов, под нагрузкой чаще всего полу-<br/>чается 4,85–4,90 В. При таком напряжении питания, например, полетные контроллеры <br/>MultiWii AIOP v.2 начинают непредсказуемо сбоить и зависать. Некоторые производи-<br/>тели специализированных мультикоптерных регуляторов оборотов учли эту проблему <br/>и выпускают регуляторы с повышенным выходным напряжением встроенного BEC. <br/>Если у ваших регуляторов оборотов заниженное напряжение источников +5 В, питайте <br/>от них сервомашинки, подсветку и т. д., а для питания контроллера используйте от-<br/>дельный источник. <br/>Импульсные стабилизаторы-преобразователи <br/>В импульсных стабилизаторах постоянное входное напряжение при помощи встро-<br/>енного генератора и силового ключа преобразуется в импульсы высокой частоты  <br/>с регулируемой длительностью при неизменной частоте. Отношение периода по-<br/><br/>Глава 2. Обязательные компоненты квадрокоптера 71 <br/>вторения электрических импульсов к их длительности называется скважностью S,  <br/>а обратная величина 1/S — коэффициентом заполнения. Чем выше коэффициент <br/>заполнения, тем больше количество энергии, передаваемой со входа стабилизатора <br/>на выход, и тем выше напряжение на выходном каскаде. <br/>Поскольку напряжение регулируется только за счет длительности активных им-<br/>пульсов, а все остальное время ток через силовой ключ регулятора не протекает, то <br/>потери энергии минимальны и КПД импульсного регулятора значительно выше, <br/>до 95%. <br/>В отличие от линейного стабилизатора, работающего только с понижением напря-<br/>жения, импульсные стабилизаторы могут быть как понижающие (Step-Down), так и <br/>повышающие (Step-Up), а по типу схемы бестрансформаторные (Switched BEC)  <br/>и трансформаторные (UBEC). Чаще используются бестрансформаторные пони-<br/>жающие преобразователи на ключевом элементе. Структурная схема такого преоб-<br/>разователя показана на рис. 2.29. <br/> <br/> <br/>Рис. 2.29. Структурная схема понижающего преобразователя <br/> <br/>Управляемый напряжением генератор V вырабатывает импульсы переменной <br/>i<br/>скважности, которые управляют ключом S. В качестве ключа обычно используются <br/>MOSFET-транзисторы с низким проходным сопротивлением канала, что снижает <br/>потери энергии на нагрев. Когда ключ замкнут, ток начинает протекать через нако-<br/>пительную цепь из дросселя L и конденсатора C, заряжая конденсатор. Напряжение <br/>на нагрузке R равно разности напряжения источника питания и ЭДС самоиндукции <br/>дросселя, ток через дроссель растет, как и напряжение на конденсаторе и нагрузке. <br/>При размыкании ключа ток самоиндукции дросселя продолжает протекать через <br/>нагрузку в том же направлении через диод D, а также через нагрузку протекает ток <br/>разряда конденсатора. Далее цикл повторяется. Чем выше коэффициент заполнения <br/>импульсов, тем выше напряжение на конденсаторе и нагрузке. Генераторы им-<br/>пульсных преобразователей работают на высоких частотах, от сотен килогерц до <br/>единиц мегагерц, что позволяет снизить габариты накопительного дросселя и кон-<br/>денсатора. <br/>Встроенная цепь обратной связи генератора отслеживает выходное напряжение и <br/>при падении напряжения на нагрузке увеличивает длительность импульсов, и на-<br/>оборот. Преобразователь может быть как регулируемым, так и настроенным на за-<br/>данное выходное напряжение. <br/><br/>72 Часть I. Теория <br/>Достоинства импульсных преобразователей: <br/>� высокий КПД; <br/>� широкий диапазон входных и выходных напряжений; <br/>� возможность плавной регулировки напряжения. <br/>Недостатки импульсных преобразователей надо обязательно иметь в виду. <br/>� При пробое ключа в схеме преобразователя напряжение первичного источника <br/>оказывается полностью приложенным к нагрузке и, как правило, выводит ее из <br/>строя. Это, пожалуй, самый неприятный и опасный недостаток. <br/>� Импульсные помехи для чувствительного оборудования. Но, как показала прак-<br/>тика, рабочие частоты и их гармоники даже у самых дешевых преобразователей <br/>не мешают радиоприему и телеметрии на частоте 2,4 ГГц, а также работе <br/>GPS/ГЛОНАСС и незаметны на картинке видеокамеры. Низкочастотные каналы <br/>связи диапазона 40–70 МГц могут испытывать помехи от преобразователя. <br/>� Более сложная конструкция, больше вес и габариты по сравнению с интеграль-<br/>ным линейным стабилизатором. <br/>Индикатор разряда батареи <br/>Вы уже знаете, что регуляторы оборотов имеют функцию плавного отключения <br/>при разряде батареи ниже аварийного уровня. Эта функция спасает батарею от глу-<br/>бокого разряда, но способна погубить квадрокоптер, поскольку от начала плавного <br/>снижения тяги до полной ее потери проходит не более 40 с. Этого достаточно, что-<br/>бы плавно посадить коптер, находящийся рядом, но вернуть его с дистанции в не-<br/>сколько сотен метров вы уже не успеете. Поэтому наличие индикатора разряда <br/>батареи критически важно для безопасных полетов. <br/>Индикаторы разряда бывают двух видов: телеметрийный и звуковой. В варианте  <br/>с телеметрией напряжение силовой батареи измеряется полетным контроллером <br/>или модулем телеметрии, и далее либо передается в общем потоке данных на при-<br/>емную станцию для отображения на мониторе, либо накладывается на видеоизоб-<br/>ражение, принимаемое с бортовой камеры. Достоинствами такого метода является <br/>точность индикации, обычно до десятых долей вольта, и большая дальность дейст-<br/>вия, а также возможность приблизительно оценить оставшееся полетное время. <br/>Но телеметрия используется не всегда. При полетах в пределах прямой видимости, <br/>когда сохраняется достаточная слышимость, можно (точнее, обязательно нужно!) <br/>использовать звуковой индикатор разряда батареи. При достижении порогового <br/>значения, но раньше, чем срабатывает отсечка регуляторов, индикатор подает пре-<br/>рывистый звуковой сигнал. Как правило, после этого в распоряжении оператора <br/>остается 1–2 минуты полетного времени, чтобы вернуть и посадить коптер. <br/>На индикаторе лучше не экономить и приобрести такой вариант, который подклю-<br/>чается к балансирному разъему и контролирует каждую ячейку в отдельности,  <br/>а также миганием светодиода показывает, какая из ячеек разрядилась раньше <br/><br/>Глава 2. Обязательные компоненты квадрокоптера 73 <br/>(рис. 2.30). Это поможет избежать ситуации, когда одна из ячеек раньше других <br/>разрядилась до критического значения, тогда как напряжение батареи в целом  <br/>остается в пределах нормы. Индикатор лучше всего монтировать в задней части <br/>рамы, излучателем в сторону оператора. Желательно выбирать индикатор со специ-<br/>альным громким излучателем. <br/> <br/> <br/>Рис. 2.30. Индикатор разряда батареи с раздельным контролем ячеек <br/> <br/><br/>  <br/> <br/> <br/>ГЛАВА 3 <br/> <br/> <br/> <br/>   <br/> <br/>Дополнительные компоненты <br/>квадрокоптера <br/>Оборудование видеоканала FPV <br/>Многие владельцы квадрокоптеров не согласятся с тем, что видеооборудование <br/>квадрокоптера отнесено ко вторичным аксессуарам, поскольку приобретают или <br/>строят коптеры именно ради полетов по видеокамере и/или высотной фотовидео-<br/>съемки. Простые полеты в пределах визуального контроля быстро наскучивают, <br/>зато полеты с видом "своими глазами" по FPV (Flight Per Video или First Person <br/>View) с высоты птичьего полета дают неповторимые ощущения. Оборудование для <br/>таких полетов можно дорабатывать почти бесконечно, что само по себе очень ин-<br/>тересно. <br/>Видеооборудование коптера в общем случае состоит из следующих компонентов: <br/>� видеокамеры, курсовая и основная; <br/>� видеокоммутатор; <br/>� стабилизированный подвес камеры; <br/>� модуль наложения информации на изображение (OSD); <br/>� видеопередатчик; <br/>� всенаправленная антенна. <br/>� источник питания видеооборудования. <br/>Наземная часть видеоканала также состоит из нескольких компонентов: <br/>� видеоприемник; <br/>� антенны, всенаправленная и направленная; <br/>� система управления положением антенны (трекер); <br/>� видеоочки и/или монитор; <br/>� видеорекордер; <br/>� источник питания. <br/><br/>Глава 3. Дополнительные компоненты квадрокоптера 75 <br/>Видеокамеры <br/>Для полетов по FPV в сочетании с видовой или репортажной съемкой удобнее ис-<br/>пользовать две камеры, курсовую и основную. Курсовая камера легкая, несложная и <br/>дает изображение среднего качества. Она монтируется на раме коптера в фиксиро-<br/>ванном положении, удобном для оператора и направляется слегка под углом к зем-<br/>ле. Такая камера имитирует вид из кабины пилота и дает ясное представление  <br/>о том, куда и под каким углом летит коптер, и есть ли препятствия на пути. На изо-<br/>бражение с этой камеры, как правило, накладывается телеметрийная информация. <br/>Основная камера имеет высокое разрешение, обычно FullHD, хорошую оптику и <br/>слот карты памяти для записи изображения. На крупных мультикоптерах часто  <br/>устанавливают фотокамеры профессионального уровня — Canon, Kodak, Sony — <br/>способные вести качественную видеосъемку. Для таких камер выпускаются специ-<br/>альные переходники, которые подключаются к разъему управления камеры и при-<br/>емнику, позволяя управлять режимом камеры дистанционно, с пульта. <br/>Основная камера крепится на стабилизированном подвесе, который сохраняет не-<br/>изменное положение камеры при кренах коптера, а также позволяет вращать каме-<br/>ру по двум осям, обеспечивая почти полусферический обзор. <br/>Удобство использования двух камер объясняется тем, что эффектную видовую <br/>съемку часто приходится вести не под тем ракурсом, который соответствует курсо-<br/>вому положению рамы коптера. В этом случае оператор может легко утратить кон-<br/>троль над пространственным положением коптера и столкнуться с препятствием <br/>или неверно оценить направление облета. При профессиональной съемке иногда <br/>работают два человека, пилот и видеооператор, а коптер оснащают двумя незави-<br/>симыми видеоканалами и двумя каналами радиоуправления, один из которых <br/>предназначен только для управления подвесом и режимами главной видеокамеры. <br/>Видеокоммутатор <br/>Если пилот-оператор один и нуждается в том, чтобы поочередно использовать кур-<br/>совую и обзорную камеры, то для переключения между камерами применяется  <br/>видеокоммутатор (рис. 3.1). К двум или трем видеовходам коммутатора подключа-<br/>ются различные источники видеосигнала, а вход управления соединяется с одним <br/> <br/>Рис. 3.1. Трехканальный видеокоммутатор <br/><br/>76 Часть I. Теория <br/>из каналов приемника. В зависимости от длительности импульсов радиоуправления <br/>выбирается соответствующий видеовход, а с выхода сигнал поступает непосредст-<br/>венно на передатчик или модуль OSD. <br/>В простых любительских системах FPV часто используется только одна камера, <br/>смонтированная на управляемом по двум осям стабилизированном подвесе. <br/>Стабилизированный подвес <br/>Стабилизированный (динамический) подвес (рис. 3.2) удерживает неизменное уг-<br/>ловое положение камеры в пространстве при небольших колебаниях рамы коптера <br/>(крены и повороты). Конструктивно подвес камеры представляет собой карданный <br/>узел с двумя осями вращения и в простейшем случае может не иметь системы ста-<br/>билизации, а управляться напрямую с выходов приемника сигналов радиоуправле-<br/>ния. Но при этом малейший крен или поворот рамы коптера будет приводить  <br/>к смещению изображения в кадре, что крайне нежелательно при видеосъемке и <br/>часто бывает неудобно при обычном пилотировании по FPV. <br/> <br/>Рис. 3.2. Простой двухосевой подвес на сервомашинках <br/>Для стабилизации подвеса по горизонту обычно применяются не гироскопы, кото-<br/>рым свойственно накопление ошибки, а трехосевые акселерометры. Для отсле- <br/>живания поворота по азимуту приходится использовать либо гироскоп, либо  <br/>комплексный сигнал гироскопа и компаса, поскольку на поворот по курсу акселе-<br/>рометр не реагирует. В простых системах флуктуации по курсу вообще не компен-<br/>сируются. <br/>При построении системы стабилизации используют один из двух возможных ис-<br/>точников данных о положении в пространстве: <br/>� полетный контроллер отслеживает изменения углового положения коптера и <br/>вычисляет компенсирующий сигнал для подвеса таким образом, чтобы угловое <br/><br/>Глава 3. Дополнительные компоненты квадрокоптера 77 <br/>положение камеры относительно горизонта не изменялось при колебаниях  <br/>рамы; <br/>� подвес оснащен независимым контроллером с акселерометрами и гироскопами, <br/>который отслеживает угловое положение камеры и компенсирует малейшие от-<br/>клонения. <br/>Первый вариант наиболее очевиден и экономичен, поскольку полетный контроллер <br/>уже оснащен необходимыми датчиками ускорений. При таком способе стабилиза-<br/>ции отсутствует положительная обратная связь, возникающая вследствие избыточ-<br/>ного отклика системы (раскачка). Но, с другой стороны, отсутствие обратной связи <br/>порождает высокие погрешности, особенно при быстрых и значительных отклоне-<br/>ниях рамы. Быстродействие системы также невысоко, потому что полетный кон-<br/>троллер кроме расчета стабилизации решает множество других задач. Этот вариант <br/>системы стабилизации по умолчанию заложен в прошивки популярных полетных <br/>контроллеров. <br/>Во втором случае контроллер подвеса по сложности и цене сопоставим с полетным <br/>контроллером и требует отдельной настройки параметров отклика под конкретную <br/>камеру. Но динамическая стабилизация камеры во втором случае заметно выше. <br/>В качестве исполнительного механизма, вращающего привод, в простейшем случае <br/>используются сервомашинки, у которых также много недостатков: высокая по-<br/>грешность, низкое время отклика, низкий крутящий момент, хрупкий редуктор,  <br/>ограниченный угол поворота. Сервомашинки обычно применяются в первом вари-<br/>анте системы и подключаются непосредственно к выводам полетного контроллера. <br/>В последнее время для вращения подвеса применяют бесколлекторные двигатели <br/>специальной конструкции (по сути, шаговые двигатели) — рис. 3.3. Они стоят за-<br/> <br/>Рис. 3.3. Двухосевой подвес с собственным контроллером и бесколлекторным приводом <br/><br/>78 Часть I. Теория <br/>метно дороже обычных сервомашинок, хотя по цене совместимы с хорошими сер-<br/>вомашинками с металлическим редуктором. Некоторые владельцы коптеров изго-<br/>тавливают их самостоятельно, переделывая обычные бесколлекторные двигатели. <br/>Бесколлекторные приводы нельзя подключать к выходам обычного полетного кон-<br/>троллера. Их используют в комплекте с независимым контроллером стабилизации <br/>подвеса или подключают к полетному контроллеру через специальный адаптер на <br/>основе микроконтроллера. Дополнительная сложность использования бесколлек-<br/>торных приводов заключается в необходимости отслеживать действительный угол <br/>поворота камеры и иметь защиту от избыточного отклонения. <br/>Видеопередатчик и видеоприемник <br/>Передача видеосигнала в любительской практике обычно происходит в разрешен-<br/>ных диапазонах 2,4 и 5,8 ГГц. В последнее время оборудование видеоканала на <br/>5,8 ГГц получает все большее распространение по причине малых габаритов и веса <br/>передающих модулей и антенн, а также снижения стоимости. Но сигнал на этой <br/>частоте сильнее подвержен затуханиям и отражениям. Как следствие, дальность <br/>надежной работы видеоканала на частоте 5,8 ГГц меньше и применяется он пре-<br/>имущественно на небольших коптерах и ближних дистанциях полетов (рис. 3.4).  <br/>В более сложных случаях используется оборудование диапазона 2,4 ГГц и даже <br/>900 МГц. <br/> <br/>Рис. 3.4. Миниатюрный бортовой передатчик диапазона 5,8 ГГц <br/>Видеопередатчик, как правило, поддерживает лишь несколько каналов (обычно во-<br/>семь) в одном из частотных поддиапазонов (группе каналов). Рабочий канал уста-<br/>навливается перемычкой или переключателем. Приемник в простейшем случае <br/>представляет собой готовый модуль, также работающий на одном из восьми кана-<br/>лов. Но рекомендуется сразу приобрести более сложный приемник, работающий на <br/><br/>Глава 3. Дополнительные компоненты квадрокоптера 79 <br/>всех частотных поддиапазонах. Это обеспечит совместимость с передатчиками раз-<br/>личных производителей. Таблица частот каналов приведена в приложении 2. <br/>Антенна бортового передатчика всенаправленная, обычно типа "клевер" или шты-<br/>ревая. В миниатюрных коптерах используются четвертьволновые штыревые антен-<br/>ны в виде отрезка провода. Наземный приемник может быть оснащен направленной <br/>или диверсифицированной антенной и системой слежения за источником сигнала <br/>(см. разд. "Антенны" главы 2). <br/>Если бортовая камера не оснащена функцией видеозаписи, то для записи изобра-<br/>жения может использоваться наземный видеорекордер, подключаемый к выходу <br/>видеоприемника. <br/>Видеомонитор и видеоочки <br/>К мониторам, используемым для полетов по FPV, предъявляются особые требова-<br/>ния. Очевидно, что такой монитор должен быть достаточно ярким, контрастным и с <br/>широкими углами обзора, чтобы обеспечить качественное изображение в солнеч-<br/>ный день. Но, кроме того, монитор не должен переключаться в дежурный режим <br/>"синий экран" при кратковременной потере сигнала или срыве синхронизации. Он <br/>должен продолжать отображать помехи, полосы, "снег" — но ни в коем случае не <br/>отключаться. Дело в том, что видеосигнал подвержен кратковременным пропада-<br/>ниям при воздействии случайной помехи или неудачной взаимной ориентации ан-<br/>тенн. Если при этом монитор уходит в режим ожидания, то для обратного включе-<br/>ния ему требуется дополнительно 1–3 с, в течение которых оператор не видит изо-<br/>бражение. Это очень некомфортно, а в сложной ситуации такая задержка может <br/>стать критической. Поэтому монитор для FPV не должен отключаться при пропа-<br/>дании или сильном ухудшении видеосигнала. В описании таких мониторов обычно <br/>особо подчеркивается: "no blue screen". Обратите на это внимание при покупке. <br/>Видеоочки при помощи двух маленьких ЖК-дисплеев и оптической системы ими-<br/>тируют просмотр большого монитора с расстояния полутора-двух метров. При <br/>этом оператор визуально изолирован от окружающей среды, ему не мешает сол-<br/>нечное освещение и окружающая обстановка, а "эффект полета" наиболее ощутим. <br/>В простых системах используется внешний видеоприемник и недорогие бытовые <br/>видеоочки, предназначенные для просмотра фильмов и видеоигр. Этим их функ-<br/>циональность и ограничивается. Специализированные очки для FPV обычно со-<br/>держат встроенный видеоприемник, батарею питания, антенну, слот для карты па-<br/>мяти и работают автономно. Дорогие модели видеоочков содержат трекер положе-<br/>ния головы пилота (head tracking system). Сигнал с трекера подается на пульт <br/>радиоуправления, в каналы управления положением камеры. При наклоне или по-<br/>вороте головы соответствующим образом меняется положение камеры. <br/>К встроенному в очки приемнику обычно подключается простая штыревая антенна. <br/>Для увеличения дальности приема приходится использовать выносной приемник  <br/>с более сложной антенной системой и подавать видеосигнал на очки по кабелю. <br/>На сегодняшний день наиболее недорогим решением являются видеоочки Quanum, <br/>представляющие собой пенопластовый корпус, в который вмонтирован один жид-<br/><br/>80 Часть I. Теория <br/>кокристаллический дисплей формата 16:9, а перед ним размешается линза Френеля, <br/>позволяющая смотреть на дисплей с расстояния в несколько сантиметров. Переме-<br/>щая линзу, можно настроить очки под свою остроту зрения. В таких очках исполь-<br/>зуются внешний приемник и батарея питания. <br/> <br/>Приемники GPS <br/>Приемник спутниковой навигации в оборудовании квадрокоптера нужен для того, <br/>чтобы: <br/>� выполнять автоматический полет по заранее заданному маршруту; <br/>� при полетах по FPV определять текущее расстояние до точки взлета, скорость и <br/>высоту полета; <br/>� при потере сигнала управления обеспечить автоматический возврат к точке <br/>взлета. <br/>Приемник GPS следует приобрести даже ради одной лишь функции автовозврата, <br/>которая спасает коптер при потере сигнала управления. <br/>Аббревиатура GPS (Global Positioning System) стала нарицательной и в быту обо-<br/>значает как любые пользовательские приемники сигналов, так и американскую на-<br/>вигационную систему, которая официально называется NAVSTAR. Соответствен-<br/>но, российская навигационная система называется ГЛОНАСС (глобальная навига-<br/>ционная спутниковая система), объединенная европейская система — GALILEO, <br/>китайская — KOMPASS и т. д. Иными словами, сокращение GPS относится к лю-<br/>бой из существующих систем спутниковой навигации, хотя среди специалистов <br/>популярна также обобщающая аббревиатура GNSS (Global Navigation Satellite <br/>System — глобальная система спутниковой навигации). Поэтому наименование <br/>"двухсистемный приемник GPS/ГЛОНАСС", строго говоря, неправильное. На са-<br/>мом деле это "двухсистемный приемник NAVSTAR/ГЛОНАСС". Впрочем, амери-<br/>канцы собственную навигационную систему уже давно называют просто GPS, так <br/>же, как Библию называют просто "Книга". И всем понятно, о чем речь. Мы далее <br/>тоже будем именовать американскую систему просто GPS. <br/>Развертывание американской системы было завершено в 1996 году. Российская <br/>система по причине известных внутренних проблем тех лет существенно отстала  <br/>в развитии, вследствие чего GPS NAVSTAR стала почти монополистом и мировым <br/>лидером. Но сейчас развитию российской системы уделяется большое внимание, ее <br/>орбитальная группировка и наземная инфраструктура близки к завершению. По-<br/>этому в продаже все чаще появляются двухсистемные приемники. Остальные сис-<br/>темы существенно отстают в глобальном охвате и находят применение в отдельных <br/>государствах и специфических областях типа судовождения, управления полетами <br/>гражданской авиации, геодезии и т. д. <br/>Описанию принципов работы GPS посвящено большое количество подробных  <br/>и познавательных статей и книг, поэтому мы рассмотрим лишь общие понятия, а <br/>также базовые различия между GPS и ГЛОНАСС. Система спутниковой навигации <br/><br/>Глава 3. Дополнительные компоненты квадрокоптера 81 <br/>состоит из орбитальной группировки (спутники), наземного (центры управления и <br/>слежения) и абонентского (приемники потребителей) сегментов. <br/>Изначально планировалось, что спутниковая группировка GPS будет состоять из <br/>24 спутников, распределенных по 4 на шести орбитах. Однако этого оказалось не-<br/>достаточно для надежного покрытия критически важных регионов Земли. Кроме <br/>того, надо иметь спутники в резерве. Поэтому общее количество спутников увели-<br/>чено до 32, и на некоторых орбитах вращается до 6 спутников. Спутники движутся <br/>на высоте около 20 000 км со скоростью 3000 м/с и совершают два оборота вокруг <br/>Земли за сутки. <br/>Спутники ГЛОНАСС располагаются на трех орбитальных плоскостях, по 8 спут-<br/>ников в каждой, и теоретически орбитальная структура ГЛОНАСС обеспечивает <br/>более полное и надежное покрытие. К сожалению, на момент написания книги <br/>формирование орбитальной группировки ГЛОНАСС не было завершено и на орби-<br/>те находилось 25 спутников, не все из которых введены в эксплуатацию. К тому же, <br/>четыре новых спутника были утрачены при неудачном запуске ракеты-носителя. <br/>Но работы по завершению группировки ведутся очень интенсивно, и есть надежда, <br/>что в ближайшие два-три года система будет полностью развернута. <br/>GPS NAVSTAR использует кодовое разделение каналов с вещанием кодированных <br/>сигналов на нескольких частотах, а ГЛОНАСС — частотное. Но суммарная ширина <br/>спектра сигналов ГЛОНАСС даже меньше, чем у GPS, поэтому один и тот же ра-<br/>диочастотный тракт приемника может принимать сигналы обеих систем. Дальней-<br/>шее разделение сигналов спутников и выделение полезной информации произво-<br/>дится методами цифровой обработки сигнала внутри абонентского приемника. Ис-<br/>пользование мультисистемных приемников существенно повышает качество <br/>навигации, особенно в сложной обстановке (городская застройка, лес, горы). <br/>Принцип определения координат <br/>Определение координат объекта производится путем измерения дальностей до <br/>спутников. Рассмотрим пример с тремя навигационными передатчиками A, B и C на <br/>плоскости (рис. 3.5). Измерение расстояний RA и RB до передатчиков A и B дает <br/>нам две окружности положения с соответствующими радиусами. Объект может <br/>находиться как в точке O, так и в точке O′. Добавление третьего передатчика лик-<br/>видирует эту неоднозначность на плоскости. <br/>Аналогично происходит определение местоположения в трехмерном пространстве, <br/>только вместо окружностей мы имеем пересекающиеся сферы местоположения, <br/>которые сложно изобразить на книжной иллюстрации. Постарайтесь представить <br/>картину мысленно. Пересечением двух сфер является окружность, на любой точке <br/>которой может находиться наш объект. Пересечение трех сфер дает нам пересече-<br/>ние трех окружностей положения в трехмерном пространстве, что порождает <br/>неоднозначность в виде двух точек положения. В ряде случаев одну из точек нави-<br/>гационный приемник может сразу исключить, если воспользоваться дополнитель-<br/>ной информацией о положении: привязка к наземной станции навигации или сото-<br/>вой связи, к точке доступа Wi-Fi, ранее сохраненные данные и т. д. Также очевид-<br/>но, что объект заведомо не может находиться, например, на глубине 300 м под <br/><br/>82 Часть I. Теория <br/>землей. Однако это частности, а в общем случае для определения координат объ-<br/>екта в трехмерном пространстве (ширина–долгота–высота) необходимы как ми-<br/>нимум четыре спутника. <br/>O<br/>B<br/>A<br/>R<br/>2<br/>R O<br/>1<br/>R<br/>3<br/>C<br/> <br/>Рис. 3.5. Определение координат на плоскости дальномерным методом <br/>Пространственные координаты спутника известны с большой точностью. Чтобы вы <br/>оценили точность позиционирования спутников на орбите, отметим, что учитыва-<br/>ется давление солнечного света на оболочку спутника, истечение газов наружу из <br/>материала оболочки, влияние гравитационного поля Луны и неоднородность грави-<br/>тационного поля Земли. <br/>Расстояние от спутника до объекта вычисляется умножением скорости света на <br/>время прохождения сигнала от спутника до приемника. Но скорость света в вакуу-<br/>ме и атмосфере различается. Кроме того, при прохождении через тропосферу и  <br/>ионосферу радиосигнал испытывает переменные задержки, величина которых  <br/>зависит от текущего физического состояния верхних слоев атмосферы. Для ком-<br/>пенсации переменных задержек применяется передача копии спутникового сигнала <br/>на второй частоте. Зависимость задержки от частоты хорошо изучена и точно из-<br/>вестна. Но двухчастотные приемники очень дороги, сигнал на второй частоте за-<br/>шифрован и доступ к его использованию лицензируется. Поэтому в гражданской <br/>практике двухчастотные приемники (не путайте с двухсистемными) практически <br/>не используются. Кроме атмосферных задержек на определение дальности влияют <br/>инструментальные задержки сигнала в цепях передатчика и приемника, ошибки <br/>часов спутника и приемника, а также релятивистский эффект, возникающий при <br/>движении спутника по орбите. Поэтому фактически приемник работает не с даль-<br/>ностями, а с псевдодальностями до спутников. <br/>Для определения времени прохождения сигнала от спутника часы приемника <br/>должны быть очень точно синхронизированы с часами спутника, т. к. расхождение <br/>–6<br/>порядка 0,3 ⋅ 10 с дает погрешность 100 м. В общем случае вычислитель приемни-<br/>ка решает систему уравнений, в которой четыре неизвестных: три пространствен-<br/>ных координаты X, Y, Z и время t. Как известно, для нахождения однозначного ре-<br/>шения системы уравнений, их должно быть на одно больше, чем неизвестных. По-<br/>этому для точной синхронизации шкал времени нужны уже пять спутников, а не <br/><br/>Глава 3. Дополнительные компоненты квадрокоптера 83 <br/>четыре. Разумеется, задача устранения погрешностей, связанных с переменными <br/>задержками, может решаться путем накопления измерений и статистической обра-<br/>ботки на основе сигнала от четырех спутников. Но такой подход менее точен и тре-<br/>бует существенно большего времени для накопления измерений. <br/>Еще одной серьезной проблемой является прием отраженных сигналов в условиях <br/>городской застройки или сильно пересеченного рельефа местности. В некоторых <br/>случаях приемник может получать только отраженный сигнал. Наличие отражений <br/>приводит к ошибочному определению координат. Для выявления и отбраковки от-<br/>раженных сигналов желательно, чтобы приемник принимал одновременно сигналы <br/>от шести спутников. <br/>Итак, современные модули GPS, применяемые в квадрокоптерах, одновременно <br/>обрабатывают сигналы не более чем от шести спутников. Дальнейшее увеличение <br/>числа одновременно обрабатываемых спутников существенно усложняет и удоро-<br/>жает приемник, но не дает заметного увеличения точности. Даже если в зоне види-<br/>мости находятся десять и более спутников, приемник в определенный момент вре-<br/>мени будет работать только с шестью. Но наличие "запасных" спутников позволяет <br/>приемнику отвергать сигналы, которые он счел отраженными и недостоверными, а <br/>также динамически переключаться на сигнал спутников, имеющих более выгодное <br/>для навигации геометрическое расположение на орбите в текущий момент. Следо-<br/>вательно, наличие большого количества видимых спутников может улучшить каче-<br/>ство услуги позиционирования, хотя и косвенным образом. <br/>Геометрический фактор <br/>Скорость и точность определения местоположения зависят от расположения спут-<br/>ников в пространстве относительно приемника. Наихудшим вариантом является <br/>расположение нескольких видимых спутников приблизительно на одной вообра-<br/>жаемой линии с приемником. В этом случае погрешность и время определения воз-<br/>растают до максимума. Поэтому наличие четырех-шести видимых спутников не <br/>всегда означает качественное позиционирование даже на открытой местности. <br/>Наилучшим вариантом является равномерное распределение нескольких спутников <br/>по полушарию над приемником. Применительно к геометрическому фактору, орби-<br/>тальная структура ГЛОНАСС является более удачной, чем GPS NAVSTAR. <br/>Альманах и эфемериды <br/>Навигационные сообщения спутников несут два типа данных: альманах и эфемери-<br/>ды. Альманах содержит параметры орбит всех спутников, при помощи которых <br/>приемник может предсказать расположение спутников с достаточно большой по-<br/>грешностью и не тратить время на попытки приема сигнала со спутников, которые <br/>заведомо не видны. Данные альманаха, передаваемые спутниками, обновляются <br/>каждые 30 суток. При хранении в памяти выключенного приемника они действи-<br/>тельны не более 2–3 месяцев, далее погрешность в расчетах орбит становится не-<br/>допустимой. <br/><br/>84 Часть I. Теория <br/>Эфемериды содержат корректирующие поправки, которые вычисляются наземны-<br/>ми станциями слежения и регулярно загружаются в бортовой вычислитель спутни-<br/>ка. В отличие от альманаха, каждый спутник передает только собственные эфеме-<br/>риды, обновляемые каждые 30 минут. При хранении в приемнике срок действия <br/>эфемерид не более 4–6 часов. <br/>Информация передается со спутника с низкой скоростью, всего 50 бод. Пакет дан-<br/>ных содержит контрольную сумму для проверки правильности приема. Также  <br/>в пакет данных входит флажок "здоровья" спутника (health status). Если спутник <br/>неисправен или находится на обслуживании, он продолжает излучать навигацион-<br/>ный сигнал для нужд станций слежения, но его сигнал помечается как недостовер-<br/>ный и отвергается приемником. <br/>Время старта приемника, необходимое для перехода в режим определения позиции <br/>(GPS Fix или режим захвата спутников), зависит от имеющейся в памяти приемни-<br/>ка информации о спутниках. <br/>"Холодный" старт <br/>При "холодном" старте ожидаемая позиция, время, альманах и эфемериды неиз-<br/>вестны. Приемник сканирует все каналы и весь диапазон возможных значений вре-<br/>менны´ х задержек навигационных сигналов. После того, как навигационный сигнал <br/>хотя бы от одного спутника получен и разобран, приемник обладает информацией <br/>о текущем альманахе всей спутниковой группировки и переходит к "теплому" старту. <br/>Время "холодного" старта на открытой местности для современных модулей со-<br/>ставляет порядка 30–35 с. При плохих метеоусловиях или мешающих кронах де-<br/>ревьев продолжительность старта может увеличиться до 60–70 с. Таким образом, <br/>при использовании приемных модулей на открытой местности можно обходиться <br/>без хранения альманаха в памяти и заново стартовать при каждом включении бор-<br/>тового питания. Но в городских условиях время "холодного" старта существенно <br/>возрастает, иногда до 10–15 минут. <br/>"Теплый" старт <br/>При "теплом" старте приемник, включенный после 6 и более часов бездействия, <br/>начнет сканировать сигналы спутников, используя данные хранящегося в памяти <br/>альманаха и время собственных часов. При этом будет осуществляться поиск толь-<br/>ко тех спутников, которые теоретически, по данным альманаха, должны находиться <br/>в видимом полушарии на момент старта. Это существенно сокращает время старта <br/>(порядка 10 с), поскольку приемнику достаточно лишь получить текущие эфемери-<br/>ды от заранее известных спутников. <br/>"Горячий" старт <br/>При "горячем" старте в памяти приемника хранится вся актуальная информация, <br/>включая действующие эфемериды, поэтому приемник переходит к определению <br/>позиции спустя 1–3 с после включения. Если же к моменту включения приемника <br/><br/>Глава 3. Дополнительные компоненты квадрокоптера 85 <br/>видимыми являются менее трех спутников со "свежими" эфемеридами, то прием-<br/>нику потребуется дополнительное время, чтобы собрать эфемериды с остальных <br/>спутников по алгоритму "теплого" старта. <br/>При перемещении выключенного приемника на расстояние более 300 км храня-<br/>щийся в его памяти альманах теряет актуальность, поэтому при включении на но-<br/>вом месте будет отработан "холодный" старт. <br/> <br/>Технология A-GPS <br/>Для ускорения "холодного" старта применяется загрузка в приемник альманаха, <br/>ориентировочных координат и времени, полученных по альтернативным каналам. <br/>Эта технология называется A-GPS (Assisted GPS). Обычно сначала по ближайшим <br/>сотовым станциям и точкам доступа Wi-Fi определяются приблизительные коорди-<br/>наты с точностью 200–500 м, затем из Интернета скачивается актуальный альманах <br/>для этой местности и загружается в память приемника. Этот метод требует наличия <br/>беспроводного доступа в Интернет и используется в современных телефонах, но <br/>малоприменим для оборудования квадрокоптеров. <br/>Переход приемника в режим захвата спутников (GPS Fix) означает лишь, что при-<br/>емник загрузил альманах и эфемериды и "видит" достаточное для работы созвездие <br/>спутников. Для достижения приемлемой точности позиционирования потребуется <br/>дополнительное время, пока приемник накапливает данные для снижения погреш-<br/>ностей статистическими методами. <br/>Некоторые модули GPS с устаревшими прошивками при неудачном расположении <br/>спутников зависали и вообще не могли стартовать по процедуре "холодного" стар-<br/>та, пока в них с компьютера не выгружали альманах. В современных модулях такая <br/>проблема не встречается. <br/>Для хранения информации в модуле приемника GPS используется энергозависимая <br/>память с резервным источником питания. Обычно это миниатюрный литиевый ак-<br/>кумулятор или ионистор. Иногда спрашивают, почему в приемниках не использу-<br/>ется обычная память EEPROM, которая не теряет информацию при отключении <br/>питания? Дело в том, что при работе приемника информация о текущих координа-<br/>тах и эфемеридах непрерывно перезаписывается, а энергонезависимая память име-<br/>ет довольно ограниченный ресурс циклов перезаписи. <br/> <br/>Антенны GPS <br/>Антенны портативных GPS-модулей имеют специфическую конструкцию. Обычно <br/>это керамический блок с нанесенными на него электрохимическим методом метал-<br/>лическими элементами (рис. 3.6). После изготовления антенну обычно подстраи-<br/>вают на заводе, подрезая уголки вибратора наждаком или лазером. Иногда приме-<br/>няются активные антенны, когда непосредственно на антенном модуле смонтиро-<br/>ван малошумящий усилитель. Такие антенны более эффективны в сложных <br/>условиях, но на открытом пространстве, когда сигналы от спутников и без того хо-<br/><br/>86 Часть I. Теория <br/>роши, они не дают заметного выигрыша. Недостатками керамической антенны <br/>являются большой вес и хрупкость, из-за чего антенны часто трескаются при <br/>аварии. Иногда трещина антенны не видна невооруженным глазом, но существен-<br/>но снижает чувствительность приемника. <br/>В последнее время, с появлением миниатюрных приемников GPS и массовым рас-<br/>пространением смартфонов, получили широкое распространение миниатюрные ке-<br/>рамические чип-антенны размером в несколько миллиметров и весом в доли грам-<br/>ма. Такие антенны производятся по технологии, схожей с изготовлением микро-<br/>схем и подстраиваются лазером в момент изготовления. <br/> <br/>Рис. 3.6. Обычная керамическая антенна GPS и миниатюрная чип-антенна <br/>Несмотря на миниатюрные размеры, чип-антенна в сочетании с современными <br/>микросхемами приемника практически не уступает по параметрам обычным антен-<br/>нам, но стоит несколько дороже и, как правило, применяется в составе готовых ми-<br/>ниатюрных модулей GPS. <br/>Поток данных GPS, протокол NMEA <br/>Навигационный модуль передает поток данных в полетный контроллер по после-<br/>2<br/>довательному интерфейсу UART (COM) или I C. В любом случае структура и со-<br/>держание этих данных соответствуют протоколу NMEA 0183 (National Marine <br/>Electronics Assotiation). Это стандарт текстового обмена данными и командами по-<br/>средством ASCII-символов, созданный для морского навигационного оборудова-<br/>ния. В настоящее время внедряется стандарт NMEA 2000. <br/>Модуль GPS передает строковые сообщения, содержащие различный набор дан-<br/>ных: широта, долгота, скорость, курс, системное время, количество спутников  <br/>и т. д. Сообщения делятся на несколько видов, формат которых содержит в своих <br/>полях строго определенную информацию. <br/><br/>Глава 3. Дополнительные компоненты квадрокоптера 87 <br/>Владельцу коптера, как правило, не приходится работать с "сырыми" данными <br/>GPS, но для общей эрудиции полезно знать их структуру. В общем случае строко-<br/>вое сообщение приемника имеет такой вид: <br/>$GPRMC,hhmmss.sss,A,GGMM.MM,P,gggmm.mm,J,v.v,b.b,ddmmyy,x.x,n,m*hh<CR><LF> <br/>$ — с этого символа начинается каждое сообщение <br/>GPRMC — первые две буквы — это идентификатор системы, остальные три — это <br/>идентификатор формата сообщения, от которого зависит содержимое остальной <br/>строки. В нашем случае GP — GPS (GL — ГЛОНАСС, GA — GALILEO и т. д.) <br/>RMC — рекомендованный минимум навигационных данных. Содержит данные  <br/>о широте, долготе, дате, времени и скорости. Эти данные приемный модуль пере-<br/>дает по умолчанию после старта. По запросу контроллера также передаются дан-<br/>ные типа GGA и GSA об активных и наблюдаемых спутниках, а при движении по за-<br/>данному маршруту некоторые контроллеры могут запрашивать строки типа GPL, BOD <br/>и RMB, содержащие параметры заданных точек и рекомендуемый минимум навига-<br/>ционных данных для достижения заданной точки. Полный список форматов доста-<br/>точно велик, и с ним можно ознакомиться в спецификации NMEA. Некоторые из-<br/>готовители добавляют в перечень форматов собственные строки, несущие инфор-<br/>мацию о состоянии приемника, версии прошивки, напряжении питания и т. д. <br/>Далее следует набор навигационной информации, подробное описание которой <br/>также можно прочесть в спецификации. <br/>ВНИМАНИЕ! <br/>Дробные значения широты и долготы в "сыром" потоке данных NMEA представлены <br/>десятичной дробью минут, а не секундами! Если эти значения ввести в строку поиска <br/>Google Maps, то местоположение на карте будет на несколько километров отличаться <br/>от истинного. Необходимо поделить дробные части широты и долготы на 60, чтобы <br/>получить значения секунд. Программы для работы с GPS не нуждаются в такой подго-<br/>товке данных и отображают координаты правильно. <br/>Протокол U-BLOX (UBX) <br/>Протокол U-BLOX (binary UBX) — это проприетарный бинарный протокол, разра-<br/>ботанный и применяемый швейцарской компанией u-blox AG, известным произво-<br/>дителем модулей и программного обеспечения для навигационного и коммуника-<br/>ционного оборудования. <br/>Поскольку навигационные приемники на основе модулей U-BLOX NEO 6 и  <br/>U-BLOX NEO 7 получили широкое, почти монопольное распространение в авиамо-<br/>делизме, прошивки полетных контроллеров поддерживают как протокол UBX, так <br/>и NMEA. <br/>В целом, спецификация приемников U-BLOX предоставляет разработчику очень <br/>широкий диапазон возможностей для обмена данными между приемником и потре-<br/>бителем. Например, реализован протокол DDC (Display Data Channel), совмести-<br/>2<br/>мый со стандартом I С. Это позволяет подключать приемник к контроллеру по ши-<br/><br/>88 Часть I. Теория <br/>2<br/>не I C в случае нехватки свободных COM-портов. Также протокол DDC допускает <br/>выборочное чтение регистров приемника и запись в них. <br/>Но если говорить о любительском применении в квадрокоптерах, то дополнитель-<br/>ные возможности протокола UBX не используются, поскольку полетный контрол-<br/>лер использует лишь минимальный набор стандартных данных GPS. Подключение <br/>2<br/>по шине I C может создать проблемы даже достаточно опытному пользователю. <br/>Поэтому, по мнению автора, в данном случае разнообразие протоколов скорее зло, <br/>чем благо. Кроме того, модули U-BLOX даже версии 7 не поддерживают одновре-<br/>менную работу с системами GPS и ГЛОНАСС, режимы необходимо переключать <br/>программно. <br/>В части II книги мы подробно рассмотрим пример настройки и подключения при-<br/>емника U-BLOX NEO 6. <br/>Адаптер Bluetooth <br/>Адаптер Bluetooth — это простой и недорогой способ подключить к полетному <br/>контроллеру смартфон, планшет или нетбук, чтобы воспользоваться утилитами для <br/>настройки и телеметрии. Разумеется, ноутбук или обычный компьютер также мож-<br/>но подключать по беспроводному соединению. Этот вариант даже более предпоч-<br/>тителен, чем соединение проводом по USB. Если забыть отключить от контроллера <br/>провод после окончания работы, то можно получить вырванный с дорожками пла-<br/>ты контроллера разъем mini-USB и серьезные трудности с последующим подклю-<br/>чением. <br/>В любительской практике обычно применяются очень дешевые и широко распро-<br/>страненные адаптеры версий HC-05, HC-06 (рис. 3.7), HC-07. Они представляют <br/>собой плату, на которой смонтированы одна или две микросхемы и печатная  <br/>антенна. В свою очередь, эта плата припаяна на плату расширения, содержащую <br/>источник 3,3 В, светодиоды и разъем. Иногда в продаже попадаются "голые" платы <br/>модулей, но в этом случае вам придется самостоятельно подключать питание, све-<br/>тодиоды и разъем. <br/>К сожалению, обычные адаптеры Bluetooth не поддерживают процесс программи-<br/>рования контроллера, потому что не могут генерировать сигнал сброса контролле-<br/> <br/>Рис. 3.7. Стандартный адаптер Bluetooth HC-06 <br/><br/>Глава 3. Дополнительные компоненты квадрокоптера 89 <br/>ра, необходимый для запуска процесса. В продаже можно встретить специальный <br/>вариант адаптера, позволяющий прошивать контроллер через беспроводное соеди-<br/>нение, но в несколько раз дороже обычного адаптера. Поэтому для записи прошив-<br/>ки все же лучше использовать проводное подключение USB. <br/>При покупке следует обратить внимание на версию адаптера. Наиболее популяр-<br/>ными, проверенными и простыми в эксплуатации являются адаптеры HC-06, но <br/>можно приобрести и другую версию. Адаптер должен работать в режиме ведомого <br/>(Slave), но иногда встречаются адаптеры, на фабрике жестко прошитые в режим <br/>ведущего (Master). Эти адаптеры содержат в названии букву "М", например HC-<br/>06M. Вы не сможете использовать такой адаптер без перепрошивки, что достаточно <br/>сложно для неподготовленного любителя. Существуют адаптеры, у которых режим <br/>Master/Slave можно переключить внешней командой конфигурации. Это, например, <br/>адаптеры HC-05. <br/>Телеметрия и OSD <br/>Система телеметрии предназначена для передачи с борта важной технической ин-<br/>формации в режиме реального времени, а также, при необходимости, записи этой <br/>информации в лог для последующего изучения. Состав этой информации зависит <br/>от назначения системы и потребностей оператора. В простейшем случае, когда по-<br/>лет происходит на небольшом удалении и коптер контролируется визуально, доста-<br/>точно следить только за напряжением силовых батарей. При полете с управлением <br/>по видеокамере уже, как правило, необходимо контролировать дальность полета и <br/>уровень радиосигнала, чтобы не потерять связь, а также следить за напряжением <br/>батареи видеоканала. <br/>На практике набор телеметрийной информации намного шире, и в него стараются <br/>включить максимум параметров. Разумеется, набор этих параметров определяется <br/>оборудованием квадрокоптера: <br/>� напряжение батарей; <br/>� потребляемый ток; <br/>� температура батарей; <br/>� режим работы полетного контроллера; <br/>� время полета; <br/>� высота; <br/>� линейная скорость; <br/>� вертикальное ускорение; <br/>� показания акселерометров (крен); <br/>� показания компаса; <br/>� обороты двигателей; <br/>� текущие координаты GPS; <br/><br/>90 Часть I. Теория <br/>� количество доступных спутников; <br/>� дальность до "дома" и направление "домой". <br/>Данные имеют разную практическую ценность. Например, обороты двигателей  <br/>в режиме реального времени нужны только для отладки и настройки. Если один <br/>или два мотора работают с большей нагрузкой в тот момент, когда коптер висит <br/>горизонтально и неподвижно, это может означать дисбаланс коптера — смещение <br/>его физического центра масс в сторону. <br/>Формировать поток данных для телеметрии может не только полетный контроллер. <br/>Большинство современных телеметрийных систем способно автономно обрабаты-<br/>вать показания датчиков тока, напряжения и температуры, и даже поток данных <br/>GPS. Нет принципиальной разницы в том, куда подключать датчики, но иногда бы-<br/>вает конструктивно удобнее и безопаснее подключить их непосредственно к моду-<br/>лю телеметрии. С другой стороны, нет нужды приобретать очень дорогой модуль <br/>логирования и телеметрии, оснащенный собственным барометром, компасом, аксе-<br/>лерометрами, поскольку эти датчики все равно есть на плате полетного контрол- <br/>лера. <br/>В общем виде система телеметрии коптера состоит из следующих компонентов: <br/>набор датчиков и прочих источников информации; бортовой модуль телеметрии, <br/>который обрабатывает исходные данные и "упаковывает" их в непрерывный поток <br/>данных; радиоканал для передачи данных на землю; устройство для приема и ото-<br/>бражения данных; устройство записи данных в лог. <br/>В практической реализации телеметрии возможны различные варианты. В класси-<br/>ческой и самой простой схеме сбор и обработку данных осуществляет полетный <br/>контроллер. Далее, через последовательный порт он передает поток данных на спе-<br/>циальный модуль OSD (On-Screen Data — будет рассмотрен далее), который накла-<br/>дывает цифробуквенные и графические элементы на изображение бортовой видео-<br/>камеры, которое на земле отображается в видеоочках оператора или на дисплее. <br/>Иногда датчики тока и напряжения и приемник GPS подключают непосредственно <br/>к модулю OSD. <br/>Запись лога данных может вестись во встроенную память полетного контроллера,  <br/>в память модуля телеметрии, в специальный логгер, в наземный компьютер либо <br/>путем записи полетного видео. Лог бывает полезен при анализе максимального по-<br/>требляемого тока, поиске просадок питающего напряжения, выявлении сбоев кана-<br/>ла управления и т. д. <br/>Телеметрийная информация может передаваться непосредственно с полетного кон-<br/>троллера при помощи специального радиомодема — оборудования, обеспечиваю-<br/>щего двустороннюю связь по протоколу UART через радиоканал. <br/>И, наконец, телеметрия может передаваться на землю при помощи аппаратуры ра-<br/>диоуправления двустороннего действия, с отображением данных на дисплее пульта <br/>управления. Это вариант удобный, но не самый дешевый, особенно если учесть, <br/>что для полетов по видеокамере все равно понадобится еще и телеметрия на экране. <br/>Окончательный выбор варианта и практическая реализация зависят только от по-<br/><br/>Глава 3. Дополнительные компоненты квадрокоптера 91 <br/>требностей и возможностей владельца коптера, поэтому нельзя однозначно сказать, <br/>что лучше. <br/>Теперь разберемся подробнее, что является источником данных для телеметрии. <br/>Датчик напряжения представляет собой простейший делитель напряжения из <br/>двух постоянных резисторов. Напряжение с выхода делителя поступает на аналого-<br/>вый вход микроконтроллера, который при помощи встроенного АЦП измеряет на-<br/>пряжение. Делитель необходим, т. к. на вход микроконтроллера категорически <br/>нельзя подавать напряжение батареи напрямую. Это приведет к выходу микро-<br/>контроллера из строя. Как минимум, будет испорчен этот аналоговый вход. <br/>Датчик тока устроен несколько сложнее. Это либо низкоомный шунт — мощный <br/>резистор с очень низким сопротивлением, включенный последовательно в разрыв <br/>силовой цепи, либо датчик Холла, реагирующий на напряженность магнитного по-<br/>ля, возникающего вокруг силового провода. В том и другом случае требуется до-<br/>полнительная схема, операционный усилитель, усиливающий слабый сигнал дат-<br/>чика. <br/>Существуют готовые измерительные модули. Пример такого модуля изображен на <br/>рис. 3.8. Этот модуль кроме резистивного делителя напряжения и токового шунта <br/>содержит импульсный источник с выходным напряжением 5,25 В и током 3 А для <br/>питания бортовой электроники. <br/>Датчики тока и напряжения имеют погрешности, вызванные разбросом параметров <br/>элементов, поэтому их показания корректируют программно, при помощи калибро-<br/>вочных констант, которые необходимо один раз подобрать при настройке коптера. <br/> <br/>Рис. 3.8. Модуль для измерения напряжения и тока силовой батареи <br/>На основании текущей продолжительности полета, напряжения и тока система те-<br/>леметрии может рассчитать количество потребленной от батареи энергии в милли-<br/>ампер-часах. Иногда этот параметр более информативен, чем просто текущее на-<br/>пряжение батареи, потому что позволяет знать, сколько батарея "отдает" на самом <br/>деле, в отличие от надписи на этикетке, и приблизительно оценить оставшееся вре-<br/>мя полета. <br/><br/>92 Часть I. Теория <br/>Датчик температуры применяется нечасто, в основном в мощных квадрокоптерах <br/>с большим энергопотреблением, когда силовая батарея может работать в критиче-<br/>ских режимах. В качестве датчика может использоваться терморезистор или термо-<br/>диод, меняющие сопротивление в зависимости от температуры, а также интеграль-<br/>2<br/>ный термометр, подключаемый к модулю телеметрии по шине I C или 1-Wire. <br/>Барометр, акселерометр и компас, как правило, используются штатные, установ-<br/>ленные на плату полетного контроллера. Полетный контроллер транслирует полу-<br/>ченные и обработанные данные в модуль телеметрии. <br/>Модуль GPS обычно тоже подключается к полетному контроллеру, который обра-<br/>батывает поток протокола NMEA, выделяет из него координаты и на их основании <br/>вычисляет количество спутников, линейную скорость и дистанцию до точки взлета <br/>для включения в поток данных телеметрии. Современные прошивки позволяют <br/>подключить модуль GPS непосредственно к модулю телеметрии, но в случае  <br/>с квадрокоптером это не имеет практического смысла — данные GPS нужны в пер-<br/>вую очередь полетному контроллеру. <br/>Радиоприемник генерирует сигнал RSSI (Received Signal Strength Indication — ин-<br/>дикация уровня принимаемого сигнала) для оценки уровня радиосигнала, посту-<br/>пающего на антенный вход приемника. Сигнал RSSI может присутствовать на вы-<br/>ходе приемника в виде постоянного напряжения, пропорционального уровню при-<br/>нимаемого сигнала, или передаваться в стандартной форме через один из выходных <br/>каналов управления PPM или SBUS. В первом случае модулю телеметрии доста-<br/>точно измерить напряжение, во втором нужно распознавать сигнал радиоуправле-<br/>ния, что требует несколько больших ресурсов. К сожалению, дешевые популярные <br/>приемники редко оснащены выходом RSSI, хотя их чипсет имеет такую возмож-<br/>ность. Некоторые приемники можно прошить альтернативной прошивкой, которая <br/>выводит сигнал RSSI в качестве отдельного канала. Также приемник является ис-<br/>точником данных о положении рукояток управления, но эти данные обрабатывает и <br/>выводит в поток телеметрии полетный контроллер. <br/>Полетный контроллер также является источником собственных данных: режим <br/>2<br/>полета, обороты двигателей, наличие ошибок в шине данных I C, время полета. <br/>Изображенный на рис. 3.9 вариант реализации телеметрии c использованием OSD <br/>наиболее популярен, особенно среди начинающих пилотов. Более того, он просто <br/>необходим при полетах по камере, иначе полет с большой вероятностью закончит-<br/>ся разряженной батареей или потерей ориентации и утратой коптера. Поэтому мы <br/>рассматриваем модуль OSD как часть системы телеметрии. <br/>Внешние данные в модуль OSD (рис. 3.10) могут поступать с полетного контролле-<br/>ра через последовательный интерфейс, непосредственно от внешних датчиков, ли-<br/>бо одновременно из разных источников. Собственный микроконтроллер модуля <br/>(MCU) обрабатывает данные и загружает их в специальную микросхему — видео-<br/>миксер (V-MIX), который накладывает цифробуквенную и графическую информа-<br/>цию на изображение. Существует несколько пользовательских прошивок для моду-<br/>лей OSD, позволяющих подбирать и настраивать отображение данных под свои  <br/> <br/><br/>Глава 3. Дополнительные компоненты квадрокоптера 93 <br/> <br/>Рис. 3.9. Стандартная система телеметрии с применением OSD <br/> <br/>Рис. 3.10. Структурная схема модуля OSD <br/> <br/> <br/>нужды. Для настройки обычно применяется интерфейсная программа на компью-<br/>тере с подключением через USB-адаптер последовательного порта. <br/>Достоинством телеметрии с применением OSD является наглядность и удобство <br/>отображения информации, а также то, что для телеметрии используется уже имею-<br/>щийся канал. Однако иногда требуется принимать, отображать и/или записывать  <br/>в лог более специфическую информацию типа оборотов двигателей, показаний ак-<br/>селерометров и т. д. В этом случае можно приобрести, в зависимости от ситуации и <br/>финансовых возможностей, либо комплект сменных модулей приемника/пере-<br/>датчика, типа FrSky, создающих двунаправленный радиоканал для передачи управ-<br/>ления на борт и приема телеметрии с борта, либо фирменное оборудование со <br/>встроенным каналом телеметрии. <br/>Можно также ничего не менять в имеющейся аппаратуре управления, а приобрести <br/>недорогой комплект из двух модулей для передачи потока информации с последо-<br/>вательного порта — так называемый радиомодем. Автор предпочитает именно это <br/>недорогое и универсальное решение. <br/><br/>94 Часть I. Теория <br/>Универсальный радиоканал (радиомодем) <br/>В большинстве случаев полный поток данных телеметрии выводится на один из <br/>последовательных портов полетного контроллера. Причем на этот порт выводится <br/>не только стандартная телеметрия, но и внутренняя служебная информация кон-<br/>2<br/>троллера (время исполнения цикла программы, наличие ошибок на шине I C, по-<br/>ложение рукояток пульта и т. д.) Также через этот порт можно "на лету" настраи-<br/>вать контроллер, меняя различные параметры. Более того, у многих полетных кон-<br/>троллеров через этот же порт можно управлять коптером со смартфона или <br/>компьютера, минуя аппаратуру радиоуправления. <br/>На земле к последовательному порту контроллера через проводной адаптер USB-<br/>COM можно подключить стационарный компьютер или ноутбук, а через адаптер <br/>OTG легко подключаются планшет или смартфон с операционной системой <br/>Android. Разумеется, стационарный компьютер, ноутбук или смартфон можно под-<br/>ключить через Bluetooth. Но увы, дальность действия стандартного оборудования <br/>Bluetooth не превышает 100 м на открытой местности, а для надежной работы <br/>желательно не превышать дистанцию 30 м. <br/>Для увеличения дальности беспроводного соединения через последовательный порт <br/>контроллера применяют специальное оборудование — радиомодем. Последова-<br/>тельный порт одного из приемопередатчиков радиомодема соединяется с портом <br/>полетного контроллера, а к порту второго приемопередатчика подключается на-<br/>земное оборудование. Радиоканал абсолютно прозрачный, т. е. с точки зрения  <br/>наземного оборудования это выглядит так, будто оно подключено напрямую к по-<br/>следовательному порту контроллера, хотя на самом деле квадрокоптер может нахо-<br/>диться на расстоянии нескольких километров от оператора. Единственное ограни-<br/>чение состоит в снижении максимальной скорости порта, и чем больше предпола-<br/>гаемая дистанция полета, тем меньшая скорость обмена должна быть задана в <br/>настройках. <br/>Как показывает опыт, скорости 19 200 бод достаточно для комфортного обмена <br/>данными. Даже скорость 9600 бод допустима для приема потока расширенной те-<br/>леметрии и дистанционного изменения настроек. При этом современные недорогие <br/>радиомодемы обеспечивают стандартную скорость 57 600 бод на расстоянии около <br/>1 км. В настоящее время скорость и дальность действия радиомодемов не является <br/>проблемой для любительских коптеров. <br/>Типичный современный модуль радиоканала состоит из специализированной мик-<br/>росхемы, оснащенной интерфейсом последовательного порта UART/RS232 и ра-<br/>диочастотным выходом. Модули повышенной мощности имеют также антенный <br/>усилитель мощности излучаемого радиосигнала. Существуют модули со встроен-<br/>ным адаптером USB-COM для подключения непосредственно к USB-порту компь-<br/>ютера. <br/>Большинство модулей промышленного класса работает в диапазоне 433 МГц с раз-<br/>делением на несколько фиксированных частотных каналов. Этот диапазон специ-<br/>ально предназначен для систем телекоммуникации и беспроводного сбора инфор-<br/><br/>Глава 3. Дополнительные компоненты квадрокоптера 95 <br/>мации. В последнее время появляется все больше модулей, особенно любительско-<br/>го и бытового назначения, работающих в диапазоне 2,4 ГГц. У этих двух частотных <br/>вариантов есть свои достоинства и недостатки. Диапазон 433 МГц специально <br/>предназначен для систем сигнализации и дистанционного сбора информации. На <br/>открытой местности он обеспечивает бόльшую дальность при малой мощности, <br/>меньше подвержен интерференции, отражениям и затуханию на складках местно-<br/>сти, в листве деревьев и т. д. Однако в этом диапазоне работают радиоканалы <br/>большинства автомобильных сигнализаций, что в городских условиях может слу-<br/>жить источником сильных помех. <br/>Оборудование на частоте 2,4 ГГц имеет меньшие габариты и массу. Благодаря бо-<br/>лее высокой несущей частоте теоретический лимит скорости выше. При сопоста-<br/>вимой дальности действия комплект оборудования 2,4 ГГц стоит дороже, но обес-<br/>печивает более помехоустойчивый и быстрый канал. С другой стороны, радиоканал <br/>на основе недорогого маломощного гигагерцевого оборудования обеспечивает <br/>меньшую дальность и более критичен к размещению и конструкции антенны, а <br/>также к климатическим условиям (туман, дождь) и рельефу местности. Кроме того, <br/>использование еще одного оборудования, работающего на частоте 2,4 ГГц, создает <br/>лишний риск взаимной интерференции с сигналами радиоуправления и видеока- <br/>нала. <br/>Если нет конструктивной возможности или желания соединять наземный модуль  <br/>с ноутбуком или смартфоном проводом USB, то наземный модуль подключается  <br/>к обычному адаптеру Bluetooth, а уже с ним соединяется смартфон, планшет или <br/>ноутбук. С точки зрения программного обеспечения это равносильно подключению <br/>к полетному контроллеру по Bluetooth, но при этом смартфон может находиться <br/>в кармане пилота, а коптер на расстоянии в километр от него. <br/>Как и в случае с радиоуправлением, производители предпочитают использовать <br/>проприетарные протоколы передачи данных по радиоканалу, а также частотные <br/>сетки, несовместимые с модулями других производителей. Более того, даже у од-<br/>ного производителя бывают разные, взаимно не совместимые серии оборудования. <br/>Поэтому настоятельно рекомендуется для построения радиоканала телеметрии <br/>приобретать модули одного производителя и одной серии. <br/>Бустеры и репитеры <br/>Бустеры и репитеры применяются для увеличения дальности действия и помехо-<br/>устойчивости каналов радиоуправления и телеметрии на расстояние до десяти ки-<br/>лометров и более. В основном такая дальность требуется при полетах по видеока-<br/>мере. <br/>Бустер (booster) — это усилитель мощности радиосигнала. Вход бустера подклю-<br/>чается к антенному выходу передатчика, а к выходу бустера подключается антенна. <br/>Наиболее популярны бустеры на диапазон 2,4 ГГц с выходной мощностью 1–2 Вт <br/>(рис. 3.11), но для сверхдальних полетов иногда применяются бустеры диапазонов <br/>27, 40 или 72 МГц с выходной мощностью более 10 Вт. <br/><br/>96 Часть I. Теория <br/> <br/>Рис. 3.11. Усилитель радиосигнала на диапазон 2,4 ГГц <br/>Обычный недорогой бустер усиливает сигнал в одном направлении — от устройст-<br/>ва к антенне. Это не создает проблем в случае односторонней передачи, например <br/>для пульта радиоуправления или видеопередатчика. Но в случае двустороннего ка-<br/>нала телеметрии бустер блокирует принимаемый сигнал, т. к. прохождение сигнала <br/>в обратном направлении, от антенны к устройству, не предусмотрено схемой уси-<br/>лителя. Поэтому с простыми бустерами не работают радиомодемы, а также модули <br/>телеметрии типа FrSky для пультов радиоуправления. <br/>Существуют более дорогие и сложные двунаправленные бустеры (2-Way Booster). <br/>Они содержат автоматически работающий коммутатор сигнала, который при нали-<br/>чии излучения на выходе радиомодема выводит сигнал через усилитель мощности <br/>в антенну, а все остальное время в режиме приема направляет принимаемый сигнал <br/>с антенны в обход цепей усилителя мощности на антенный вход модема. Обычно <br/>входной сигнал также подвергается усилению при помощи малошумящего усили-<br/>теля, что существенно повышает дальность действия канала. Двунаправленные <br/>бустеры на 2,4 ГГц обычно продаются в качестве оборудования Wi-Fi, но подходят <br/>и для нужд телеметрии. <br/>Репитер (repeater) — это повторитель сигнала. Он принимает сигнал передатчика и <br/>переизлучает его. Излучаемая мощность репитера может не превышать мощность <br/>передатчика радиоуправления или даже быть меньше, но за счет того, что репитер <br/>физически располагается на линии между передатчиком и приемником, дальность <br/>действия почти удваивается. <br/>Некоторые бытовые Wi-Fi-роутеры удается заставить работать в качестве репите-<br/>ров сигнала радиоуправления путем перепрошивки. <br/>Иногда для сверхдальних полетов применяют ретрансляторы. Например, ретранс-<br/>лятор может принимать сигнал обычного пульта на частоте 2,4 ГГц, перекодиро-<br/>вать его и излучать на частоте 72 МГц с мощностью 15–20 Вт. Такое устройство <br/>обычно стараются установить на возвышенности и питают от автомобильного ак-<br/>кумулятора. С точки зрения удобства эксплуатации, для дальних полетов ретранс-<br/><br/>Глава 3. Дополнительные компоненты квадрокоптера 97 <br/>лятор с усилителем мощности более предпочтителен, т. к. его можно установить <br/>недалеко от оператора (например, на крыше автомобиля), и действовать он может <br/>одинаково для всех направлений полета. <br/> <br/>Жидкокристаллические и OLED-дисплеи <br/>Когда есть возможность использовать в качестве дисплея смартфон или планшет  <br/>с операционной системой Android, подключенные к полетному контроллеру по <br/>Bluetooth, наличие дополнительного дисплея в составе конструкции может казаться <br/>лишним. Но зачастую использование аппаратного дисплея, смонтированного на <br/>коптере, оказывается удобнее и безопаснее. Если нужно быстро проверить количе-<br/>ство доступных спутников GPS, напряжение батареи или суммарное время полета, <br/>удобнее посмотреть это на бортовом дисплее, а не подключать мобильный гаджет. <br/>Управление отображаемыми данными, переключение режимов полетного контрол-<br/>лера и изменение параметров в ручном режиме производится при помощи переме-<br/>щения рукояток пульта в определенные крайние положения. В дежурном режиме <br/>на дисплее отображаются данные телеметрии (напряжение, ток, обороты двигате-<br/>лей, время работы и т. д.). <br/>В самодельных коптерах применяют один из двух типов дисплеев: жидкокристал-<br/>лический (LCD, Liquid Crystall Display) или на органических светоэлементах <br/>(OLED, Organic Light Emitting Device). Обе разновидности по умолчанию поддер-<br/>живаются большинством популярных версий прошивок. Для настройки и тестиро-<br/>вания предусмотрено использование так называемых виртуальных дисплеев.  <br/>В этом случае в роли дисплея выступает запущенная на компьютере программа <br/>PuTTY, Hercules, Termite или любой другой программный терминал последова-<br/>тельного порта, а выход последовательного порта контроллера подключается <br/>к компьютеру через адаптер USB-COM. <br/>Жидкокристаллический дисплей. Обычно это двух- или четырехстрочный дис-<br/>2<br/>плей с фиксированными знакоместами, подключаемый по протоколу IC или <br/>UART(рис. 3.12). Знакогенератор прошит в памяти дисплея, поэтому набор ото-<br/>бражаемых символов ограничен стандартным набором ASCII. <br/>OLED-дисплей. Это относительно новое для любительской практики устройство. <br/>Дисплей графический, изображение формируется из миниатюрных пикселов-<br/>светодиодов, поэтому могут отображаться не только цифробуквенные символы,  <br/>но и графические изображения. Прошивка MultiWii по умолчанию поддерживает <br/>монохромный дисплей CRIUS OLED C-16 с разрешением 128×64 точек, подклю-<br/>2<br/>чаемый по протоколу I C (рис. 3.13). <br/>Преимущества графического OLED-дисплея: <br/>� небольшие габариты и вес; <br/>� большой объем отображаемой текстовой информации; <br/>� возможность отображать графику. <br/><br/>98 Часть I. Теория <br/> <br/>Рис. 3.12. Дисплей 4 строки 16 знакомест LCD03 <br/> <br/>Рис. 3.13. Графический дисплей CRIUS OLED <br/> <br/>Недостатки: <br/>� большой объем программного кода в прошивке контроллера для формирования <br/>знакогенератора и графических символов; <br/>� более высокая цена; <br/>� на ярком солнце изображение почти не видно; <br/><br/>Глава 3. Дополнительные компоненты квадрокоптера 99 <br/>� дисплей CRIUS CO-16 "из коробки" работает нестабильно и требует доработки, <br/>что, впрочем, не гарантирует безупречную дальнейшую работу. <br/>В свою очередь ЖК-дисплей стоит существенно дешевле, его обслуживание зани-<br/>мает меньший объем памяти, работает без сбоев, изображение лучше видно на  <br/>ярком солнце. Но при этом он больше весит и отображает небольшой объем ин-<br/>формации. <br/>Цветной графический LCD-дисплей (рис. 3.14). Графическая матрица устроена <br/>аналогично компьютерному монитору и позволяет отображать минимум <br/>262 000 цветов. Недорогие дисплеи подходящего размера обычно подключаются  <br/>к источнику данных по протоколу SPI. В прошивке MultiWii не реализована под-<br/>держка цветных дисплеев с протоколом SPI, поэтому автором разработана собст-<br/>венная конструкция автономного модуля дисплея на основе микроконтроллера <br/>Atmega328. <br/> <br/>Рис. 3.14. Цветной графический дисплей <br/>Средства поиска: биперы, маячки, GPS-трекеры <br/>Даже если полет происходит в пределах прямой видимости, после аварии поиск <br/>коптера в лесу, густом кустарнике или овражистой местности может быть очень <br/>затруднителен. Для облегчения поиска применяют специальные технические сред-<br/>ства. <br/>Самое простое устройство для поиска — это звуковой сигнализатор (бипер). Обыч-<br/>но в нем используется излучатель, аналогичный индикатору разряда батареи. Излу-<br/>чатель активируется сигналом на одном из выводов полетного контроллера, по  <br/>команде с пульта. Такому решению присущи очевидные недостатки: для срабаты-<br/><br/>100 Часть I. Теория <br/>вания бипера необходимо, чтобы питание и электроника коптера остались исправ-<br/>ными после краша и продолжали принимать сигналы управления, а это случается <br/>далеко не всегда. Слышимость бипера также зависит от того, насколько удачно <br/>упал коптер. Можно применить более сложный бипер с автономной батареей пита-<br/>ния и датчиком удара, но радиус действия все равно существенно ограничивается <br/>слышимостью звукового сигнала на местности. <br/>На рис. 3.15 изображен простейший универсальный бипер, который состоит из <br/>транзисторного ключа и активного звукоизлучателя, питается напряжением 5 В и <br/>управляется стандартным логическим уровнем с вывода контроллера. В зависимо-<br/>сти от настройки прошивки контроллера, бипер может короткими звуковыми сиг-<br/>налами индицировать переключение режимов, а по команде с пульта включаться <br/>в постоянном режиме. <br/> <br/>Рис. 3.15. Простейший звуковой излучатель <br/>Попытки авиамодельного сообщества использовать для поиска моделей радиома-<br/>ячки, с последующей пеленгацией их специальным приемником, пока реализуются <br/>с переменным успехом. Радиус действия и точность ориентации на источник у ра-<br/>диомаячка заметно выше, но к упомянутой ранее зависимости от исправности бор-<br/>товой аппаратуры добавляется необходимость использовать пеленгующий прием-<br/>ник с антенной узконаправленного действия. Кроме того, передатчик маячка дол-<br/>жен иметь собственную передающую антенну, и эффективность ее работы очень <br/>сильно зависит от расположения после падения. Маячки могут иметь автономный <br/>источник питания и датчик удара. В качестве приемника обычно используют недо-<br/>рогие китайские портативные радиостанции. <br/>Наиболее сложным, дорогостоящим и эффективным устройством является GPS-<br/>трекер. Это устройство состоит из приемника GPS, модуля сотовой связи GSM и <br/>автономного источника питания. Во время всего полета приемник GPS непрерывно <br/>отслеживает координаты летательного аппарата и с интервалом в несколько секунд <br/>передает их при помощи модуля сотовой связи. Координаты могут передаваться <br/>как по каналу GPRS на сервер одного из сервисов по отслеживанию объектов, так и <br/>в виде обычных SMS на телефон владельца. В первом случае можно воспользо-<br/>ваться одним из бесплатных или условно-бесплатных сервисов, которые не только <br/>ведут лог координат, но и накладывают их на карту местности. Во втором случае <br/>частота передачи SMS зависит от их стоимости и ограничений сотового оператора. <br/><br/>Глава 3. Дополнительные компоненты квадрокоптера 101 <br/>Поэтому обычно SMS во время полета следуют с интервалом не менее 10 с, а после <br/>аварии оператор отправляет SMS с командой на трекер и в ответ получает коорди-<br/>наты упавшего коптера с точностью 6–12 м. <br/>В настоящее время широко применяются готовые миниатюрные GPS-трекеры <br/>(рис. 316) китайского производства, которые крепятся на ошейники собак, а также <br/>трекеры для контроля за перемещением пожилых людей или детей. Все эти треке-<br/>ры имеют автономную батарею, которой хватает на несколько часов, и неплохо <br/>подходят для использования на квадрокоптерах. Трекеры для детей и пожилых лю-<br/>дей обычно оснащены тревожной кнопкой и каналом голосовой связи, но для ис-<br/>пользования в коптерах это излишние опции, к тому же повышающие вес и стои-<br/>мость. <br/> <br/>а б <br/>Рис. 3.16. Автомобильный (а) и бытовой (б) GPS-трекеры <br/>Главным недостатком GPS-трекеров является необходимость находиться в зоне <br/>действия сотовой связи. Это не слишком критично для европейских стран, но мо-<br/>жет оказаться проблемой на бескрайних российских просторах. Но даже при нали-<br/>чии сотовой связи она может прерваться после падения коптера в овраг или водоем. <br/>То же самое относится и к приему сигнала GPS. Благодаря постоянному слежению <br/>за координатами и скоростью полета можно по логам с достаточной точностью <br/>предсказать направление полета и точку падения, существенно сузив зону поиска. <br/>Для окончательного поиска может оказаться полезен и упомянутый выше бипер. <br/> <br/>Сервомашинки <br/>Для квадрокоптера сервомашинки не являются обязательным компонентом. В ба-<br/>зовой конструкции они не нужны, и даже в подвесах камеры все чаще используют-<br/>ся специальные бесколлекторные двигатели. Но в любом случае устройство серво-<br/>машинок полезно знать для общей эрудиции. <br/>Сервомашинка представляет собой классическое электромеханическое устройство <br/>с обратной связью (рис. 317). Она состоит из электромотора, редуктора, потенцио-<br/>метра обратной связи и платы управления. Сервомашинки разделяются на аналого-<br/>вые и цифровые в зависимости от устройства узла управления. В цифровых серво-<br/>машинках применяется встроенный микроконтроллер. <br/><br/>102 Часть I. Теория <br/> <br/>Рис. 3.17. Устройство обычной сервомашинки <br/>Потенциометр обратной связи механически напрямую связан с выходным валом <br/>сервомашинки, и положение бегунка потенциометра отражает для схемы управле-<br/>ния положение вала. На схему управления сервомашинкой с одного из каналов <br/>приемника или с выхода полетного контроллера поступают стандартные импульсы <br/>радиоуправления, структуру и параметры которых мы уже рассмотрели ранее.  <br/>Каждый входящий импульс радиоуправления запускает встроенный генератор од-<br/>нократного опорного импульса внутри сервомашинки. Длительность внутреннего <br/>опорного импульса зависит от положения бегунка потенциометра. Электронная <br/>схема управления сравнивает длительности входящего и опорного импульсов. Если <br/>они совпадают, то ничего не происходит. Если же длительности различаются, то <br/>вырабатывается разностный сигнал с положительным или отрицательным знаком. <br/>Этот сигнал поступает на схему управления мотором, который начинает вращаться <br/>в сторону уменьшения разности импульсов, поворачивая через редуктор выходной <br/>вал и движок потенциометра. Как только длительности управляющего и опорного <br/>импульсов совпадают, мотор останавливается. <br/>Таким образом, угловое положение вала сервомашинки всегда соответствует поло-<br/>жению ручек управления на пульте либо управляющему сигналу полетного кон-<br/>троллера. Если же к валу сервомашинки прикладывается внешнее усилие, то ма-<br/>лейшее смещение вала относительно заданного положения приводит к появлению <br/>сигнала рассогласования, и сервомашинка возвращает вал в заданное положение. <br/>Но так идеально машинка работает только в теории. На практике механическая <br/>часть обладает инерцией, и даже после отключения питания мотора он поворачива-<br/>ется немного больше, чем нужно — вал проскакивает заданное положение. Элек-<br/>троника отрабатывает возврат, и механика вновь проскакивает немного больше, <br/>чем нужно, но уже в обратную сторону, и все повторяется. В итоге возникает цик-<br/>лическое автоколебательное дрожание вала, так называемый джиттер. Чтобы пода-<br/>вить джиттер, вводят так называемую "мертвую зону", внутри которой электроника <br/>не обращает внимания на разностный сигнал, полагая, что он равен нулю и вал <br/>точно стоит в заданном положении. Но слишком большая "мертвая зона" снижает <br/>точность управления. Подавления джиттера при узкой мертвой зоне добиваются, <br/>используя прецизионные шестеренки редуктора и высокоточные потенциометры <br/><br/>Глава 3. Дополнительные компоненты квадрокоптера 103 <br/>обратной связи, а также оптимизируя сервомашинки под определенное напряжение <br/>питания. <br/>Если на вход сервомашинки приходит сигнал нестандартной длительности, напри-<br/>мер, в результате воздействия помехи, то вал сервомашинки резко проворачивается <br/>в крайнее положение и там упирается в ограничитель. К поломке сервомашинки <br/>это не приводит, но резко возрастает ее потребляемый ток, а внезапный уход  <br/>в крайнее положение может привести к порче внешних механических компонентов <br/>модели или к аварии. Этого недостатка лишены цифровые сервомашинки. Микро-<br/>контроллер игнорирует заведомо ошибочный входной сигнал, не меняя положение <br/>вала. <br/>Кроме того, в цифровых сервомашинках естественным образом реализуется после-<br/>довательный протокол S.Bus/S.Bus2 или аналогичный. Благодаря этому можно  <br/>каждой сервомашинке присвоить свой уникальный адрес и соединить их все одной <br/>последовательной сигнальной шиной. Также к достоинствам цифровых сервома-<br/>шинок можно отнести высокое быстродействие и точность, т. к. аналоговая схема <br/>считывает положение вала потенциометра и управляет двигателем только по при-<br/>ходу управляющего импульса, а цифровая схема делает это намного чаще. Недос-<br/>татками цифровых сервомашинок являются более высокая цена и необходимость <br/>программировать их при помощи специального программатора. <br/>Важно иметь в виду, что цифровые сервомашинки питаются от более высокого на-<br/>пряжения, чем аналоговые: 6 или 7,4 В вместо 5 В. Попытка включить обычную <br/>машинку вместо цифровой приведет к выходу аналоговой машинки из строя. <br/>Потенциометр сервомашинки подвержен механическому износу, истиранию рези-<br/>стивного слоя в районе центрального положения, поэтому по мере эксплуатации <br/>возрастает погрешность сервомашинки и джиттер. Но это становится заметно по <br/>прошествии минимум десяти часов непрерывной эксплуатации. Как правило, <br/>раньше происходит разрушение пластикового редуктора машинки вследствие ава-<br/>рии. Сервомашинки, рассчитанные на повышенные механические нагрузки, делают <br/>с металлическими редукторами. <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/><br/>  <br/> <br/> <br/> <br/> <br/>ЧАСТЬ II <br/> <br/> <br/> <br/>ПРАКТИКА <br/>Глава 4. Подготовка к изготовлению квадрокоптера <br/>Глава 5. Сборка и настройка квадрокоптера <br/>Глава 6. Подключение и настройка внешних модулей <br/>Глава 7. Обслуживание и ремонт квадрокоптера <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/><br/>  <br/> <br/> <br/>ГЛАВА 4 <br/> <br/> <br/> <br/>   <br/> <br/>Подготовка  <br/>к изготовлению квадрокоптера <br/>Прежде всего, необходимо определиться с размером конструкции, который приня-<br/>то выражать в расстоянии между осями моторов по диагонали. При изготовлении <br/>самого первого коптера лучше избегать крайних проявлений — наладонных нано-<br/>коптеров или конструкций с диагональю более 700 мм и весом более 2 кг. Размер <br/>диагонали рамы самых распространенных коптеров для обычного любительского <br/>применения лежит в пределах от 250 до 600 мм. <br/>Типоразмер 450 мм оптимален с точки зрения экономичности компонентов и про-<br/>стоты изготовления. В свою очередь, коптеры размером 600 мм более стабильны  <br/>в полете, способны нести больше полезной нагрузки и дают больше возможностей <br/>для развития конструкции в перспективе, ими легче управлять визуально, потому <br/>что они крупнее. Рамы размером менее 450 мм нежелательно использовать для <br/>обучения пилотированию "с нуля", т. к. неопытному пилоту сложно визуально  <br/>определить положение небольшого коптера в пространстве. <br/>Важным фактором в подборе компонентов коптера являются финансовые возмож-<br/>ности пилота, поэтому дать универсальный рецепт невозможно. Мы будем исхо-<br/>дить из скромных возможностей школьника или студента, а читатель может мас-<br/>штабировать меру своих затрат самостоятельно. <br/>ПРИМЕЧАНИЕ <br/>С точки зрения экономии средств и времени обычно выгоднее покупать узлы и компо-<br/>ненты в виде целевых наборов: набор для сборки рамы, набор моторов и регуляторов, <br/>набор из передатчика и приемника и т. д. Как правило, наборы  стоят на 20–30% де-<br/>шевле, чем при покупке компонентов по отдельности. <br/>На основе опыта автора и обсуждений на тематических форумах можно пред- <br/>ложить следующий экономичный алгоритм построения и развития конструкции <br/>в условиях ограниченных средств. <br/>1. Если нет возможности за один сезон закупить полный комплект дополнительно-<br/>го оборудования — видеокамеры, видеоканал, OSD, GPS, то имеет смысл при-<br/>обрести с прицелом на будущее качественный полетный контроллер, хорошие <br/>регуляторы оборотов на рабочий ток не менее 30 А, комплект аппаратуры ра-<br/><br/>108 Часть II. Практика <br/>диоуправления не менее, чем на 8 каналов (лучше на 12) и построить первую <br/>раму размером 450 мм. Оснастить эту раму недорогими двигателями и пропел-<br/>лерами. <br/>2. После успешного обучения, к следующему сезону приобрести более мощные <br/>двигатели, пропеллеры и батареи, построить раму размером 600 мм и переста-<br/>вить на нее уже имеющиеся контроллер, регуляторы и приемник радиоуправле-<br/>ния. Если будет возможность, то оснастить эту раму приемником GPS и видео-<br/>оборудованием. <br/>Подбор силовых компонентов <br/>К силовым компонентам конструкции относятся все узлы и детали, непосредствен-<br/>но участвующие в создании тяги, позволяющей коптеру оторваться от земли: дви-<br/>гатели и пропеллеры (винтомоторная группа, ВМГ), регуляторы оборотов, силовая <br/>батарея. Они требуют тщательной взаимной оптимизации параметров, не допуская <br/>при этом выхода за рамки допустимых значений тока и температуры. <br/>ПРИМЕЧАНИЕ <br/>Общепринятым и универсальным критерием оценки качества подбора компонентов <br/>является время полета коптера. Если использовать силовые компоненты среднего <br/>ценового сегмента, применяемые в большинстве любительских конструкций, то обыч-<br/>ное время комбинированного полета — движение + висение — составляет 14–18 ми-<br/>нут. <br/>Резкие акробатические эволюции и ускорения сокращают время полета. Также <br/>уменьшается время полета в ветреную погоду, когда квадрокоптер вынужден не-<br/>прерывно компенсировать порывы ветра скачками оборотов двигателей. <br/>Расчеты и оптимизация <br/>Для оптимизации конструкции можно использовать популярный онлайн-сервис <br/>www.ecalc.ch, позволяющий производить расчет и оптимизацию параметров само-<br/>летов, вертолетов, квадрокоптеров и импеллерных моделей. По отношению к ком-<br/>пьютерной оптимизации авиамоделисты делятся на три категории: <br/>� те, кто тщательно обсчитывают всевозможные сочетания параметров и безус-<br/>ловно доверяют результату; <br/>� те, кто не признают компьютерную оптимизацию вообще; <br/>� те, кто используют компьютерные расчеты для оценки и проверки, не выходят <br/>ли эксплуатационные параметры за пределы допустимых значений, с после-<br/>дующей проверкой и доводкой в ходе испытаний. <br/>Автор склоняется к третьему варианту. <br/>В качестве примера выполним расчеты для двух реальных наборов компонентов, <br/>которые автор успешно использует на своих коптерах несколько лет, и сравним <br/>реальные показатели нагрузок и времени полета с расчетными. Без регистрации <br/><br/>Глава 4. Подготовка к изготовлению квадрокоптера 109 <br/>сайт предоставляет только демоверсию расчетов со сниженной точностью и огра-<br/>ниченным выбором компонентов, поэтому лучше сразу зарегистрироваться. <br/>Набор 1 — рама 450 мм: <br/>� двигатели Turnigy Aerodrive 2213, 1050kV, 56 г, 16 А пиковый ток; <br/>� батарея Turnigy nano-tech, 2200 mAh, 201 г; <br/>� регулятор четырехканальный Skywalker Quattro, 20 А; <br/>� пропеллеры безымянные 10×4,7 дюйма. <br/>Набор 2 — рама 600 мм: <br/>� двигатели AX-2810Q, 750kV, 70 г, 30 А пиковый ток; <br/>� батарея Turnigy nano-tech, 3300 mAh, 317 г; <br/>� регуляторы Afro, 30 А; <br/>� пропеллеры Gemfan 11×4,7 дюйма. <br/>Введем в форму на сайте данные для первого набора компонентов. Вес модели <br/>(включая ВМГ) зададим 950 г, потому что именно столько весит полностью снаря-<br/>женный коптер автора, включая дополнительное оборудование. Если рамы у вас <br/>еще нет и оценить полный вес не получается, то можно оставить вес 850 г, предло-<br/>женный по умолчанию. Вес снаряженного коптера влияет на расчет потребляемого <br/>тока и температуры двигателей. <br/>В списке аккумуляторов выберем наиболее близкий по характеристикам вариант: <br/>LiPo 2100mAh 30/45С. База данных сайта хранит и отображает вес аккумулятора <br/>из расчета на одну банку. Во время расчета этот вес будет автоматически умножен <br/>на количество банок. <br/>В списке регуляторов выберем опцию max 20A. <br/>Нужный мотор Turnigy найдем в самом конце списка: 2213-20T (1050). Его вес на <br/>сайте слегка занижен относительно реального. <br/>Нужного нам производителя пропеллеров в списке нет, поэтому можно выбрать <br/>один из похожих, APC Electric E или GWS EP размера 10*4,7. Надо особо отме-<br/>тить, что при одинаковом паспортном размере пропеллера на практике тяга и эко-<br/>номичность ВМГ может различаться на 10–15% в зависимости от производителя <br/>и качества пропеллеров и двигателей. Поэтому вам в любом случае впоследствии <br/>придется покупать пропеллеры разных производителей и экспериментировать  <br/>с ними. Автор провел серию измерений тяги различных недорогих пропеллеров <br/>размером от 9×5 до 11×4,7 в сочетании с популярным двигателем из набора 1 и ус-<br/>тановил, что наиболее эффективными оказались пропеллеры 10×4,7 безымянного <br/>производителя, которые продаются практически везде по самой низкой цене. К со-<br/>жалению, среди этих пропеллеров весьма высок процент брака в виде "бабочки" <br/>лопастей, поэтому они требуют тщательной балансировки и даже устранения "ба-<br/>бочки" при помощи фена, но распространенность, чрезвычайно низкая цена и вы-<br/>сокая эффективность искупают эти недостатки в коптерах для начинающих. <br/><br/>110 Часть II. Практика <br/>Ввод данных окончен, нажимаем кнопку Рассчитать и проверяем результаты. Сра-<br/>зу можно отметить, что полетное время сильно занижено. В реальности среднее <br/>полетное время квадрокоптера #1 при наличии новой полностью заряженной бата-<br/>реи составляет 12–14 минут, при спокойном висении — до 17 минут. Зато прочие <br/>параметры, такие как потребляемый ток, температура двигателей и т. д., весьма <br/>близки к реальным. Мы видим, что ни один из параметров не выходит за рамки до-<br/>пустимого, а регуляторы можно покупать на ток 15 А. <br/>Теперь рассчитаем второй вариант комплектации. Зададим реальный вес снаряжен-<br/>ной рамы 1200 г, включая дополнительное оборудование. Если вы еще не знаете <br/>вес готовой рамы, можете для оценочного расчета ограничиться весом 1000 г. <br/>Далее выбираем: батарея LiPo 3300mAh - 35/50C, регулятор max 30A, двигатель <br/>AX-2810Q-750, пропеллеры APC Electric E 11*4,7. Запускаем расчет и анализиру-<br/>ем результат. Расчетное время полета вновь занижено. В реальности среднее время <br/>смешанного полета этого коптера на свежей батарее 3300 mAh составляет 13–<br/>15 минут. Но главное, что мы видим — большой, почти двукратный запас по току <br/>для регуляторов, моторов и батареи. Расчетные значения тока и температуры весь-<br/>ма точно соответствуют реальным. О недогруженности моторов говорят и графики <br/>внизу страницы. В данном случае автор этого и хотел, приобретая компоненты "на <br/>вырост", для более крупной рамы и большей полезной нагрузки. <br/>Обратимся к столбцу Коптер в результатах расчета. При общем весе ВМГ 788 г <br/>расчетная полезная нагрузка составила 955 г, т. е. максимальный расчетный полет-<br/>ный вес, при котором ток и температура не выходят за пределы допустимых, со-<br/>ставляет 788 + 955 = 1743 г. Полетный вес имеющегося коптера 1200 г, значит, мы <br/>можем добавить еще 543 г полезной нагрузки. Надо полагать, что если полетный <br/>вес коптера будет соответствовать предельному, мы как раз получим расчетное <br/>укороченное время полета. <br/>Теперь проведем эксперимент. Увеличим размер пропеллера до 12×4,7. Мы видим, <br/>что потребляемый от батареи ток несколько увеличился, но при этом время полета <br/>возросло. Это говорит о том, что повысилась эффективность работы ВМГ. И дейст-<br/>вительно, для двигателя AX-2810Q с kV = 750 пропеллер 11×4,7 слишком мал и не <br/>позволяет развить оптимальную тягу. Полевые испытания с пропеллерами 12×4,5 <br/>полностью подтвердили расчеты. Среднее время смешанного полета увеличилось <br/>примерно на 3 минуты. <br/>Дальнейшее увеличение размера пропеллера до 14×4,7 приводит к возрастанию <br/>времени висения, но снижает время активного полета. Это связано с большой <br/>инерцией вращения винтов. Стабилизация коптера, как вы знаете, происходит за <br/>счет быстрого и точного управления оборотами двигателей. С увеличением размера <br/>быстро нарастают пиковые токи через двигатели и регуляторы, которые вынужде-<br/>ны резко разгонять и тормозить тяжелые "маховики" пропеллеров. Это увеличивает <br/>расход энергии при активном пилотировании. Увеличивается гироскопический  <br/>эффект пропеллеров. В целом коптер становится более плавным и вялым в управ-<br/>лении. Поэтому пропеллеры большого диаметра применяются в основном для  <br/>аэровидеосъемки при стабильном и плавном полете. <br/><br/>Глава 4. Подготовка к изготовлению квадрокоптера 111 <br/>ПРИМЕЧАНИЕ <br/>Когда работа над книгой подходила к завершению, возобновил свою работу сайт рос-<br/>сийского калькулятора www.rc-calc.com Интерфейс этого сайта проще и понятнее <br/>для новичков; сайт позволяет авторизоваться через аккаунты в соцсетях или Google, <br/>хранить данные своих коптеров и обмениваться ссылками на результаты расчетов.  <br/>К тому моменту, когда вы будете читать эту книгу, сайт наверняка будет наполнен <br/>достаточным количеством исходных данных для расчетов. <br/>Теперь, когда вы поняли основные принципы подбора компонентов, поэксперимен-<br/>тируйте с различными пропеллерами, моторами и батареями. Обратите особое <br/>внимание на то, в каких случаях нагрузки выходят за пределы допустимого. Посте-<br/>пенно вы начнете интуитивно чувствовать оптимальное сочетание компонентов и <br/>без программы расчета. Простое увеличение емкости батареи не обязательно уве-<br/>личит время полета, т. к. возрастет вес батареи. Соответственно, для новой батареи <br/>может понадобиться изменить ВМГ. <br/>Стойкость конструкции к авариям <br/>Выбор конструкционных материалов во многом зависит от разумно заданной стой-<br/>кости к авариям. Мы исходим из того, что аварии случаются даже у опытных пило-<br/>тов, а в период обучения без них не обойтись. <br/>Стойкой к авариям является не та конструкция, которая вообще не ломается при <br/>падении — так не бывает, а та, у которой ущерб после падения минимален. По-<br/>этому важной частью стойкой конструкции является наличие разрушаемых элемен-<br/>тов. Эти элементы должны иметь минимальную стоимость и сложность изготов- <br/>ления. Разрушаясь, они поглощают энергию деформации и сохраняют в целости  <br/>дорогие и важные узлы. В ряде случаев используются подпружиненные элементы. <br/>Классическим примером поглощающего узла являются посадочные стойки. Их на-<br/>меренно делают упругими и прочными ровно настолько, чтобы при сильном ударе <br/>о землю они поглотили максимум энергии, но не передали деформацию дальше, а в <br/>крайнем случае сломались сами. В общем случае, прочность элементов конструк-<br/>ции должна нарастать от периферии к центру. Сначала должны идти амортизи-<br/>рующие элементы, затем сминаемые и далее несущие и критически важные. Здесь <br/>просматривается аналогия с пассивной безопасностью автомобиля, у которого сна-<br/>чала идут амортизирующие бамперы, затем сминаемые зоны моторного отсека и <br/>багажника, а потом усиленный стальными трубами салон. <br/>Примером неудачной, с точки зрения стойкости к авариям, конструкции квадро-<br/>коптера является сочетание прочных монолитных лучей и прослабленного чрез-<br/>мерно большими прорезями и отверстиями центра рамы. При ударе лучом о землю <br/>вся энергию удара передается на центральную часть, ломая ее на куски. При этом <br/>могут пострадать и электронные узлы. После аварии потребуется долгий и слож-<br/>ный ремонт рамы, тогда как сломанный луч можно заменить даже в полевых усло-<br/>виях, а погнутый просто выправить. Ослабление центра рамы относительно лучей <br/>не дает заметного выигрыша по весу, но существенно снижает стойкость. Поэтому <br/>лучше сделать прочный центр рамы, а лучи облегчить фрезерованием или высвер-<br/><br/>112 Часть II. Практика <br/>ливанием. Сказанное не относится к рамам, у которых центр и лучи из карбона.  <br/>Такие рамы почти неразрушаемы, но стоят достаточно дорого. <br/>Еще одним разрушаемым элементом является нейлоновый крепеж — винты, гайки, <br/>стойки. Их нежелательно применять для крепления лучей и монтажа нагруженных <br/>элементов конструкции в тяжелых коптерах, но для крепления электронных узлов, <br/>антенн и небольших видеокамер они подходят хорошо. При аварии с деформацией <br/>рамы нейлоновые винты легко срезаются или срываются и плата или антенна про-<br/>сто отлетает в сторону, оставаясь целой. В случае использования прочного метал-<br/>лического крепежа можно получить плату полетного контроллера с отломленными <br/>углами или даже треснувшую по диагонали. Особенно сложны в диагностике визу-<br/>ально незаметные скрытые трещины платы с разрывом проводников. Применение <br/>нейлонового крепежа также дает экономию веса, которая очень важна для неболь-<br/>ших коптеров. <br/>Расцепляемые электрические разъемы тоже вносят свой вклад в безопасность. <br/>Кроме традиционных для авиамодельного оборудования штыревых рядных разъе-<br/>мов все чаще применяются миниатюрные разъемы типа MOLEX. Оба типа разъе-<br/>мов не разрушаются и не повреждают плату при разъединении рывком во время <br/>аварии, но обеспечивают надежный контакт во время эксплуатации. Поэтому не <br/>следует дополнительно фиксировать разъемы в гнезде при помощи термоклея или <br/>металлических скобок. Иначе вероятность после аварии получить вырванные  <br/>с платы вместе с кусками дорожек гнезда разъемов будет существенно выше, чем <br/>вероятность пропадания контакта в полете. <br/>Силовые провода от распределителя питания к регуляторам и от регуляторов к мо-<br/>торам следует соединять только пайкой (рис. 4.1). Несмотря на то, что эти провода <br/>следует делать как можно короче, желательно предусмотреть небольшой запас на <br/>вытягивание при деформации лучей или отламывании моторамы. Провода, выхо-<br/>дящие из двигателя, необходимо прочно закрепить либо каплей эпоксидной смолы <br/>в окне двигателя, либо хомутом к мотораме, чтобы избежать отрыва провода от об-<br/>мотки внутри двигателя при натяжении. На рис. 4.2 обратите внимание на фикса-<br/>цию выводов двигателя эпоксидной смолой. Внутри луча уложен небольшой запас <br/>провода (~2 см) на случай отламывания моторамы. <br/> <br/> <br/>Рис. 4.1. Пример монтажа двигателя с укладкой провода снаружи луча <br/><br/>Глава 4. Подготовка к изготовлению квадрокоптера 113 <br/> <br/>Рис. 4.2. Пример монтажа двигателя с укладкой провода внутри луча <br/>На квадрокоптерах не применяются так называемые пропсейверы — крепление <br/>пропеллеров к втулке при помощи резинового кольца, как на легких электрических <br/>самолетах. Нагрузки на пропеллер слишком велики, поэтому пропеллеры крепятся <br/>жестко, при помощи гайки или нейлоновых стяжек и при аварии обычно ломаются. <br/>Защитные кольца вокруг пропеллеров хорошо защищают окружающих от травм, но <br/>мало помогают при падении. <br/>ПРИМЕЧАНИЕ <br/>Коптерам присуще захлестывание лопастей, т. е. удар лопастей вращающегося винта <br/>о луч даже при не очень сильном ударе о землю. Поэтому нельзя располагать регуля-<br/>торы или другие компоненты на луче в зоне потенциальной досягаемости удара ло- <br/>пастью. <br/>Для защиты силовых батарей от механических повреждений в продаже появились <br/>карбоновые чехлы, но применение чехлов или поролоновых оберток может привес-<br/>ти к перегреву батареи, поэтому защиту батарей используйте с осторожностью. <br/>Конструкционные материалы <br/>Как мы уже говорили, в идеале механическая прочность конструкции должна  <br/>нарастать от периферии к центру. В остальном конструкция коптера, особенно  <br/>начального уровня, мало критична к конструкционным материалам. <br/>Древесина, как ни странно, является одним из лучших материалов для изготовле-<br/>ния рамы первого коптера размером до 450 мм, особенно его лучей. Дело в том, что <br/>лучи из древесных брусков плохо проводят вибрацию от моторов и не имеют вы-<br/>раженных собственных резонансов. Это очень благотворно влияет на стабильность <br/>работы акселерометров. Лучи из древесины мало весят и стоят недорого. Цен-<br/>тральную часть рамы можно изготовить из качественной фанеры толщиной 3–4 мм. <br/>Иногда можно встретить объемные конструкции из фанеры, изготовленные лазер-<br/>ной резкой и собранные по принципу 3D-паззлов. <br/>Но деталям из древесины присущи и недостатки. Это низкая механическая проч-<br/>ность и склонность к раскалыванию, что порождает проблемы при креплении мо-<br/><br/>114 Часть II. Практика <br/>торамы к лучам и самих лучей к центру рамы. Необходимо иметь определенный <br/>опыт работы с древесиной. Если вы обладаете навыками, инструментами и сырьем, <br/>то почти все детали рамы первого коптера вполне можно изготовить из брусков и <br/>фанеры. Исключение составят лишь моторамы и мелкие крепежные кронштейны <br/>для дополнительных устройств. Следует избегать сборки на клею — это сущест-<br/>венно снижает ремонтопригодность. <br/>Радиотехнический стеклотекстолит изготавливается из нескольких слоев стекло-<br/>ткани, пропитанных эпоксидной смолой. На производстве листы зажимаются в <br/>пресс и подвергаются горячему отверждению. Материал прочный, достаточно лег-<br/>ко сверлится, пилится и фрезеруется в домашних условиях, но почти не поддается <br/>лазерной резке. Обычно применяется для изготовления печатных плат, поэтому <br/>продается в радиомагазинах с покрытием медной фольгой с одной или двух сторон. <br/>Доступность и прочность сделали этот материал очень популярным. Серьезными <br/>недостатками стеклотекстолита являются большой удельный вес и склонность <br/>к расслаиванию при механических нагрузках. <br/>ВНИМАНИЕ! <br/>Не следует удалять фольгу с текстолита при помощи раскаленного утюга! В результа-<br/>те перегрева пластина текстолита необратимо деформируется, закручиваясь "вин-<br/>том". Кроме того, перегретый текстолит склонен к расслаиванию. <br/>Фольгу следует удалять химическим травлением при помощи хлорного железа или <br/>персульфата аммония. Эти реактивы можно приобрести в радиомагазине вместе  <br/>с текстолитом. Процесс травления в свежем подогретом растворе хлорного железа <br/>занимает 15–20 минут. Раствор можно использовать многократно. Для экономии <br/>раствора лучше протравливать уже готовые детали. Протравленные поверхности <br/>можно красить, к ним хорошо прилипает эпоксидный клей. <br/>ВНИМАНИЕ! <br/>Будьте аккуратны при работе с хлорным железом! Раствор оставляет на окружающих <br/>предметах и одежде ничем не удаляемые бурые пятна, а также сильно окрашивает <br/>кожу рук. <br/>Конструкционный текстолит по структуре аналогичен радиотехническому, но <br/>более прочен, меньше склонен к расслаиванию под нагрузкой. В отличие от радио-<br/>технического обладает худшими изолирующими свойствами, но для изготовления <br/>механических деталей это не имеет значения. Сверлится, пилится и фрезеруется так <br/>же легко, как и радиотехнический. Не требует удаления фольги. Обычно окрашива-<br/>ется в черный, реже в коричневый или зеленый цвет. Иногда имеет текстурирован-<br/>ную тиснением поверхность. К сожалению, этот материал редко встречается в про-<br/>даже в России, хотя на производстве в Китае используется очень широко, как де-<br/>шевый заменитель карбона. В России можно попробовать приобрести листовой <br/>"электротехнический текстолит G10", но его цена будет выше, чем у китайского <br/>конструкционного. <br/>Карбон во всех его вариациях является почти идеальным материалом для летаю-<br/>щих устройств. Наполняющим и силовым элементом материала являются карбоно-<br/><br/>Глава 4. Подготовка к изготовлению квадрокоптера 115 <br/>вые волокна, а связующим веществом — полиэфирные композиции горячего либо <br/>холодного отверждения. Карбоновым волокнам присуща чрезвычайно высокая <br/>удельная прочность при малом весе. Недостатком карбоновых деталей является <br/>хорошая проводимость вибрации и наличие выраженных собственных резонансов, <br/>что вредит виброзащите. <br/>В авиамоделизме применяются следующие разновидности карбоновых материалов. <br/>� Карбоновая ткань изготавливается из длинных волокон методом перекрестно-<br/>го плетения. В зависимости от технологии бывает из скрученных и прямых во-<br/>локон, различается по плотности плетения. Применяется для формовки объем-<br/>ных изделий (каркасы, кожухи). Из карбоновой ткани методом вакуумной фор-<br/>мовки изготавливают особо прочные и легкие пустотелые объемные рамы <br/>коптеров, так называемые "корки". <br/>� Листовой карбон изготавливается из нескольких слоев карбоновой ткани, про-<br/>питанной полиэфирной композицией с последующим холодным или горячим <br/>отверждением под прессом. Очень легок и прочен, почти не гнется, сверлится и <br/>фрезеруется труднее, чем стеклотекстолит. Стоит в несколько раз дороже стек-<br/>лотекстолита. <br/>ВНИМАНИЕ! <br/>В силу своих электрических свойств и физической структуры листовой карбон в неко-<br/>торых случаях способен полностью заблокировать работу приемника GPS, если его <br/>антенна расположена ближе, чем 2–2,5 см от поверхности карбона. При использова-<br/>нии карбоновых рам или деталей приемник GPS должен быть вынесен вверх на штан-<br/>ге или стойках высотой не менее 3 см. <br/>� Карбоновые трубки изготавливаются либо накручиванием нескольких слоев <br/>карбоновой ткани на оправку с пропиткой смолой, либо экструзией полимерной <br/>массы с наполнителем из карбоновых волокон. Это очень хороший материал для <br/>изготовления лучей рамы либо сборной трубчатой рамы целиком. Но у него есть <br/>серьезный недостаток: карбоновым трубкам, особенно изготовленным из нави-<br/>той ткани, присуща склонность к резко выраженным пикам резонанса на часто-<br/>тах вибрации. <br/>� Экструдированные профили (pulltruded carbon) изготавливаются экструзией <br/>полимерной массы с наполнителем из карбоновых волокон через профильную <br/>фильеру. Это могут быть круглые, квадратные или прямоугольные прутки, <br/>трубчатые профили. Материал различается по длине и ориентации карбоновых <br/>волокон. Дешевые материалы изготавливаются с наполнителем из коротких, <br/>хаотично ориентированных, карбоновых волокон. Как правило, это профили от-<br/>носительно большого сечения. Более дорогие и прочные профили содержат <br/>длинные волокна, ориентированные вдоль профиля. <br/>При изготовлении коптеров популярны трубчатые профили комбинированного <br/>сечения (рис. 4.3): квадратные снаружи, но с круглым отверстием внутри (square <br/>tube). Такие профили сочетают высокую удельную прочность круглой трубки и <br/>удобство монтажа квадратного профиля. Дело в том, что при изготовлении лу-<br/>чей из круглой трубки для крепления моторов и стыковки с рамой приходится <br/><br/>116 Часть II. Практика <br/> <br/>Рис. 4.3. Карбоновый профиль комбинированного сечения <br/>применять специальные хомуты и кронштейны, а для квадратного профиля они <br/>не нужны. <br/>� Карбоновые сэндвичи состоят из двух наружных слоев карбоновой ткани, на-<br/>клеенных полиэфирным клеем на тонкую листовую бальзу. Как правило, изго-<br/>тавливаются самостоятельно и применяются при строительстве малогабаритных <br/>сверхлегких конструкций. Обладают уникальным соотношением удельного веса <br/>и прочности. <br/>� Алюминиевые сэндвичи — материал, применяемый в рекламном производстве <br/>и при облицовке фасадов зданий. Два слоя алюминиевой фольги, толщиной <br/>0,3 мм каждый, наклеены на листовой пластик. Очень хорошо обрабатывается <br/>на станке с ЧПУ и вручную. Но обладает большим удельным весом и низким <br/>отношением прочности к весу. Поэтому не рекомендуется для изготовления  <br/>летающих конструкций. <br/>� Смешанные материалы — китайская новация, направленная на снижение се-<br/>бестоимости и цены материала. В производстве экструдированных профилей <br/>наполнитель может состоять из смеси карбоновых (~60–70%) и стеклянных <br/>(~40–30%) волокон. В производстве листовых материалов берется окрашенный <br/>в черный цвет технический текстолит G10 и с двух сторон облицовывается оди-<br/>нарным слоем карбоновой ткани. По внешнему виду для неопытного взгляда  <br/>такой материал неотличим от чисто карбонового листа. <br/>Как распознать поддельный карбон <br/>Строго говоря, смешанные материалы нельзя считать подделкой, если производитель <br/>или продавец честно сообщает о составе материала и продает его по адекватной це-<br/>не. Но, к сожалению, на практике комбинированные материалы очень часто продают <br/>под видом и по цене чистого карбона. Как можно распознать подделку? <br/>При дистанционном заказе в интернет-магазине невозможно заранее опознать под-<br/>делку, разве что по необычно низкой цене по сравнению с другими магазинами.  <br/><br/>Глава 4. Подготовка к изготовлению квадрокоптера 117 <br/>Экструдированные профили со смешанным наполнителем визуально почти невоз-<br/>можно отличить от чисто карбоновых. По цвету они практически не отличаются от <br/>профилей с чистым наполнителем, потому что цвет можно легко затемнить добавле-<br/>нием технической сажи. Сравнению поддается только удельный вес, но для этого на-<br/>до иметь возможность взвешивать разные образцы. <br/>Поддельный листовой карбон можно довольно легко распознать по срезу (рис. 4.4). <br/>Возьмите деталь со срезом после фрезы или слегка обработайте кромку листа наж-<br/>дачной бумагой. Затем протрите срез ваткой, смоченной спиртом, органическим рас-<br/>творителем 646 или ацетоном. Прежде всего, на ватке должны остаться только мел-<br/>кие частицы материала, без следов красителя. Кустарно изготовленный "гаражный" <br/>карбон или облицованный карбоном черный текстолит может оставить следы краски. <br/>Обработанный растворителем срез карбона почти не матируется и демонстрирует от-<br/>четливо заметную слоистую структуру карбоновой ткани, на которой видно чередова-<br/>ние укладки слоев. Срез текстолита после обработки становится светло-серым, мато-<br/>вым, слоистую структуру почти не заметно. <br/>При сверлении или фрезеровании опилки от настоящего карбонового листа черные и <br/>пушистые, как тонкая пыль. При обработке стеклотекстолита опилки светло-серые  <br/>и более грубые. В процессе обработки большинства разновидностей текстолита ощу-<br/>щается характерный резкий запах фенольных смол, входящих в его состав. Поли-<br/>эфирные смолы карбоновых листов почти не издают запах. <br/> <br/>Рис. 4.4. Боковые срезы карбона и текстолита <br/>Сплавы алюминия применяются в основном для изготовления трубчатых лучей <br/>рамы и мелких крепежных элементов. Стоимость таких лучей, в отличие от карбо-<br/>новых, очень мала. После аварии незначительно погнутый луч можно выправить в <br/>полевых условиях. Листовой алюминий для изготовления центральной части рамы <br/>и моторам не применяется по причине излишнего веса и сложности обработки  <br/>в домашних условиях. Более целесообразно применять листовой текстолит или <br/>карбон. <br/>Пластик в последнее время набирает популярность листовой фиберпластик, обыч-<br/>но акрилат, армированный дисперсным стекловолокном (FRP, Fiberglass Reinforced <br/>Plastic). Он легче стеклотекстолита и без проблем обрабатывается в домашних ус-<br/>ловиях, с завода окрашен в различные яркие цвета. При этом он упруг и прочен, <br/>меньше подвержен изломам. Небольшая рама из фиберпластика получается проч-<br/>ной, красивой и легкой. К сожалению, его довольно сложно купить в небольшом <br/>количестве, и стоит он на российском рынке несуразно дорого. Будем надеяться, <br/>что со временем цена и предложение нормализуются. <br/><br/>118 Часть II. Практика <br/>Остальные материалы применяются в качестве вспомогательных, для изготовления <br/>чехлов, кронштейнов и т. д. <br/>Виброзащита <br/>Вибрация — это проклятие винтокрылых машин, и квадрокоптеры — не исключе-<br/>ние. Источником вибрации являются винтомоторные группы, каждая из которых <br/>дает вибрацию на своей частоте, распространяющуюся по лучам к центральной <br/>части рамы и полетному контроллеру. При наложении нескольких высокочастот-<br/>ных колебаний возникают низкочастотные колебания с частотой, равной разности <br/>частот источников вибрации. Картину усугубляют собственные резонансы элемен-<br/>тов конструкции. <br/>ПРИМЕЧАНИЕ <br/>Вибрация очень вредна для акселерометров и гироскопов, поскольку сбивает их пока-<br/>зания. Внешне воздействие вибрации на контроллер проявляется в хаотичном подер-<br/>гивании коптера, его дрожании, внезапных рывках и кратковременной потере управ-<br/>ления на определенных оборотах при резонансе конструкции. В особо экстремальных <br/>случаях возможен внезапный переворот коптера и авария. <br/>Виброзащита включает в себя балансировку винтомоторной группы, которую мы <br/>рассмотрим в следующем разделе, а также виброизоляцию — препятствование рас-<br/>пространению вибрации при помощи вибропоглощающих и виброизолирующих <br/>материалов. <br/>Современные алгоритмы программной фильтрации позволяют эффективно защи-<br/>щать полетный контроллер от вибрационного шума в показаниях акселерометров, <br/>поэтому задача виброзащиты существенно упростилась. Сейчас уже не имеет прак-<br/>тического смысла виброизоляция креплений моторов, напрасно усложняющая кон-<br/>струкцию. Тщательной балансировки пропеллеров и моторов вполне достаточно. <br/>Далее вибрация распространяется по лучам. Высверливание или фрезерование  <br/>отверстий в алюминиевых лучах не только облегчает конструкцию, но также помо-<br/>гает подавить вибрацию и резонансы. Для подавления резонансов трубчатых кар-<br/>боновых лучей их внутреннее пространство заполняют монтажной пеной или <br/>вставляют цилиндрики длиной около 2 см из плотной пористой резины. Цилиндри-<br/>ки должны вставляться туго и располагаться на разном расстоянии друг от друга. <br/>Среднее расстояние между вставками примерно 5–7 см. <br/>ВНИМАНИЕ! <br/>В стенках карбоновых лучей нельзя рассверливать или фрезеровать окна, это значи-<br/>тельно снизит их прочность. <br/>К центральной части рамы лучи всегда крепятся жестко и прочно. Допускается <br/>складная конструкция, но виброизоляция в этой части конструкции никогда не <br/>применяется. <br/>Благодаря современным алгоритмам фильтрации вибропомех полетный контроллер <br/>может быть жестко прикреплен к раме (рис. 4.5). Автор настоятельно советует по-<br/><br/>Глава 4. Подготовка к изготовлению квадрокоптера 119 <br/>ступать именно так, а особое внимание уделить балансировке ВМГ. Но иногда, <br/>особенно при использовании дешевых некачественных моторов и пропеллеров, ка-<br/>чественная балансировка не получается. В таком случае следует смонтировать кон-<br/>троллер на 1–2 слоях пенистого двустороннего скотча или на проставках из плот-<br/>ной резины. Избегайте избыточного демпфирования контроллера! <br/> <br/>Рис. 4.5. Варианты крепления полетного контроллера к раме <br/>Избыточное демпфирование <br/>Избыточное демпфирование контроллера возникает при использовании слишком <br/>мягких демпферов, допускающих раскачивание. Ускорения при вибрации —  <br/>линейные, и раскладываются на ортогональные векторы, поэтому не влияют на  <br/>гироскопы, затрагивая только акселерометры. Но при слишком мягких демпферах <br/>появляется вращательная составляющая вибрации, как показано на рис. 4.6. Если <br/>центр тяжести платы смещен относительно геометрического центра точек опор, то  <br/>линейные ускорения неравномерно смещают плату на упругом подвесе, отсюда и <br/>возникает вращательная составляющая. <br/> <br/>Рис. 4.6. Эффект избыточного демпфирования <br/>Вращательная составляющая "сводит с ума" гироскопы, а поскольку гироскопы <br/>предназначены для немедленной и острой реакции на угловые отклонения, то вред <br/>от передемпфирования значительно превосходит вред от вибрации. Неопытные <br/><br/>120 Часть II. Практика <br/>владельцы коптеров склонны чрезмерно демпфировать полетный контроллер. <br/>Лучше начинать с монтажа контроллера вообще без демпферов, и смягчать крепле-<br/>ние только при крайней необходимости, когда балансировка ВМГ и настройка па-<br/>раметров программной фильтрации не помогают. <br/>Демпфирование подвеса камеры <br/>Вибрация камеры проявляется на изображении в виде "эффекта желе", когда изо-<br/>бражение полностью или в виде чередующихся широких полос колышется, словно <br/>студень. Этот эффект возникает из-за биений между частотами вибрации и часто-<br/>той смены кадров. <br/>Камера не должна жестко отслеживать малейшее отклонение рамы, поэтому, в от-<br/>личие от крепления контроллера, для подвеса камеры применяют мягкие демпфе-<br/>ры. Обычно это специальные пустотелые амортизаторы-"грибки" из силикона. <br/>Амортизаторы различаются по размерам и жесткости. Чем тяжелее камера, тем <br/>жестче амортизаторы и тем большее их количество требуется. Приблизительная <br/>жесткость в виде максимальной нагрузки на один амортизатор указывается в его <br/>характеристиках, но для достижения наилучшего результата обычно требуется <br/>подбирать жесткость и количество амортизаторов экспериментально. Поэтому <br/>амортизаторы лучше сразу приобретать с запасом и различной жесткости. <br/>Маленькую и легкую камеру можно подвесить на четырех амортизаторах малой <br/>или средней жесткости. При конструировании подвеса также следует избегать вра-<br/>щательно-раскачивающей составляющей, которая может сопровождать вибрацию. <br/>Для того чтобы избежать раскачивания подвеса, следует стараться поднять его <br/>центр тяжести как можно выше и разнести амортизаторы подвеса на максимальное <br/>расстояние, как показано на рис. 4.7. <br/>Остальные электронные узлы, такие как приемники GPS, выносные магнетометры, <br/>приемники и т. д., виброизоляции не требуют. <br/> <br/>Рис. 4.7. Предотвращение раскачивания подвеса <br/><br/>Глава 4. Подготовка к изготовлению квадрокоптера 121 <br/>Фиксация резьбовых соединений <br/>Высокочастотная вибрация способствует саморазвинчиванию резьбовых соедине-<br/>ний. Чтобы воспрепятствовать этому, применяются различные фиксаторы резьбы. <br/>Прежде всего, это гайки со специальными нейлоновыми вставками. Формально это <br/>одноразовые гайки, но на практике они выдерживают 3–4 цикла завинчивания-<br/>развинчивания, после чего нейлоновая вставка истирается резьбой и гайку нужно <br/>менять. <br/>В случаях, когда гайки с фиксатором применить невозможно, например при креп-<br/>лении двигателя к мотораме, используют жидкие фиксаторы резьбы. В обиходе их <br/>часто называют "локтайт" по имени наиболее известного производителя Loctite. <br/>Небольшое количество жидкости наносят на резьбу винта непосредственно перед <br/>завинчиванием. После того как винт вкручен, жидкость полимеризуется от контак-<br/>та с металлом, без присутствия воздуха. Поэтому такие фиксаторы называются ана-<br/>эробными. Поскольку катализатором полимеризации являются ионы металла, вин-<br/>товые соединения "пластик — пластик" такая жидкость не зафиксирует. <br/>Приобрести фиксатор резьбы можно в любом магазине автозапчастей и аксессуа-<br/>ров. По прочности фиксации жидкости делятся на три категории: сильная (крас-<br/>ная), средняя (синяя) и слабая (зеленая). При сборке квадрокоптеров желательно <br/>использовать синюю или зеленую жидкость. Они размягчаются при нагревании. <br/>Для вывинчивания винта рекомендуется нагреть его, например, мощным паяльни-<br/>ком. Соединения, зафиксированные качественной красной жидкостью, зачастую не <br/>удается расфиксировать даже при сильном нагреве. <br/>После разборки обязательно следует очистить резьбы винта и гайки от остатков <br/>фиксатора при помощи метчика и плашки, а перед сборкой нанести новый слой <br/>фиксатора. <br/>ПРИМЕЧАНИЕ <br/>Не используйте фиксатор для разборных соединений типа "металл — пластик". От-<br/>вердевший фиксатор, прилипший к металлической резьбе, разрушит резьбу пластико-<br/>вой детали при вывинчивании. Если деталь, в которую ввинчен стальной винт, алю-<br/>миниевая, то старайтесь вывинчивать винт только при нагреве или использовать сла-<br/>бый фиксатор, иначе алюминиевая резьба может быть испорчена. <br/>Для фиксации резьбы нейлонового крепежа можно использовать циакриновый <br/>клей. Это обычный "секундный" клей в маленьких тюбиках. Такой клей очень  <br/>быстро и прочно фиксирует нейлоновую резьбу. Смоченный клеем винт следует <br/>завинчивать быстро и не останавливаясь. Соединение с клеем исключительно  <br/>одноразовое, развинтить его не получится! Циакриновый клей не дает надежную <br/>фиксацию металлических резьб. <br/>Крепление моторов и винтов <br/>Конструкция квадрокоптера предусматривает только жесткое крепление винтов на <br/>валы моторов, и должно быть максимально надежным. Потеря пропеллера в полете <br/>означает немедленную и безусловную аварию коптера, а неправильное крепление <br/>значительно усиливает вибрацию. <br/><br/>122 Часть II. Практика <br/>Даже опытные владельцы коптеров допускают распространенную ошибку в мон-<br/>таже моторов и винтов: чрезмерный вынос вверх относительно плоскости крепле-<br/>ния. Обратимся к рис. 4.8, на котором схематически изображены два способа мон-<br/>тажа. <br/> <br/>а б <br/>Рис. 4.8. Два способа монтажа моторов на мотораме <br/> <br/>Способ (а) технически проще для монтажа мотора, особенно если у этого мотора <br/>длинный вал со стороны ротора, а также позволяет использовать для крепления <br/>винта стандартную цангу, которая идет в комплекте мотора. Очевидно, что малей-<br/>ший дисбаланс винта приведет к значительной маятниковой вибрации мотора на <br/>упругой мотораме. В свою очередь, такая вибрация приводит к "бабочке" вращения <br/>винта — движению лопастей в разных плоскостях — что существенно снижает эф-<br/>фективность ВМГ. Эта конструкция имеет четко выраженные резонансы вибрации <br/>при определенных оборотах мотора. Данный способ требует очень качественной <br/>балансировки винтов и моторов. <br/>В способе (б) мотор находится под моторамой, а винт закреплен на штатном проп-<br/>сейвере или цанге как можно ближе к мотораме. В данном случае маятниковая виб-<br/>рация минимальна. Недостатком второго варианта является возможность захлесты-<br/>вания лопастей об луч при жесткой посадке или аварии. Но, как правило, аварии <br/>происходят редко, и винты при этом все равно ломаются, а вибрация доставляет <br/>намного больше неприятностей. <br/>Сказанное не относится к специальным моторам для квадрокоптеров, которые <br/>имеют уменьшенную высоту и готовый узел крепления винта, интегрированный <br/>с мотором. Такие моторы крепятся на мотораму только сверху. <br/>Для крепления винтов в коптерах начального и среднего уровня очень удобно ис-<br/>пользовать штатный пропсейвер из комплекта поставки мотора. Он представляет <br/>собой втулку с двумя выступающими винтами. В самолетной конструкции винт <br/>крепится на него при помощи колечка из жесткой резины. Во время аварии самоле-<br/>та пропеллер просто соскакивает вбок и не ломается. Но для квадрокоптера такой <br/><br/>Глава 4. Подготовка к изготовлению квадрокоптера 123 <br/>способ совершенно неприемлем и приведет к потере винта в воздухе и аварии! По-<br/>этому винт крепят к пропсейверу при помощи двух нейлоновых стяжек, как пока-<br/>зано на рис. 4.9, а. Диаметр отверстия винта может не совпадать с диаметром  <br/>пропсейвера, поэтому применяются либо переходные кольца из комплекта винта, <br/>либо рассверливание отверстия. Осевой люфт винта недопустим! <br/>ПРИМЕЧАНИЕ <br/>Чтобы надежно зафиксировать пропсейвер, рекомендуется при помощи алмазного <br/>надфиля сделать на валу мотора неглубокие фаски под зажимные винты. <br/> <br/> <br/>а б <br/>Рис. 4.9. Монтаж обычного (а) и специального укороченного (б) моторов <br/>Для рассверливания воздушных винтов настоятельно советуем применять не свер-<br/>ло, а специальную шагово-коническую развертку (рис. 4.10), которую можно при-<br/>обрести в магазине слесарных инструментов. Эту покупку следует сделать сразу, <br/>потому что первое время винты придется менять часто. В отличие от сверла, раз-<br/>вертка самоцентруется в отверстии, ее не надо вставлять в дрель, достаточно за-<br/>жать в тисках и вращать винт от руки. <br/> <br/>Рис. 4.10. Шагово-коническая развертка для воздушных винтов <br/>Цанги-переходники, надеваемые на вал мотора, являются хоть и очевидным, но до-<br/>вольно неудачным способом крепления винта. Они зачастую имеют низкое качест-<br/>во, что приводит к нарушению центровки винта и появлению неустранимой силь-<br/>ной вибрации. Под влиянием вибрации такие цанги часто соскакивают с вала во <br/>время полета, либо у них развинчивается гайка, что также приводит к утере винта. <br/>Сотни аварий коптеров произошли именно по этой причине. У специализирован-<br/>ных моторов зажимной узел имеет насечки, препятствующие проворачиванию вин-<br/>та на валу и отвинчиванию гайки. <br/><br/>124 Часть II. Практика <br/>ПРИМЕЧАНИЕ <br/>Некоторые специализированные моторы для коптеров имеют цанги с правой и левой <br/>резьбой, в зависимости от рабочего направления вращения. Такие моторы надо поку-<br/>пать парами и монтировать правильно, чтобы направление вращения способствовало <br/>затягиванию гайки на валу. Обычно такие моторы имеют маркировку "R" и "L", которая <br/>совпадает с маркировкой соответствующих винтов. <br/>Магнитоизоляция <br/>Большие токи, протекающие в силовых проводах питания, порождают магнитное <br/>поле вокруг проводников. Это магнитное поле сбивает показания магнетометра — <br/>электронного компаса на плате полетного контроллера. Если компас не использу-<br/>ется, то магнитными наводками можно пренебречь. Но в большинстве случаев <br/>компас необходим при полетах по FPV для указания направления возврата домой, <br/>для автовозврата по GPS и для полета по заданным точкам. Компас также необхо-<br/>дим в режиме Headfree, когда контроллер автоматически отслеживает по компасу <br/>курсовое положение рамы и вычисляет условное направление "вперед". <br/>Если компас будет подвержен наводкам, то алгоритм контроллера все равно отра-<br/>ботает прибытие в заданную точку по координатам GPS, но скорость и траектория <br/>полета будут далеки от оптимальных. Ситуацию усугубляет то, что магнитные  <br/>помехи не постоянны, а пропорциональны оборотам несущих винтов. <br/>Для компенсации мощных магнитных наводок самым эффективным решением  <br/>является вынос микросхемы магнетометра на штанге длиной около 15 см вверх над <br/>рамой. Существуют готовые модули, которые состоят из антенны GPS и магнето-<br/>метра на одной плате, и модули, которые содержат только магнетометр. При нали-<br/>чии радиолюбительского опыта можно отпаять магнетометр с платы контроллера и <br/>поместить его на выносную плату. Магнетометр соединяется с контроллером по <br/>2<br/>шине I C, поэтому при использовании внешнего контроллера потребуется настро-<br/>2<br/>ить адрес магнетометра на шине I C и в некоторых случаях перерезать проводник, <br/>идущий к микросхеме на плате. Это зависит от версии платы и прошивки. <br/>При сборке коптера особое внимание следует уделить правильной укладке силовых <br/>проводников. Их длина должна быть минимально возможной; при этом длина по-<br/>ложительной и отрицательной шин питания должна быть одинаковой и пролегать <br/>они должны параллельно и только рядом, для максимальной взаимной компенса-<br/>ции магнитных полей. Скручивание силовых проводов между собой незначительно <br/>уменьшает наводки. <br/>ВНИМАНИЕ! <br/>Категорически запрещается укладывать монтажный запас силовых проводов кольцом <br/>(рис. 4.11)! <br/>Некоторые звукоизлучатели в индикаторах разряда батареи или поисковых маячках <br/>содержат очень мощные магниты. Поэтому звукоизлучатели следует монтировать <br/>как можно дальше от платы контроллера. <br/>Решение, следует ли выносить магнетометр на штангу, зависит от величины маг-<br/>нитных помех в собранном коптере. В разделе, посвященном интерфейсу настрой-<br/><br/>Глава 4. Подготовка к изготовлению квадрокоптера 125 <br/>ки коптера, будет рассказано, как проверить величину помех исходя из показаний <br/>компаса. Если при пиковом увеличении рабочего тока компас отклоняется не  <br/>более, чем на 3–5 градусов, то это нормально, и можно больше ничего не предпри-<br/>нимать. <br/> <br/>а б <br/>Рис. 4.11. Правильная (а) и неправильная (б) укладка излишка силового провода <br/> <br/>Поскольку через силовую батарею протекает суммарный ток от всех моторов, она <br/>тоже является проводником, порождающим магнитное поле вокруг себя. Иногда <br/>изменение расположения батареи относительно платы контроллера существенно <br/>снижает магнитные наводки. <br/> <br/> <br/> <br/><br/>  <br/> <br/> <br/>ГЛАВА 5 <br/> <br/> <br/> <br/>   <br/> <br/>Сборка и настройка квадрокоптера <br/> <br/>Изготовление рамы <br/>Прежде всего, вы должны определиться, имеет ли для вас смысл изготовление са-<br/>модельной рамы. Готовый набор, состоящий из центральной текстолитовой части, <br/>четырех моторам, металлических лучей и необходимого крепежа, можно заказать  <br/>в Китае по цене 18–20 долларов с бесплатной доставкой. Покупка материалов для <br/>самодельной рамы вряд ли обойдется дешевле. Плюс потраченное на работу время, <br/>пыль, шум и прочие бытовые неудобства. Но если вам работа с конструкторскими <br/>программами, станком ЧПУ и слесарными инструментами доставляет удовольст-<br/>вие — тогда запасайтесь материалами и приступайте к изготовлению. Пока по поч-<br/>те доставляют ранее выбранные вами моторы, регуляторы, полетный контроллер <br/>и прочие компоненты, работа над рамой будет завершена. <br/>При изготовлении первой рамы рекомендуем воздержаться от ненужного "изобре-<br/>тательства" и "рационализаторства", а также от излишней замысловатости техниче-<br/>ских решений. Поверьте, в конструкции начального уровня все уже придумано и <br/>испытано до вас. Все возможные ошибки уже совершены, обсуждены и учтены ты-<br/>сячами энтузиастов-любителей. Стандартная базовая конструкция такова, потому <br/>что она действительно оптимальная. Она недорогая, простая, как топор, прочная и <br/>ремонтопригодная. <br/>Пример популярной конструкции стандартной рамы схематически показан на <br/>рис. 5.1. Векторные чертежи, пригодные для масштабирования и резки на станке  <br/>с ЧПУ, можно скачать на сайте издательства. По этим чертежам можно заказать <br/>резку на станке, например в рекламной фирме, или изготовить детали вручную. <br/>Центральная часть и моторамы изготавливаются из радиотехнического стеклотек-<br/>столита толщиной 2–2,5 мм. Фольга стравливается с текстолита в растворе хлорно-<br/>го железа. Рекомендуется стравливать фольгу после изготовления деталей. Это  <br/>поможет сэкономить хлорное железо. Кроме того, по фольге легче кернить или <br/>расчерчивать стальной иглой разметку под вырезку и сверление. <br/>Центральная часть рамы состоит из двух пластин, верхней и нижней, между кото-<br/>рыми зажаты лучи из квадратного алюминиевого профиля с шириной стенки около  <br/> <br/><br/>Глава 5. Сборка и настройка квадрокоптера 127 <br/> <br/>Рис. 5.1. Пример конструкции стандартной рамы <br/>10–12 мм. Предусмотрены дуговые пазы под крепежные винты, благодаря чему <br/>раму можно складывать для транспортировки. Если складывание не планируется, <br/>дуговые пазы следует заменить обычными отверстиями. В исходном состоянии <br/>чертежи деталей рассчитаны на диагональ 550–600 мм и соответствующие двигате-<br/>ли, но могут быть легко смасштабированы в любой программе, работающей с век-<br/>торными рисунками. <br/>Мы сознательно не приводим здесь чертежи подвеса камеры, посадочных шасси  <br/>с повышенным просветом, батарейного отсека, поскольку эти части конструкции  <br/>в значительной мере зависят от навесного оборудования, которое будете использо-<br/>вать именно вы. Кроме того, множество различных чертежей защитных кожухов, <br/>кронштейнов и прочих частей конструкции можно без труда найти в свободном <br/>доступе в Интернете. Рассматривайте приведенную здесь конструкцию, как основу <br/>и не бойтесь самостоятельно добавлять нужные узлы в соответствии со своими по-<br/>требностями. <br/>ПРИМЕЧАНИЕ <br/>Стравливание фольги не дает ощутимой экономии веса, но заметно повышает эстети-<br/>ческую составляющую. Окисленная медная фольга имеет неприглядный вид, а краска <br/>на нее ложится очень плохо. Кроме того, при соприкосновении меди с алюминиевыми <br/>деталями образуются гальванические пары, которые со временем могут стать источ-<br/>ником электрических помех в полете. Такие помехи очень трудно распознать. <br/>Для переноса чертежа на листовую заготовку распечатайте его на обычной бумаге. <br/>Рекомендуется использовать струйный принтер, потому что тонер лазерного прин-<br/><br/>128 Часть II. Практика <br/>тера осыпается с бумаги при работе. Приклейте бумагу к заготовке при помощи <br/>канцелярского клея-карандаша. После окончания работы достаточно слегка смо-<br/>чить бумагу для удаления. Можно также распечатать чертеж на листе специальной <br/>самоклеящейся бумаги. Такая бумага очень прочно прилипает к заготовке, но для <br/>удаления придется отмачивать ее спиртом, растворителем 646 или специальным <br/>аэрозолем Label-Off для удаления этикеток. <br/>Внутренние контуры ("окна" в деталях) предварительно обсверливаются сверлом <br/>диаметром 2–2,5 мм. Перемычки между отверстиями перекусывают кусачками, за-<br/>тем обрабатывают кромки плоским и круглым напильниками или бормашиной. <br/>Можно выпилить окна при помощи лобзика, но потребуются качественные и проч-<br/>ные полотна, желательно с мелким зубом. <br/>ВНИМАНИЕ! <br/>При обработке текстолита и карбона бормашиной образуется облако чрезвычайно <br/>вредной для здоровья мелкой волокнистой пыли, обладающей выраженным раздра-<br/>жающим эффектом! Используйте при работе качественный респиратор и прилегаю-<br/>щие защитные очки или организуйте непрерывный отсос пыли. <br/>Лучи изготавливаются из квадратного тонкостенного алюминиевого профиля <br/>10×10 мм, который продается в магазинах строительных и хозяйственных товаров. <br/>Если не удалось найти такой профиль, то в магазине мебельной фурнитуры можно <br/>приобрести четыре мебельные ручки из аналогичного профиля. Для коптеров раз-<br/>мера 460 мм можно использовать профили 12×12 мм. <br/>Для облегчения лучей в них можно рассверлить или выфрезеровать отверстия. От-<br/>верстия на прилегающих сторонах должны быть взаимно смещены, как показано на <br/>рис. 5.2. <br/> <br/>Рис. 5.2. Расположение облегчающих отверстий луча <br/>Когда детали рамы готовы, покрасьте их нитрокраской в контрастные цвета, чтобы <br/>облегчить распознавание положения рамы в пространстве. Традиционно принято <br/>два передних луча красить в красный или оранжевый цвет, два задних в черный, а <br/>центр рамы делать черным или флуоресцентно-желтым. Впрочем, это вопрос лич-<br/>ного комфорта и вкуса. Цвет пропеллеров обычно выбирают соответствующим <br/>цвету лучей. Для окраски рамы можно приобрести в автомагазине так называемую <br/><br/>Глава 5. Сборка и настройка квадрокоптера 129 <br/>эмаль для колесных дисков или, что еще лучше, эмаль для тормозных суппортов. <br/>Такие эмали имеют едко-яркие красный и желто-оранжевый цвета, хорошо ложатся <br/>на металл с первого слоя, быстро сохнут и дают прочное глянцевое покрытие. Цена <br/>автомобильной тюнинговой эмали на 40–50% больше, чем у обычного баллончика <br/>из магазина хозтоваров, но результат того стоит. <br/>Для облегчения распознавания пространственного положения рамы ее можно осна-<br/>стить дополнительными визуальными маркерами: ярко-желтым пенопластовым <br/>или поролоновым "поплавком", смонтированным на карбоновом прутке между <br/>задними лучами, светодиодными лентами разного цвета или яркими шариками на <br/>посадочных стойках. <br/>После покраски собираем раму, используя металлические винты и самофиксирую-<br/>щиеся гайки с нейлоновой вставкой. Такие гайки следует приобрести с запасом, <br/>т. к. после двух-трех отвинчиваний они теряют свойство самофиксации. Крепеж-<br/>ные винты двигателей и пропсейверов зафиксируйте анаэробным фиксатором резь-<br/>бы синего или зеленого цвета. <br/>Балансировка воздушных винтов <br/>Даже самые качественные карбоновые воздушные винты требуют как минимум <br/>проверки балансировки, а обычные пластиковые винты следует балансировать обя-<br/>зательно. Также нужно проверить их геометрию. Винты могут быть деформирова-<br/>ны в процессе складирования и перевозки, а также из-за неравномерного высыха-<br/>ния пластика при хранении, особенно при воздействии высоких температур. Кста-<br/>ти, по этой причине винты следует хранить в темном прохладном месте. <br/>Для балансировки винтов вам понадобится балансир, баллончик бытового антиста-<br/>тика, скальпель или острый нож со скругленным лезвием и кусочек мелкой наж-<br/>дачной бумаги. <br/>Самое простое устройство для балансировки можно изготовить самостоятельно. <br/>Оно представляет собой гладкую стальную ось, например, направляющую от при-<br/>вода CD-ROM, которая помещается на самодельную подставку в виде переверну-<br/>той буквы П и свободно катается по рельсам, сделанным из половинок лезвия от <br/>канцелярского ножа или бритвенных лезвий (рис. 5.3). <br/>Более точным и надежным является магнитный балансир. В нем ось удерживается <br/>в воздухе за счет мощных магнитов и практически не испытывает трение о магниты <br/>(рис. 5.4). <br/>Прежде чем приступать к балансировке, следует проверить геометрию винта. По-<br/>ложите винт плашмя на плоскую ровную поверхность, плотно прижмите бобышку <br/>винта и тщательно измерьте расстояния от кончиков лопастей до поверхности. Эти <br/>расстояния должны совпадать как можно точнее. У некачественных или деформи-<br/>рованных винтов расхождение расстояний может достигать 2–3 мм. Такие винты <br/>лучше сразу отбраковать или использовать только в крайнем аварийном случае. <br/>Незначительно деформированный винт можно попробовать выпрямить, осторожно <br/>прогревая основание лопасти возле бобышки при помощи фена паяльной станции  <br/> <br/><br/>130 Часть II. Практика <br/> <br/>Рис. 5.3. Балансир  Рис. 5.4. Балансир с магнитным подвесом <br/>на самодельной опоре из лезвий <br/> <br/>при температуре 120–140 °C или струей кипящей воды и отклоняя лопасть в нуж-<br/>ную сторону. <br/>После проверки геометрии винтов следует, при необходимости, удалить заусенцы <br/>по краям лопастей и на бобышке, рассверлить отверстия до нужного диаметра <br/>и/или вставить переходные кольца по диаметру вала или втулки пропсейвера и <br/>только после этого начинать балансировку. <br/>Балансир, даже самодельный — это очень чувствительное устройство. Подвешен-<br/>ный на балансире винт будет реагировать на малейшее движение воздушных масс <br/>вокруг. Поэтому следует выбирать помещение с полным отсутствием сквозняков и <br/>не делать резких движений во время балансировки. По этой же причине надо на-<br/>нести тонкий слой антистатика на всю поверхность винта, а если столешница пла-<br/>стиковая или из лакированной древесины, то и на столешницу тоже. В противном <br/>случае пластиковые лопасти винта будут непредсказуемо притягиваться к рукам <br/>и столешнице. <br/>После высыхания антистатика подвесьте винт на балансире и засеките, какая ло-<br/>пасть тяжелее. Обратите внимание, с какой скоростью она опускается — при дос-<br/>тижении некоторого опыта это подскажет вам, сколько пластика нужно будет уда-<br/>лить с тяжелой лопасти. <br/>Затем лезвием скальпеля или остро заточенного ножа начинайте осторожно соскаб-<br/>ливать очень тонкий слой пластмассы со внутренней поверхности лопасти. Сни-<br/>майте слой равномерно со всей поверхности, начиная от бобышки и далее пример-<br/>но на 2/3 длины лопасти, или немного дальше. Ближе к законцовке лопасть и без <br/>того тонкая. Если дисбаланс небольшой, то, возможно, придется снять слой только <br/>с части лопасти. В процессе обработки периодически помещайте винт на балансир <br/>для проверки. Помните, что можно очень легко перестараться и тогда придется  <br/>облегчать другую лопасть. <br/><br/>Глава 5. Сборка и настройка квадрокоптера 131 <br/>Соскабливание надо завершить в тот момент, когда обрабатываемая лопасть будет <br/>чуть-чуть тяжелее, чем нужно. После этого осторожно заполируйте поверхность <br/>лопасти мелкой наждачной бумагой, также периодически контролируя баланс. Да-<br/>же полировочной шкуркой можно снять лишний слой. <br/>Описание процесса балансировки кажется долгим, но на самом деле опыт приходит <br/>уже после второго винта, и дальше процесс балансировки занимает не более 5–<br/>6 минут даже в сложных случаях. Важно не спешить и делать все аккуратно. <br/>Почему мы рекомендуем соскабливать тяжелую лопасть, а не наклеивать полоски <br/>скотча на легкую, как это любят делать начинающие моделисты? Во-первых, сле-<br/>дует знать, что существует статический и динамический баланс. Уравновешивая <br/>лопасти в неподвижном состоянии при помощи локально расположенного грузика, <br/>мы добиваемся статического баланса. Но в динамике, когда разные участки лопасти <br/>движутся с разной линейной скоростью, очень важно, где именно расположен гру-<br/>зик, потому что от этого зависит порождаемое им центробежное ускорение. Поэто-<br/>му при балансировке грузиком даже идеальный статический баланс не означает <br/>отсутствие дисбаланса при вращении. Ведь избыточный вес тяжелой лопасти <br/>обычно распределен более-менее равномерно по ее объему, поэтому и удалять его <br/>следует так же равномерно, чтобы при достижении баланса статического достигать <br/>так же и баланса динамического. Во-вторых, балансировка соскабливанием более <br/>точна, тогда как кусочек скотча обычно оказывается слегка тяжелее или легче, чем <br/>нужно. В-третьих, кусочки скотча неэстетичны и склонны постепенно отклеи- <br/>ваться. <br/>Все вышесказанное относится к пластиковым лопастям. Карбоновые лопасти ба-<br/>лансировать соскабливанием нельзя, но и существенным дисбалансом они обычно <br/>не обладают. В случае необходимости их балансируют все же при помощи скотча, <br/>либо осторожно подпиливая надфилем заднюю кромку лопасти по всей длине. <br/>Балансировка моторов <br/>Балансировка моторов обычно выполняется на заводе. Моторы от именитых произ-<br/>водителей редко нуждаются в дополнительной балансировке. Что касается недоро-<br/>гих китайских моторов, то их балансировку необходимо обязательно проверять. <br/>Иногда попадаются совершенно неотбалансированные моторы, а также экземпляры <br/>с люфтом подшипников и даже с кривой посадкой ротора на вал. Такие моторы <br/>лучше сразу отбраковать или отремонтировать, иначе они станут постоянным ис-<br/>точником проблем, связанных с неравномерной тягой и вибрацией. <br/>В заводских условиях моторы балансируют, нанося на внутреннюю сторону ротора <br/>капельки быстросохнущего эпоксидного компаунда и подтачивая их бормашиной, <br/>либо аккуратно засверливая металл у основания ротора. Аналогичные способы <br/>иногда применяют и в домашних условиях, особенно для точной доводки качест-<br/>венных моторов. Для балансировки двигатель необходимо разобрать, оставив вал  <br/>в роторе. Затем положить вал с ротором на рельсы из лезвий и определить сторону <br/>перевеса. На противоположную сторону осторожно наносят густой эпоксидный <br/><br/>132 Часть II. Практика <br/>компаунд (смесь эпоксидной смолы с инертным порошковым наполнителем) и по-<br/>степенно добиваются равновесия, затем дожидаются отвердевания компаунда. При <br/>большом дисбалансе имеет смысл удалять металл ротора дрелью или бормашиной <br/>с более тяжелой стороны. Разумеется, ни в коем случае нельзя пытаться подтачи-<br/>вать магниты. <br/>Но разборка двигателя — это трудоемкий процесс, сопряженный с возможностью <br/>повредить двигатель или потерять мелкие стопорные и упорные шайбы. Поэтому <br/>двигатель лучше разбирать только для ремонта. <br/>Для балансировки двигателей коптера нам понадобится включать их поочередно  <br/>в рабочем режиме. Если электроника коптера еще не полностью готова, то можно <br/>воспользоваться одиночным регулятором оборотов, поочередно подключая его  <br/>к моторам. Управляющий сигнал на вход регулятора можно подавать как напрямую <br/>с канала газа (throttle) приемника, так и с выхода сервотестера. Главное — обеспе-<br/>чить вращение двигателя во всем рабочем диапазоне оборотов, чтобы выявить не <br/>только вибрацию, но и возможные резонансы на определенных оборотах. При ис-<br/>пользовании штатной электроники коптера моторы следует подключать по одному, <br/>чтобы другие моторы не мешали балансировке. <br/>Для балансировки моторов можно сделать простейшее приспособление из кусочка <br/>зеркала и лазерной указки (рис. 5.5). Указка закрепляется на штативе, а зеркальце <br/>жестко крепится на луче коптера рядом с мотором. Нельзя приклеивать зеркальце <br/>на двусторонний пенистый скотч, он будет гасить вибрацию. Луч указки отражает-<br/>ся от зеркальца и падает на белый экран, расположенный на расстоянии около 3 м. <br/>Малейшая вибрация зеркальца будет приводить к размыванию световой точки от-<br/>раженного лазерного луча. <br/> <br/>Рис. 5.5. Схема балансировки мотора при помощи лазерной указки <br/>Балансировку двигателя мы будем производить при помощи скотча повышенной <br/>клейкости. Двигатель при работе нагревается, и некачественный скотч может  <br/>отклеиться. Хорошо подходит армированный скотч серого цвета для ремонтных <br/>работ, именуемый в магазинах хозтоваров "сантехническим", а также клейкая алю-<br/>миниевая лента, применяемая при монтаже систем вентиляции. <br/><br/>Глава 5. Сборка и настройка квадрокоптера 133 <br/>ВНИМАНИЕ! <br/>Все работы по начальной балансировке моторов выполняются без пропеллеров. <br/>Так же как и при балансировке пропеллеров, процесс по описанию может показать-<br/>ся долгим, но при достижении небольшого навыка занимает не более пяти минут на <br/>мотор. Приготовьте грузик из скотча размерами около 1×2 см. Включите мотор, <br/>прогоните его по всему диапазону оборотов, запомните величину размытия отра-<br/>женного луча указки. Наклейте грузик на внешнюю сторону ротора в произвольном <br/>месте, но не слишком прочно. Включите мотор и проверьте результат. Если вибра-<br/>ция усилилась, переклейте грузик на противоположную сторону. Когда заметите <br/>уменьшение вибрации, начинайте постепенно смещать грузик в одну и другую сто-<br/>рону в поисках наименьшей вибрации. Когда это положение найдено, отметьте его <br/>маркером и попробуйте варьировать размеры грузика в меньшую и большую сто-<br/>рону. Возможно, при этом понадобится подкорректировать положение грузика.  <br/>Когда оптимальный грузик подобран, замените его постоянным такого же размера <br/>и приклейте прочно. <br/>При наличии некоторого опыта и усердия можно вполне обходиться без лазерного <br/>приспособления, а уровень вибрации оценивать, держась подушечками пальцев за <br/>луч рамы возле мотора. Если применяются качественные винты и моторы с зажим-<br/>ной гайкой, то проведя предварительную раздельную балансировку моторов и вин-<br/>тов, можно попробовать добиться оптимальной балансировки винтомоторной пары <br/>в сборе. Но при этом следует соблюдать осторожность, чтобы не получить травму <br/>от вращающегося винта. Фиксируя винт на валу в разных положениях, можно най-<br/>ти такое, при котором общая вибрация винтомоторной пары будет минимальной. <br/>Сборка квадрокоптера <br/>Последовательность сборки рамы зависит от конструкции и обычно не несет в себе <br/>скрытых сложностей. Важно лишь соблюдать правильную последовательность <br/>монтажа электронных и силовых компонентов. <br/>Обычно в первую очередь монтируются моторы и регуляторы. Мотор соединяется <br/>с регулятором тремя проводами и достоверно угадать правильную полярность не-<br/>возможно. Даже если провода на выходе регулятора разноцветные, цвет ничего не <br/>означает. Поэтому сначала выполняется пробное подключение и проверяется на-<br/>правление вращения моторов. Разумеется, нужно делать это без пропеллеров! Вра-<br/>щение должно соответствовать указанному на схеме рис. 2.1. Если мотор вращается <br/>в противоположную сторону, достаточно поменять местами подключение любых <br/>двух выводов. После этого соединения нужно тщательно пропаять, изолировать <br/>термоусадочной трубкой и аккуратно уложить провода вдоль луча. Настоятельно <br/>рекомендуем именно пропаивать все силовые соединения и не использовать разъ-<br/>емы. <br/>Для проверки вращения мотора можно поочередно подключать регуляторы к выхо-<br/>ду сервотестера или канала газа приемника и питать их от силовой батареи. Если <br/>регуляторы не стартуют от сигнала приемника или сервотестера без предваритель-<br/><br/>134 Часть II. Практика <br/>ной калибровки, то временно отложите окончательное подключение моторов. По-<br/>сле того как мы откалибруем регуляторы с помощью специального режима кон-<br/>троллера, можно будет проверить правильность соединения и окончательно припа-<br/>ять выводы моторов. <br/>Далее на раму монтируется распределитель питания, к нему подключаются провода <br/>питания регуляторов и разъем для подключения силовой батареи. Не забудьте сра-<br/>зу подключить к распределителю питания гибкий двужильный провод — отвод пи-<br/>тающего напряжения, которое будете использовать для питания бортового обору-<br/>дования через преобразователь 12V → 5V. Напомним, что использовать для пита-<br/>ния контроллера источники +5V, встроенные в регуляторы, нежелательно, т. к. <br/>контроллер следует питать слегка завышенным напряжением 5,2–5,6 В. Кроме то-<br/>го, с регуляторов, работающих в квадрокоптере на больших токах, поступает на-<br/>пряжение, загрязненное помехами и пригодное разве что для питания сервомаши-<br/>нок. Заранее продумайте, в каком месте будет смонтирована плата источника +5V, <br/>и выведите провод от распределителя в это место. <br/>Когда рама собрана, регуляторы и моторы установлены и подключены, установите <br/>на свое место контроллер и приемник. Воздержитесь от соблазна сразу смонтиро-<br/>вать приемник GPS, модуль Bluetooth и прочее дополнительное оборудование. <br/>Сначала убедитесь в правильном соединении приемника и контроллера, откалиб-<br/>руйте регуляторы, проверьте направление вращения моторов и настройте парамет-<br/>ры радиоканала. <br/>Пробное подключение и настройку базового комплекта, состоящего из источника <br/>питания, приемника, контроллера, регуляторов и моторов, можно выполнить на <br/>столе. В этом случае сразу наклейте бирочки из скотча или самоклеящейся бумаги <br/>на все провода и разъемы, чтобы в дальнейшем при монтаже или ремонте не терять <br/>время и не допустить ошибки. <br/>Примите за правило подключать дополнительное оборудование пошагово. На каж-<br/>дом этапе полностью завершайте все необходимые настройки и проверяйте работу <br/>устройства в полете. Только после этого приступайте к подключению следующего <br/>модуля. Помните, что при неудачном сочетании взаимного расположения или не-<br/>правильной разводке питания некоторые модули могут мешать друг другу. Напри-<br/>мер, следует максимально разносить в пространстве антенны передатчиков теле-<br/>метрии и видеоканала и антенну приемника радиоуправления. <br/>Настройка опций и параметров прошивки <br/>Если вы изготавливаете квадрокоптер самостоятельно, а не запускаете покупной <br/>"из коробки", то вам придется настроить прошивку полетного контроллера под <br/>свои потребности. Настройка состоит из двух этапов: конфигурирование опций <br/>программного кода и настройка параметров прошитого контроллера. <br/>Параметры прошивки делятся на две категории: постоянные и переменные. Посто-<br/>янные параметры настраиваются один раз в самом начале. К таким параметрам от-<br/>носятся тип рамы, тип полетного контроллера и прочие, не требующие изменения  <br/><br/>Глава 5. Сборка и настройка квадрокоптера 135 <br/>в процессе эксплуатации. Переменные параметры требуют уточнения и подстройки <br/>в процессе испытаний и отладки. Это настройки программного фильтра вибрации, <br/>параметры обратной связи PID и некоторые другие. <br/>ПРИМЕЧАНИЕ <br/>Не пытайтесь раз и навсегда настроить все параметры прошивки. Это невозможно, <br/>т. к. в процессе эксплуатации и развития конструкции все равно придется вносить кор-<br/>рективы. Если же в процессе настройки вы допустите несколько ошибок одновремен-<br/>но, то выявить их может быть трудно. Лучше начать с настройки базовых параметров <br/>и убедиться в надлежащей работе контроллера, после чего поэтапно настраивать <br/>прошивку под свои периферийные модули. <br/>Исторически так сложилось, что в популярных прошивках используется Arduino-<br/>совместимый программный код. Напомним, что мы будем использовать полетный <br/>контроллер Crius All-In-One (AIO) и прошивку MultiWii v.2.30, которая достаточно <br/>стабильна и проверена на момент написания книги. Архив с прошивкой и утилитой <br/>конфигурирования доступен для скачивания по адресу https://code.google.com/p/ <br/>multiwii/. В качестве настольного компьютера использовался компьютер с опера-<br/>ционной системой Windows 7. <br/>Подключение платы контроллера к компьютеру <br/>Плата полетного контроллера подключается к порту USB компьютера через разъем <br/>mini-USB. Обратите внимание, что в этом случае плата питается от порта USB ком-<br/>пьютера. Это налагает ряд ограничений. <br/>� Используйте только качественный кабель, в противном случае плата будет рабо-<br/>тать со сбоями, либо соединение вообще не установится. <br/>� Проверьте напряжение питания, поступающее с компьютера. Зачастую оно бы-<br/>вает занижено до 4,5–4,6 В. Контроллер не будет стабильно работать при таком <br/>напряжении питания. При необходимости приобретите либо дополнительный <br/>разветвитель USB с внешним источником питания, либо картридер формата <br/>5,25″ с разъемами USB и питанием напрямую от блока питания компьютера. <br/>� Настоятельно не рекомендуется подключать иные источники питания к плате <br/>при подключении ее к разъему USB. <br/>Соединение с компьютером происходит через встроенный на плату конвертер USB-<br/>COM на популярной микросхеме FTDI FT232. Если вы впервые подключаете уст-<br/>ройство на основе этой микросхемы, то потребуется установка драйвера. Вы мо- <br/>жете либо положиться на автоматическую установку драйвера средствами <br/>Windows, либо скачать установочный файл драйвера на сайте производителя <br/>http://www.ftdichip.com/Drivers/VCP.htm. <br/>Когда драйвер установлен, при подключении контроллера в системе появляется <br/>виртуальный COM-порт. Откройте диспетчер устройств компьютера (рис. 5.6):  <br/>Панель управления | Диспетчер устройств | Порты (COM и LPT). <br/>Запомните номер порта, который появляется при подключении контроллера. В ва-<br/>шей системе он может отличаться от номера на иллюстрации. Номер также может <br/><br/>136 Часть II. Практика <br/>измениться при включении в другое гнездо USB. Больше никакие действия по на-<br/>стройке подключения не требуются. Если драйвер установлен правильно, вы  <br/>не должны вообще обращаться к настройкам порта, Windows все сделает автомати-<br/>чески. <br/>Рис. 5.6. Виртуальный  <br/>COM-порт полетного <br/>контроллера <br/> <br/> <br/>Среда разработки Arduino IDE <br/>Прошивка распространяется в виде набора файлов исходных кодов, включая спе-<br/>циальный файл конфигурации. В общем случае, в файл конфигурации необходимо <br/>внести поправки в соответствии со своими нуждами, а затем скомпилировать про-<br/>шивку и записать ее в полетный контроллер. Это несложно, даже если раньше вы <br/>никогда не сталкивались с программированием микроконтроллеров. <br/>Прежде всего, скачайте с сайта www.arduino.cc самую свежую версию среды раз-<br/>работки Arduino IDE. На момент написания книги это была версия 1.6.1. Если вы <br/>захотите использовать старую версию прошивки MultiWii v2.20, то для компиляции <br/>придется использовать архивную версию Arduino IDE 1.0.5, иначе при компиляции <br/>будут возникать ошибки. Для установки достаточно запустить инсталлятор и под-<br/>твердить запросы на установку по умолчанию. Обе версии Arduino IDE могут быть <br/>установлены на компьютер одновременно, но в разные папки. <br/><br/>Глава 5. Сборка и настройка квадрокоптера 137 <br/>После окончания установки подключите контроллер к компьютеру и запустите <br/>Arduino IDE. Откроется стартовое окно с пустым проектом. В терминах Arduino <br/>программа для микроконтроллера называется скетч. Теперь нужно настроить ком-<br/>пилятор под нужный микроконтроллер и указать номер порта для связи. Выберите <br/>меню Инструменты | Плата | Arduino Mega 2560. <br/>Затем выберите порт: Инструменты | Порт и задайте номер порта COM, который <br/>соответствует вашей плате. Если плата не подключена, то нужный порт в списке не <br/>появится. <br/>ПРИМЕЧАНИЕ <br/>Микроконтроллер ATMega2560 оснащен энергонезависимой памятью (EEPROM) ем-<br/>костью 4096 байт. В этой памяти хранятся настроечные константы прошивки MultiWii. <br/>Перед загрузкой новой прошивки EEPROM необходимо очистить. В противном случае <br/>прошивка может работать неправильно, либо не заработает вообще. <br/>Для очистки EEPROM загрузите специальный короткий скетч из папки готовых <br/>примеров Arduino: Файл | Образцы | EEPROM | eeprom_clear. Скетч откроется <br/>в новом окне, но настройки платы и порта останутся прежними. <br/>ПРИМЕЧАНИЕ <br/>Имейте в виду, что загрузка любой новой программы в память контроллера стирает <br/>записанную ранее. Если вы взяли чужой контроллер на время или не уверены, что хо-<br/>тите уничтожить имеющуюся прошивку, то не загружайте в память контроллера новые <br/>программы! <br/>В строке <br/>for (int i = 0; i < 512; i++) <br/>исправьте значение 512 на 4096, чтобы очистить EEPROM полностью: <br/>for (int i = 0; i < 4096; i++) <br/>Теперь нажмите кнопку со стрелкой для загрузки программы в микроконтроллер.  <br/>В течение нескольких секунд произойдет компиляция исходного текста программы <br/>в машинные коды, затем плата весело замигает светодиодами во время загрузки <br/>прошивки. Примерно через три секунды после загрузки светодиод A на плате нач-<br/>нет светиться постоянно. Это означает, что процесс очистки EEPROM завершен и <br/>контроллер готов к записи и настройке новой прошивки. Файлы примеров Arduino <br/>IDE защищены от записи, поэтому сохраните исправленный скетч очистки <br/>EEPROM в другое удобное место. <br/>Память EEPROM нужно чистить, если: <br/>� это первая загрузка прошивки в память контроллера, или предыдущая версия <br/>неизвестна; <br/>� меняется версия прошивки; <br/>� меняется тип коптера; <br/>� меняется состав датчиков платы или их тип; <br/>� после записи новой прошивки коптер стал вести себя неадекватно. <br/><br/>138 Часть II. Практика <br/>В остальных случаях, когда вы ограничиваетесь правкой настроечных параметров, <br/>стирать EEPROM перед повторной записью прошивки не надо. <br/>Настройка базовых опций кода прошивки <br/>Ранее вы скачали и разархивировали проект прошивки MultiWii. Проект состоит из <br/>нескольких файлов. Файлы скетчей имеют расширения ino или cpp; файлы так на-<br/>зываемых заголовков имеют расширения h. В среде Arduino имя папки проекта <br/>обязательно совпадает с именем главного файла проекта. Например, если папка  <br/>носит имя MultiWii_AIOP, то главный файл в этой папке называется MultiWii_ <br/>AIOP.ino. <br/>Откройте главный файл двойным щелчком или через меню Файл | Открыть. При <br/>этом в среде Arduino IDE откроются все файлы проекта. Сейчас нас интересует <br/>только файл config.h. В нем подробно расписана конфигурация прошивки. Осталь-<br/>ные файлы, если вы не имеете четкого понимания своих действий, лучше не тро-<br/>гать. <br/>Механизм конфигурирования прошивки MultiWii, как, впрочем, и многих других <br/>программ для микроконтроллеров, основан на так называемых "дефайнах" — слу-<br/>жебных директивах компилятора #define (определить). После этой директивы че-<br/>рез пробел следуют имя параметра и его значение. В коде программы вместо кон-<br/>кретного значения указывают имя параметра. Во время обработки программного <br/>кода компилятор отыскивает имя параметра и автоматически подставляет вместо <br/>него соответствующее значение. <br/>Например, если определен некий параметр <br/>#define    MY_PARAMETER    10 <br/>и он несколько раз используется в разных местах очень длинной программы, то <br/>впоследствии нам достаточно лишь один раз заменить его значение в определении, <br/>а остальные замены сделает компилятор. Для удобства настройки все необходимые <br/>определения вынесены в отдельный файл проекта и снабжены комментариями. <br/>Наличие или отсутствие определений, указанных без значения, используется для <br/>того, чтобы иметь возможность скомпилировать разные варианты программы. <br/>Например, имеются два определения <br/>#define    HELICOPTER <br/>//#define  AIRPLANE <br/>при этом второе определение закрыто символом комментария // и невидимо для <br/>компилятора. Теперь, если в программе встретятся такие два фрагмента: <br/>#ifdef    HELICOPTER <br/>    Фрагмент программы 1; <br/>#endif <br/>#ifdef AIRPLANE <br/>    Фрагмент программы 2; <br/>#endif <br/><br/>Глава 5. Сборка и настройка квадрокоптера 139 <br/>то компилятор обработает первый фрагмент кода и проигнорирует второй, потому <br/>что определение AIRPLANE закомментировано и не существует. И наоборот, если мы <br/>закомментируем определение HELICOPTER и раскомментируем AIRPLANE, то будет <br/>скомпилирован второй фрагмент кода. <br/>Существуют и более сложные условные конструкции директив компилятора, но <br/>нам сейчас достаточно знать два метода, применяемые при пользовательском кон-<br/>фигурировании прошивки: задание численных значений и комментирование/рас-<br/>комментирование имен параметров. <br/>В группе однотипных параметров должна быть раскомментирована только одна <br/>строка. Если вы раскомментировали новую строку, не забудьте закрыть коммента-<br/>рием предыдущую. В противном случае возникнет неоднозначность, которая при-<br/>ведет к ошибке компиляции, либо неправильной работе прошивки. <br/>Итак, щелчком на закладке в окне IDE откройте файл config.h. Сейчас мы сконфи-<br/>гурируем по порядку самые необходимые параметры. После этого нужно загрузить <br/>прошивку в контроллер и проверить, как он работает. По мере подключения внеш-<br/>них модулей (GPS, дисплей и т. д.) мы будем вновь обращаться к настройке про-<br/>шивки. <br/>Тип рамы <br/>В секции 1 — BASIC SETUP найдите и раскомментируйте строку, которая обозначает <br/>X-образную раму: <br/>#define QUADX <br/>Минимальный рабочий газ <br/>ВНИМАНИЕ! <br/>Помните, что параметры сигналов, поступающих с приемника на контроллер, и сигна-<br/>лов, поступающих с выходов контроллера на моторы или сервомашинки, — это со-<br/>вершенно разные значения. Контроллер перерабатывает входные сигналы согласно <br/>своим алгоритмам. При настройке прошивки используются длительности как входных, <br/>так и выходных сигналов. <br/>Минимальный рабочий газ означает длительность выходных импульсов, посту-<br/>пающих с контроллера на регуляторы в режиме ожидания, при минимальном  <br/>положении рукоятки газа на пульте. Из соображений безопасности настоятельно <br/>рекомендуется задавать это значение таким, чтобы при активированных моторах <br/>(режим ARMED) пропеллеры вращались с минимальной скоростью, предупреждая об <br/>опасности. <br/>//#define MINTHROTTLE 1300  // for Turnigy Plush ESCs 10A <br/>//#define MINTHROTTLE 1120  // for Super Simple ESCs 10A <br/>//#define MINTHROTTLE 1064  // special ESC (simonk) <br/>//#define MINTHROTTLE 1050  // for brushed ESCs like ladybird <br/>#define MINTHROTTLE 1150    // (*) <br/><br/>140 Часть II. Практика <br/>Вы можете либо выбрать один из готовых параметров, либо опытным путем подоб-<br/>рать под свои регуляторы такое минимальное значение, при котором моторы начи-<br/>нают вращаться на холостом ходу после активации. Если ваших регуляторов нет в <br/>списке значений, оставьте раскомментированной строку по умолчанию. Но при <br/>указанном значении 1150 моторы могут вращаться слишком быстро, исправьте на <br/>1090. Впоследствии вы сможете скорректировать его, проверяя собранный коптер. <br/>Если же вы решили пренебречь требованиями безопасности, задайте такое значе-<br/>ние, при котором моторы не вращаются при активации (режим ARMED). Обычно это <br/>значение немного больше 1000. <br/>Максимальный рабочий газ <br/>Это длительность выходного сигнала контроллера, при котором регулятор развива-<br/>ет максимальные обороты мотора. Параметр одинаковый для всех каналов. Также <br/>может потребовать подстройки опытным путем. <br/>#define MAXTHROTTLE 1850 <br/>Если вы не знаете значение для своего регулятора, можете оставить значение по <br/>умолчанию. Не следует задавать значение большее, чем способны принять ваши <br/>регуляторы. Это чревато некорректным масштабированием управляющих сигналов <br/>контроллера, что приведет к не совсем адекватной реакции на резкие внешние воз-<br/>действия. С другой стороны, слишком низкое значение сужает динамический диа-<br/>пазон оборотов для акробатического пилотирования. Впоследствии, развив свои <br/>навыки пилотирования до акробатики, вы сможете проверить правильность на-<br/>стройки этого параметра при помощи тахометра. В графике оборотов мотора не <br/>должно быть горизонтальной площадки, когда вы увеличиваете газ на пульте, а <br/>фактические обороты мотора больше не растут. <br/>Минимальный газ при включении <br/>#define MINCOMMAND  1000 <br/>Это минимальное значение импульсов газа, которое подается на регуляторы, когда <br/>моторы не активированы. В регуляторы встраивается защита от включения, если <br/>газ при подаче питания не на "нуле", чтобы не нанести ущерб внезапным запуском <br/>пропеллера при подаче питания. Но у некоторых регуляторов защитный порог <br/>меньше 1000, поэтому может понадобиться уменьшить значение MINCOMMAND при-<br/>мерно до 900. <br/>2<br/>Скорость шины I C <br/>#define I2C_SPEED 100000L <br/>//#define I2C_SPEED 400000L <br/>Это скорость обмена данными между процессором и встроенными и/или внешними <br/>сенсорами и модулями. Начальную настройку и проверку работы платы желатель-<br/>но проводить на низкой скорости, стандартной для большинства плат контролле-<br/><br/>Глава 5. Сборка и настройка квадрокоптера 141 <br/>ров. Впоследствии можно проверить способность платы работать на высокой ско-<br/>рости, контролируя наличие ошибок шины через конфигуратор или на подключае-<br/>мом дисплее. <br/>Тип стандартной платы <br/>Разработчики прошивки подготовили набор готовых конфигураций для множества <br/>популярных полетных контроллеров. В конфигурации описываются применяемые <br/>датчики и подпрограммы для работы с ними. Найдите и раскомментируйте нашу <br/>плату: <br/>#define CRIUS_AIO_PRO_V1 <br/>Не обращайте внимание на версию платы. Прошивка подойдет и для второй вер-<br/>сии. <br/>Независимые сенсоры <br/>Данная секция предназначена для опытных пользователей. Ничего не меняйте  <br/>в этой секции без необходимости. Если вы используете самодельную или нестан-<br/>дартную плату, то можете закомментировать все наименования плат в предыдущей <br/>секции, а затем раскомментировать нужные датчики по отдельности в соответствии <br/>с компонентами своего полетного контроллера. В этой же секции можно указать <br/>положение микросхем акселерометра, гироскопа и компаса относительно положе-<br/>ния рамы. <br/>Активация моторов (арминг) <br/>В секции 2, озаглавленной COPTER TYPE SPECIFIC OPTIONS, сейчас нам может пона-<br/>добиться только параметр <br/>#define ALLOW_ARM_DISARM_VIA_TX_YAW <br/>//#define ALLOW_ARM_DISARM_VIA_TX_ROLL <br/>Первая строка обозначает активацию моторов перемещением рукоятки газа вниз <br/>вправо до упора (ARM) и деактивацию в позиции вниз влево (DISARM). Это стандарт-<br/>ный способ активации. Если закрыть первую строку и раскрыть вторую, то будет <br/>работать активация двумя рукоятками. <br/>Позже в этой же секции мы будем настраивать управление стабилизированным <br/>подвесом камеры. <br/>Модификации радиоприемника <br/>Если вы используете стандартное подключение раздельных каналов приемника, <br/>когда каждый выход приемника подключается к соответствующему входу кон-<br/>троллера, то эту секцию можно пропустить. По умолчанию в ней закрыты все  <br/>параметры. <br/><br/>142 Часть II. Практика <br/>Если используется приемник, оснащенный только выходом PPM-SUM, раскоммен-<br/>тируйте под него одну из строк <br/>//#define SERIAL_SUM_PPM ... <br/>соответствующую информации в тексте комментария, и подайте сигнал на вход <br/>PPM платы контроллера. Если раскомментировать строку <br/>//#define PPM_ON_THROTTLE <br/>то сигнал PPM-SUM подается на вход канала газа контроллера Crius AIOP. <br/>При подключении приемника-сателлита Spektrum раскомментируйте строку <br/>//#define SPEKTRUM 1024 <br/>если используется приемник DSM2, и строку <br/>//#define SPEKTRUM 2048 <br/>если используется приемник DSMX. Физически приемник подключается ко входу <br/>Rx одного из последовательных портов. По умолчанию это SERIAL1, но вы можете <br/>раскомментировать расположенную ниже строку <br/>//#define SPEK_SERIAL_PORT 1 <br/>и указать нужный порт 0, 1 или 2. Убедитесь, что этот порт не будет занят другим <br/>устройством. <br/>Для подключения Futaba S-BUS сигнал необходимо инвертировать при помощи <br/>простейшего самодельного инвертора. Мы рассмотрим этот вопрос в разд. "Под-<br/>ключение приемника по шине S-BUS" главы 6. <br/>Есть ряд проблем с подключением приемников по шине S-BUS. Недорогие и попу-<br/>лярные приемники Orange RX9 имеют выход S-BUS, якобы совместимый с ориги-<br/>нальным протоколом Futaba, но поддержка этой опции реализована в приемнике <br/>некорректно. Насколько известно автору, пока никому не удалось использовать <br/>этот выход приемников Orange для подключения к полетному контроллеру одним <br/>сигнальным проводом. В коде прошивки MultiWii v2.20 также некорректно работа-<br/>ла часть кода, отвечающего за прием и декодирование сигнала S-BUS, но впослед-<br/>ствии в код были внесены поправки. <br/>Скорость портов <br/>Для связи с большинством внешних модулей, а также для подключения к компью-<br/>теру используются встроенные последовательные порты SERIAL0–SERIAL3. Мак-<br/>симальная допустимая скорость любого из портов 115 200 бит/с. <br/>#define SERIAL0_COM_SPEED 115200 <br/>#define SERIAL1_COM_SPEED 115200 <br/>#define SERIAL2_COM_SPEED 115200 <br/>#define SERIAL3_COM_SPEED 115200 <br/>Порт SERIAL0 используется для подключения к компьютеру. Через этот порт про-<br/>исходит обмен информацией с программами настройки и управления. Также к это-<br/><br/>Глава 5. Сборка и настройка квадрокоптера 143 <br/>му порту подключается адаптер Bluetooth или радиомодем для беспроводного со-<br/>единения с компьютером или смартфоном. К порту SERIAL1 подключают выход <br/>приемника S-BUS. Порт SERIAL2 используется для подключения приемника GPS. <br/>К порту SERIAL3 подключается модуль OSD и/или телеметрии. <br/>При начальной настройке нет необходимости менять параметры по умолчанию.  <br/>В дальнейшем скорость может быть установлена в соответствии с параметрами <br/>применяемого внешнего модуля. Если вы изменили скорость порта SERIAL0, то не <br/>забудьте указать новую скорость в настройках интерфейсной программы WinGUI <br/>на компьютере. <br/>Фильтр гироскопа <br/>Как мы уже говорили ранее, гироскопы и акселерометры очень болезненно реаги-<br/>руют на вибрацию, поэтому приходится применять программную фильтрацию по-<br/>тока данных с датчиков. По умолчанию программный фильтр для гироскопов имеет <br/>максимальную полосу пропускания. Предполагается, что вы достаточно хорошо <br/>отбалансировали винтомоторные пары. Если же балансировка не позволяет устра-<br/>нить негативное влияние вибрации на гироскопы, которое проявляется в хаотичном <br/>и внезапном подергивании коптера по крену и курсу, придется опытным путем  <br/>подобрать нужный фильтр. Сначала определите, какой интегральный гироскоп ис-<br/>пользуется, ITG3200/ITG3205 или MPU6050. На платах Crius AIOP используется <br/>микросхема MPU6050. Далее выберите один из вариантов частоты среза фильтра: <br/>//#define MPU6050_LPF_256HZ <br/>//#define MPU6050_LPF_188HZ <br/>//#define MPU6050_LPF_98HZ <br/>//#define MPU6050_LPF_42HZ <br/>//#define MPU6050_LPF_20HZ <br/>//#define MPU6050_LPF_10HZ <br/>//#define MPU6050_LPF_5HZ <br/>Числовой параметр означает, что все колебания с частотой выше указанной будут <br/>подавлены цифровым фильтром прошивки. Первая строка используется по умолча-<br/>нию и подходит только для микрокоптеров. Для коптера с диагональю около <br/>450 мм и пропеллерами 10–11 дюймов следует начинать настройку с частоты 98 Гц. <br/>Большинство средних коптеров хорошо летают с фильтром на частоту среза 42 Гц. <br/>К сожалению, не существует алгоритма быстрой настройки гироскопа. Это долгая <br/>и достаточно хлопотная процедура. Раскомментировав одну из строк, нужно по-<br/>пробовать полетать минут 10, внимательно следя за поведением коптера в разных <br/>режимах. Затем раскомментировать другую строку, закрыв предыдущую, и срав-<br/>нить поведение коптера в воздухе. Для этого придется брать с собой в поле ноутбук <br/>и USB-провод, чтобы не возвращаться домой для перепрошивки. После того как вы <br/>окончательно остановились на одном из фильтров, понадобится заново настроить <br/>параметры PID через конфигуратор. <br/><br/>144 Часть II. Практика <br/>Функция Failsafe <br/>Эта функция по умолчанию отключена в стандартной прошивке строкой <br/>//#define FAILSAFE <br/>но ее лучше включить, даже если ваш приемник оснащен неотключаемой функцией <br/>Failsafe. Абсолютная надежность работы приемника, особенно в непроверенной <br/>конструкции, не гарантирована. Например, питание приемника может внезапно <br/>пропасть из-за плохого контакта. Функция Failsafe контроллера активируется, если <br/>импульсы на одном из выходов приемника CH1–CH4 пропадают или делаются  <br/>короче 985 мкс. Параметр в строке <br/>#define FAILSAFE_DELAY     10 <br/>задает интервал времени с шагом 0,1 с, по истечении которого включается Failsafe <br/>после пропадания сигнала. При этом включается режим стабилизации горизонта, <br/>сигналы YAW, PITCH, ROLL выставляются в среднее положение и коптер начина-<br/>ет снижаться. Скорость снижения задается в строке <br/>#define FAILSAFE_THROTTLE  (MINTHROTTLE + 200) <br/>Числовой параметр этой строки надо выбрать такой, чтобы скорость снижения со-<br/>ставляла около 1 м/с. После настройки потребуется экспериментальная проверка. <br/>Если коптер снижается слишком быстро, увеличиваем значение. <br/>По истечении интервала с шагом 0,1 с, указанного в строке <br/>#define FAILSAFE_OFF_DELAY 200 <br/>моторы коптера отключатся. <br/>Минимальная длительность импульсов для срабатывания Failsafe определяется <br/>в строке <br/>#define FAILSAFE_DETECT_TRESHOLD  985 <br/>Мертвая зона и нейтральная зона <br/>Предполагается, что коптер не должен реагировать на незначительные отклонения <br/>управляющих сигналов от центрального положения, потому что такие отклонения <br/>обусловлены скорее несовершенством аппаратуры, чем действиями пилота. По <br/>умолчанию задано значение ±6. <br/>#define DEADBAND 6 <br/>Если у вас качественная аппаратура со стабильными отцентрованными значениями <br/>сигнала, можно уменьшить значение этого параметра или закомментировать его. <br/>Значение нейтральной зоны задает интервал изменений положения рукоятки газа, <br/>внутри которого коптер не реагирует на газ в режиме удержания высоты. Если из-<br/>менение газа выходит за пределы заданного интервала, удержание высоты времен-<br/>но игнорируется и коптер начинает подниматься или снижаться. <br/>#define ALT_HOLD_THROTTLE_NEUTRAL_ZONE 50 <br/><br/>Глава 5. Сборка и настройка квадрокоптера 145 <br/>Магнитное склонение <br/>Магнитное склонение определяется в секции настроек GPS, но вписать его нужно <br/>сразу для правильной последующей калибровки компаса и работы функции Head <br/>Free. Определите магнитное склонение для своей местности на сайте www. <br/>magnetic-declination.com (рис. 5.7). <br/> <br/>Рис. 5.7. Определение магнитного склонения <br/>В примере на рисунке магнитное склонение положительное и составляет 3°59′. Но <br/>в прошивке используется значение с десятичными долями градуса. Для конверта-<br/>ции надо к целому значению градусов прибавить значение минут, деленное на 60: <br/>3°59′ → 3° + 59′/60 = 3,98°. <br/>Впишите это значение в строку <br/>#define MAG_DECLINATION  3.98f <br/>В связи с дрейфом магнитных полюсов значение склонения нужно периодически <br/>проверять на сайте и обновлять в прошивке. <br/>*  *  * <br/>На этом базовая настройка прошивки завершена. Сохраните файлы, скомпилируйте <br/>прошивку и загрузите ее в контроллер. Перед этим память EEPROM контроллера <br/>должна быть очищена, как сказано в начале раздела. После завершения загрузки <br/>прошивки на плате контроллера должны быстро мигать светодиоды A и C. Это оз-<br/>начает, что контроллер ожидает от вас команду калибровки акселерометров. В этом <br/><br/>146 Часть II. Практика <br/>состоянии контроллер еще не готов к полетам. Для дальнейшей настройки нам по-<br/>надобится утилита конфигурации с визуальным интерфейсом, установленная на <br/>компьютер. Таких утилит две: упрощенная MultiWiiConf и более сложная MultiWii <br/>WinGU. <br/> <br/>Альтернативная прошивка MahoWii <br/>Проекту MultiWii, как и многим другим открытым проектам, присуще наличие от-<br/>ветвлений — альтернативных вариантов, настроенных под специфические цели или <br/>имеющих дополнительные опции. Начинающим владельцам мультикоптеров в ка-<br/>честве альтернативы настоятельно рекомендуем прошивку MahoWii. Детальное <br/>описание опций прошивки можно прочесть в дневнике разработчика по адресу <br/>http://forum.rcdesign.ru/blogs/83206/blog17033.html и в комментариях к дневнику. <br/>Прошивка MahoWii особенно хороша для начинающих. Существует упрощенная и <br/>заранее настроенная версия RC2.1_base, которая "из коробки" обеспечивает ста-<br/>бильный полет практически любого коптера с минимальными коррективами на-<br/>стройки либо вообще без изменений. Но в базовой версии отсутствует режим <br/>удержания высоты и поддержка GPS. Для более опытных пилотов предназначена <br/>полная версия MahoWii RC3. <br/>Основными достоинствами этой прошивки для начинающего пилота являются сле-<br/>дующие опции: <br/>� эффективный режим удержания высоты; <br/>� возможность задать минимальную "защитную" высоту полета, ниже которой <br/>коптер не опустится в случае ошибки пилотирования; <br/>� эффективный фильтр вибропомех; <br/>� динамическая автокоррекция высоты при пролетах, когда рама наклонена; <br/>� поддержка ультразвукового сонара. <br/>Кроме специфических параметров, описанных в дневнике разработчика, все ос-<br/>тальные настройки соответствуют стандартной версии MultiWii. Прошивка <br/>MahoWii спонсируемая, т. е. для получения актуальной версии прошивки необхо-<br/>димо сделать фиксированный взнос на поддержку проекта. <br/>В дальнейшем, говоря про настройку прошивки, мы будем подразумевать стан-<br/>дартный вариант прошивки MultiWii, а особенности MahoWii при необходимости <br/>отмечать отдельно. <br/> <br/>ВАЖНО! <br/>Для компилирования прошивки MahoWii следует использовать старую версию Arduino <br/>IDE 1.0.5, т. к. при использовании версии 1.6.x будут появляться ошибки компиляции <br/>из-за смены версии компилятора GCC. <br/><br/>Глава 5. Сборка и настройка квадрокоптера 147 <br/>Функциональные режимы контроллера <br/>Прежде чем приступить к использованию программ-конфигураторов, нужно разо-<br/>браться с функциональными режимами контроллера, которые переключаются при <br/>помощи органов управления пульта. Некоторые из этих режимов для платы Crius <br/>AIOP доступны всегда и в списке помечены звездочкой (*), остальные становятся <br/>доступными после настройки опций прошивки MultiWii. В других разновидностях <br/>прошивок многие опции имеют похожее или идентичное название и значение. Пра-<br/>вила включения режимов настраиваются в конфигураторе, поэтому надо хорошо <br/>понимать, что мы будем настраивать. <br/>ARM*: режим активации моторов. Управляется либо комбинацией положения ру-<br/>кояток пульта (см. приложение 3), либо тумблером одного из каналов AUX. Если <br/>моторы не активированы (disarmed), то регуляторы оборотов находятся в режиме <br/>ожидания, питание на моторы не подается. Коптер никак не реагирует на движение <br/>рукояток управления. Но в режиме ожидания контроллер ведет полноценный об-<br/>мен информацией с периферийными модулями, ждет захват спутников GPS, пере-<br/>дает телеметрию и т. д. После активации моторов (armed) моторы работают в ми-<br/>нимальном режиме. Коптер реагирует на рукоятки управления и полностью готов  <br/>к взлету. Это опасный режим, коптер следует активировать только непосредствен-<br/>но перед взлетом. <br/>LEVEL (ANGLE)*: режим автоматической стабилизации положения коптера за <br/>счет гироскопов и акселерометров. Когда режим активен, при отклонении рукоятки <br/>крена Pitch-Roll контроллер "запоминает" углы текущего положения коптера в про-<br/>странстве (level) и автоматически поддерживает это положение даже при возврате <br/>рукояток в нейтраль. Для выравнивания коптера в горизонталь нужно сместить  <br/>рукоятку в противоположном направлении за нейтраль. <br/>HORIZON*: режим автоматического выравнивания коптера в горизонтальное по-<br/>ложение при возврате рукоятки Pitch-Roll в нейтраль. В остальном схож с режимом <br/>LEVEL и, по сути, представляет собой его модификацию. Чем сильнее рукоятка <br/>крена отклоняется от нейтрали, тем меньше удельный вес показаний акселерометра <br/>и тем больше вес показаний гироскопа в алгоритме стабилизации. Это помогает <br/>динамично управлять коптером. Но при возврате в нейтраль коптер автоматически <br/>возвращается в горизонтальное положение, соответствующее откалиброванному <br/>нулевому положению акселерометра. Режим особо рекомендуется начинающим <br/>пилотам, и при полетах по FPV достаточно просто отпустить рукоятку и правильно <br/>настроенный коптер сам выровняется и зависнет на месте (для стабилизации по вы-<br/>соте нужен еще и барометр). <br/>Режимы LEVEL и HORIZON взаимоисключающие и не должны включаться одно-<br/>временно. Рекомендуется присоединить их к одному каналу AUX, чтобы при одном <br/>положении тумблера включался режим LEVEL, а при другом HORIZON. Если оба <br/>режима отключены, работает стабилизация только за счет датчиков угловых уско-<br/>рений — настоятельно НЕ рекомендуется так делать начинающим пилотам. Опыт-<br/>ным вертолетчикам полет "на гироскопах" не составит особого труда. <br/><br/>148 Часть II. Практика <br/>BARO*: режим удержания высоты по барометру в положении газа, близком к точ-<br/>ке висения. Доступен при наличии микросхемы интегрального барометра на плате. <br/>Работает независимо от других режимов. Режим начинает работать более-менее <br/>точно на высоте более 2–3 м. На меньшей высоте воздушная подушка и завихрения <br/>у земной поверхности, создаваемые винтами, вносят слишком большую погреш-<br/>ность в показания барометра. В некоторых версиях прошивки режим BARO может <br/>препятствовать полной посадке коптера и отключению моторов, поэтому его сле-<br/>дует включать после взлета, на рабочей высоте, и отключать перед посадкой. В со-<br/>временных алгоритмах показания барометра учитываются совместно с показания-<br/>ми акселерометра по вертикальной оси z, что позволяет гасить быстрые вертикаль-<br/>ные флуктуации. Причем показаниям акселерометра при краткосрочных девиациях <br/>отдается предпочтение. <br/>VARIO: модификация режима удержания высоты, когда скорость изменения высо-<br/>ты зависит от степени отклонения рукоятки газа от точки зависания. Чем сильнее <br/>отклонили рукоятку, тем быстрее меняется высота полета. При возврате газа в точ-<br/>ку висения происходит фиксация новой высоты. Во многих современных вариантах <br/>прошивок режим VARIO не выделяется в отдельную опцию, а применяется некий <br/>универсальный алгоритм удержания высоты, который гибко реагирует на измене-<br/>ние положения рукоятки газа. Иногда носит название ALTHOLD или похожее. <br/>MAG*: режим включения магнетометра. Доступен при наличии микросхемы инте-<br/>грального магнетометра на плате. Используется для стабилизации коптера по кур-<br/>су, поскольку стабилизации курса на основе одного гироскопа присуща нарастаю-<br/>щая погрешность. Но зачастую включение магнетометра только вредит. При нали-<br/>чии магнитных наводок от силовых цепей могут происходить самопроизвольные <br/>повороты по курсу при увеличении и уменьшении газа. В этом случае режим MAG <br/>лучше отключить. <br/>HEADFREE*: режим удержания условного направления "вперед" независимо от <br/>физического положения рамы. Требует наличия качественного магнетометра, за-<br/>щищенного от помех. В момент активации моторов (включение ARM) контроллер <br/>запоминает курс, на который указывает физическое направление "вперед" рамы. <br/>Обычно это направление вперед от оператора. При вращении рамы вокруг своей <br/>оси во время полета контроллер пересчитывает направление по показаниям магне-<br/>тометра. Поэтому с точки зрения оператора направления полета "вправо-влево" и <br/>"вперед-назад" остаются постоянными, независимо от разворота рамы в воздухе. <br/>Считается, что этот режим удобен и безопасен для начинающих операторов, часто <br/>теряющих контроль над направлением полета при удалении коптера на достаточное <br/>расстояние. Также этот режим предпочитают некоторые операторы при полетах <br/>по FPV. <br/>HEADADJ*: режим корректировки направления "вперед" во время работы режима <br/>HEADFREE. Если в результате девиаций магнетометра утрачено правильное ус-<br/>ловное направление "вперед" или его нужно сменить по желанию оператора, или <br/>нужно просто полетать в обычном режиме, то можно временно включить <br/>HEADADJ. После отключения HEADADJ контроллер запоминает текущее поло-<br/>жение "вперед" рамы коптера и дальнейший курс вычисляет уже от него. <br/><br/>Глава 5. Сборка и настройка квадрокоптера 149 <br/>CAMSTAB: режим стабилизации двухосевого подвеса камеры. При наклонах рамы <br/>контроллер старается стабилизировать положение подвеса. Активируется по каналу <br/>AUX, но обычно, при наличии подвеса, этот режим делают включенным постоянно. <br/>CAMTRIG: спуск затвора фотокамеры или запуск/остановка видеозаписи. К спе-<br/>циальному выходу TRIG на плате контроллера может быть подключен как элек-<br/>тронный адаптер для управления камерой, так и сервомашинка, механически дей-<br/>ствующая на кнопку спуска камеры. <br/>GPS HOME: режим автоматического возврата "домой" по координатам GPS. При <br/>наличии приемника GPS в режиме захвата спутников в момент активации моторов <br/>происходит запоминание координат. Затем, при включении режима GPS HOME <br/>коптер автоматически возвращается к точке старта и зависает на высоте, заданной в <br/>настройках прошивки. Эта функция очень полезна в режиме Failsafe и позволяет <br/>автоматически вернуть коптер при потере канала управления. При возврате исполь-<br/>зуется компас. <br/>GPS HOLD: режим автоматического удержания позиции по координатам GPS. Для <br/>качественного удержания высоты должен быть также включен режим BARO. Если <br/>отклонить рукоятку управления от нейтрали, режим удержания временно отклю-<br/>чится, и коптер будет реагировать на команды управления. При возврате рукоятки <br/>в нейтраль контроллер зафиксирует новую позицию. <br/>ПРИМЕЧАНИЕ <br/>Режимы GPS HOME и GPS HOLD взаимоисключающие и не должны включаться од-<br/>новременно. <br/>PASSTHRU: режим сквозного прохождения сигналов радиоуправления с приемни-<br/>ка на управляемое устройство. В коптерах не применяется. Может использоваться, <br/>например, в самолетах, когда пилот хочет временно отключить стабилизацию и  <br/>перейти к полностью ручному управлению. При этом стабилизация видеокамеры <br/>может продолжать работать. <br/>BEEPER: включение звукового излучателя (beeper, buzzer), подключенного к спе-<br/>циальному выходу контроллера. Если в прошивке включено обслуживание звуко-<br/>вых сигналов и активирован режим BEEPER, то контроллер будет реагировать <br/>звуком на переключение режимов, а также издавать сигнал "найди меня" при сра-<br/>батывании функции Failsafe. <br/>LEDMAX: включение подсветки рамы коптера в постоянном режиме. Если ис-<br/>пользуется функция прошивки LED_FLASHER, заставляющая подсветку коптера <br/>мигать с заданной частотой, то при активации режима LEDMAX в нее передается <br/>максимальное значение 0xFF, при котором подсветка горит постоянно. Это необхо-<br/>димо при полетах в ночное время, когда быстро мерцающая подсветка может силь-<br/>но раздражать зрение. <br/>LEDLOW: принудительное отключение подсветки, когда используется функция <br/>прошивки LED_FLASHER. При активации режима LEDLOW в нее передается <br/>минимальное значение 0x00, при котором подсветка не горит. <br/><br/>150 Часть II. Практика <br/>LLIGHTS: включение посадочных огней (Landing Lights) для подсвечивания поса-<br/>дочной площадки в темное время суток. Посадочные огни также могут включаться <br/>автоматически, по показаниям сонара, при достижении заданной высоты. Эта <br/>функция включается в настройках прошивки. <br/>CALIB: если в прошивке включена возможность калибровки акселерометра в по-<br/>лете, то по включению режима CALIB во время стабильного горизонтального  <br/>висения текущее положение запоминается, как нулевое калибровочное положение <br/>для акселерометра. В предыдущих версиях прошивки для этого мог использоваться <br/>переключатель режима PASSTHRU. <br/>OSD SW: включение/выключение вывода информации OSD в полете, если такая <br/>возможность активирована в прошивке. По умолчанию поток данных доступен че-<br/>рез последовательный порт всегда. <br/> <br/>Конфигуратор MultiWiiConf <br/>Эту программу вы скачали в архиве вместе с прошивкой. Для работы приложения <br/>потребуется движок Java от Sun Microsystems. Если Java отсутствует на вашем <br/>компьютере, при первом запуске вам будет автоматически предложено скачать  <br/>и установить оболочку Java. Впоследствии Java понадобится и для программы на-<br/>стройки модуля OSD. <br/>Утилита настройки не требует инсталляции. В разархивированной ранее папке вы-<br/>берите нужную версию программы в соответствии с вашей операционной систе-<br/>мой. Перед запуском программы контроллер должен быть подключен к компьюте-<br/>ру, иначе нужный COM-порт не появится в списке. После запуска выберите нуж-<br/>ный порт в списке и нажмите кнопку START. На плате контроллера должны <br/>замерцать светодиоды Rx-Tx, а в окне приложения появиться графики потока дан-<br/>ных от сенсоров (рис. 5.8). <br/> <br/>Калибровка акселерометра <br/>Расположите плату строго горизонтально и нажмите кнопку CALIB_ACC. При-<br/>близительно в течение 10 с произойдет калибровка акселерометров. В это время <br/>плата должна быть неподвижной и не испытывать вибрации. По завершении ка-<br/>либровки светодиоды A и C перестанут мигать непрерывно и будут мигать только <br/>при наклоне платы больше 18° от горизонтали, что означает критический неском-<br/>пенсированный угол, при котором коптер может начать "соскальзывать", если нет <br/>достаточной вертикальной тяги. <br/>Теперь попробуйте наклонять и поворачивать плату. Авиагоризонт и компас в пра-<br/>вой части окна должны отображать текущее положение контроллера в пространст-<br/>ве. Расположите плату контроллера стрелкой вперед. При наклоне вправо авиаго-<br/>ризонт должен наклоняться влево, и наоборот. Соответственно, при наклоне вперед <br/>уровень горизонта должен подниматься. <br/><br/>Глава 5. Сборка и настройка квадрокоптера 151 <br/> <br/>Рис. 5.8. Главное окно интерфейса MultiWiiConf <br/>ПРИМЕЧАНИЕ <br/>Распространенной ошибкой начинающих пилотов является неправильное понимание <br/>сути показаний авиагоризонта. Он показывает не абсолютное положение летательно-<br/>го аппарата относительно горизонтали, а вид линии горизонта глазами пилота, нахо-<br/>дящегося в кабине, как в компьютерной игре. Зеленый сегмент индикатора — это зем-<br/>ля, голубой — небо. <br/>Для редактирования числовых значений в данной Java-программе применяется до-<br/>вольно непривычный способ: щелкнуть мышью на числе и при зажатой левой <br/>кнопке мыши двигать мышь влево или вправо. Соответственно, число будет <br/>уменьшаться или увеличиваться. Затем нужно нажать кнопку WRITE для записи <br/>в память контроллера. <br/>Значения по умолчанию, доступные для настройки через интерфейс, эксперимен-<br/>тально подобраны разработчиками прошивки так, чтобы сделать максимально <br/>безопасным и комфортным первый полет усредненного коптера размером 450–<br/>500 мм весом до 1 кг, собранного из распространенных комплектующих. Вы може-<br/>те быть уверены, что правильно и аккуратно собранный коптер достаточно хорошо <br/>полетит на параметрах по умолчанию. Но впоследствии некоторые параметры по-<br/>требуют подстройки для более качественного управления именно вашим коптером. <br/>Секция параметров RATE и EXPO характеризует отклик коптера на сигнал, посту-<br/>пающий с пульта. RATE — это коэффициент пропорциональности реакции копте-<br/>ра на изменение управляющего сигнала по кренам Pitch-Roll. Уменьшение коэффи-<br/>циента делает отклик более вялым и ограниченным по размаху. Параметр EXPO <br/>характеризует линейность отклика контроллера на угол отклонения рукояток. При <br/><br/>152 Часть II. Практика <br/>наличии экспоненты, при небольшом отклонении рукояток реакция невелика, при <br/>дальнейшем отклонении степень отклика нарастает нелинейно. Наличие экспонен-<br/>ты полезно для начинающих пилотов, которым присуще нервное дерганье рукояток <br/>пульта относительно нейтрали без необходимости. С другой стороны, резкий от-<br/>клик при большом отклонении рукояток позволяет быстро парировать положение <br/>коптера в аварийной ситуации. <br/>ПРИМЕЧАНИЕ <br/>Экспоненты в настройках пульта и контроллера ни в коем случае не должны склады-<br/>ваться! Настоятельно рекомендуется отключить (выставить в ноль) экспоненты в на-<br/>стройках всех каналов пульта управления и использовать только настройки контрол-<br/>лера, т. к. контроллер отрабатывает экспоненту более точно. <br/>Секция параметров MID и EXPO относится к управлению газом. Параметр MID — <br/>это значение газа в процентах отклонения рукоятки, при котором коптер зависает  <br/>в воздухе, не двигаясь по вертикали. Этот параметр используется, как опорный,  <br/>в режиме удержания высоты по барометру и при расчете газа снижения после сра-<br/>батывания Failsafe. Значение газа висения впоследствии обязательно надо уточнить <br/>экспериментально, засекая положение рукоятки газа для висения полностью сна-<br/>ряженного коптера при наполовину разряженной силовой батерее. Кривая экспо-<br/>ненты газа выглядит иначе, чем экспонента кренов. Она плоская в середине и дает <br/>более резкий отклик по обе стороны от средней точки. Для начинающего пилота <br/>лучше оставить линейную кривую газа с нулевой экспонентой. Обязательно убеди-<br/>тесь, что в пульте также установлена нулевая экспонента газа. <br/>Секцию настройки параметров обратной связи PID пока не будем трогать и вер-<br/>немся к ней после нескольких первых успешных полетов. <br/>Секция параметров AUX1, AUX2, AUX3, AUX4 должна быть настроена перед по-<br/>летом. В ней определяется, каким образом полетные режимы контроллера пере-<br/>ключаются при помощи дополнительных тумблеров или регуляторов пульта.  <br/>В списке режимов появляются обязательные опции плюс дополнительные, которые <br/>на данный момент определены в прошивке и физически доступны. Например, на <br/>рис. 5.8 не видны режимы GPS HOME и GPS HOLD, потому что приемник GPS не <br/>подключен и в прошивку не поступает поток данных. Если в коде прошивки при <br/>помощи описаний #define активировать стабилизацию камеры или поисковый би-<br/>пер, соответствующие строки также появятся в списке. <br/>Параметр TPA (Throttle PID Attenuation) определяет степень ослабления влияния <br/>стабилизации при отклонении рукоятки газа от среднего положения. По умолчанию <br/>коэффициент равен нулю. Это означает, что система стабилизации коптера реаги-<br/>рует на внешние воздействия коптера одинаково при любом положении рукоятки <br/>газа. <br/>Два поля значений RATE справа от секции PID также содержат коэффициенты <br/>уменьшения стабилизации, но при отклонении от нейтрали по осям Pitch-Roll и <br/>Yaw. Для спокойного стабильного пилотирования, полетов по FPV и висения нуж-<br/>но оставить нулевое значение. Чем ближе значения в этих полях к единице, тем <br/>меньше стабилизация коптера и тем быстрее и острее он реагирует на резкие от-<br/><br/>Глава 5. Сборка и настройка квадрокоптера 153 <br/>клонения рукояток. Для динамичного пилотирования нужно задать значения по-<br/>рядка 0,30; для агрессивной акробатики 0,65–0,70. При отпускании рукояток в ней-<br/>тральное положение автоматическая стабилизация восстанавливается. <br/>Для привязки режима к положению одного из переключателей AUX в нужной <br/>строке, напротив названия режима, включите белый квадратик щелчком мыши. На-<br/>пример, на иллюстрации показано, что режим удержания высоты BARO включится <br/>при максимальном значении канала AUX1. При минимальном значении канала <br/>AUX3 будет включен режим стабилизации ANGLE, а при максимальном значении <br/>этого канала — режим HORIZON. Установленные значения нужно обязательно <br/>записать в память, нажав кнопку WRITE. Если к контроллеру подключен прием-<br/>ник, можно сразу проверить правильность настройки, меняя положение тумблеров <br/>пульта. <br/>Каналы AUX могут быть привязаны не только к тумблерам, но и к потенциометрам <br/>или трехпозиционным переключателям, чтобы задействовать среднее значение ка-<br/>нала. Если нужно, чтобы какой-то режим (например, стабилизация камеры <br/>CAM_STAB) был включен всегда, поставьте галочки во все три значения любого <br/>канала AUX напротив нужного режима. <br/>Контроллер может хранить в EEPROM три набора настроечных параметров. Это <br/>удобно, если надо быстро переключаться между разными стилями пилотирования <br/>или переставлять контроллер на разные платы. <br/>В версии приложения 2.30 появилась вкладка окна SETTINGS (рис. 5.9). В этом <br/>окне можно изменить скорость порта для соединения с платой контроллера, а также  <br/> <br/> <br/> <br/>Рис. 5.9. Окно настроек MultiWiiConf <br/><br/>154 Часть II. Практика <br/>некоторые параметры прошивки без ее перезагрузки. Нажмите кнопку READ, что-<br/>бы прочитать все доступные для редактирования параметры. В данном случае без <br/>редактирования прошивки мы можем поменять параметры MINTHROTTLE (опи-<br/>сание см. выше) и MAG_DECL. <br/>Конфигуратор MultiWii WinGUI <br/>Как следует из названия, это графический интерфейс (GUI) для настройки MultiWii <br/>в среде Windows. Конфигуратор оперирует тем же набором параметров, что и <br/>MultiWiiConf, но имеет более широкую функциональность. На момент написания <br/>книги был доступен для скачивания пререлиз бета #5 приложения WinGUI 2.30 — <br/>иными словами, приложение в состоянии разработки. Эта версия предназначается <br/>для работы с прошивкой MultiWii v2.30, имеет существенно переработанный ди-<br/>зайн интерфейса и, что самое главное, планировщик миссий для автоматических <br/>полетов по GPS. <br/>Автору так и не удалось осуществить подключение новой версии к полетному кон-<br/>троллеру на компьютере под Windows 7. При попытке подключиться приложение <br/>выводило окно ошибки с сообщением о несоответствии параметров входного зна-<br/>чения и отказывалось работать дальше. Будем надеяться, что к моменту выхода <br/>книги из печати будет доступен финальный или, хотя бы, более стабильный релиз. <br/>К счастью, с прошивкой MultiWii 2.30 нормально работает WinGUI предыдущей <br/>версии 2.20 (рис. 5.10). Это стабильная, многократно проверенная и отлаженная <br/>версия, с которой легко и удобно работать. Скачайте архив и разверните его. Уста-<br/>новка не требуется, достаточно запустить файл MultiWiiWinGUI.exe. <br/> <br/>Рис. 5.10. Стартовый экран конфигуратора MultiWii WinGUI <br/><br/>Глава 5. Сборка и настройка квадрокоптера 155 <br/>К моменту запуска программы плата контроллера должна быть подключена к USB, <br/>иначе нужный порт не появится в списке. При работе с WinGUI никакое устройство <br/>не должно быть подключено к порту SERIAL0, иначе возникнет конфликт уст-<br/>ройств. По умолчанию скорость обмена равна 115 200 бод. Если вы задали в на-<br/>стройках прошивки другую скорость порта SERIAL0, то не забудьте перед под-<br/>ключением выбрать эту скорость в меню. К некоторым экземплярам платы Crius <br/>AIOP подключение происходит не с первого раза. В этом случае нужно повторить <br/>попытку подключения или закрыть и снова запустить конфигуратор. <br/>Прочие опции меню: <br/>� Read Settings — прочитать настройки из памяти контроллера; <br/>� Write Settings — записать настройки в память контроллера; <br/>� Load Defaults — восстановить в интерфейсе настройки по умолчанию. Затем <br/>нужно нажать кнопку Write Settings, чтобы перенести настройки в память кон-<br/>троллера; <br/>� Load from File — прочитать настройки из файла; <br/>� Save to File — сохранить настройки в файл; <br/>� Start Log — запись полетного лога (журнала) в файл; <br/>� Start GPS Log — запись лога данных GPS; <br/>� Log Browser — утилита просмотра записанных ранее логов с возможностью <br/>построения графиков. <br/>Разумеется, пока контроллер лежит на вашем столе, в ведении логов нет необходи-<br/>мости. Для ведения логов в полевых условиях, во время полета, вам придется орга-<br/>низовать радиоканал для передачи данных с борта коптера на ноутбук (радиолинк). <br/>Последующий анализ логов поможет выявить, например, в какой момент возникает <br/>сбой в работе коптера. Но, как правило, анализ логов нужен продвинутым пилотам, <br/>а для начала можно вполне обойтись без них. <br/>Вкладка Parameters содержит секцию настроек PID, экспонент и коэффициентов. <br/>Назначение этих настроек рассмотрено выше, в описании конфигуратора <br/>MultiWiiConf. Разница лишь в более удобном способе ввода числовых значений. <br/>Вкладка RC Control Settings содержит настройки зависимости режимов контрол-<br/>лера от состояния каналов AUX, которые также рассмотрены ранее. Не забывайте <br/>после изменения настроек записывать их в память контроллера, чтобы увидеть ре-<br/>зультат. <br/>Вкладка Realtime Data отображает поток данных с сенсоров, радиоприемника и <br/>приемника GPS в режиме реального времени. Частоту обновления данных можно <br/>менять в диапазоне от 1 до 20 раз в секунду. Поскольку контроллер выдает эти <br/>данные по запросу конфигуратора, слишком частые запросы могут мешать кон-<br/>троллеру во время реального полета, когда скорость обмена данными невелика. На <br/>этой же вкладке можно запустить процедуры калибровки акселерометра и магни-<br/>тометра. <br/><br/>156 Часть II. Практика <br/>Вкладка Map требует наличия работающего приемника GPS и доступа в Интерне-<br/>те для загрузки карты в соответствии с координатами, полученными с приемника. <br/>Провайдера карт можно выбрать в правом нижнем углу, в списке Map Provider. <br/>Вкладка Video Capture предназначена для записи видео с любого источника ви-<br/>деосигнала, подключенного к компьютеру. Если говорить о записи видео с борта <br/>коптера, то компьютер должен быть оснащен либо устройством захвата видеосиг-<br/>нала, поступающего с выхода приемника FPV, либо видеоприемником, подклю-<br/>чаемым по USB. <br/>Вкладка GUI Settings содержит настройки путей для сохранения файлов логов и <br/>настроек. Также на этой вкладке можно задать набор данных, которые будут запи-<br/>саны в лог. <br/>Вкладка CLI — это окно терминала (Command Line Interface). Обмен данными <br/>между контроллером и внешними программами происходит при помощи специаль-<br/>ного протокола MSP (MultiWii Serial Protocol). Внешняя программа посылает  <br/>в контроллер команду запроса на чтение или запись данных, а контроллер отраба-<br/>тывает эту команду, выгружая блок данных или записывая полученные данные  <br/>в свою память. Когда открыта вкладка CLI, автоматический обмен данными с кон-<br/>фигуратором прекращается и система находится в ожидании ручного ввода коман-<br/>ды. Ответ контроллера выводится в окне вкладки. Такой режим нужен только про-<br/>двинутым пользователям, занимающимся модификацией и отладкой прошивки. <br/> <br/>Терминал для работы с COM-портами <br/>Некоторые дополнительные устройства, такие как модуль Bluetooth и радиомоде-<br/>мы, для настройки и проверки требуют отправки на них специальных текстовых <br/>команд и просмотра ответа на эти команды. Для этого на компьютере должна быть <br/>установлена программа терминала последовательного порта. Существует множест-<br/>во таких утилит, но на основании собственного опыта автор рекомендует использо-<br/>вать программу Termite 3.0. Программа очень простая и стабильная, ничего лишне-<br/>го, но при этом имеются все необходимые настройки. <br/>Архив с программой можно скачать на сайте разработчика: http://www. <br/>compuphase.com/software/termite-3.1.zip. Она не требует инсталляции, достаточно <br/>развернуть архив в удобное место. Вместе с программой рекомендуем скачать спе-<br/>циальный шрифт GNU Unifont http://www.compuphase.com/software/unifont-<br/>5.1.zip и поместить его в одну папку с программой терминала. Шрифт отображает <br/>небуквенные служебные символы, если они встречаются в потоке данных. Эта  <br/>опция может пригодиться в будущем. <br/>При работе с дополнительными модулями потребуется проверить и изменить сле-<br/>дующие настройки терминала. <br/>� Номер последовательного порта. Это порт, который появляется в системе при <br/>подключении адаптера USB-COM. При подключении одного и того же устрой-<br/>ства к разным разъемам USB номер порта может меняться. <br/><br/>Глава 5. Сборка и настройка квадрокоптера 157 <br/>� Скорость обмена с устройством. Для каждого устройства определена своя ско-<br/>рость по умолчанию, указанная в инструкции или описании. <br/>� Присоединение символов конца строки и перевода каретки, <LF> и <CR>. Неко-<br/>торые модули требуют наличия этих символов в конце команды, некоторые — <br/>нет. <br/>Остальные настройки, как правило, менять не надо. Также не следует менять на-<br/>стройки соответствующего порта в системе Windows, т. к. при открытии програм-<br/>мы терминала соответствующие параметры порта в системе будут установлены  <br/>автоматически, на то время, пока открыт порт. <br/>Программы для мобильных устройств <br/>Программы для мобильных устройств позволяют настраивать коптер в полевых <br/>условиях, принимать и отображать телеметрийную информацию, а также иногда <br/>управлять коптером вместо пульта радиоуправления. Для их взаимодействия с кон-<br/>троллером потребуется наличие беспроводного соединения по Bluetooth, а при <br/>больших дистанциях — радиомодема. Подключение модуля Bluetooth и радиомо-<br/>дема рассмотрено в главе 6. На момент написания книги для операционной системы <br/>Android были доступны три популярные утилиты конфигурации и телеметрии: <br/>NAZE32 Comfigurator, MultiWii Configuration Tool и EZ-GUI Ground Station. Их <br/>можно легко найти поиском в Google Play. <br/>EZ-GUI Ground Station <br/>Cтарое название этой программы — MultiWii EZ-GUI. Программа постоянно дора-<br/>батывается и модифицируется; разработчик активно участвует в общении на тема-<br/>тических форумах и аккуратно отвечает на вопросы и замечания пользователей. <br/>Программа не полностью бесплатная, доступ к полному пакету функций GPS и ве-<br/>дению логов полета необходимо купить. Но стоимость опции невысока, а функции <br/>очень полезные, поэтому рекомендуем приобрести их сразу после скачивания про-<br/>граммы. Ключ активации для платных опций хранится на карте памяти SD мо-<br/>бильного устройства, поэтому при активации и использовании программы карта <br/>памяти должна быть доступна. <br/>Интерфейс программы состоит из трех основных секций, которые прокручивают- <br/>ся поперечным движением. Перед началом работы программу нужно настроить. <br/>Войдите в меню Конфигурации | Настройки. Должен быть выбран тип связи <br/>Bluetooth. Далее нажмите кнопку выбор Bluetooth, чтобы выбрать модуль <br/>Bluetooth вашего коптера. Если модуля нет в списке спаренных устройств смартфо-<br/>на или планшета, нажмите кнопку Поиск устройств и проведите связывание <br/>Bluetooth с вашим мобильным устройством как обычно. <br/>Далее, нажимая стрелку → в правом верхнем углу, последовательно пройдите  <br/>остальные этапы настройки. Выберите версию прошивки, в нашем случае это <br/>MultiWii 2.3. Настройку голосовых уведомлений можно не менять. Уведомления <br/>голосом бывают полезны во время полета, но довольно навязчивы. Остальные два <br/><br/>158 Часть II. Практика <br/>экрана настроек пропустите. По завершении настройки программа перезапустится, <br/>и вы вновь окажетесь на главном экране. Щелкните по ссылке Соединиться в пра-<br/>вом верхнем углу. Соединение устанавливается примерно 3–5 с. Иногда, в зависи-<br/>мости от модели смартфона и модуля Bluetooth, соединение устанавливается  <br/>со второй-третьей попытки. Особенно это характерно для смартфонов Samsung. <br/>В отдельных случаях помогает перезагрузка смартфона. <br/>Опции стартового экрана отображают основную полетную информацию. Для кор-<br/>ректного отображения карты и координат в мобильном устройстве должен быть <br/>доступен мобильный Интернет и включен приемник GPS. Пока не поступают дан-<br/>ные GPS с коптера, на карте отображается местоположение пилота (стартовая точ-<br/>ка). Во время полета карта в режиме реального времени "следует" за положением <br/>коптера. Разумеется, для этого данные должны передаваться на достаточное рас-<br/>стояние при помощи удлинителя радиомодема. <br/>На экране Настройки нам понадобятся вначале только кнопки PID, AUX, <br/>КАЛИБРОВКА и ЛОГ. По умолчанию включено автоматическое ведение логов <br/>(журналов) полета. На SD-карту телефона в режиме реального времени записыва-<br/>ются координаты коптера, напряжение батареи, обороты моторов и т. д. После по-<br/>лета данные можно посмотреть на мобильном устройстве в виде графиков, а также <br/>конвертировать в формат KML для загрузки в сервис Google Earth, чтобы посмот-<br/>реть 3D-траекторию полета на фоне спутниковой карты местности. Иногда это хо-<br/>рошо помогает при поиске потерянного коптера. <br/>В расширенных настройках можно выбрать текущий профиль: 0, 1 или 2. MultiWii <br/>позволяет сохранять три разных профиля настроек и переключаться между ними.  <br/>В свою очередь конфигуратор позволяет не только выбрать текущий профиль, но и <br/>записать в него временные настройки, а если не понравилось — вернуть исходные. <br/>Использование остальных функций определяется вариантом прошивки, конфигу-<br/>рацией дополнительного оборудования коптера и потребностями пользователя, по-<br/>этому детальная расшифровка всех опций программы в данной книге не имеет <br/>смысла. Назначение настроек интуитивно понятно, вы без труда освоите их по мере <br/>приобретения опыта. <br/>NAZE32 Configurator <br/>Как следует из названия, программа разрабатывалась для конфигурирования по-<br/>летного контроллера NAZE32, но совместима и с другими контроллерами, рабо-<br/>тающими на прошивке MultiWii. Для подключения требуется, чтобы Bluetooth <br/>квадрокоптера уже был связан с телефоном и присутствовал в списке доступных <br/>устройств. Связывание осуществляется стандартными средствами вашего мобиль-<br/>ного устройства. В различных устройствах на базе Android эта процедура может <br/>незначительно различаться. <br/>Применительно к плате CRIUS AIOP с прошивкой MultiWii v.2.3 эта программа <br/>имеет ограниченную функциональность, но позволяет оперативно настраивать  <br/>параметры PID, AUX (Switches) и RATE с одного экрана. <br/><br/>Глава 5. Сборка и настройка квадрокоптера 159 <br/>ВНИМАНИЕ! <br/>Функция триммирования акселерометра AccTrim работает только для платы NAZE32 <br/>на Baseflight. <br/>Для плат с прошивкой MultiWii подстройка горизонта акселерометра производится <br/>при помощи стиков пульта, как описано в главе 6. <br/>MultiWii Configuration Tool <br/>Простая и удобная утилита, которая поддерживает все стандартные настройки и <br/>отображает поток данных MultiWii версии 2.3 несмотря на то, что формально заяв-<br/>лена версия 2.1, поскольку базовый протокол обмена данными не изменился. <br/>В настройках программы есть удобная опция Keep Screen On, не позволяющая  <br/>экрану смартфона отключаться в состоянии покоя. <br/>Калибровка регуляторов оборотов <br/>Как вы знаете, диапазон значений длительности импульсов в сигнале радиоуправ-<br/>ления может слегка различаться в разной аппаратуре. Перед началом эксплуатации <br/>регуляторы должны быть откалиброваны, т. е. настроены под правильное "понима-<br/>ние" рабочего диапазона сигналов радиоуправления имеющегося оборудования. <br/>Некоторые регуляторы после покупки вообще не начинают работать без прохожде-<br/>ния процедуры калибровки. <br/>ПРИМЕЧАНИЕ <br/>Распространенной ошибкой начинающих владельцев коптеров является попытка ка-<br/>либровать регуляторы отдельно от контроллера, при помощи специального програм-<br/>матора или подключая напрямую к приемнику. Впоследствии это приводит к необъяс-<br/>нимому поведению моторов коптера в воздухе. Контроллер не транслирует через себя <br/>сигналы с приемника. Он вырабатывает собственные сигналы управления оборотами. <br/>Поэтому калибровать регуляторы следует только при помощи специального режима <br/>контроллера, причем все регуляторы одновременно и желательно в окончательном <br/>варианте подключения каналов. Если вы поменяете местами подключение регулято-<br/>ров к каналам моторов, калибровку желательно повторить. Так же следует поступить и <br/>при замене одного из регуляторов при поломке. <br/>Последовательность процедуры калибровки: <br/>1. В тексте прошивки контроллера (см. файл config.h) найдите и раскомментируйте <br/>строку #define ESC_CALIB_CANNOT_FLY, расположенную в конце файла. <br/>2. Запишите прошивку в контроллер. <br/>3. Подключите моторы без пропеллеров к регуляторам. Направление вращения не <br/>имеет значения. <br/>4. Спаяйте цепь питания регуляторов и контроллера, если монтаж временный. <br/>5. Подключите входы регуляторов к соответствующим выходам контроллера и <br/>промаркируйте регуляторы. <br/>6. Подайте питание на контроллер и регуляторы. <br/><br/>160 Часть II. Практика <br/>После запуска контроллера начнется калибровка. Моторы издадут серию мелодич-<br/>ных звуков, могут пищать и хаотично дергаться в процессе калибровки. Примерно <br/>через 20 с калибровка завершится. Моторы могут раз в секунду издавать короткий <br/>писк, это зависит от модели регулятора. <br/>Отключите питание. Обязательно сразу же закомментируйте строку <br/>//#define ESC_CALIB_CANNOT_FLY <br/>и заново загрузите прошивку. Теперь ваши регуляторы откалиброваны и готовы <br/>к полетам. <br/>Настройка канала радиоуправления <br/>Сигналы управления, поступающие на контроллер с приемника, должны соответст-<br/>вовать определенным требованиям, более жестким, чем в случае самолетов и даже <br/>вертолетов. Существует множество моделей пультов управления; для некоторых из <br/>них предлагается несколько вариантов пользовательских прошивок. Поэтому  <br/>в данной книге невозможно привести детальное руководство по настройке каких-<br/>либо пультов. Мы будем исходить из того, что вы руководствуетесь имеющейся <br/>у вас детальной инструкцией по использованию вашей модели пульта. <br/>ПРИМЕЧАНИЕ <br/>Прежде всего, запомните правило настройки пульта для квадрокоптера: никаких <br/>триммеров, смещающих среднюю точку сигнала, потому что для квадрокоптера рабо-<br/>чий диапазон канала должен быть строго симметричным! В нейтральном (среднем) <br/>положении длительность импульсов каждого канала должна как можно точнее соот-<br/>ветствовать 1500. Минимальное значение сигнала — около 1000, максимальное — <br/>около 2000. Крайние значения менее критичны, главное, чтобы рабочий ход вниз и <br/>вверх от центра был одинаковым. <br/>Среднее значение 1500 выставляется на пульте при помощи субтриммеров. Разница <br/>между триммером и субтриммером описана в главе 2. Нижнее и верхнее значения <br/>задаются регулятором расходов пульта. Обычно в меню настроек пульта этот пункт <br/>называется Rates или Travel Adjust. Например, можно выставить минимальные <br/>значения 1065 и максимальные 1935. В этом случае будет симметричное отклоне-<br/>ние от центра ±435. <br/>Для настройки подключите выходы приемника к контроллеру, а сам контроллер  <br/>к USB-порту компьютера и запустите любой конфигуратор. Проверьте правильность <br/>подключения выходов приемника и настройки каналов AUX передатчика, двигая <br/>рукоятки и переключая тумблеры пульта. При необходимости переставьте местами <br/>разъемы каналов приемника или измените порядок каналов в настройках пульта. <br/>Убедитесь, что сигналы не инвертированы. При движении рукояток вправо и вверх <br/>сигналы нарастают, а при движении влево и вниз уменьшаются. После проверки <br/>рекомендуется наклеить бирки с удобными для вас метками на разъемы или прово-<br/>да, это значительно ускорит последующую сборку или ремонт коптера. <br/>Наблюдая за показаниями каналов в окне конфигуратора, настройте пульт. Теперь <br/>настроим "мертвую зону" пульта. В идеале при отпускании рукоятки в среднее по-<br/><br/>Глава 5. Сборка и настройка квадрокоптера 161 <br/>ложение сигнал должен всегда принимать значение 1500, но на практике у любых <br/>пультов наблюдается небольшое случайное отклонение. <br/>1. Отклоните рукоятку в крайнее положение и плавно верните в центр. Засеките <br/>величину отклонения от 1500. Например, 1500 – 1493 = 7. <br/>2. Проделайте эту процедуру для каналов ROLL, PITCH и YAW, отклоняя рукоят-<br/>ки в обе стороны. Запомните максимальное значение из всех получившихся от-<br/>клонений от центра. <br/>3. Повторите процедуру, по очереди резко отпуская рукоятки, чтобы они возвра-<br/>щались в центр под действием пружины. <br/>4. К максимальному значению отклонения, найденному в результате всех манипу-<br/>ляций, прибавьте 3–4 единицы. <br/>5. Откройте в Arduino IDE исходный код прошивки и в строке #define DEADBAND xx <br/>укажите вычисленное вами значение мертвой зоны. <br/>6. Запишите исправленную прошивку в память контроллера. <br/>Теперь дрожание средней точки сигнала не будет влиять на поведение коптера. <br/>Итак, на данном этапе вы предварительно сконфигурировали прошивку, настроили <br/>управление основными режимами по каналам AUX, откалибровали регуляторы, <br/>акселерометр и магнетометр, настроили сигналы пульта управления. Наверняка <br/>теперь вы захотите проверить работу контроллера, наблюдая за индикацией в окне <br/>конфигуратора. <br/>Активируйте моторы, переместив рукоятку газа в положение "ARM", т. е. вправо <br/>вниз, примерно на одну секунду. Если параметры сигналов управления настроены <br/>правильно, на плате контроллера должны загореться светодиоды A и С, в окне <br/>конфигуратора изменит цвет индикатор "ARM", а показания оборотов моторов воз-<br/>растут и будут равны величине, указанной при настройке прошивки в строке <br/>#define MINTHROTTLE xxxx <br/>ПРИМЕЧАНИЕ <br/>Еще одна распространенная ошибка начинающих: смотреть на обороты моторов в ок-<br/>не конфигуратора, когда плата контроллера лежит на столе. Помните, что контрол-<br/>лер — это система с обратной связью, которая старается отработать внешнее возму-<br/>щение, пока оно не будет скомпенсировано. Допустим, плата лежит на столе не иде-<br/>ально ровно. После подачи питания контроллер попытается выровнять ее за счет <br/>неравномерных оборотов моторов. Стоит вам чуть пошевелить плату, и контроллер <br/>будет пытаться вновь исправить ее положение, изменив обороты. Поэтому в "на-<br/>стольных" условиях обороты моторов никогда не будут одинаковыми при нейтральном <br/>положении рукояток пульта. <br/>Поставьте рукоятку газа в среднее положение. Индикаторы оборотов моторов при-<br/>мут положение, близкое к среднему. Переместите правую рукоятку пульта вперед. <br/>Должны увеличиться обороты задних моторов (6)–(3) и уменьшиться передних (2)–<br/>(5). При движении рукоятки назад должна наблюдаться обратная картина. При от-<br/>клонении рукоятки вправо увеличатся обороты левой пары (2)–(6) и уменьшатся <br/>правой (5)–(3). Отклонение влево должно дать обратную картину. Переместите ле-<br/><br/>162 Часть II. Практика <br/>вую рукоятку (YAW) вправо. Должны возрасти обороты диагональной пары (6)–(5) <br/>и уменьшится пары (2)–(3). Отклонение влево должно дать обратный эффект. Если <br/>реакция отличается, проверьте, не инвертированы ли сигналы в каналах радио-<br/>управления. При необходимости включите инверсию нужных каналов в настройках <br/>пульта. <br/>Проверьте реакцию контроллера на переключение тумблеров или вращение регуля-<br/>торов, подключенных к каналам AUX. Если все работает, как ожидалось, контрол-<br/>лер и радиоуправление готовы к испытаниям на коптере. <br/>Первое включение и первый взлет <br/>Первое включение коптера в рабочем режиме должно происходить без пропел- <br/>леров! <br/>Строго запрещается подавать питание от силовой батареи при подключенном  <br/>к компьютеру USB-кабеле. Если нужно работать с интерфейсом конфигуратора, <br/>используйте соединение по Bluetooth, о котором будет сказано далее (см. главу 6). <br/>Смонтируйте контроллер на раму, подключите моторы, приемник и преобразова-<br/>тель питающего напряжения. Не забудьте защитить барометр от воздействия за-<br/>вихрений воздуха и попадания внутрь пыли и прямых солнечных лучей при помо-<br/>щи небольшого кусочка поролона. Включите передатчик, подключите силовую ба-<br/>тарею. Во время загрузки контроллера моторы должны издать непродолжительные <br/>звуковые сигналы и затихнуть. После окончания инициализации контроллера на <br/>нем должен гореть только индикатор питания. Если подключен приемник GPS, то <br/>будет мигать светодиод B. <br/>Активируйте моторы, переместив рукоятку газа до упора вправо вниз. Загорятся <br/>светодиоды A и C на плате контроллера. Если в настройках прошивки заданы холо-<br/>стые обороты моторов при активации, они начнут вращаться с небольшой часто-<br/>той. Моторы должны стартовать строго одновременно. В противном случае повто-<br/>рите процедуру калибровки регуляторов. Еще раз проверьте правильность направ-<br/>лений вращения. <br/>Плавно увеличьте газ примерно на 1/3 рабочего хода. Поднимите коптер в воздух и <br/>наклоните его. При наклоне рамы вперед на 15–20° должны заметно увеличиться <br/>обороты передней пары моторов и уменьшиться задней — контроллер пытается <br/>компенсировать крен. Аналогично должны меняться обороты соответствующих <br/>пар моторов при кренах в другие стороны. При повороте рамы вокруг своей оси  <br/>в горизонтальной плоскости должны меняться обороты диагональных пар моторов. <br/>Взявшись рукой за раму, несколько раз пройдите рукояткой газа от минимума до <br/>максимума и обратно. Вибрация рамы должна быть незначительной и не иметь вы-<br/>раженных низкочастотных резонансов на всем диапазоне оборотов. В противном <br/>случае необходимо провести тщательную балансировку моторов, как было сказано <br/>ранее. <br/>Отключите силовую батарею и установите пропеллеры, тщательно соблюдая на-<br/>правленность вращения. <br/><br/>Глава 5. Сборка и настройка квадрокоптера 163 <br/>Дальнейшие испытания желательно проводить на открытом воздухе или хотя бы на <br/>балконе, в отсутствие детей и домашних животных. Воздержитесь от искушения <br/>совершить первый взлет в центре жилой комнаты. Квадрокоптеры могут быть  <br/>нестабильны на высоте менее 1 м из-за эффекта воздушной подушки и круговых <br/>завихрений в комнате, а при неправильно откалиброванном гироскопе склонны  <br/>к внезапному "соскальзыванию" вбок в момент взлета. Обычно у начинающих пи-<br/>лотов испытания заканчиваются разбитым телевизором или посеченной лопастями <br/>мебелью. Просматривая в Интернете видеоролики с полетами в комнате, имейте <br/>в виду: <br/>� это делают опытные пилоты, неосознанными движениями рукояток компенси-<br/>рующие малейший боковой снос при взлете; <br/>� обычно это не первый взлет проверенных и настроенных коптеров. <br/>В качестве компромисса можно привязать к концам лучей рамы утяжелители в ви-<br/>де гантелей или двухлитровых бутылок с водой шнурками длиной около 70 см. <br/>Можно также воспользоваться советом подвесить коптер на балконе на туго натя-<br/>нутых горизонтально крест-накрест капроновых шнурах, привязанных к концам <br/>лучей. Но такие способы испытаний не очень информативны. <br/>ВНИМАНИЕ! <br/>Дальнейшие испытания потребуют от вас особой аккуратности и осторожности. <br/>Включите питание коптера. Крепко возьмите его одной рукой за нижнюю часть <br/>рамы и поднимите над головой. Второй рукой плавно увеличивайте газ, пока не <br/>ощутите, что тяга винтов скомпенсировала вес коптера и он достиг точки висения. <br/>Засеките положение рукоятки газа на шкале пульта — впоследствии вам понадо-<br/>бится это знать. Коптер должен висеть спокойно и ровно, без подрагиваний и по-<br/>пыток повернуться по курсу. <br/>Попробуйте резко наклонять коптер в стороны. Он должен мгновенно реагировать <br/>ощутимо сильным сопротивлением и выравнивать раму. Выравнивание не должно <br/>сопровождаться рывком в противоположную сторону и/или затухающими колеба-<br/>ниями. Если это происходит, значит, реакция системы стабилизации чрезмерна и <br/>потребуется подстройка параметров PID. Аналогично проверьте реакцию на по-<br/>пытку повернуть раму по курсу. <br/>Если коптер в точке висения ведет себя ровно и предсказуемо, осторожно доведите <br/>газ до максимума, наблюдая за вибрацией рамы и звуком работы моторов. В прин-<br/>ципе, идеальной динамической балансировки добиться невозможно, поэтому всегда <br/>будет присутствовать низкочастотная вибрация рамы на частоте биений — разно-<br/>сти высокочастотных вибраций винтомоторных пар. Главное, чтобы вибрация не <br/>имела выраженных резонансов и коптер не реагировал на вибрацию хаотичным <br/>подергиванием по всем осям. <br/>Моторы при максимальной нагрузке должны продолжать работать с ровным зву-<br/>ком, без щелчков, хрипения или провалов тяги, что может означать пропуск фазы <br/>мотора от механической перегрузки или срабатывание защитной отсечки регулято-<br/>ра от перегрузки по току, либо просадку питания слабой силовой батареи. В этом <br/><br/>164 Часть II. Практика <br/>случае надо попробовать установить пропеллеры меньшего диаметра или с мень-<br/>шим шагом и использовать более мощную батарею. <br/>Когда предполетная проверка проведена и явных неполадок не просматривается, <br/>можно приступать к пробным полетам на открытом воздухе. Установите коптер на <br/>горизонтальной поверхности, подключите силовую батарею и после этого не дви-<br/>гайте коптер. После подачи питания и запуска контроллера начнется процедура ка-<br/>либровки гироскопов, сопровождаемая быстрым миганием светодиодов A и C. <br/>Двигать коптер в этот момент не следует, иначе калибровка сорвется. <br/>В прошивках MultiWii версий от 2.2 и далее предусмотрено обнаружение переме-<br/>щения и повторная калибровка. Эта функция включается раскомментированием <br/>строки <br/>//#define GYROCALIBRATIONFAILSAFE <br/>ПРИМЕЧАНИЕ <br/>Если коптер двигали в процессе калибровки гироскопов, то при взлете он начнет <br/>сильно и непредсказуемо крениться, смещаясь в сторону, и может даже перевернуть-<br/>ся. В этом случае гироскоп нужно перекалибровать при помощи команды рукоятками <br/>управления (см. приложение 3). <br/>Также в прошивке есть строка <br/>#define ONLYARMWHENFLAT <br/>которая не даст активировать моторы, если наклон поверхности, с которой стартует <br/>коптер, слишком велик. <br/>Активировав моторы, плавно увеличьте газ до момента, когда коптер начнет слегка <br/>отрываться от земли. При этом он не должен крениться, дергаться или интенсивно <br/>сползать в сторону. Уверенно увеличьте чуть больше точки висения и дайте копте-<br/>ру подняться на высоту около 2–3 м. Сразу верните газ к точке висения и корректи-<br/>руйте положение коптера правой рукояткой пульта. Обратите внимание, в какую <br/>сторону самопроизвольно смещается коптер при отсутствии ветра. Плавно убавьте <br/>газ и посадите коптер. Повторите взлет и посадку несколько раз. Теперь вы готовы <br/>приступить к триммированию акселерометров. <br/>Триммирование акселерометров <br/>Даже при самой точной калибровке уровня на идеально горизонтальной плоскости <br/>собранный коптер будет слегка смещаться в сторону по множеству причин: разная <br/>тяга моторов, кривизна рамы, смещение центра тяжести, неточный монтаж кон-<br/>троллера на раме и т. д. Но, как вы знаете, пользоваться триммерами пульта катего-<br/>рически не рекомендуется. Поэтому будем триммировать акселерометры средства-<br/>ми самого контроллера. Это нужно делать в безветренную погоду. <br/>Установив, в какую сторону смещается коптер, посадите его и деактивируйте мо-<br/>торы. Рукоятку газа переместите вверх до упора. Правую рукоятку переместите до <br/>упора в сторону, противоположную крену. Если присутствуют крены по двум на-<br/>правлениям, их следует триммировать по очереди. Например, если коптер кренится <br/><br/>Глава 5. Сборка и настройка квадрокоптера 165 <br/>вправо и вперед, переместите рукоятку влево. Контроллер ответит на команду се-<br/>рией вспышек светодиодов А и С, после чего верните рукоятку в нейтраль. Анало-<br/>гично скорректируйте продольный крен смещением рукоятки назад. Одно переме-<br/>щение рукоятки соответствует крену в 0,1°. Обычно предварительное триммирова-<br/>ние выполняют сериями по 3–4 отклонения рукоятки. Затем поднимите коптер  <br/>в воздух и проверьте результат. При необходимости повторите процедуру. Пра-<br/>вильно триммированный коптер при отсутствии ветра висит спокойно и почти не <br/>дрейфует. <br/>Теперь обратим внимание на курсовую устойчивость. Коптер не должен стремить-<br/>ся повернуться вправо или влево. Легкий дрейф курса до 10° в течение нескольких <br/>минут считается нормальным. Стремление к повороту может быть вызвано неточ-<br/>ной геометрией рамы или установкой моторов не строго горизонтально, особенно <br/>на круглых трубчатых лучах, а также неравномерным износом подшипников мото-<br/>ров или затрудненным вращением после аварии. Магнетометр на время проверки <br/>следует выключить, чтобы исключить влияние магнитных наводок. <br/>Итак, мы имеем предварительно настроенный коптер, который достаточно стаби-<br/>лен и пригоден для эксплуатации. Зачастую этим можно ограничиться, т. к. про-<br/>шивка по умолчанию включает в себя подобранные опытным путем усредненные <br/>настройки. Но лучших результатов можно достичь при точной настройке парамет-<br/>ров обратной связи PID. <br/>Настройка PID <br/>Мультикоптер представляет собой классическую стабилизированную систему  <br/>с обратной связью, реагирующую на внешние воздействия с целью компенсировать <br/>их влияние. Прежде всего, стабилизируется положение коптера по горизонтали  <br/>и по курсу. Это обязательный минимум. При наличии соответствующих данных <br/>может также стабилизироваться высота по барометру и позиция по GPS. <br/>Реакция системы на внешнее воздействие определяется тремя компонентами от-<br/>клика: пропорциональным (Proportional), интегральным (Integral) и дифференци-<br/>альным (Differential). Отсюда и пошло сокращение PID. Для более ясного понима-<br/>ния компоненты можно свести в условную зависимость: <br/>F = P ⋅ Sens + I ⋅ Sens – D ⋅ Sens, <br/>STAB<br/>где F — усилие, направленное на возврат коптера в положение стабилизации; <br/>STAB<br/>Sens — данные об угловых ускорениях и кренах, поступающие с сенсоров. Обра- <br/>тите внимание, что D стоит в формуле с отрицательным знаком, это понадобится <br/>далее. <br/>Компонент Proportional определяет степень пропорциональности отклика системы <br/>на воздействие. Функция отклика линейная. Чем больше значение P, тем сильнее <br/>система противодействует внешнему влиянию, возвращая коптер в исходное поло-<br/>жение. Чрезмерная реакция может привести к тому, что коптер проскочит положе-<br/>ние равновесия (перерегулирование). Потребуется возвращать коптер в обратном <br/>направлении. Таким образом, могут возникнуть затухающие колебания (осцилля-<br/><br/>166 Часть II. Практика <br/>ции), а в крайних случаях и незатухающая неуправляемая раскачка. Поэтому пара-<br/>метр P должен быть подобран так, чтобы не возникали осцилляции. <br/>Для более точного и адекватного регулирования желательно, чтобы отклик систе-<br/>мы формировался по более сложному закону, чем линейная зависимость. Напри-<br/>мер, компенсация кратковременного воздействия мимолетного завихрения воздуха <br/>не требует такого же мощного отклика, как при воздействии постоянного сильного <br/>потока ветра. Вблизи точки равновесия желательно уменьшить реакцию, чтобы не <br/>проскочить искомое положение. Поэтому одним лишь параметром P не обойтись. <br/>Integral — период времени, в течение которого накапливаются и усредняются дан-<br/>ные об отклонении от равновесной точки. Позволяет устранять дрейф, возникаю-<br/>щий за счет небольших отклонений от равновесной точки. Дрейф возникает за счет <br/>ошибок в неидеальной системе обратной связи, и реальная система никогда не по-<br/>падает точно "в ноль". Интегральный компонент позволяет накопить ошибку за за-<br/>данный интервал времени и полученную суммарную величину применить для <br/>окончательного выравнивания. При меньшем значении I коптер быстрее заканчива-<br/>ет цикл выравнивания, но с меньшей точностью попадает в ноль и больше подвер-<br/>жен дрейфу. При большем значении коптер выравнивается дольше, но точнее и <br/>меньше подвержен дрейфу. <br/>Differential — зависимость скорости возврата в исходное положение от степени <br/>отклонения. Совершенно логичный алгоритм действия: чем сильнее коптер откло-<br/>нился, тем больше скорость, с которой он начинает возвращаться, а по мере ком-<br/>пенсации отклонения скорость возврата снижается. <br/>ВНИМАНИЕ! <br/>Параметр D в конфигураторе задан положительным числом, но в формуле использу-<br/>ется со знаком "минус". Это часто порождает путаницу и вынуждает делать оговорки. <br/>Оперируя понятиями "меньше" и "больше", мы будем иметь в виду значения, зада-<br/>ваемые в конфигураторе. <br/>Увеличение D приводит к увеличению скорости возврата, усиливает влияние P  <br/>и может привести к появлению осцилляций. Уменьшение D снижает склонность <br/>к осцилляции и влияние P и уменьшает скорость возврата. <br/>Как видите, изменение компонентов I и D изменяет значимость компонента P для <br/>процесса стабилизации. Поэтому настройка PID — это многоэтапный процесс,  <br/>в котором приходится начинать с настройки P, затем настройки I и D, а затем воз-<br/>вращаться к более точной подстройке P и так, возможно, несколько раз. Прошивка <br/>содержит некие более-менее универсальные значения PID, которые позволят вам <br/>совершить достаточно стабильные первые полеты, но в дальнейшем вы обязатель-<br/>но захотите настроить PID под свой коптер и свои предпочтения. <br/>Базовая настройка параметра P <br/>Для настройки рекомендуется использовать подключение к коптеру по Bluetooth, <br/>т. к. придется неоднократно обращаться к настройкам через программу конфигура-<br/>тора. Иначе придется каждый раз отключать/подключать силовую батарею и про-<br/>вод USB. <br/><br/>Глава 5. Сборка и настройка квадрокоптера 167 <br/>Установите в конфигураторе значения PID по умолчанию. Соблюдая осторожность, <br/>крепко возьмите коптер в руку, поднимите над головой и увеличьте газ до состоя-<br/>ния свободного висения. Попробуйте наклонить коптер в любую сторону. Он будет <br/>сопротивляться и стремиться вернуться обратно. Быстро отклоните коптер и по-<br/>звольте ему вернуться в горизонталь. Постепенно увеличивайте значение P для <br/>осей Pitch и Roll до тех пор, пока не почувствуете, что появились затухающие  <br/>осцилляции (коптер слегка проскакивает равновесие, совершая колебание). Прибавку <br/>значения с каждым шагом уменьшайте. После достижения осцилляции уменьшите <br/>значение P на 15–20%. Повторите эту же процедуру для оси Yaw. На этом базовую <br/>настройку P можно считать законченной. Дальнейшую настройку вы будете вы-<br/>полнять в поле, меняя параметры I и D и проверяя результат в полете. <br/>Настройка I и D для плавного стабильного полета <br/>Исходим из того, что базовая настройка P уже проведена. Постепенно уменьшайте <br/>параметр I до момента, когда почувствуете, что появился неприемлемо сильный <br/>дрейф при висении. После этого увеличьте значение примерно на 20%. <br/>Увеличивайте значение D до тех пор, пока не заметите, что стабилизация после <br/>резких отклонений стиков не стала неприемлемо слабой. Затем уменьшите D и по-<br/>пробуйте немного уменьшить P. <br/>Настройка I и D для активного пилотирования и акро <br/>Постепенно уменьшайте параметр I до момента, когда почувствуете, что появился <br/>неприемлемо сильный дрейф при висении. После этого увеличьте значение при-<br/>мерно на 5–10%. Остаточный дрейф не успеет себя проявить при активном пилоти-<br/>ровании. Уменьшайте значение D до тех пор, пока стабилизация после резких  <br/>манипуляций стиками не начнет приводить к опасной раскачке. Затем увеличьте D <br/>до исчезновения чрезмерной раскачки. Теперь можно попробовать немного умень-<br/>шить P. <br/>В целом, настройка PID — это субъективный процесс. Его задача — найти ваш <br/>личный компромисс между стабильностью коптера и комфортом управления. <br/> <br/> <br/><br/>  <br/> <br/> <br/>ГЛАВА 6 <br/> <br/> <br/> <br/>   <br/> <br/>Подключение и настройка  <br/>внешних модулей <br/>Подключение адаптера USB-COM <br/>Как вы уже знаете, на плате полетного контроллера CRIUS AIOP уже есть встроен-<br/>ный адаптер USB-COM. Но вам все равно придется приобрести дополнительно  <br/>автономный адаптер. Он неоднократно потребуется для настройки модулей OSD и <br/>телеметрии, GPS и Bluetooth. Также при помощи этого адаптера вы сможете менять <br/>прошивку большинства модулей OSD. <br/>В продаже доступно большое количество разнообразных адаптеров USB-COM, но <br/>все они построены на базе одного из трех чипов: FTDI (FT232), Prolific (PL2303) <br/>или на ставшем популярным относительно недавно CH340G производства компа-<br/>нии WCH Nanjing QinHeng Electronics. Не рекомендуется приобретать адаптеры на <br/>основе PL2303, т. к. они не оснащены выходом DTR, который используется для <br/>сброса контроллеров Atmel при записи в них прошивки. Вам будет сложно исполь-<br/>зовать такой адаптер для перепрошивки, например, модулей OSD — придется <br/>вручную нажимать кнопку сброса в момент начала записи прошивки. Лучше всего <br/>использовать адаптер на основе оригинального чипа FT232, к нему подойдет драй-<br/>вер, который вы уже установили при первом подключении полетного контроллера <br/>к компьютеру. Компания FTDI сейчас ведет борьбу с производителями дешевых <br/>китайских клонов микросхемы FT232, поэтому при обнаружении поддельной мик-<br/>росхемы работа драйвера может быть блокирована. Для адаптера на основе <br/>CH340G можно скачать драйвер и руководство по установке на сайте http:// <br/>arduino-project.net/driver-ch340g/. <br/>После того как драйвер адаптера будет успешно установлен, проверим работу <br/>адаптера USB-COM в режиме эха. Для этого соедините между собой выводы Tx  <br/>и Rx адаптера. Теперь адаптер будет передавать данные сам себе и по кольцу воз-<br/>вращать их обратно в программу терминала. <br/>Запустите программу Termite и выберите нужный порт, который появился в систе-<br/>ме при подключении адаптера: Settings | Port Configuration | Port. Остальные на-<br/>стройки менять пока не надо, нажмите кнопку OK. Теперь в нижней строке окна <br/>терминала введите любой текст латиницей и нажмите клавишу <Enter>. Текст дол-<br/><br/>Глава 6. Подключение и настройка внешних модулей 169 <br/>жен появиться в окне терминала дважды, как отправленный и принятый. Теперь <br/>адаптер и терминал готовы к использованию. Если эхо не работает, проверьте пра-<br/>вильность настройки номера порта, появляется ли новый порт в списке устройств <br/>компьютера при подключении адаптера, мигают ли на плате адаптера светодиоды <br/>приема-передачи при их наличии. При подключении адаптера к другому порту USB <br/>ему может быть назначен новый номер порта. <br/>Подключение источника питания <br/>Несмотря на кажущуюся простоту, правильному подключению источника питания <br/>к контроллеру CRIUS AIOP v2 следует уделить особое внимание. Иначе вы рискуе-<br/>те столкнуться с непредсказуемым поведением контроллера, зависаниями и сбоями <br/>или испортить его. <br/>ПРИМЕЧАНИЕ <br/>На плате контроллера AIOP версии 2 нет встроенного стабилизатора +5V! Подав на <br/>контроллер напряжение 12 В от силовой батареи, вы сожжете как минимум встроен-<br/>ный стабилизатор +3,3V. <br/>Обратимся к схеме разводки цепей питания на рис. 6.1. Подать питание на кон-<br/>троллер можно тремя способами: через разъем USB (J1), с внешнего источника че-<br/>рез отдельный разъем питания (J2) и с регулятора оборотов через разъем-гребенку <br/>для подключения моторов и сервомашинок (J3). <br/> <br/>Рис. 6.1. Схема цепей питания полетного контроллера <br/><br/>170 Часть II. Практика <br/>Стабилитрон D3 и самовосстанавливающиеся предохранители F1, F2 защищают <br/>контроллер от переполюсовки. Когда к одному из разъемов приложено напряжение <br/>обратной полярности, D3 оказывается включенным в прямом направлении и зако-<br/>рачивает цепь питания, что вызывает срабатывание соответствующего предохрани-<br/>теля. Для полного восстановления проводимости предохранителя после срабатыва-<br/>ния требуется минимум два часа. К сожалению, самовосстанавливающиеся предо-<br/>хранители срабатывают очень медленно, за доли секунды. Стабилитрон D3 <br/>открывается тоже не мгновенно. Поэтому вероятность поломки контроллера при <br/>переполюсовке весьма велика. <br/>Диоды D1 и D2 развязывают питание от USB и с внешних разъемов между собой. <br/>Питающее напряжение с разъемов J2 и J3 не может попасть на разъем USB через <br/>встречно включенный диод D1 и испортить порт компьютера. Но полностью дове-<br/>рять этой защите нельзя. Существует вероятность, что диод D1 будет пробит,  <br/>в этом случае встречное напряжение будет приложено к порту USB вашего компь-<br/>ютера и может вывести хост-контроллер порта из строя. Поэтому одновременного <br/>подключения внешнего питания и порта USB лучше избегать. <br/>ПРИМЕЧАНИЕ <br/>К сожалению, на диодах D1 и D2 падает питающее напряжение. Самовосстанавли-<br/>вающийся предохранитель также обладает сопротивлением 1,5–2 Ом. По измерениям <br/>автора, выполненным на разных платах, суммарное падение напряжения на диоде и <br/>предохранителе под рабочей нагрузкой составляет 0,33–0,35 В. И если подать на кон-<br/>троллер напряжение 5,00 В, то фактически контроллер будет питаться напряжением <br/>4,65 В. При таком напряжении плата контроллера работает неустойчиво и склонна  <br/>к непредсказуемым сбоям прямо в процессе полета. Поэтому напряжение источника <br/>питания должно лежать в пределах 5,2–5,6 В. <br/>Для питания контроллера можно использовать преобразователь напряжения "step-<br/>down" с подстройкой или подобрать номинал постоянных резисторов на плате пре-<br/>образователя. В специализированных источниках питания для коптеров обычно <br/>уже выставлено напряжение с нужным запасом. Если вы хотите использовать про-<br/>стейший линейный стабилизатор на микросхеме 78L05 или аналогичной, то вклю-<br/>чите в разрыв ее "земляного" вывода один-два маломощных кремниевых диода <br/>в прямом направлении, как показано на схеме рис. 6.2. <br/> <br/> <br/>Рис. 6.2. Увеличение выходного напряжения линейного стабилизатора <br/><br/>Глава 6. Подключение и настройка внешних модулей 171 <br/>Если ваш контроллер при питании от порта USB нестабильно работает, выдает <br/>странные показания датчиков в программу конфигурации или зависает, то можно <br/>попробовать закоротить перемычкой из тонкого провода диод D1, как показано на <br/>рис. 6.3. Это следует делать, только если вы четко понимаете, что и зачем делаете, <br/>и имеете достаточный опыт пайки миниатюрных SMD-компонентов! После такой <br/>переделки порт вашего компьютера останется без защиты от случайной подачи <br/>встречного напряжения с регуляторов или через разъем внешнего питания J2. Нуж-<br/>но будет особенно тщательно следить за тем, чтобы случайно не подключить одно-<br/>временно питание от батареи и порт USB. <br/> <br/>Рис. 6.3. Закорачивание развязывающего диода D1 в цепи питания от порта USB <br/>Подключение звукоизлучателя <br/>Звукоизлучатели (beeper, buzzler) могут быть пассивными либо активными. Актив-<br/>ные звукоизлучатели содержат собственно пассивный звукоизлучающий элемент и <br/>встроенный генератор звуковой частоты, который начинает работать при подаче <br/>питающего напряжения либо разрешающего логического уровня на управляющий <br/>вход. В авиамоделизме чаще всего применяются малогабаритные магнитодинами-<br/>ческие излучатели, состоящие из мощного редкоземельного магнита, катушки и <br/>металлической мембранки. Иногда встречаются пьезоэлектрические звукоизлуча-<br/>тели, но обычно они менее эффективны: имеют меньшую громкость и требуют для <br/>работы большего напряжения, поэтому используются реже. <br/>ПРИМЕЧАНИЕ <br/>Пассивные звукоизлучатели категорически запрещается подключать напрямую к вы-<br/>ходу микроконтроллера, т. к. это может привести к перегрузке выхода по току и выходу <br/>контроллера из строя. <br/><br/>172 Часть II. Практика <br/>Оптимальным решением является использование готового активного звукоизлуча-<br/>теля, например, такого, как на рис. 3.15. Они стоят очень недорого, содержат встро-<br/>енный генератор и транзисторный ключ, вход для управления логическим уровнем <br/>контроллера. <br/>Имейте в виду, что звукоизлучатели разных типов могут иметь одинаковый корпус, <br/>поэтому однозначно отличить активный излучатель от пассивного можно не всегда. <br/>Кроме того, вам могут встретиться активные излучатели, рассчитанные на 12 В. <br/>Прежде, чем подключать излучатель к контроллеру, подайте на его выводы пи-<br/>тающее напряжение +5 В. Если он будет издавать звук достаточной громкости  <br/>с частотой 1000 Гц, то все в порядке. Иначе придется искать другой бипер или де-<br/>лать простейшую схему звукового генератора. Контроллер генерирует только <br/>управляющий сигнал "вкл/выкл". <br/>Простейший ключ для управления бипером можно сделать на основе биполярного <br/>или полевого транзистора, как показано на схеме рис. 6.4. Подойдет любой мало-<br/>мощный биполярный n-p-n-транзистор или полевой N-канальный, затвор которого <br/>управляется логическими уровнями. Такие транзисторы еще называют "цифро- <br/>выми". <br/> <br/>а б <br/>Рис. 6.4. Ключ на биполярном (а) и полевом (б) транзисторе <br/>Для активации функции бипера надо раскомментировать строку <br/>#define BUZZER <br/>После этого в интерфейсе конфигуратора появится опция BEEPER и можно будет <br/>назначить включение звукового сигнала на один из переключателей AUX. Если  <br/>хотите, чтобы коптер коротким звуковым сигналом реагировал на изменение  <br/>режимов, раскомментируйте строку <br/>#define RCOPTIONSBEEP <br/>По умолчанию вход бипера подключается к цифровому выходу D32 на плате кон-<br/>троллера. К сожалению, во второй версии платы Crius AIOP это не штыревой разъ-<br/><br/>Глава 6. Подключение и настройка внешних модулей 173 <br/>ем, а контактная площадка на плате (рис. 6.5). Рядом расположены площадки не-<br/>скольких других дополнительных выводов. Крайне неудобное и опасное решение: <br/>эти площадки отслаиваются после перегрева при пайке, их можно легко оторвать, <br/>неосторожно дернув за провод. Эстетизма конструкции и удобства при эксплуата-<br/>ции торчащие из платы провода тоже не добавляют. <br/> <br/>Рис. 6.5. Дополнительные цифровые выходы (D32–D37) контроллера <br/>Поэтому желательно перенести выход бипера на один из свободных цифровых вы-<br/>ходов, снабженных штыревым разъемом. Например, если вы не планируете исполь-<br/>зовать выход D46 для управления затвором фотокамеры, то для переноса выхода <br/>бипера на вывод D46 найдите в прошивке строки <br/>//#define OVERRIDE_BUZZERPIN_PINMODE   pinMode (A2, OUTPUT); <br/>//#define OVERRIDE_BUZZERPIN_ON        PORTC |= 1<<2; <br/>//#define OVERRIDE_BUZZERPIN_OFF       PORTC &= ~(1<<2); <br/>Раскомментируйте их и замените аргументы определений следующими значениями: <br/>#define OVERRIDE_BUZZERPIN_PINMODE   pinMode (46, OUTPUT); <br/>#define OVERRIDE_BUZZERPIN_ON        PORTL |= 1<<3; <br/>#define OVERRIDE_BUZZERPIN_OFF       PORTL &= ~(1<<3); <br/>Подключать бипер к выводу D46 удобно, т. к. в штатном режиме на гребенке разъ-<br/>ема присутствует питающее напряжение +5 В и бипер можно подключить стан-<br/>дартным трехжильным проводом от сервомашинки. <br/>Подключение ультразвукового сонара <br/>Ультразвуковой сонар хорошо подходит для автоматического включения посадоч-<br/>ных огней (фонарей подсветки посадочной площадки) в темное время суток, по-<br/>скольку огни нужно включать на высоте менее 3 м. Это именно та дистанция, на <br/>которой обычный модуль сонара начинает достаточно точно и стабильно работать. <br/>Такой способ управлять включением огней не является расточительным, т. к. моду-<br/>ли сонаров HC-SR04 (рис. 6.6) стоят в Китае менее двухсот рублей. Эти сонары ис-<br/>пользуются во множестве любительских проектов и продаются, как аксессуар для <br/>Arduino. <br/><br/>174 Часть II. Практика <br/> <br/>Рис. 6.6. Ультразвуковой сонар HC-SR04 <br/>К сожалению, поддержка сонаров SR04 не реализована в прошивке MultiWii 2.3, <br/>поэтому для использования сонара можно воспользоваться прошивкой MahoWii <br/>RC3. Для включения сонара раскомментируйте в прошивке строку <br/>//#define SONAR_GENERIC_ECHOPULSE <br/>Далее обратите внимание на строки <br/>#define SONAR_PING 12   // D12 PIN that trigger measure <br/>#define SONAR_READ 11   // D11 PIN to read response pulse <br/>//#define SONAR_PING 9  // D9 PIN that trigger measure <br/>//#define SONAR_READ 10 // D10 PIN to read response pulse <br/>Здесь определяется, к каким выводам платы будет подключаться сонар. В нашем <br/>случае вывод сонара TRIG подключается к выводу D12 полетного контроллера, а <br/>вывод сонара ECHO — к выводу D11 полетного контроллера. Эти выводы распо-<br/>ложены в гребенке для подключения регуляторов оборотов. На эту гребенку также <br/>выведено напряжение питания, поэтому сонар можно запитать прямо от этого  <br/>разъема. Рекомендуется использовать именно эти выводы, т. к. выводы D9 и D10 <br/>понадобятся нам для управления подсветкой. <br/>Имейте в виду, что при питании от USB из-за развязывающих диодов D1 и D2  <br/>(см. рис. 6.1) напряжение питания не будет поступать на гребенку J3. Чтобы  <br/>сонар начал работать, питание должно поступать на плату через разъем J2 или от <br/>встроенного стабилизатора регулятора оборотов. <br/>В процессе измерения полетный контроллер генерирует пусковой импульс на вы-<br/>воде SONAR_PING и ждет ответный импульс на входе SONAR_READ. Работаю-<br/>щий сонар издает едва различимые щелчки с частотой несколько герц. <br/>Наличие сонара может помочь стабилизировать высоту полета на малой высоте 1–<br/>3 м, когда барометр работает плохо. Для настройки в прошивке MahoWii предна-<br/>значены две строки: <br/>#define SONAR_MAX_DISTANCE 300 <br/>#define SONAR_ERROR_MAX 10 <br/><br/>Глава 6. Подключение и настройка внешних модулей 175 <br/>Первая строка определяет максимальную высоту в сантиметрах, когда показания <br/>сонара еще принимаются во внимание при удержании высоты. Как показывает <br/>практика, китайские сонары редко работают на расстоянии более 3 м. Вторая стро-<br/>ка определяет максимальное количество ошибок измерения, после превышения ко-<br/>торого показания сонара считаются недостоверными и происходит переключение <br/>на барометр. <br/>Периодически в продаже встречаются бракованные сонары, страдающие большой <br/>погрешностью, либо вовсе неисправные. Поэтому при заказе в Китае желательно <br/>приобрести два-три экземпляра и тщательно проверить их работоспособность. Для <br/>проверки необходимо, чтобы на сонар поступало питающее напряжение при под-<br/>ключении по USB. Плюсовой провод питания сонара временно подключите  <br/>к штырьку "+" платы контроллера, слева от вывода "PPM". После записи прошивки, <br/>в которой включен сонар, он должен начать издавать быстрые щелчки. <br/>Запустите конфигуратор MultiWii WinGUI. В перечне подключенных сенсоров <br/>должен появиться сонар. Попробуйте направлять сонар на стены и потолок. В стро-<br/>ке ALT интерфейса должна отображаться текущая дистанция до отражающей по-<br/>верхности с погрешностью не более 2–3 см. Если значение дистанции периодиче-<br/>ски непредсказуемо меняется или имеет слишком большую погрешность, сонар <br/>лучше заменить. <br/>Подключение светодиодной подсветки <br/>Светодиоды используются для подсветки рамы коптера либо посадочной площадки <br/>при полетах в ночное время. Возможность управления светодиодами предусмотре-<br/>на в прошивке. Для коммутации светодиодов понадобится изготовить простейший <br/>ключ на одном транзисторе, аналогичный ключу для коммутации звукоизлучателя. <br/>Но перед тем как начать изготовление коммутатора и подсветки, нам потребуется <br/>сделать некоторые расчеты. <br/>ПРИМЕЧАНИЕ <br/>Светодиод — довольно капризный элемент схемы. Он рассчитан на строго опреде-<br/>ленный рабочий ток, протекающий через кристалл. Превышение этого тока приводит  <br/>к перегреву кристалла и его быстрой деградации, что выражается в снижении яркости. <br/>Главным параметром режима светодиода является именно рабочий ток, протекаю-<br/>щий через кристалл, а не напряжение питания, подаваемое на схему. Дело в том, <br/>что в рабочем режиме падение напряжения на p-n-переходе светодиода почти не <br/>меняется при изменении питающего напряжения. Меняется только ток, протекаю-<br/>щий через светодиод, и он легко может быть превышен при колебаниях напряже-<br/>ния. Поэтому в светодиодных светильниках используются специальные схемы-<br/>драйверы, стабилизирующие ток, а не напряжение. Но для наших целей вполне <br/>достаточно использовать ограничивающие ток резисторы, поскольку напряжение <br/>питания меняется в небольших пределах. <br/>Падение напряжения на светодиоде зависит от цвета свечения и конкретной марки <br/>светодиода. Ориентировочные значения для расчета схем приведены в табл. 6.1. <br/><br/>176 Часть II. Практика <br/>Таблица 6.1. Значения для расчета схем <br/>Цвет Длина волны, нм Падение напряжения, В <br/>Инфракрасный От 760 До 1,9 <br/>Красный 610–760 1,60–2,03 <br/>Оранжевый 590–610 2,03–2,10 <br/>Желтый 570–590 2,10–2,20 <br/>Зеленый 500–570 2,20–3,50 <br/>Синий 450–500 2,50–3,70 <br/>Фиолетовый 400–450 2,80–4,00 <br/>Ультрафиолетовый До 400 3,10–4,40 <br/>Белый  3,00–3,70 <br/> <br/>Как следует из табл. 6.1, разброс падений напряжения может быть довольно суще-<br/>ственным даже внутри одной цветовой группы, особенно для популярных синих <br/>светодиодов. Разброс напряжений между цветовыми группами еще больше. Поэто-<br/>му если нет возможности получить точные данные из спецификации конкретной <br/>марки светодиодов, то лучше измерить падение напряжения самостоятельно, чтобы <br/>рассчитать схему наиболее точно и использовать светодиоды более эффективно. <br/>Рабочий ток светодиодов зависит от паспортной мощности, и здесь желательно все <br/>же использовать паспортные данные, хотя бы для аналогичных светодиодов. Мож-<br/>но измерить рабочий ток и напряжение ваших светодиодов при помощи простей-<br/>шей схемы, состоящей из переменного резистора номиналом 680 Ом, миллиампер-<br/>метра и вольтметра (рис. 6.7). <br/> <br/> <br/>Рис. 6.7. Измерение параметров светодиода <br/>Вместо двух измерительных приборов можно использовать один мультиметр, по-<br/>очередно включая его в разрыв цепи для контроля тока и параллельно светодиоду <br/>для измерения напряжения. Установите движок переменного резистора в положе-<br/>ние максимального сопротивления (по нашей схеме — вправо) и подайте питание. <br/><br/>Глава 6. Подключение и настройка внешних модулей 177 <br/>Постепенно уменьшая сопротивление, следите за напряжением на светодиоде. Сна-<br/>чала оно будет нарастать пропорционально углу поворота резистора, а светодиод <br/>будет светиться все ярче. Но в какой-то момент напряжение почти перестанет на-<br/>растать при уменьшении сопротивления. Это будет означать, что светодиод вошел <br/>в рабочий режим. Верните движок переменного резистора на 1–2 градуса обратно. <br/>Напряжение на светодиоде будет соответствовать предельному рабочему напряже-<br/>нию светодиода, а ток в цепи — предельному рабочему току. Для постоянной экс-<br/>плуатации эти значения желательно уменьшить на 10%, чтобы продлить срок <br/>службы светодиодов. <br/>Для обычных массовых светодиодов с линзой диаметром 5 мм и белым или синим <br/>цветом свечения рабочим напряжением принято считать 3 В, а рабочий ток — по-<br/>рядка 12–15 мА. Для красных светодиодов аналогичной мощности рабочим напря-<br/>жением считается 2 В при том же токе. Таким образом, номинал токоограничи-<br/>тельного резистора в цепи будет зависеть от цвета применяемых светодиодов. <br/>Итак, рассчитаем номинал гасящего резистора для линейки из последовательно <br/>включенных светодиодов (рис. 6.8). На готовых светодиодных лентах может при-<br/>меняться отдельный резистор для каждого светодиода или пары светодиодов, но в <br/>самодельной подсветке мы используем один резистор для линейки из 3–4 свето-<br/>диодов, так проще. Напряжение максимально заряженной литий-ионной батареи <br/>может достигать 4,2 ⋅ 3 = 12,6 В. Но это напряжение под нагрузкой быстро снижа-<br/>ется до рабочего 3,72 ⋅ 3 = 11,16 В, поэтому при расчетах мы будем использовать <br/>усредненное значение 12 В. <br/>Если взять светодиоды с падением напряжения ровно 3 В, то можно соединить по-<br/>следовательно 4 светодиода и вообще не использовать гасящий резистор. Но это не <br/>самое удачное решение, т. к. при случайном превышении напряжения питания ни-<br/>чем не ограниченный ток через светодиоды может нарастать нелинейно, что выве-<br/>дет из строя либо сами светодиоды, либо ключевой транзистор. <br/> <br/>Рис. 6.8. Линейка последовательно включенных светодиодов <br/>Допустим, у нас есть синие светодиоды с рабочим падением напряжения 3,25 В  <br/>и рабочим током 18 мА. На трех последовательно соединенных диодах падает на-<br/>пряжение 3,25 ⋅ 3=9,75 В. Следовательно, на резисторе должно падать напряжение <br/>12 – 9,75 = 2,25 В. По закону Ома <br/>R = U/I, <br/>–3<br/>следовательно, R = 12/18 ⋅ 10 ≈ 670 Ом. Для светодиодов другого цвета или с дру-<br/>гим рабочим током расчет сопротивления надо повторить. <br/>Окончательная схема коммутатора, управляющего несколькими линейками свето-<br/>диодов, показана на рис. 6.9. Количество линеек зависит от конструкции вашей <br/><br/>178 Часть II. Практика <br/>подсветки. Разумеется, при использовании готовых светодиодных полос они про-<br/>сто подключаются вместо линеек, без гасящих резисторов. Ключевой транзистор <br/>может быть любым подходящим по суммарному рабочему току. При использова-<br/>нии мощных светодиодов рекомендуется применять полевые MOSFET-транзис-<br/>торы, управляемые логическим уровнем TTL на затворе, с низким внутренним  <br/>сопротивлением, чтобы избежать их нагрева и потерь энергии. Например, можно <br/>использовать применяемые в материнских платах компьютеров ключевые N-ка-<br/>нальные транзисторы SSM9915H (AP9915H) или IRL3803. Для управления мало-<br/>мощными светодиодами можно применить обычный биполярный n-p-n-транзистор, <br/>например C945. <br/> <br/>Рис. 6.9. Схема коммутатора для управления светодиодами <br/>Теперь внесем необходимые изменения в исходный код прошивки. Найдите и рас-<br/>комментируйте следующие строки: <br/>#define LED_FLASHER <br/>#define LED_FLASHER_DDR DDRB <br/>#define LED_FLASHER_PORT PORTB <br/>#define LED_FLASHER_BIT PORTB4 <br/>Первая строка активирует функцию управления подсветкой. Следующие три стро-<br/>ки назначают порт микроконтроллера и конкретный вывод порта, к которому мы <br/>будем подключать коммутатор. В данном случае изменения не потребуются, т. к. <br/>вывод назначен на линию 4 порта B, а это вывод D10 на плате полетного контрол-<br/>лера CRIOUS AIOP, расположенный на гребенке для подключения регуляторов. <br/>Поэтому коммутатор подсветки можно подключить обычным трехжильным прово-<br/>дом для сервомашинок. Напомним, что к выводам D11 и D12 у нас подключен со-<br/>нар, а к выводу D46 — бипер. <br/><br/>Глава 6. Подключение и настройка внешних модулей 179 <br/>Строка //#define LED_FLASHER_INVERT инвертирует выходной сигнал. <br/>Следующие строки определяют свечение светодиодов в различных режимах: <br/>#define LED_FLASHER_SEQUENCE       0b00000000 <br/>#define LED_FLASHER_SEQUENCE_ARMED 0b00000101 <br/>#define LED_FLASHER_SEQUENCE_MAX   0b11111111 <br/>#define LED_FLASHER_SEQUENCE_LOW   0b00000000 <br/>В каждой строке присутствует восьмибитное двоичное число. Это последователь-<br/>ность вспышек светодиода. Последовательность циклически повторяется. Ноль  <br/>соответствует погашенному светодиоду, единица — включенному. Длительность <br/>одной вспышки 0,125 с, полный цикл 8 ⋅ 0,125 = 1 секунда. <br/>Например, последовательность 0b00000101 означает, что светодиод дает две корот-<br/>кие вспышки длительностью 0,125 с циклически раз в секунду. Последовательность <br/>0b11111111 соответствует постоянно горящему светодиоду, а 0b00000000 — пол- <br/>ностью погашенному. Вы можете задавать произвольную последовательность для <br/>любого режима. <br/>Первая строка соответствует режиму DISARMED (питание подано, моторы не ак-<br/>тивны). По умолчанию подсветка погашена. Изменив последовательность на <br/>0b00000001, можно заставить подсветку вспыхивать раз в секунду, напоминая, что <br/>питание подключено. В режиме ARMED светодиод по умолчанию вспыхивает <br/>дважды. <br/>После активации функции подсветки в панели конфигуратора становятся доступны <br/>для настройки еще два параметра, LEDMAX и LEDLOW, которыми можно управ-<br/>лять при помощи переключателей AUX. Разумеется, эти режимы взаимно противо-<br/>положные и не должны включаться одновременно. Но их можно включать парал-<br/>лельно с другими режимами и задать произвольные последовательности мигания, <br/>изменив последовательность двоичных битов. <br/> <br/> <br/>Подключение посадочных огней <br/>Посадочные огни предназначены для подсветки посадочной площадки при полетах <br/>в темное время суток. Обычно они представляют собой несколько мощных белых <br/>светодиодов, направленных вертикально вниз. Схема коммутатора для их включе-<br/>ния и порядок расчета режима светодиодов идентичны описанным выше. <br/>По умолчанию в прошивке для управления посадочными огнями назначен вывод 37 <br/>в виде контактной площадки на печатной плате. Для удобства подключения комму-<br/>татора мы переназначим выход на вывод D9 на штыревой гребенке. Найдите в тек-<br/>сте прошивки строки <br/>//#define LANDING_LIGHTS_DDR DDRC <br/>//#define LANDING_LIGHTS_PORT PORTC <br/>//#define LANDING_LIGHTS_BIT PORTC0 <br/><br/>180 Часть II. Практика <br/>Раскомментируйте их и внесите следующие изменения: <br/>#define LANDING_LIGHTS_DDR DDRH <br/>#define LANDING_LIGHTS_PORT PORTH <br/>#define LANDING_LIGHTS_BIT PORTH6 <br/>После активации этих строк в интерфейсе конфигуратора MultiWii WinGUI появля-<br/>ется опция LLIGHTS, позволяющая включать посадочные огни любым тумблером <br/>AUX. Поскольку каналов AUX мало, можно сделать включение посадочных огней <br/>инверсным по отношению к режиму удержания высоты BARO (ALTHOLD). Когда <br/>коптер взлетает или садится, режим удержания высоты отключен и горят посадоч-<br/>ные огни. <br/>Подключение приемника по шине S-BUS <br/>Для подключения выхода приемника S-BUS ко входу RX1 порта SERIAL1 необхо-<br/>димо изготовить простейший инвертор сигнала на одном n-p-n-транзисторе. Это <br/>может быть любой маломощный n-p-n-транзистор, например самый распростра-<br/>ненный C945 или BC337. Компоненты схемы (рис. 6.10) можно не монтировать на <br/>плате, а спаять детали вывод к выводу и поместить их в термоусадочную трубку. <br/>Питание на инвертор подается с разъема приемника или контроллера. <br/> <br/>Рис. 6.10. Схема инвертора сигнала для подключения приемника по S-BUS <br/>В файле конфигурации прошивки найдите секцию SBUS RECEIVER и раскомменти-<br/>руйте строки <br/>#define SBUS <br/>#define SBUS_SERIAL_PORT 1 <br/>#define SBUS_MID_OFFSET 988 <br/>Последняя строка потребуется, если значение среднего положения в сигнале с вы-<br/>хода приемника отличается от стандартного. <br/>К сожалению, поскольку формат сигнала S.BUS Futaba является предметом автор-<br/>ского права, производителям других приемников приходится использовать "фута-<br/><br/>Глава 6. Подключение и настройка внешних модулей 181 <br/>боподобные" форматы сигнала, которые не полностью соответствуют специфика-<br/>ции Futaba. В прошивку MultiWii 2.3 внесены существенные изменения и дополне-<br/>ния, но по-прежнему нет гарантии, что полетный контроллер сможет декодировать <br/>сигнал вашего приемника, если это не приемник Futaba. В крайнем случае, придет-<br/>ся прибегнуть к обычному способу подключения. <br/>Подключение и настройка адаптера Bluetooth <br/>Новый модуль Bluetooth нужно проверить и настроить до подключения к полет- <br/>ному контроллеру. Несмотря на кажущуюся простоту, настройка часто вызывает <br/>затруднения даже у опытных пользователей, поэтому разберем ее подробнее. <br/>Подключите модуль Bluetooth к адаптеру USB-COM. Обратите внимание, что ли-<br/>нии данных надо подключать перекрестно: Tx → Rx, Rx → Tx. Питание на модуль <br/>также подайте с разъема адаптера. <br/>Большинство модулей Bluetooth для конфигурирования необходимо перевести  <br/>в служебный режим (режим модема, AT-mode). В этом режиме модуль перестает <br/>работать по радиоканалу и готов принимать команды через последовательный <br/>порт. Некоторые модификации модулей не требуют перевода в служебный режим и <br/>всегда готовы к приему команд. Скорость обмена данными с терминалом должна <br/>совпадать с ранее установленной в настройках модуля. По умолчанию, с фабрики, <br/>модули обычно настроены на скорость 9600 бод. Но иногда встречаются модули, <br/>настроенные на другую скорость. Заказав модуль в интернет-магазине, вы не може-<br/>те быть абсолютно уверены, какую версию модуля получите. Поэтому обычно при-<br/>ходится действовать методом проб и ошибок. <br/>Наиболее распространенными и часто покупаемыми являются модули HC-06 и <br/>HC-05. Они состоят из двух микросхем (рис. 6.11), одна из них — собственно сам <br/>трансивер Bluetooth, а вторая — это микросхема памяти. Визуально они неразли-<br/>чимы, т. к. аппаратная часть у них одинаковая, отличается только прошивка. HC-06 <br/>может работать только в режиме slave (ведомый), т. е. только отвечать на приказ <br/>установить связь, поступающий от старшего ведущего устройства — компьютера <br/>или смартфона, и имеет очень ограниченную систему команд. Модуль HC-05 мо-<br/>жет работать как в режиме master (ведущий), так и в режиме slave. Система команд <br/>этого модуля намного обширнее и отличается по синтаксису от HC-06. Также отли-<br/>чается и процедура перевода модуля в режим настройки. Если модули нужны вам <br/>только для связи с коптером, постарайтесь приобрести именно HC-06. <br/>ПРИМЕЧАНИЕ <br/>Для связи с коптером нам нужен только режим ведомого, slave. Не покупайте модули  <br/>с индексом "М" в названии (HC-06-M, HC-07-M). Это модули, которые на заводе жестко <br/>запрограммировали в прошивке в режим master. Для смены режима потребуется дос-<br/>таточно хлопотная процедура замены прошивки, программатор, работающий через <br/>аппаратный LPT-порт, и специальные программы. <br/>В последнее время встречаются более новые модули HC-07, состоящие из одной <br/>микросхемы, объединяющей в себе процессор и память. Функционально модули  <br/> <br/><br/>182 Часть II. Практика <br/> <br/>Рис. 6.11. Два варианта расположения управляющего входа KEY <br/>HC-07 полностью совместимы с HC-06, поэтому все, что касается системы  <br/>команд и настройки HC-06, применимо и к HC-07. Существуют и более экзотиче-<br/>ские, с точки зрения массовых продаж, модули: HC-08 и HC-09. Они встречаются <br/>редко, стоят дороже и никакого практического смысла для наших задач в них нет. <br/>Для удобства использования модули обычно припаивают на плату расширения, со-<br/>держащую стабилизатор питания 3,3 В, один или два светодиода индикации режи-<br/>ма и разъем. Если вы приобрели только модуль, плату расширения можно докупить <br/>отдельно или сделать самому. Не забудьте поставить на плату стабилизатор 3,3 В! <br/>Настройка модулей HC-06 и HC-07 <br/>Итак, изначально мы предполагаем, что в наших руках модуль HC-06 (07). Если  <br/>у него новая версия прошивки Linvor1.8, то для перевода в режим приема AT-команд <br/>не потребуется соединять вывод KEY(26) (см. рис. 6.11) с напряжением питания <br/>+3,3 В. <br/>Для настройки мы будем использовать программу терминала Termite 3.0. Откройте <br/>окно настроек терминала кнопкой Settings (рис. 6.12). В группе параметров Port <br/>configuration выберите нужный порт и укажите скорость 9600. Больше ничего <br/>здесь не меняйте. В группе параметров Transmitted text установите переключатель <br/>Append nothing и флажок Local echo. Остальные настройки менять не надо, на-<br/>жмите кнопку OK. <br/>В строку ввода введите заглавными латинскими буквами AT и нажмите клавишу <br/><Enter>. Если скорость совпадает и модуль готов к приему AT-команд, он ответит <br/>OK. Если ответа нет, попробуйте задать скорость обмена 115200. Если ответа по-<br/>прежнему нет, попробуйте по порядку перебрать все доступные варианты скорости. <br/><br/>Глава 6. Подключение и настройка внешних модулей 183 <br/>Если же и это не помогло, следует отключить питание, перевести модуль в режим <br/>модема, соединив вывод (26) с выводом (12), и включить питание. Теперь снова <br/>попробуйте получить ответ на команду АТ на скорости 9600 или 115200. <br/> <br/>Рис. 6.12. Окно настройки терминала <br/>Когда модуль ответит, можно приступать к конфигурированию. Перечень команд <br/>приведен в табл. 6.2. <br/>Таблица 6.2. Базовый перечень команд настройки модулей Bluetooth HC-06 <br/>Команда Ответ Описание <br/>AT OK Проверка отклика <br/>AT+VERSION OKlinvorV1.8 Запрос версии прошивки <br/>AT+NAME**** OKsetname Установить имя **** <br/>AT+PIN1234 OKsetPIN Установить пин-код 1234 <br/>AT+BAUD1 OK1200 Установить скорость 1200 <br/>AT+BAUD2 OK2400 Установить скорость 2400 <br/>AT+BAUD3 OK4800 ---//--- 4800 <br/>AT+BAUD4 OK9600 ---//--- 9600 <br/>AT+BAUD5 OK19200 ---//--- 19200 <br/>AT+BAUD6 OK38400 ---//--- 38400 <br/>AT+BAUD7 OK57600 ---//--- 57600 <br/>AT+BAUD8 OK115200 ---//--- 115200 <br/>AT+BAUD9 OK230400 ---//--- 230400 <br/>AT+BAUDA OK460800 ---//--- 460800 <br/>AT+BAUDB OK921600 ---//--- 921600 <br/>AT+BAUDC OK1382400 ---//--- 1382400 <br/><br/>184 Часть II. Практика <br/>Рекомендуем задать интуитивно понятное имя, которое будет отображаться на <br/>смартфоне или компьютере при установлении связи и выборе устройства. Напри-<br/>мер, можно назвать модуль COPTER или QUADRO. Командой AT+PIN задайте пин-<br/>код (пароль) к вашему модулю. Злые хакеры вряд ли попытаются перехватить <br/>управление вашим коптером в полете, поэтому пин-код должен легко запоминать-<br/>ся. И, наконец, задайте скорость обмена данными в радиоканале. По умолчанию в <br/>прошивке MultiWii принята скорость 115 200, это максимально допустимое значе-<br/>ние. Если вы хотите задать другую скорость обмена, укажите ее не только в на-<br/>стройках Bluetooth, но и в прошивке, в строке <br/>#define SERIAL0_COM_SPEED 115200 <br/>а также в настройках конфигураторов MultiWiiConf и MultiWii WinGUI. Как только <br/>вы измените скорость модуля, он перестанет отвечать на старой скорости, и нужно <br/>будет изменить скорость в настройках терминала. Убедившись, что модуль отвеча-<br/>ет на новой скорости, можно отключить питание модуля, убрать перемычку между <br/>выводами (26) и (12), и снова включить питание. Теперь модуль готов к привязке <br/>с мобильным устройством или компьютером. <br/> <br/>Настройка модулей HC-05 <br/>Для перевода модуля HC-05 в режим настройки необходимо соединить вывод (34)  <br/>с выводом (12) и подать питание (см. рис. 6.11). В режиме настройки модуль всегда <br/>будет доступен на скорости 38 400 бод независимо от того, какая скорость была <br/>задана ранее для рабочего режима. <br/>В настройках терминала надо выбрать порт USB-COM адаптера, скорость 38400  <br/>и опцию Append CR-LF. Остальные настройки не меняем. Если вам продали дей-<br/>ствительно модуль HC-05 и он правильно подключен, то он обязательно должен <br/>ответить OK на команду АТ. <br/>Задайте имя модуля командой AT+NAME=<name>, где в треугольных скобках введите <br/>нужное вам имя. Проверить, как оно записалось, можно командой AT+NAME?. <br/>Задайте пин-код для доступа командой AT+PSWD=<1234>, где в треугольных скобках <br/>введите нужный пин-код. Проверить пин-код можно командой AT+PSWD?. <br/>Проверьте рабочую скорость командой AT+UART?. Если задана неправильная ско-<br/>рость, смените ее командой AT+UART=<bodrate>,<stopbit>,<paritybit>, где в первых <br/>скобках скорость из стандартного ряда: 4800, 9600, 19200, 38400, 57600, 115200. Более <br/>высокие скорости доступны в модуле, но нам не потребуются. Остальные два  <br/>параметра в нашем случае обязательно нулевые. Например, команда <br/>AT+UART=115200,0,0 задаст рабочую скорость 115 200 бод. <br/>Модуль HC-05 может работать в режиме ведущего (master), т. е. инициировать  <br/>соединение со своей стороны. Но нам нужен модуль, который работает в режиме <br/>ведомого (slave), т. е. устанавливает связь по внешнему запросу ведущего. Поэтому <br/>командой AT+ROLE=0 его надо перевести в режим ведомого. <br/><br/>Глава 6. Подключение и настройка внешних модулей 185 <br/>Установка связи модуля с компьютером <br/>Теперь подключим модуль Bluetooth к контроллеру и свяжем его с компьютером. <br/>Модуль подключается к разъему, обозначенному на плате, как "SERIAL0". Имейте <br/>в виду, что подключение по USB и Bluetooth не могут работать одновременно, т. к. <br/>используют один и тот же аппаратный порт контроллера. Для соединения по USB <br/>нужно отключить разъем Bluetooth и наоборот. <br/>Ноутбуки оснащены встроенным Bluetooth, а для настольного компьютера нужно <br/>приобрести внешний USB-адаптер и установить для него драйвер в соответствии  <br/>с прилагаемой инструкцией. На компьютере под управлением Windows 7 нажмите <br/>кнопку Пуск и последовательно выберите команды Устройства и принтеры | До-<br/>бавление устройства. Начнется поиск доступных беспроводных устройств. Могут <br/>быть найдены самые разные устройства в радиусе доступности, включая телефоны <br/>и компьютеры ваших соседей. Примерно через 10–15 c вы увидите в списке уст-<br/>ройство Bluetooth, которое называется, как ваш модуль квадрокоптера. Щелкните <br/>на нем дважды, выберите Ввести код образования пары и введите пин-код моду-<br/>ля. Устройство с именем вашего коптера появится в списке устройств Windows  <br/>и начнется установка драйверов последовательного порта Bluetooth. После этого  <br/>в окне диспетчера устройств появится новый порт либо два порта (рис. 6.13). <br/>Обычно первый это служебный порт адаптера Bluetooth в компьютере, а второй <br/>соответствует виртуальному порту квадрокоптера. Теперь вы можете подключать <br/>программы конфигуратора по беспроводному каналу точно так же, как по проводу. <br/>Связывание с мобильным телефоном или планшетом под управлением Android <br/>производится в соответствии с меню конкретного мобильного устройства. <br/> <br/> <br/>Рис. 6.13. Виртуальные порты Bluetooth <br/><br/>186 Часть II. Практика <br/>Подключение радиомодема <br/>Адаптеры Bluetooth имеют небольшую дальность действия, в лучшем случае не-<br/>сколько десятков метров на открытой местности. Если у вас нет аппаратуры радио-<br/>управления со встроенным каналом телеметрии, но хочется, чтобы на смартфоне <br/>или ноутбуке велись логи (журналы) и отображалась телеметрия на протяжении <br/>всей дистанции полета, то придется использовать радиомодем (удлинитель канала, <br/>радиолинк). Решение задачи облегчается тем, что существует простое и относи-<br/>тельно недорогое оборудование для организации так называемого "прозрачного" <br/>последовательного канала. В этом случае с точки зрения пользователя обмен дан-<br/>ными выглядит так, будто полетный контроллер и устройство отображения связаны <br/>проводами напрямую, а не разделены километровой дистанцией. <br/>Для организации радиоканала телеметрии мы будем использовать популярные ра-<br/>диомодемы 3DR Radio производства компании 3D Robotics. На сегодняшний день <br/>это, пожалуй, лучшее решение по сочетанию цены, качества связи и простоты экс-<br/>плуатации. Рекомендуем на начальном этапе не экспериментировать с самодель-<br/>ными модемами на основе модулей HM-TRP, а приобрести готовый набор, изобра-<br/>женный на рис. 6.14. Покупка отдельных модулей-полуфабрикатов и антенн не <br/>даст вам экономии средств по сравнению с ценой готового набора, а потери време-<br/>ни на программирование модулей и изготовление модемов будут большими и бес-<br/>смысленными. Модемы в этом наборе уже настроены и готовы к работе "из короб-<br/>ки". В наборе также имеются антенны и соединительные провода. Наборы изготав-<br/>ливаются на разные рабочие частоты: 433, 868, 915 МГц. В нашей стране <br/>разрешенным является диапазон 433 МГц. <br/> <br/>Рис. 6.14. Набор радиомодемов 3D Radio <br/>Один из модемов предназначен для монтажа на борту коптера, имеет разъем для <br/>подключения к контроллеру и обозначен словом "Air". Второй модем наземный, <br/>оснащен разъемом USB, при помощи которого подключается не только к ноутбуку, <br/>но и смартфону или планшету с операционной системой Android. Ваш смартфон <br/>или планшет должен иметь функцию разъема OTG. Это тот же самый USB-разъем, <br/><br/>Глава 6. Подключение и настройка внешних модулей 187 <br/>через который вы заряжаете гаджет или подключаете его к компьютеру, но он мо-<br/>жет работать еще и как активный порт для подключения внешних устройств.  <br/>В комплекте со смартфоном или планшетом должен поставляться провод-адаптер <br/>OTG (рис. 6.15), его можно также купить в магазине мобильных аксессуаров. Разу-<br/>меется, предварительно надо удостовериться, что ваше мобильное устройство под-<br/>держивает OTG. <br/> <br/>Рис. 6.15. Провод-адаптер для подключения внешних устройств по OTG <br/>В продаже встречаются также варианты модемов без разъема USB, но это менее <br/>удобно, т. к. для подключения к компьютеру или мобильному устройству придется <br/>использовать внешний адаптер USB-COM. <br/>Поскольку в продаже часто встречаются китайские клоны популярных продуктов, <br/>сразу после покупки рекомендуем проверить антенну для бортового модема и убе-<br/>диться, что она предназначена именно для диапазона 433 МГц и вам не продали <br/>антенну от бытового Wi-Fi-роутера на 2,4 ГГц (внешне они выглядят одинаково). <br/>Осторожно снимите чехол антенны с основания. Содержимое антенны должно вы-<br/>глядеть так, как показано на рис. 2.15. В крайнем случае, можно самостоятельно <br/>изготовить активную часть антенны. Она представляет собой спираль из 19 витков <br/>медного провода ∅0,8 мм, навитого на оправку ∅3,5 мм. <br/>Подключение модемов к компьютеру,  <br/>проверка и настройка <br/>Подключите антенны к модемам. Включите наземный модем в разъем USB стацио-<br/>нарного компьютера. Внутри модема может быть установлена микросхема одного <br/>из двух адаптеров USB-COM: FT232 или CP2102. В первом случае драйвер адапте-<br/>ра уже установлен на вашем компьютере, поскольку вы подключали полетный кон-<br/>троллер для настройки. Во втором случае драйвер для адаптера CP2102 необходимо <br/>установить отдельно. Скачайте архив драйвера с сайта компании Silicon Labs. По-<br/>сле установки драйвера и подключения модема в системе появится новый вирту-<br/>альный порт COM. Запомните его номер. <br/>Модемы оснащены двумя светодиодами, зеленым и красным. Мигающий зеленый <br/>означает, что модем находится в состоянии поиска связи со вторым, парным моде-<br/>мом. Постоянно горящий зеленый светодиод означает, что парный модем найден и <br/><br/>188 Часть II. Практика <br/>канал связи открыт. Красный светодиод вспыхивает при передаче данных и горит <br/>постоянно при записи новой прошивки в память модема. <br/>Подайте напряжение питания +5 В на бортовой модем. Через несколько секунд мо-<br/>демы должны найти друг друга и зеленые светодиоды зажгутся постоянно. Если <br/>это не произошло, не волнуйтесь. В этом случае понадобится небольшая дополни-<br/>тельная настройка. <br/>Итак, если зеленые светодиоды горят постоянно, соедините между собой выводы <br/>Tx и Rx бортового модема. Таким образом, он будет по кольцу возвращать обратно <br/>все, что ему передали, т. е. работать в режиме эха. Запустите программу терминала <br/>Termite 3.0 для работы с последовательным портом, которую использовали при на-<br/>стройке адаптера Bluetooth. В настройках терминала выберите порт, к которому <br/>подключен модем, скорость 57 600, а также опции Append CR-LF и Local Echo. <br/>Теперь введите любой текст в строке передачи и отправьте его. Он должен отобра-<br/>зиться в окне терминала и тут же повториться в следующей строке. В принципе, <br/>после этой проверки модемы можно начинать эксплуатировать. <br/>Но по умолчанию выходная мощность модемов установлена вполовину от макси-<br/>мальной. Этого достаточно для близких полетов, но в сложных помеховых услови-<br/>ях или на дальних дистанциях желательно установить полную мощность, 100 мВт. <br/>Также может потребоваться сменить идентификатор пары модемов, если в районе <br/>ваших полетов могут присутствовать аналогичные модемы. <br/>Для настройки модемов применяется специальный конфигуратор 3DRRadio Config. <br/>Он позволяет настроить не только модем, подключенный к порту, но и удаленный <br/>модем, используя радиоканал. Разумеется, для удаленного конфигурирования вто-<br/>рого модема канал должен быть установлен. Поэтому, если не совпадают частоты <br/>или скорости обмена модемов, придется конфигурировать их по отдельности, под-<br/>ключая бортовой модем к компьютеру при помощи внешнего адаптера USB-COM. <br/>Архив конфигуратора можно скачать на сайте автора программы по адресу <br/>http://vps.oborne.me/3drradioconfig.zip. <br/>Конфигуратор не требует установки. Модем должен быть подключен к порту USB <br/>до запуска программы, чтобы соответствующий порт появился в списке выбора. На <br/>второй модем просто подайте питание +5 В. Если при этом зеленые светодиоды <br/>горят непрерывно, второй модем доступен конфигуратору через радиоканал. <br/>Выбрав нужный порт и скорость по умолчанию 57600, нажмите кнопку Load <br/>Settings. Начнется считывание конфигурации модемов. Вообще, имейте в виду, что <br/>общение конфигуратора с модемами всегда происходит неторопливо и нужно про-<br/>являть терпение, дожидаясь окончания всех процедур. <br/>В наборе настроек нас интересуют, в первую очередь, следующие параметры <br/>(рис. 6.16). <br/>� Baud — скорость обмена с внешними устройствами, округленно. Так, опция 57 <br/>в списке соответствует скорости 57 600  бод. <br/>� Air Speed — скорость передачи данных по радиоканалу. Эта скорость обычно <br/>устанавливается выше, чем скорость внешнего обмена, т. к. по радиоканалу  <br/>передаются еще и служебные данные. <br/><br/>Глава 6. Подключение и настройка внешних модулей 189 <br/>� Net ID — идентификатор вашей радиосети, диапазон значений 0–500. Настоя-<br/>тельно рекомендуется сменить его на любой другой из списка, чтобы избежать <br/>случайного конфликта с аналогичными модемами. По этому номеру модемы <br/>опознают свою пару. <br/>� Tx Power — мощность передатчика в dBm. Для тестирования канала на близких <br/>дистанциях рекомендуется использовать малую мощность, затем установить <br/>максимальную. <br/>� ECC — Error Correcting Code, режим корректировки ошибок. Каждый пакет <br/>данных передается дважды, что вдвое сокращает пропускную способность  <br/>радиоканала, но существенно снижает количество ошибок. Если канал исполь-<br/>зуется только для передачи телеметрии, то галочку можно снять. <br/>� Mavlink — специальный режим расширенной поддержки протокола Mavlink, <br/>применяемого в проекте Ardupilot. В нашем случае, когда применяется прошив-<br/>ка MultiWii, этот режим бесполезен, поэтому рекомендуется выбрать опцию <br/>Raw Data. <br/> <br/>Рис. 6.16. Утилита конфигурирования модемов 3DRadio Config <br/>Остальные опции, особенно рабочие частоты Min Freq и Max Freq, менять не  <br/>надо. Пункт меню Terminal предназначен для ручного ввода служебных команд <br/>модема и в нашем случае не используется. <br/><br/>190 Часть II. Практика <br/>Настройки, сделанные для первого модема, копируются для второго нажатием <br/>кнопки Copy Required Items to Remote. Затем нажмите кнопку Save Settings и до-<br/>ждитесь окончания записи. Если второй модем недоступен для записи через радио-<br/>канал, то сперва сконфигурируйте первый модем и запомните его настройки. Затем <br/>подключите через внешний адаптер USB-COM второй модем и повторите процесс <br/>настройки. Не забывайте, что выводы Tx и Rx адаптера и модема следует соединять <br/>перекрестно: Tx → Rx, Rx → Tx. <br/>Пункт RSSI предназначен для проверки качества радиоканала. Здесь мы видим <br/>график уровней принимаемого сигнала и отношения "сигнал/шум" для обоих мо-<br/>демов. Измерение RSSI работает с накоплением, поэтому график начинает отобра-<br/>жаться спустя 3–4 с после нажатия кнопки Connect. В течение этого времени не <br/>следует вращать колесико мыши и масштабировать окно графика, это может  <br/>вызвать сбой программы. <br/>ВНИМАНИЕ! <br/>Во время построения графика между модемами идет обмен информацией в служеб-<br/>ном режиме, поэтому строго рекомендуется прекращать сеанс нажатием кнопки <br/>Disconnect и обязательно дождаться окончания сеанса связи, когда красный светоди-<br/>од перестанет мигать. В противном случае возможно "зависание" модема вплоть до <br/>необходимости перепрошивки. <br/>Подключение наземного модема  <br/>к мобильным устройствам <br/>Модемы 3DR Radio без труда подключаются к мобильным устройствам на ОС <br/>Android. Достаточно лишь установить приложение EZ-GUI Ground Station. Вместе  <br/>с этим приложением устанавливаются необходимые драйверы Linux для поддержки <br/>последовательного порта через USB. Подключите модем к устройству через разъем <br/>USB/OTG. Появится приглашение запустить программу и ассоциировать ее с этим <br/>устройством для автозапуска. Если вы не планируете использовать другие про-<br/>граммы, можно установить флажок автозапуска. <br/>Далее необходимо внести некоторые изменения в настройки программы. Перейди-<br/>те в меню Конфигурации | Настройки. Выберите опцию USB/Последовательный <br/>порт. Ниже оставьте по умолчанию универсальный драйвер, если не уверены, на <br/>какой микросхеме выполнен адаптер порта в вашем модеме. <br/>Скорость передачи данных выберите соответствующую настройкам вашего моде-<br/>ма. В нашем случае это 57600. Далее при помощи стрелки в правом верхнем углу <br/>пролистайте настройки до страницы Дополнения и поставьте флажок Поддержка <br/>3DR Radio. Выйдите из программы для сохранения настроек и перезапуска. Теперь <br/>мобильное приложение настроено для работы через радиомодем. Когда связь  <br/>с бортовым модемом установлена, в меню Настройки начинает работать раздел <br/>3DR RADIO КОНФ. В этом разделе можно скачать текущие настройки модемов и <br/>поменять их, что весьма удобно, если нужно изменить мощность модема или иден-<br/>тификатор сети в полевых условиях. <br/><br/>Глава 6. Подключение и настройка внешних модулей 191 <br/>Следует отметить, что в продаже встречается вариант конструкции наземного мо-<br/>дема, вместо адаптера USB-COM, оснащенного стандартным модулем Bluetooth, <br/>смонтированным с обратной стороны платы модема. В этом случае модем может <br/>связываться с мобильным устройством или компьютером по Bluetooth. Также есть <br/>возможность соединения через последовательный порт. Для этого на плате модема <br/>есть перемычка, по которой подается либо отключается питание на модуль <br/>Bluetooth. <br/>Подключение бортового модема  <br/>к полетному контроллеру <br/>Наборы модемов могут поступать в продажу с различными вариантами соедини-<br/>тельных проводов и вовсе не обязательно разводка проводников на 6-контактном <br/>разъеме типа MiniMOLEX совпадет с разводкой порта SERIAL0 на плате CRIUS <br/>AIOP. Пользуясь тонкой швейной иглой, осторожно приподнимите фиксирующий <br/>лепесток разъема и вытащите контакт из посадочного места. Затем аккуратно <br/>вставьте контакт на новое место. Будьте осторожны, не сломайте фиксирующий <br/>лепесток в ячейке разъема. <br/>В прошивке нужно установить правильную скорость обмена данными. Найдите <br/>строку <br/>#define SERIAL0_COM_SPEED 115200 <br/>и замените значение скорости тем значением, которое задано в настройках модема. <br/>Такую же скорость надо задать в интерфейсе программы MultiWii WinGUI, если вы <br/>используете ноутбук. <br/>ПРИМЕЧАНИЕ <br/>Не забывайте, что теперь даже по проводу USB контроллер будет соединяться с ком-<br/>пьютером на новой скорости. <br/>Подключение модема к порту SERIAL3  <br/>полетного контроллера <br/>Если вы используете прошивку MahoWii, то можете подключить модем к порту <br/>SERIAL3, тем самым освободив порт SERIAL0/FTDI для других нужд. Найдите  <br/>в прошивке, в начале файла config.h, следующие строки и раскомментируйте их: <br/>#define TELEMETRY_FRSKY <br/>#define TELEMETRY_FRSKY_SERIAL 3 <br/>#ifdef TELEMETRY_FRSKY <br/>    #define SERIAL3_COM_SPEED 57600 <br/>#endif <br/>Строго говоря, этот фрагмент кода подразумевает подключение модуля телеметрии <br/>FrSKY, но также работает с модемами 3DR Radio. Через порт SERIAL3 в данном <br/>случае при помощи радиомодема можно работать с программами MultiWii WinGUI <br/>и EZ-GUI Ground Station точно так же, как и через порт SERIAL0. <br/><br/>192 Часть II. Практика <br/>В нашем примере в настройках прошивки указана скорость 57 600 бод, она может <br/>быть другой, но в любом случае должна совпадать со скоростью обмена в настрой-<br/>ках радиомодема. <br/>Подключение и настройка приемника GPS <br/>Подключение стандартного фабричного модуля GPS мы рассмотрим на примере <br/>двух популярных приемников: CRIUS NEO-6M v3.0 с обычной керамической патч-<br/>антенной (рис. 6.17) и CRIUS NEO-6M v2.0 с активной керамической антенной <br/>(рис. 6.18). Оба эти приемника изготовлены на основе модуля u-blox NEO-6M, со-<br/>держат внешнюю энергонезависимую память EEPROM 32k для хранения текущих <br/>настроек и перезаряжаемую литиевую батарейку в качестве резервного источника <br/>питания для хранения альманаха. Светодиод FIX, расположенный, к сожалению,  <br/>с обратной стороны платы, своим миганием сообщает, что приемник вошел в ре-<br/>жим захвата спутников 2D/3D Fix. <br/> <br/>Рис. 6.17. Приемник CRIUS NEO-6M v3.0 с обычной антенной <br/> <br/>Рис. 6.18. Приемник CRIUS NEO-6M v2.0 с активной антенной <br/><br/>Глава 6. Подключение и настройка внешних модулей 193 <br/>Приемник с активной антенной имеет меньшие габариты и вес, но обеспечивает <br/>лучшую чувствительность. По наблюдениям автора, уровень принимаемого сигна-<br/>ла выше на 30–40%. <br/>Вопрос резервного хранения данных очень важен для этих приемников. Первая <br/>версия приемника не содержала EEPROM для хранения настроек, поэтому при раз-<br/>ряде резервного источника все настройки терялись. Это было очень неудобно, за-<br/>частую уже на поле выяснялось, что все настройки утрачены и использовать при-<br/>емник невозможно. Сейчас эта проблема снята, резервный источник используется <br/>  <br/>только для хранения данных альманаха. Емкость этой батарейки всего 5 мА⋅ ч, <br/>полного заряда хватает для хранения альманаха в течение 3–4 дней. Если батарейка <br/>разряжена, то для полного заряда требуется подавать питание на приемник мини-<br/>мум в течение 3-х часов. Если не поддерживать заряд батарейки дома, то во время <br/>полетов она успевает зарядиться максимум на 20–30%, этого хватает, чтобы хра-<br/>нить альманах и обеспечивать быстрый "горячий" старт в промежутке между  <br/>отдельными полетами в течение нескольких часов. Впрочем, продолжительность <br/>"холодного" старта на открытой местности обычно не превышает 40–60 с, поэтому <br/>теперь потеря данных альманаха — не проблема. <br/>Прежде всего, скачайте с сайта производителя и установите самую свежую версию <br/>программы u-Center для настройки и проверки приемника. Скачивание доступно по <br/>адресу http://www.u-blox.com/en/evaluation-tools-a-software/u-center/u-center.html. <br/>Во время подготовки книги была доступна версия 8.16. <br/>Подключение приемника к компьютеру <br/>Подключите приемник к вашему адаптеру USB-COM, соблюдая правильную по-<br/>лярность питания и соединяя линии Tx и Rx приемника и адаптера перекрестно: <br/>Tx → Rx, Rx → Tx. Затем подключите приемник к компьютеру. <br/>В зависимости от версии прошивки приемника, с большой долей вероятности мо-<br/>жет случиться досадное недоразумение: Windows распознает ваш приемник, как <br/>трекбол Microsoft BallPoint, и установит соответствующий драйвер. В этом случае <br/>поток данных с приемника будет восприниматься операционной системой, как <br/>управляющие сигналы трекбола. При подключенном приемнике указатель мыши <br/>будет хаотично прыгать по экрану, периодически имитируя нажатия кнопок. Чтобы <br/>устранить это недоразумение, внесите небольшое изменение в реестр Windows.  <br/>Запустите системную утилиту Regedit, откройте ветку реестра <br/>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\sermouse <br/>и измените значение параметра Start с 3 на 4. Затем перезагрузите компьютер. По-<br/>сле перезагрузки в системе после подключения адаптера и приемника должен быть <br/>виден только виртуальный COM-порт. <br/>По умолчанию в приемниках NEO-6M установлена скорость обмена данными <br/>9600 бод и протокол выходного потока данных NMEA. Но в приемниках, куплен-<br/>ных с рук или настроенных продавцом под конкретное устройство, эти параметры <br/>могут быть другими. <br/><br/>194 Часть II. Практика <br/>Подключите приемник к компьютеру и запустите программу u-Center (рис. 6.19).  <br/>В меню Receiver | Port выберите нужный последовательный порт. Далее в меню <br/>Receiver поставьте галочку напротив строки Autobauding. Если скорость обмена <br/>заранее неизвестна или изменилась в процессе настройки, программа сама подберет <br/>правильную скорость. Далее выберите версию вашего приемника: Receiver | <br/>Generation | u-blox 6. <br/> <br/>Рис. 6.19. Главное окно программы u-Center <br/>Как правило, после этого соединение с приемником устанавливается автомати- <br/>чески, о чем говорит мигающий зеленым цветом значок в строке состояния внизу <br/>окна, а в окнах программы появляется отображение текущих данных. <br/>Первый старт приемника может происходить очень долго, даже при хорошей ви-<br/>димости спутников. В некоторых случаях захват спутников 3D Fix может не про-<br/>изойти вообще. Не волнуйтесь, это нормально. Далее мы разберемся, как загрузить <br/>в приемник данные для холодного старта с внешнего сервера. <br/>ПРИМЕЧАНИЕ <br/>Первое, что нужно сделать после установления связи с новым приемником, — сохра-<br/>нить в файл его текущую конфигурацию на случай, если вы что-то случайно испортите <br/>в процессе настройки или экспериментов. <br/><br/>Глава 6. Подключение и настройка внешних модулей 195 <br/>Выберите меню Tools | GNSS Configuration и нажмите кнопку GNSS > File. Теку-<br/>щие настройки будут прочитаны из приемника и сохранены в виде текстового фай-<br/>ла. В дальнейшем этот файл можно редактировать, нажав кнопку Edit, если вы  <br/>хорошо изучили спецификацию приемников u-blox и хорошо понимаете, что делае-<br/>те. Готовые файлы настроек для специальных случаев можно часто встретить на <br/>форумах. Эти настройки нужны при работе с пользовательскими версиями проши-<br/>вок или дополнительными устройствами наподобие адаптера для подключения <br/>2<br/>приемника по шине I C. <br/>Сохраненную конфигурацию можно выгрузить в приемник из файла нажатием <br/>кнопки File > GNSS. Если при этом установлена галочка сохранения в энергонеза-<br/>висимую память (non-volatile memory), то настройки будут записаны в EEPROM  <br/>и сохранятся после отключения питания. В противном случае настройки будут <br/>действовать только до первого отключения питания. <br/>Следующий шаг после подключения приемника — регистрация на фирменном  <br/>онлайн-сервисе u-blox AssistNow для получения логина и пароля. <br/> <br/>Получение доступа к сервису AssistNow Online <br/>При первом включении после долгого перерыва, когда резервный источник разря-<br/>жен или данные альманаха или эфемериса, сохраненные в памяти, утратили свою <br/>валидность, старт приемника может затянуться на минуты или часы, а при неудач-<br/>ном стечении внешних факторов не состояться вообще. <br/>AssistNow — это фирменный онлайн-сервис компании u-blox. Сообщив этому сер-<br/>вису свои текущие или предполагаемые координаты, вы тут же получаете в ответ <br/>набор данных (альманах, эфемериды, точное время) для данной точки земной по-<br/>верхности в момент запроса. Этот альманах через последовательный порт загружа-<br/>ется в приемник, после чего приемник в течение нескольких секунд переходит <br/>в режим 3D Fix. <br/>Сервис полностью бесплатный и доступен всем при наличии интернет-соединения. <br/>Логин и пароль предоставляются в автоматическом режиме. Отправьте письмо  <br/>с темой "login/password request" на адрес agps-server@u-blox.com. Через несколько <br/>минут вы получите автоматическое ответное письмо, в котором будет ваш логин и <br/>пароль. Обычно в качестве логина используется адрес электронной почты, с кото-<br/>рого отправлено письмо. В письме сказано, что доступ к сервису предоставляется  <br/>в течение нескольких часов после отправки письма, но на самом деле обычно дос-<br/>тупен сразу, как только вы получили ответ. <br/>Выберите в меню u-Center пункт Tools | AssistNow Online | AssistNow Oline (u-blox 5-7). <br/>В поля Latitude (широта) и Longitude (долгота) введите ваши предполагаемые ко-<br/>ординаты. Их можно определить при помощи смартфона или посмотреть на карте <br/>maps.google.com. Высоту Altitude и погрешность Accuracy можно задать нулевы-<br/>ми. Далее введите свои логин и пароль, адрес сервера и номер серверного порта  <br/>не меняйте. Запрос пакета данных Request — full (полный набор всех доступных <br/>данных). <br/><br/>196 Часть II. Практика <br/>Далее необходимо выбрать команду сброса, которая будет передана приемнику по-<br/>сле загрузки данных (рис. 6.20). Рекомендуем всегда выбирать полный "холодный" <br/>рестарт (cold), т. к. при быстром "горячем" рестарте приемник иногда почему-то <br/>остается в состоянии 2D Fix. Холодный рестарт длится на 20–30 с дольше, но  <br/>гарантированно перезапускает приемник в полностью рабочее состояние. <br/> <br/>Рис. 6.20. Настройки сервиса AssistNow Online <br/>Теперь нажмите кнопку OK, и начнется загрузка данных с сервера в ваш приемник. <br/>Это займет 3–4 с. После того как приемник перезагрузится, определит текущие ко-<br/>ординаты и войдет в режим 3D Fix, вы можете вновь открыть окно AssistNow <br/>Online, нажать кнопку Use Current для использования текущих координат и по-<br/>вторно загрузить уточненные данные. Все введенные значения полей сохраняются <br/>в памяти компьютера и могут быть использованы при следующем запросе. Но, как <br/>правило, при нормальной эксплуатации приемника с небольшими, не более недели, <br/>перерывами, необходимость повторных обращений к сервису не возникает. <br/>Изменение текущих настроек <br/>Для подключения приемника к полетному контроллеру необходимо изменить лишь <br/>три основные настройки: скорость последовательного порта, частоту обновления <br/>навигационных данных и протокол потока данных. В программе u-Center при под-<br/>ключенном приемнике нажмите клавишу <F9>. Откроется окно настроек и сооб-<br/>щений. Убедитесь, что в левом нижнем углу нажата кнопка Disable/Enabe <br/>Autopolling (названия кнопок появляются при наведении указателя мыши). Это <br/>функция автоматического опроса настроек приемника. Настройки считываются <br/>примерно раз в три секунды. <br/>В левом столбце выберите раздел UBX и подраздел CFG (Config). Ниже в списке <br/>выберите пункт PRT (Ports). Теперь в списке справа выберите опции именно так, <br/><br/>Глава 6. Подключение и настройка внешних модулей 197 <br/>как показано на рис. 6.21, и нажмите кнопку Send в левом нижнем углу. Настройки <br/>будут отправлены в приемник и начнут действовать до первого отключения пита-<br/>ния. Для сохранения настроек в EEPROM необходимо выполнить отдельную про-<br/>цедуру. <br/>ВНИМАНИЕ! <br/>Обратите особое внимание на то, что в раскрывающемся списке Protocol in должна <br/>быть выбрана именно строка 0+1+2 - UBX+NMEA+RTCM, поскольку именно по прото-<br/>колу RTCM в приемник загружаются настройки. Если вы случайно отключите этот про-<br/>токол, то рискуете потерять возможность менять настройки через u-Center. <br/>Выходным протоколом в нашем случае укажем только NMEA, поскольку нет ника-<br/>кой необходимости выводить смешанный поток данных NMEA+UBLOX или ис-<br/>пользовать проприетарный протокол UBLOX. <br/>Скорость обмена 57 600 бод соответствует частоте обновления навигационных <br/>данных 5 Гц. Кроме того, это рекомендованная скорость для прошивки <br/>MultiWii 2.3. <br/> <br/>Рис. 6.21. Настройка скорости порта и протокола данных <br/>Теперь в левой колонке выберите пункт RATE (Rates) и задайте новую скорость <br/>обновления навигационных данных. По умолчанию задана частота 1 Гц, т. е. све-<br/>жие навигационные данные поступают в контроллер один раз в секунду. Но для <br/>управления коптером, как мы уже говорили выше, необходимо обновлять данные <br/>как минимум с частотой 5 Гц. Увеличение частоты обновления данных требует <br/>увеличения скорости обмена порта. Для частоты 5 Гц порт должен работать со ско-<br/>ростью не менее 57 600 бод, именно ее мы установили только что. Задайте на-<br/>стройки, как показано на рис. 6.22, и нажмите кнопку Send. Сразу после этого в <br/>главном окне программы должно быть визуально заметно, что данные стали обнов-<br/>лять намного чаще, а значок соединения в строке статуса должен мигать с частотой <br/>5 Гц. <br/><br/>198 Часть II. Практика <br/> <br/>Рис. 6.22. Настройка частоты обновления навигационных данных <br/>Чем выше частота обновления данных, тем точнее работает функция позициониро-<br/>вания и удержания в полетном контроллере. В зависимости от модификации при-<br/>емника и прошивки, некоторые модули u-blox могут работать с частотой 10 Гц. Но <br/>есть нюансы. Путем некоторых ухищрений, введя команду $PMTK220,100*2F в руч-<br/>ном режиме, можно заставить любой приемник NEO-6 выдавать пакеты данных  <br/>с частотой 10 Гц. Но если при этом сам чипсет приемника не способен производить <br/>измерения с частотой более 5 Гц, то очевидно, что при частоте вывода пакетов  <br/> <br/> <br/> <br/>Рис. 6.23. Сохранение текущих настроек в энергонезависимую память <br/><br/>Глава 6. Подключение и настройка внешних модулей 199 <br/>10 Гц каждый пакет данных будет дублироваться, и реального прироста скорости <br/>обновления мы все равно не получим. <br/>Чтобы проверить возможности вашего варианта приемника, введите в настройки <br/>следующие параметры: Measurement Period = 100ms; Navigation Rate = 1. Если <br/>при этом поле Navigation Rate не становится розовым, а после нажатия кнопки <br/>Send под ней не появляется сообщение об ошибке, значит, ваш приемник мо- <br/>жет обновлять данные с частотой 10 Гц. В этом случае не забудьте увеличить ско-<br/>рость порта до 115 200 бод, иначе для передачи потока данных не хватит скорости <br/>порта. <br/>Убедившись, что с новыми настройками приемник функционирует нормально, мо-<br/>жете сохранить их в энергонезависимую память. В левом столбце выберите стро- <br/>ку CFG (Config), в правой части установите переключатель Save current <br/>configuration (рис. 6.23) и нажмите кнопку Send. На этом настройка завершена. <br/>Перейдите в меню Tools | GNSS Configuration и сохраните текущую конфигура-<br/>цию в отдельный файл. Это поможет при необходимости быстро восстановить на-<br/>стройки. <br/>Подключение приемника к полетному контроллеру <br/>Приемник подключается к порту SERIAL2, причем достаточно подключить лишь <br/>выход Tx ко входу Rx2 полетного контроллера, т. к. мы подключаем заранее на-<br/>строенный приемник и настройка "на лету" средствами прошивки нам не понадо-<br/>бится. <br/>В случае использования прошивки MultiWii 2.3 вносить изменения в настройки <br/>практически не потребуется. Необходимо найти следующие строки и убедиться, <br/>что они раскомментированы: <br/>#define GPS_SERIAL 2 <br/>#define GPS_BAUD 57600 <br/>#define NMEA <br/>#define MAG_DECLINATION  x.xxf <br/>Этих строк достаточно для того, чтобы начать использовать функцию GPS. Убеди-<br/>тесь, что параметр GPS_BAUD соответствует скорости последовательного порта при-<br/>емника, а в параметре MAG_DECLINATION правильно указано магнитное склонение для <br/>вашей местности. Про настройку этого параметра было сказано ранее, в разделе <br/>о настройке прошивки MultiWii. <br/>Строку //#define INIT_MTK_GPS в нашем случае следует оставить закомментирован-<br/>ной. Она активирует процедуру автоматической настройки параметров приемников <br/>на основе чипсета MTK и в нашем случае не подходит для приемников u-blox. <br/>Строка #define GPS_LED_INDICATOR включает мигание светодиода B при поступле-<br/>нии данных с приемника. Пока нет захвата спутников 3D Fix, светодиод мигает в <br/>такт поступающим пакетам данных с приемника. В режиме 3D Fix одна короткая <br/>вспышка соответствует пяти спутникам, две вспышки — шести спутникам и т. д. <br/><br/>200 Часть II. Практика <br/>Данным GPS присуща случайная погрешность, поэтому координаты пользователя <br/>не застывают в некой точке, а с каждым новым измерением "прыгают" внутри  <br/>окружности, представляющей собой границы зоны погрешности. Соответственно, <br/>если квадрокоптер будет идеально отслеживать координаты каждого измерения, то <br/>в режиме удержания позиции он начнет хаотично метаться внутри окружности <br/>с радиусом 2–4 м. Поэтому данные GPS подвергают усреднению и фильтрации. <br/>Строка #define GPS_LEAD_FILTER активизирует режим предиктивной фильтрации, <br/>чтобы скомпенсировать задержку данных GPS, когда коптер быстро сменил пози-<br/>цию, а новые координаты еще не поступили. Алгоритм фильтра пытается ввести <br/>предсказание координат на основании известного ранее вектора движения и дан-<br/>ных об ускорениях с акселерометра. <br/>Строку //#define GPS_FILTERING лучше оставить закомментированной. Это фильтр <br/>с сильным усреднением для компенсации шумов данных, когда данные распреде-<br/>лены внутри зоны погрешности чересчур хаотично. Фильтр вносит большую за-<br/>держку в работу функции позиционирования. Может быть полезен при использо-<br/>вании старых модификаций приемников. <br/>Строка #define GPS_WP_RADIUS 200 определяет расстояние до заданной точки в сан-<br/>тиметрах, при котором можно считать, что точка уже достигнута. Указывать рас-<br/>стояние менее 200 см нет смысла, т. к. это минимальная погрешность применяемых <br/>нами гражданских приемников. В противном случае контроллер коптера может <br/>считать, что нужные координаты не достигнуты и бесконечно долго флуктуировать <br/>около точки назначения. <br/>Параметр #define NAV_SLEW_RATE 30 определяет сглаживание случайных выбросов <br/>данных. Если коптер ведет себя стабильно в режимах GPS HOLD и GPS HOME, <br/>можно попробовать уменьшить этот параметр до 15. <br/>Стартовая позиция GPS HOME обнуляется каждый раз при арминге моторов. То <br/>есть, квадрокоптер считает "домашней" ту точку, в которой активированы моторы. <br/>Но это не всегда приемлемо для опытных пилотов. Например, при полетах по FPV <br/>оператор может посадить коптер на крышу здания, отключить моторы, затем взле-<br/>теть снова. В этом случае первоначальные домашние координаты будут утрачены и <br/>в случае срабатывания функции Filesafe при утрате связи коптер автоматически <br/>вернется на крышу здания, а не к оператору. Чтобы этого не случалось, можно рас-<br/>комментировать строку <br/>//#define DONT_RESET_HOME_AT_ARM <br/>При этом в качестве домашних запоминаются координаты, в которых выполнена <br/>команда калибровки гироскопов (левый стик до упора влево и вниз, правый стик до <br/>упора вверх). <br/>Подключение приемника GPS с прошивкой MahoWii <br/>Настройка прошивки MahoWii для подключения приемника NEO-6M лишь незна-<br/>чительно отличается от настроек прошивки MultiWii v2.3. Необходимо задать вы-<br/>соту полета, которую будет поддерживать коптер при автоматическом возвращении <br/><br/>Глава 6. Подключение и настройка внешних модулей 201 <br/>домой по функции RTH в строке #define ALT_TO_RTH 3000. Высота задается в сан-<br/>тиметрах. <br/>В строке #define ALT_TO_RTH_FINISH 200 указывается высота зависания при дости-<br/>жении точки возврата. Не следует указывать высоту меньше 200 см, т. к. за время <br/>полета может накопиться погрешность барометра. Кроме того, как вы помните,  <br/>барометр дает большую погрешность при висении на малой высоте. <br/>Строка #define INS_PH_NAV_ON включает инерциальную систему удержания пози-<br/>ции, которая учитывает данные акселерометра для повышения точности удер- <br/>жания. <br/>Подключение дисплея <br/>Теперь, когда можно приобрести по доступной цене графические OLED- или TFT-<br/>модули, приобретение двустрочного текстового дисплея для подключения к полет-<br/>ному контроллеру вряд ли целесообразно. Поддержка OLED-дисплеев встроена  <br/>в прошивку MultiWii. Для подключения цветного TFT-дисплея автор разработал <br/>собственную конструкцию на базе микроконтроллера ATmega328. <br/>Монохромный OLED дисплей CRIUS CO-16 <br/>2<br/>Дисплей подключается по протоколу I C к соответствующему четырехконтактному <br/>разъему полетного контроллера. На этот же разъем выведено напряжение питания <br/>+5 В. Обратите внимание, что в отличие от "перекрестного" подключения по по-<br/>2<br/>следовательному протоколу UART, соединение для I C должно быть прямым: <br/>SDA → SDA, SCL → SCL. <br/>Для активации поддержки OLED-дисплея в прошивке найдите секцию LCD/OLED - <br/>display settings и раскомментируйте строку <br/>#define OLED_I2C_128x64 <br/>Если вы не хотите, чтобы при включении питания на дисплей выводилась старто-<br/>вая заставка в виде логотипа MultiWii, то закройте комментарием строку <br/>#define SUPPRESS_OLED_I2C_128x64LOGO <br/>Теперь включим вывод телеметрии на дисплей строкой <br/>#define LCD_TELEMETRY <br/>Информация разбита на девять страниц, с 1 по 9. Нулевой странице соответствует <br/>пустой экран. Можно задать автопереключение страниц строкой <br/>#define LCD_TELEMETRY_AUTO "123452679" <br/>или установить произвольный порядок автопереключения, например <br/>#define LCD_TELEMETRY_AUTO  "212232425262729" <br/>где странице номер два уделено особое внимание. Должна быть раскомментирова-<br/>на только одна из двух упомянутых строк. <br/><br/>202 Часть II. Практика <br/>Страницы можно переключать вручную, движением правого стика до упора вправо <br/>вверх. Для этого строки автопереключения должны быть закомментированы, а рас-<br/>комментировать надо строку <br/>#define LCD_TELEMETRY_STEP "0123456789" <br/>Порядок следования страниц может быть произвольным, любые страницы, включая <br/>нулевую, можно удалить из последовательности или повторить. <br/>Настройка параметров через меню дисплея <br/>При помощи стиков пульта и меню, отображаемого на дисплее, можно настроить <br/>различные параметры: PID, экспоненты, минимальный и максимальный газ, при-<br/>вязку переключателей AUX. Прямо скажем, делать это, глядя на крошечный моно-<br/>хромный экран — удовольствие на большого любителя. Но в ситуации, когда под-<br/>ходящий смартфон или ноутбук недоступен, может пригодиться и дисплей. Для <br/>включения функции конфигурирования раскомментируйте строку <br/>#define LCD_CONF <br/>Чтобы разрешить изменение привязки переключателей AUX, раскомментируйте <br/>еще одну строку: <br/>#define LCD_CONF_AUX <br/>Для входа в меню конфигурации надо левый стик переместить вправо вниз, а пра-<br/>вый стик — вверх. Эти движения следует делать одновременно, иначе вместо входа <br/>в меню вы можете левым стиком активировать моторы. Полный перечень движе-<br/>ний стиков для настройки через дисплей приведен в приложении 3. <br/>Проблемы с подключением дисплеев CRIUS OLED  <br/>и их решение <br/>Дисплеям CRIUS CO-16 версии 1.0 присущи конструктивные недостатки, которые <br/>устранены в более новых версиях. Но дисплеев первой версии и их клонов было <br/>изготовлено очень много, поэтому вероятность купить неустойчиво работающий <br/>модуль довольно велика. Прежде всего, упомянутым дисплеям присуща проблема <br/>неустойчивого сброса, так называемое "звездное небо". При включении питания <br/>встроенный контроллер дисплея не сбрасывается, очищая видеопамять, и экран <br/>хаотично покрывается одиночными светящимися пикселами. Далее дисплей уже не <br/>реагирует на команды и данные с полетного контроллера. Некоторые экземпляры <br/>дисплеев зависают изредка, некоторые при каждом включении. <br/>Простым и широко известным способом решения этой проблемы является включе-<br/>ние резистора с номиналом 150–200 Ом в разрыв плюсового провода питания. Ре-<br/>зистор маломощный, затягивается вместе с проводом и местом пайки в термоуса-<br/>дочную трубку. Может потребоваться подобрать номинал резистора для более  <br/>устойчивой работы. У автора дисплей работает с сопротивлением 180 Ом. Этот <br/>способ хорош тем, что требует минимальные навыки пайки. <br/><br/>Глава 6. Подключение и настройка внешних модулей 203 <br/>Если включение резистора не помогает, попробуйте подключить RC-цепь к выводу <br/>сброса контроллера дисплея, как показано на рис. 6.24 и 6.25. Этот способ требует <br/>наличия соответствующих инструментов и навыка пайки миниатюрных компо- <br/>нентов. <br/> <br/>Рис. 6.24. Схема подключения RC-цепи сброса <br/> <br/>Рис. 6.25. Монтаж компонентов цепи сброса <br/>В сочетании определенных экземпляров полетного контроллера и дисплея может <br/>возникнуть ситуация, когда при подключении дисплея резко возрастает количество <br/>2<br/>ошибок на шине I C, полетный контроллер неустойчиво читает данные с датчиков <br/>либо вообще зависает. Предположительно, это вызвано чрезмерной "подтяжкой" <br/>линий SCL и SDA к напряжению питания встроенным контроллером дисплея, что <br/><br/>204 Часть II. Практика <br/>приводит к неустойчивой работе отдельных экземпляров сенсоров на плате полет-<br/>ного контроллера. Проблема может быть устранена последовательным включением <br/>резисторов с сопротивлением 560–750 Ом в разрыв проводов SCL и SDA, соеди-<br/>няющих дисплей и полетный контроллер. Точное значение номинала резисторов <br/>надо подобрать опытным путем. <br/>Самодельный цветной дисплей <br/>Вниманию читателей, имеющих некоторый опыт самостоятельного изготовления <br/>печатных плат, предлагается авторская конструкция цветного дисплея для <br/>MultiWii. Дисплей построен на основе готового дисплейного модуля с разрешением <br/>128×160 точек, диагональю 1,8 дюйма и цветовой палитрой 262 000 оттенков. Об-<br/>мен данными с дисплеем происходит по последовательному протоколу SPI. По-<br/>скольку в прошивке MultiWii поддержка этого протокола не реализована, в дисплее <br/>используется дополнительный микроконтроллер ATmega328. Он обменивается <br/>данными с полетным контроллером по внутреннему протоколу MSP (MultiWii <br/>Serial Protocol) и пересылает обработанные данные собственно в графическую па-<br/>мять дисплея по SPI. Дисплей кроме графической матрицы содержит в себе специ-<br/>альную микросхему, так называемый драйвер дисплея. Драйвер содержит цепи <br/>управления ЖК-матрицей и буферную память изображения. Он подчиняется внеш-<br/>ним командам и позволяет извне обращаться к отдельным пикселам изображения. <br/>Иными словами, микроконтроллер ATmega328 служит посредником между полет-<br/>ным контроллером и драйвером дисплея, обрабатывая данные и пересылая их <br/>драйверу. <br/>Конструктивно дисплей выполнен в виде "бутерброда", состоящего из собственно <br/>дисплейного модуля и самодельной платы расширения, которая припаяна прямо на <br/>выводы платы дисплея (рис. 6.26 и 6.27). <br/>Плата расширения представляет собой несложную самодельную печатную плату, <br/>на которую припаян готовый китайский клон модуля Arduino Pro Mini с рабочим  <br/> <br/> <br/>Рис. 6.26. Общий вид дисплейного модуля <br/><br/>Глава 6. Подключение и настройка внешних модулей 205 <br/> <br/>Рис. 6.27. Монтаж платы расширения дисплейного модуля <br/>напряжением 5 В и тактовой частотой 16 МГц. Использование готового модуля на-<br/>много рациональнее в отношении затрат времени и денег, чем самостоятельное из-<br/>готовление печатной платы, содержащей микроконтроллер и навесные элементы. <br/>Встречаются различные варианты клонов Arduino Pro Mini. На рис. 6.28 показан <br/>внешний вид платы, использованной в дисплее. Разводка расширяющей платы дис-<br/>плея выполнена под этот вариант клона. Можно приобрести другую версию модуля <br/>Arduino, но тогда придется изменить разводку расширяющей платы. <br/> <br/>Рис. 6.28. Готовый модуль Arduino Pro Mini для дисплея <br/>Дисплейный модуль можно приобрести в России, в магазинах, торгующих аксес-<br/>суарами и модулями расширения для Arduino, либо заказать в Китае или на eBay. <br/>Также потребуется приобрести клон модуля Arduino Pro Mini. Автор приобретал <br/>компоненты на Aliexpress. Ключевые слова для поиска: "TFT SPI display" и <br/>"Arduino Pro Mini". <br/>Печатная плата изготавливается любым удобным способом. Все они многократно и <br/>подробно описаны в Интернете и радиолюбительской литературе, поэтому здесь <br/>мы не будем останавливаться на технологических подробностях. Отметим лишь, <br/>что ширина проводников и зазоры между контактными площадками позволяют ис-<br/>пользовать "лазерно-утюжную технологию" (ЛУТ). Контактные площадки под <br/>монтаж модуля Arduino выполнены без отверстий. Для качественной пайки доста-<br/>точно смазать флюсом площадки и отверстия модуля. Припой легко затекает в от-<br/>верстие модуля Arduino и надежно припаивает его к расширяющей плате. <br/>Принципиальная электрическая схема изображена на рис. 6.29. Исходный файл <br/>схемы, а также рисунок печатной платы в формате DipTrace можно скачать на  <br/>сайте издательства (см. приложение 4). Схема несложная и содержит минимум  <br/>деталей, поэтому все соединения можно выполнить даже без печатной платы,  <br/>отрезками тонкого провода. <br/><br/>206 Часть II. Практика <br/>Рис. 6.29. Схема дисплея <br/><br/>Глава 6. Подключение и настройка внешних модулей 207 <br/>Резисторы R1–R4 предназначены для взаимного согласования логических уровней <br/>между модулями. Дело в том, что хоть общее напряжение питания конструкции <br/>5 В, но внутреннее рабочее напряжение питания дисплейного модуля — 3,3 В, вы-<br/>рабатывается встроенным стабилизатором. А рабочее напряжение модуля <br/>Arduino — 5 В. Соответственно различаются напряжения логических уровней двух <br/>модулей. Если выходы Arduino Pro Mini соединить напрямую со входами контрол-<br/>лера дисплея, то он может выйти из строя. Резисторы R1–R4 ограничивают ток в <br/>цепи и в сочетании с внутренним сопротивлением входов работают, как делители <br/>напряжения. <br/>Дисплейный модуль содержит слот для подключения карты SD, разведенный на <br/>отдельные выводы. Причем согласующие резисторы уже установлены на плате  <br/>модуля. В схеме устройства предусмотрено подключение карты SD к микрокон-<br/>троллеру, это позволяет в будущем использовать дисплей и для записи логов (жур-<br/>налов) полета. Но в настоящее время функция ведения лога в прошивке не реализо-<br/>вана. <br/>Для подключения дисплея к полетному контроллеру, а также для записи прошивки <br/>используется разъем J1. По разводке выводов он совпадает с популярной платой <br/>MinimOSD и совместим с фирменным адаптером FTDI USB-COM и его клонами. <br/>Поэтому один и тот же адаптер пригодится для записи прошивок в разные модули. <br/>Поскольку дисплей подключается к порту SERIAL0, то для подключения по USB <br/>дисплей следует отключать. <br/>Запись прошивки в контроллер дисплея <br/>В прошивке дисплея используется свободно распространяемая графическая биб-<br/>лиотека для работы с драйвером дисплейного модуля. Для тех, кто раньше не стал-<br/>кивался с программированием, коротко поясним, что библиотека — это заранее <br/>написанный набор стандартных процедур для работы с чем-либо. В нашем случае  <br/>с дисплеем. Любое стандартное действие, будь то очистка экрана, вывод текста или <br/>рисование прямоугольника, выполняется через обращение к готовой процедуре <br/>библиотеки. <br/>Но в стандартном наборе библиотек Arduino IDE нужной нам библиотеки нет, ее <br/>следует установить отдельно. В скачанном с сайта издательства архиве найдите <br/>папку с названием Adafruit_ST7735 и скопируйте ее полностью, не меняя название, <br/>в папку для библиотек Arduino — C:\Program Files\Arduino\libraries. Затем скопи-<br/>руйте туда же библиотеку графического ядра Adafruit_GFX. Содержимое папки <br/>библиотек должно выглядеть приблизительно так, как на рис. 6.30. <br/>Теперь запустите Arduino IDE и откройте меню Файл | Образцы. В списке должна <br/>появиться строка Adafruit_ST7735. Это означает, что графическая библиотека ус-<br/>тановлена правильно. Номер в ее названии соответствует номеру микросхемы <br/>драйвера дисплея. <br/>ПРИМЕЧАНИЕ <br/>В некоторых случаях в модуле дисплея может быть установлен драйвер Samsung <br/>S6D02A1. К сожалению, по внешнему виду модуля это невозможно распознать, а про-<br/><br/>208 Часть II. Практика <br/>давцы заранее не предупреждают. Поэтому, если правильно собранный дисплей не <br/>подает признаков жизни, необходимо установить библиотеку Adafruit_QDTech и вне-<br/>сти исправления в прошивку. <br/> <br/>Рис. 6.30. Папка библиотек Arduino c графическими библиотеками дисплея <br/>Настройка прошивки <br/>По умолчанию прошивка готова к использованию без каких-либо изменений. Тем <br/>не менее, при желании пользователь может настроить под себя содержимое выво-<br/>димых данных и их размещение на экране, даже не имея навыков программиро- <br/>вания. <br/>Вывод данных разбит на страницы. За формирование каждой страницы отвечает <br/>отдельный файл page1.ino, page2.ino и т. д. Всего страниц семь. Строка главного <br/>файла программы <br/>#define START_PAGE 1 <br/>задает стартовую страницу при включении дисплея. Вы можете указать здесь лю-<br/>бой другой номер из числа доступных. <br/>#define TOTAL_PAGE 7 <br/>задает общее количество страниц. После достижения этого числа происходит воз-<br/>врат к первой странице, т. е. страницы переключаются по кругу. Следующий фраг-<br/>мент программы задает порядок следования страниц: <br/>case 1: show_1(); break;  //STATUS <br/>case 2: show_2(); break;  //RADIO <br/>case 3: show_3(); break;  //ACTIVE MODE <br/><br/>Глава 6. Подключение и настройка внешних модулей 209 <br/>case 4: show_4(); break;  //GPS <br/>case 5: show_5(); break;  //MOTORS <br/>case 6: show_6(); break;  //SERVOS <br/>case 7: show_7(); break;  //SENSORS <br/>Здесь case 1:, case 2: и т. д. — это порядковый номер отображаемой страницы. <br/>Например, если вы напишете <br/>case 1: show_4(); break;  //GPS <br/>... <br/>case 4: show_1(); break;  //STATUS <br/>... <br/>то отображаемые страницы 1 (STATUS) и 4 (GPS) поменяются местами при ото-<br/>бражении, и при включении питания первым будет отображаться статус GPS. <br/>В файле screenmap.h указаны опорные координаты каждой надписи на каждой <br/>странице. Меняя эти координаты по своему усмотрению, вы можете переставлять <br/>на страницах данные и подписи к ним. На экране дисплея нулевая точка координат <br/>находится слева вверху. То есть, значения по оси x отсчитываются как обычно, сле-<br/>ва направо. Но значения по оси y отсчитываются сверху вниз. <br/>Страницы перелистываются перемещением правой рукоятки пульта вправо вверх <br/>до упора. При активации моторов на всех страницах внизу появляется предупреж-<br/>дающая красная строка. <br/>Поскольку обмен данными происходит через порт SERIAL0, то при подключении <br/>провода USB дисплей следует отключать от разъема. В прошивке дисплея задана <br/>скорость порта по умолчанию 115 200. Если вы изменили скорость порта SERIAL0 <br/>в настройках контроллера, то в прошивке дисплея также следует установить новую <br/>скорость. Найдите в коде прошивки дисплея строку <br/>Serial.begin(115200); <br/>и в скобках укажите новое значение скорости обмена. <br/>Дисплей можно подключить к порту SERIAL3, если к этому порту не подключен <br/>модем телеметрии. В этом случае также надо обратить внимание на совпадение <br/>скоростей портов. <br/>Монтаж и подключение оборудования FPV <br/>В общем случае, полеты с обзором по видеокамере — довольно дорогостоящее за-<br/>нятие, если использовать оборудование высокого качества с большим радиусом <br/>действия. Зачастую комплект такого оборудования стоит дороже самого коптера. <br/>Но для того чтобы начать отрабатывать навыки полетов и успешно провести пер-<br/>вый сезон, нам не потребуются существенные затраты и сложное оборудование. <br/>Теперь разберемся, какие компоненты необходимы начинающему пилоту, а без  <br/>каких вполне можно обойтись. <br/>Одним из оптимальных и недорогих начальных вариантов может быть покупка на-<br/>бора, состоящего из малогабаритной CCD-видеокамеры, видеопередатчика, видео-<br/>приемника, пары всенаправленных антенн и видеоочков. Стоимость такого набора <br/><br/>210 Часть II. Практика <br/>заметно меньше, чем суммарная стоимость компонентов при покупке по отдельно-<br/>сти. Набор обычно снабжается подробными инструкциями по подключению и  <br/>необходимыми соединительными проводами. Но, к сожалению, такие наборы не <br/>всегда бывают в наличии по доступной цене, поэтому нужно быть готовым к само-<br/>стоятельному подбору компонентов. <br/>Видеокамера <br/>Вместо использования двух видеокамер — курсовой и видовой — для начинающе-<br/>го пилота вполне достаточно одной камеры среднего качества, закрепленной на <br/>управляемом стабилизированном подвесе. Следовательно, отпадает потребность  <br/>в видеокоммутаторе и освобождается один из радиоканалов, которых и так мало <br/>в недорогой аппаратуре радиоуправления. <br/>Наиболее простым и очевидным решением будет покупка одной из специализиро-<br/>ванных популярных экшн-камер: GoPro, Xiaomi Yui или Möbius. Для этих камер  <br/>в продаже имеется широчайший выбор готовых стабилизированных подвесов раз-<br/>личной степени сложности, разные аксессуары — чехлы, кабели, адаптеры — <br/>вплоть до специальных передатчиков, подключаемых прямо к разъему камеры. <br/>ПРИМЕЧАНИЕ <br/>Обратите внимание на наличие в камере композитного видеовыхода и выхода канала <br/>звука. Такая опция обычно обозначается как "A/V Output". Некоторые современные <br/>экшн-камеры оснащены только выходом стандарта HDMI, что делает невозможным <br/>подключение такой камеры к обычному видеопередатчику. Даже если наличие компо-<br/>зитного видеосигнала обозначено в перечне опций, вы можете столкнуться с отсутст-<br/>вием специального кабеля для подключения к видеовыходу. При покупке экшн-камеры <br/>не забудьте одновременно с ней приобрести соответствующий видеокабель. Через <br/>этот кабель иногда на камеру можно подавать внешнее питающее напряжение. <br/>Стоимость даже начального комплекта "экшн-камера + подвес" составляет около <br/>6–8 тыс. руб., что может оказаться неприемлемо для начинающего пилота, особен-<br/>но с учетом возможных аварий в процессе обучения. Учебный комплект начально-<br/>го уровня (рис. 6.31), состоящий из миниатюрной CCD-камеры и простого подвеса <br/>на двух сервомашинках, обойдется нам не дороже 1500 руб., весьма живуч и ре-<br/>монтопригоден при авариях. Миниатюрная камера, как правило, вообще не страда-<br/>ет даже при самых сложных падениях. <br/>Приобретая подвес для мини-камеры, обратите внимание, входят ли сервомашинки <br/>в комплект. Если нет, то отдельно купите сервомашинки Turnigy TG-9 или <br/>Hextronik HXT900, причем в двойном количестве, поскольку при авариях у них ло-<br/>маются шестеренки редуктора. <br/>При выборе видеокамеры предпочтителен вариант со встроенным стабилизатором <br/>питания, чтобы можно было питать камеру от источника с напряжением 7–12 В без <br/>отдельного внешнего стабилизатора. Следует избегать питания камеры и видеопе-<br/>редатчика от силовой батареи, т. к. в силовой цепи присутствуют импульсные  <br/>помехи, засоряющие изображение. Наличие встроенного микрофона является пре-<br/>имуществом камеры, т. к. во время полета полезно слышать звук моторов, это эле-<br/>мент обратной связи между квадрокоптером и пилотом. <br/><br/>Глава 6. Подключение и настройка внешних модулей 211 <br/> <br/>Рис. 6.31. Камера и подвес начального уровня на сервомашинках <br/>Система изображения у большинства камер сейчас PAL, реже встречается NTSC, <br/>но видеоочки, мониторы и модули OSD способны автоматически определять сис-<br/>тему. В крайнем случае можно задать систему принудительно в настройках очков <br/>и перемычкой на модуле OSD. <br/>Угол обзора объектива должен быть порядка 90–96°, чтобы обеспечить достаточ-<br/>ный обзор. Встречаются камеры с углами обзора 110–120°. Но при таких углах воз-<br/>никают сильные оптические искажения перспективы, к которым нужно привык-<br/>нуть, и которые не для всех комфортны. <br/>Одним из вариантов является использование малогабаритного автомобильного ви-<br/>деорегистратора. Если изготовить сменное крепление, можно переставлять регист-<br/>ратор с автомобиля на время полетов. Автор делал так на одном из своих коптеров. <br/>Но для этого нужно, чтобы регистратор имел композитный видеовыход. <br/>Видеопередатчик и приемник <br/>При выборе передатчика и приемника или очков со встроенным приемником нужно <br/>уделить особое внимание частотной совместимости. Наиболее часто используе-<br/>мым является диапазон 5,8 ГГц. Он разбит на 32 канала, таблица частот приведена <br/>в приложении 2. Некоторые универсальные передатчики и приемники могут ис-<br/>пользовать весь диапазон. Но чаще доступны только восемь каналов, и у разных <br/>производителей они различаются. Поэтому, если вы не покупаете готовый набор, <br/>обратите внимание на точное совпадение частот каналов, а не просто частотного <br/>диапазона. Проблема совместимости снимается, если применяется передатчик на <br/><br/>212 Часть II. Практика <br/>32 канала. Такой передатчик легко определить визуально, у него на плате есть <br/>5<br/>двухпозиционный переключатель из 5 сегментов: 2 = 32. Если есть шестой сег-<br/>мент, то он не используется. <br/>Наиболее популярными являются передатчики и приемники на основе модулей <br/>BOSCAM и их многочисленных клонов. Для начинающего пилота оптимальным <br/>решением будет покупка 32-канального передатчика TS5823 с выходной мощ- <br/>ностью 200 мВт (рис. 6.32). Реальная дальность действия видеоканала при этом <br/>около 800–900 м, что сопоставимо с дальностью действия обычного пульта радио-<br/>управления Turnigy или аналогичного. Покупка более мощного передатчика имеет <br/>смысл, если аппаратура радиоуправления позволяет улетать на большие расстоя-<br/>ния. Самодельные передатчики на основе модулей BOSCAM имеет смысл делать <br/>только в условиях жесткой экономии веса для миниатюрных коптеров и при нали-<br/>чии радиолюбительского опыта. <br/> <br/>Рис. 6.32. Малогабаритный видеопередатчик TS5823 <br/>Отдельно следует обсудить монтаж передатчика на раме коптера. Плата передатчи-<br/>ка, даже маломощного, сильно нагревается. Поэтому нельзя помещать передатчик <br/>внутрь защитного чехла или корпуса, он должен хорошо обдуваться. Диаграмма <br/>направленности популярной антенны типа "клевер" (см. рис. 2.16) несимметрична <br/>по вертикали и напоминает купол в направлении, противоположном питающему <br/>кабелю. Это означает, что для достижения максимальной дальности действия ан-<br/>тенна передатчика должна быть направлена вниз и располагаться на максимальном <br/>удалении от металлических частей рамы. Но с точки зрения безопасности при ава-<br/>риях и жестких посадках это очень опасный способ монтажа, и антенна зачастую <br/>обрывается при аварии. Поэтому начинающим пилотам следует монтировать ан-<br/>тенну с направлением вниз только при наличии высоких посадочных стоек. В лю-<br/>бом случае, следует стараться смонтировать передатчик на максимальном удалении <br/>от приемников GPS и радиоуправления. Несмотря на то, что их рабочие диапазоны <br/>не совпадают, нельзя исключать возможность высокочастотных наводок на вто-<br/>ричные цепи или помех, образованных паразитными гармониками излучения. <br/>ВНИМАНИЕ! <br/>Передатчики мощностью от 250 мВт и более содержат выходной усилитель. Он выхо-<br/>дит из строя при включении передатчика без антенны даже на короткое время, а также <br/>при замыкании в цепи нагрузки. Поэтому авария с обрывом антенны или замыканием <br/>кабеля возле разъема обычно приводит к поломке передатчика. Также, строго не ре-<br/><br/>Глава 6. Подключение и настройка внешних модулей 213 <br/>комендуется подавать питание на передатчик при отключенной антенне. Неисправ-<br/>ность выражается в резком снижении дальности передачи без каких-либо иных внеш-<br/>них признаков. Чтобы убедиться в неисправности выходного каскада, необходимо ис-<br/>пользовать высокочастотный ваттметр или хотя бы заведомо исправные антенны и <br/>приемник. <br/>При наличии некоторого радиолюбительского опыта можно приобрести приемный <br/>модуль BOSCAM RX5808 (рис. 6.33). Его необходимо смонтировать на простей-<br/>шую самодельную плату, снабженную антенным разъемом типа SMA-F (можно <br/>извлечь из неисправного сетевого оборудования D-Link), стабилизатором питания <br/>+5 В, микропереключателем из трех сегментов для выбора канала и разделитель-<br/>ным конденсатором в цепи видео (рис. 6.34). <br/> <br/>Рис. 6.33. Модуль BOSCAM RX5808 <br/> <br/>Рис. 6.34. Схема подключения модуля RX5808 <br/><br/>214 Часть II. Практика <br/>ВНИМАНИЕ! <br/>Подключение модуля без разделительного конденсатора в цепи видео может привес-<br/>ти к выходу модуля из строя! <br/>Микропереключатели S1-1...S1-3 нужны для выбора каналов. Всего таким спосо-<br/>3<br/>бом можно выбрать 2 = 8 каналов, перечисленных в табл. 6.3. <br/>Таблица 6.3. Стандартные каналы приемника RX5808 <br/>Номер канала 1 2 3 4 5 6 7 8 <br/>Частота канала 5705 5685 5665 5645 5885 5905 5925 5945 <br/>CH1 0 1 0 1 0 1 0 1 <br/>Логические уровни <br/>на входах выбора CH2 0 0 1 1 0 0 1 1 <br/>канала <br/>CH3 0 0 0 0 1 1 1 1 <br/> <br/>При питании от готового источника +5 В стабилизатор не нужен, а вместо микро-<br/>переключателя можно использовать перемычки. Путем небольшой переделки и  <br/>добавления микроконтроллера ATmega328 модуль RX5808 можно превратить  <br/>в 32-канальный приемник, совместимый с любым передатчиком диапазона 5,8 ГГц. <br/>Автором этого открытого проекта является Саймон Чемберс (Simon Chambers).  <br/>Детальное описание модификации, а также исходный код для прошивки микрокон-<br/>троллера можно получить на странице разработчика по адресу https://code. <br/>google.com/p/rx5808-pro/wiki/rx5805. Мы ограничимся пояснениями к идее проек-<br/>та, поскольку нет необходимости дублировать в книге подробный материал разра-<br/>ботчика. <br/>В модуле приемника применяется микросхема RTC6715. Частоту приема можно <br/>задать двумя способами: выбором из восьми фиксированных значений, если вывод <br/>микросхемы SPI_EN (7) с общим проводом, и подачей команд по интерфейсу SPI, <br/>если на выводе SPI_EN высокий уровень. Во втором случае выводы CH1–CH3 пре-<br/>вращаются в выводы SPI. Управляя рабочей частотой приемника при помощи мик-<br/>роконтроллера, можно заставить его работать на любом из 32 каналов. Для пере-<br/>делки приемника достаточно отпаять защитный экран, удалить с платы одну пере-<br/>мычку и припаять экран обратно. Аналогичным образом можно модифицировать <br/>приемник, встроенный в видеоочки. Такая модификация приемника очень попу-<br/>лярна и применяется во многих любительских конструкциях. <br/>Покупка 32-канального приемника RC832 (рис. 6.35) также снимает все проблемы <br/>совместимости частот с аппаратурой разных марок. У приемника два комбиниро-<br/>ванных аудио/видеовыхода, к одному подключается монитор или видеоочки, ко <br/>второму можно подключить любое устройство для записи видео. Для подключения <br/>потребуется миниатюрный штыревой разъем диаметром 2,5 мм. Такие разъемы <br/>встречаются в гарнитурах некоторых мобильных телефонов, обычно Nokia. Подой-<br/>дет как трех-, так и четырехконтактный разъем. Поэтому для подключения видео-<br/>очков к приемнику можно купить в салоне сотовой связи переходник для наушни-<br/>ков "штекер 2,5 — гнездо 3,5" или недорогую гарнитуру и отрезать от нее разъем. <br/><br/>Глава 6. Подключение и настройка внешних модулей 215 <br/> <br/>Рис. 6.35. Приемник RC832 и назначение выводов штыревого разъема <br/>Видеоочки и монитор <br/>Если вы используете внешний независимый видеоприемник, то к нему можно под-<br/>ключить любые видеоочки, предназначенные для видеоигр или просмотра видео. <br/>Следует обратить внимание на совпадение форматов изображения (4:3 или 16:9) <br/>камеры и очков. Самым простым и доступным по стоимости вариантом для нович-<br/>ков являются видеоочки Quanum, которые можно приобрести в виде набора для <br/>самостоятельной сборки. Они состоят из пенопластового корпуса, монитора и  <br/>линзы Френеля, которая позволяет смотреть на монитор с расстояния в несколько <br/>сантиметров. Линз в наборе несколько, под разную остроту зрения. Важным досто-<br/>инством монитора является то, что он не отключается в "синий экран" при пропа-<br/>дании сигнала. <br/>Отдельно следует упомянуть полный набор начального уровня "Quanum + SkyZone", <br/>который состоит из очков-монитора, передатчика TS5823, приемника RC832, пары <br/>антенн с круговой поляризацией, миниатюрной камеры Sony и комплекта соедини-<br/>тельных проводов. Причем стоимость этого набора заметно ниже, чем компонентов <br/>по отдельности. Вам потребуется докупить лишь подвес на сервомашинках, как на <br/>рис. 6.31. Набор можно смонтировать на коптере практически без применения пай-<br/>ки. Очки имеют довольно неуклюжий дизайн и примитивную конструкцию, зато <br/>являются безусловным лидером по соотношению "цена/качество". Впоследствии, <br/>приобретя себе более дорогие видеоочки, вы можете использовать "Quanum" для <br/>демонстрации полетов с видом "из кабины пилота" своим друзьям и близким. <br/>В том случае, если вы предпочитаете использовать монитор, обратите внимание на <br/>модель Fieldview 777. Мониторы этой марки бывают как одиночные, так и со <br/><br/>216 Часть II. Практика <br/>встроенными 32-канальным приемником на 5,8 ГГц и видеорекордером. Данные <br/>мониторы также не отключаются при потере сигнала. <br/>Подключение подвеса к контроллеру <br/>Прежде, чем приступать к настройке параметров управления подвесом, его нужно <br/>правильно собрать и смонтировать на раму квадрокоптера. При сборке валы серво-<br/>машинок необходимо поставить в среднее положение и собрать подвес так, чтобы <br/>камера была направлена прямо вперед по курсу и под углом примерно 45° вниз от <br/>горизонтали. Небольшие отклонения будут исправлены при настройке. Подвес не-<br/>обходимо прикрепить к виброизолированной площадке, подвешенной на 4–6 амор-<br/>тизаторах (рис. 6.36). <br/> <br/>Рис. 6.36. Пример крепления подвеса к виброизолирующему основанию <br/>Простой подвес на сервомашинках подключается к контроллеру с минимальными <br/>правками в прошивке. Достаточно в секции Cam Stabilisation найти и раскоммен-<br/>тировать строку: <br/>#define SERVO_TILT <br/>Предыдущая строка //#define SERVO_MIX_TILT предназначена для подвесов другого <br/>типа, с другой конструкцией механики. <br/>После записи прошивки в контроллер в конфигураторах MultiWii WinGUI и <br/>MultiWiiConf появится новая опция CAMSTAB. Ее, как и любую другую опцию, мож-<br/>но активировать по одному из каналов AUX1–AUX4 или включить постоянно, по-<br/>ставив галочки для всех трех значений любого канала AUX одновременно. Сохра-<br/>ните настройки в конфигураторе. Подключите сервомашинку, отвечающую за кур-<br/>совое положение, к разъему ROLL (45), а за отклонение вверх-вниз — к разъему <br/><br/>Глава 6. Подключение и настройка внешних модулей 217 <br/>PITCH (44). Теперь, если начать наклонять раму коптера в стороны, подвес будет <br/>стараться сохранить исходное положение камеры в пространстве. Не забывайте, <br/>что на трехрядную гребенку разъема должно поступать питание +5 В, поэтому при <br/>питании через провод USB сервомашинки работать не будут. <br/>По умолчанию в прошивке уже заданы параметры, при которых подвес достаточно <br/>точно работает с недорогими сервомашинками TG9 и HXT900. Но наверняка ис-<br/>ходное положение камеры будет выставлено неточно, а при кренах рамы компен-<br/>сация недостаточно велика либо чрезмерна. Для устранения недочетов нужно про-<br/>извести точную настройку параметров. Это как раз тот случай, когда произвести <br/>настройку при помощи мобильного приложения EZ-GUI Ground Station намного <br/>проще, чем при помощи стационарного компьютера. Тем не менее, рассмотрим оба <br/>варианта. <br/>Настройка при помощи EZ-GUI Ground Station <br/>Запустите приложение EZ-GUI Ground Station и установите соединение с мобиль-<br/>ным устройством одним из описанных выше способов: через адаптер Bluetooth или <br/>радиомодем. Если опция CAMSTAB еще не активирована, войдите в экран На-<br/>стройки | AUX, отметьте нужные флажки и сохраните в память контроллера. <br/>Затем на экране Настройки нажмите кнопку СЕРВЫ (рис. 6.37). Из контроллера <br/>автоматически прочитаются текущие настройки, а именно: минимальное и макси-<br/>мальное значение управляющего сигнала, значение для среднего положения и ко-<br/>эффициент реакции. Чем он больше, тем сильнее реакция подвеса на отклонение  <br/> <br/> <br/> <br/>Рис. 6.37. Меню настройки подвеса в EZ-GUI Ground Station <br/><br/>218 Часть II. Практика <br/>рамы. Отрицательное значение коэффициента инвертирует направление отклоне-<br/>ния. При настройке следует добиваться того, чтобы при отклонениях рамы угол <br/>наклона камеры практически не менялся. <br/>Крайние значения Min и Max необходимо уменьшать в том случае, если при мак-<br/>симальных отклонениях подвеса камера во что-то упирается. Значение среднего <br/>положения Mid используется не только для регулировки нейтрального положения <br/>подвеса. В окне настройки этого параметра можно выбрать, через какой канал ра-<br/>диоуправления мы можем вручную управлять положением камеры. По умолчанию <br/>стоит прочерк, т. е. подвес работает в полностью автоматическом режиме и стаби-<br/>лизируется относительно нейтрального положения. <br/>Но вы можете захотеть управлять камерой вручную, через каналы AUX. Ведь на <br/>пульте этим каналам можно назначить не только тумблеры, но и переменные рези-<br/>сторы. В этом случае при наличии свободных каналов вы можете манипулировать <br/>камерой вправо-влево и вверх-вниз, либо по одной из осей. Подвес будет стабили-<br/>зироваться относительно текущего положения камеры. Новые значения отправляют <br/>в контроллер кнопкой "вверх" и сразу после этого они начинают действовать. <br/>Настройка подвеса  <br/>при помощи конфигуратора MultiWiiConf <br/>После запуска конфигуратора и установления связи с контроллером нажмите кноп-<br/>ку Read. После считывания текущих настроек прошивки в меню появится вкладка <br/>SERVO (рис. 6.38). Иногда нужно нажать кнопку дважды, чтобы эта вкладка по- <br/> <br/> <br/> <br/>Рис. 6.38. Вкладка SERVO конфигуратора MultiWiiConf <br/><br/>Глава 6. Подключение и настройка внешних модулей 219 <br/>явилась. Перейдите на вкладку и нажмите кнопку GIMBALL. Настройки автома-<br/>тически прочитаются из контроллера и отобразятся на экране. Теперь нажмите <br/>кнопку GO LIVE, чтобы записывать новые значения в контроллер в режиме реаль-<br/>ного времени. Перемещая при помощи мыши движки значений MID, можно  <br/>настроить нейтральное положение камеры. При помощи движков TILT_PROP  <br/>и ROLL_PROP задается коэффициент пропорциональности реакции подвеса на <br/>отклонение. <br/>При помощи движков MID также можно определить каналы для ручного управле-<br/>ния камерой. Эта часть интерфейса программы своей изощренной логикой способ-<br/>на шокировать даже подготовленного пользователя. Для перехода в режим опреде-<br/>ления канала следует уменьшить значение MID до 0, а затем начать плавно увели-<br/>чивать. Теперь в подписи к движку будут отображаться названия каналов. Выбрав <br/>нужный канал, нажмите кнопку SAVE. <br/>Настройка подвеса в прошивке MahoWii <br/>В прошивке MahoWii настройка через конфигуратор на момент подготовки книги <br/>не была предусмотрена. Все настройки выполняются в файле config.h. К сожале-<br/>нию, при этом для проверки настроек нужно каждый раз записывать прошивку <br/>в контроллер. Найдите секцию Cam Stabilisation и раскомментируйте строку <br/>#define SERVO_TILT <br/>В строках ниже указаны параметры настроек положения сервомашинки TILT (от-<br/>клонение по вертикали): <br/>#define TILT_PITCH_MIN     1020 <br/>#define TILT_PITCH_MAX     2000 <br/>#define TILT_PITCH_MIDDLE  1500 <br/>#define TILT_PITCH_PROP    10 <br/>//#define TILT_PITCH_AUX_CH AUX4 — раскомментируйте эту строку, чтобы опреде-<br/>лить канал ручного управления. Можно указать один из AUX1–AUX4. <br/>Далее следуют строки настройки положения сервомашинки ROLL (отклонение по <br/>горизонтали): <br/>#define TILT_ROLL_MIN       1020 <br/>#define TILT_ROLL_MAX       2000 <br/>#define TILT_ROLL_MIDDLE    1500 <br/>#define TILT_ROLL_PROP      -10 <br/>//#define TILT_ROLL_AUX_CH  AUX4 <br/>Параметры TILT_PITCH_PROP и TILT_ROLL_PROP задают коэффициент пропорциональ-<br/>ности для реакции на отклонения рамы. Отрицательное значение инвертирует на-<br/>правление отклонения. <br/>Настройка модуля MinimOSD <br/>Мы будем использовать модуль MinimOSD второй версии (рис. 6.39). От первой <br/>версии он отличается наличием импульсного источника питания, который из 7–<br/><br/>220 Часть II. Практика <br/>12 В входного напряжения делает +5 В для питания аналоговой части. В предыду-<br/>щей версии вместо импульсного источника стоял линейный стабилизатор, который <br/>при питании напряжением 12 В очень сильно нагревался. А поскольку микросхема <br/>видеомиксера MAX7456 сама нагревается весьма ощутимо, то суммарный нагрев <br/>мог привести к выходу модуля из строя, и требовалось монтировать модуль с уче-<br/>том хорошего обдува. Но даже при обдуве модули иногда выходили из строя в <br/>жаркую погоду. Поэтому при покупке обратите внимание на наличие импульсного <br/>стабилизатора. <br/> <br/>Рис. 6.39. Модуль MinimOSD и его компоненты <br/>Наличие независимого стабилизатора напряжения позволяет питать аналоговую <br/>часть модуля от той же самой батареи 2S–3S, которая питает видеокамеру и пере-<br/>датчик. При этом цифровая часть питается стабилизированным напряжением +5 В <br/>через разъем полетного контроллера. <br/>Прежде чем приступить к настройке модуля, необходимо выполнить небольшую <br/>доработку модуля (рис. 6.40). Металлическая подложка микросхемы должна быть <br/>припаяна к плате. Это необходимо для надежного отведения тепла от микросхемы. <br/>Посмотрите на отверстия под микросхемой с обратной стороны платы. Если видно, <br/>что подложка микросхемы не припаяна к плате, вы можете сделать это самостоя-<br/>тельно, при помощи паяльника мощностью около 60 Вт. Смочите отверстия под <br/>микросхемой спиртоканифольным флюсом и заполните их припоем так, чтобы он <br/>достиг подложки. Ни в коем случае не используйте активные кислотосодержащие <br/>флюсы! <br/>Далее следует соединить между собой шины цифровой и аналоговой "земли", по-<br/>местив каплю припоя на площадки для перемычки. Разработчики разделили шины <br/>из лучших побуждений, так принято делать в классической практике помехозащи-<br/>ты, чтобы помехи из цифровой части схемы как можно меньше попадали в анало-<br/>говый видеотракт. Но на практике это приводит к частым выходам микросхемы <br/>видеомиксера из строя. Причиной этого являются переходные процессы, которые <br/>возникают в цепях питания при включении. Во время переходных процессов ино-<br/>гда на малые доли секунды потенциал на входах микросхемы оказывается ниже, <br/><br/>Глава 6. Подключение и настройка внешних модулей 221 <br/>чем потенциал "земли", т. е. ко входу прикладывается отрицательный потенциал. <br/>Оказалось, что микросхема MAX7456 крайне чувствительна к этому и выходит из <br/>строя. <br/> <br/>Рис. 6.40. Обратная сторона платы модуля MinimOSD <br/>На время программирования и настройки обе части модуля, цифровую и аналого-<br/>вую, можно питать напряжением +5 В от USB-порта компьютера. Для этого соеди-<br/>ните капелькой припоя перемычку питания, показанную на рис. 6.39. <br/>Проверку и настройку модуля MinimOSD можно выполнить без камеры. Достаточ-<br/>но иметь источник питания +5 В и монитор с аналоговым композитным видеовхо-<br/>дом. В качестве монитора может также выступать любой телевизор. <br/>Модули MinimOSD и их многочисленные клоны обычно поступают в продажу за-<br/>программированными прошивкой для работы с проектом ArduPilot. Эта прошивка <br/>обменивается данными с полетным контроллером через протокол MAVLink (Micro <br/>Air Vehicle Link), но проект MultiWii использует собственный протокол MSP <br/>(MultiWii Serial Protocol), поэтому прошивку придется заменить. Для этого нам по-<br/>требуется уже привычный набор: среда программирования Arduino IDE и адаптер <br/>USB-COM на основе чипа FTDI FT232. Плата модуля OSD разработана для под-<br/>ключения к фирменному адаптеру USB-COM, поэтому выводы на обратной сторо-<br/>не платы помечены в соответствии с цветами проводов адаптера. Вы можете под-<br/>ключить любой адаптер FTDI в соответствии с рис. 6.39. Напомним, что выводы Tx <br/>и Rx следует подключать перекрестно: Tx → Rx, Rx → Tx. <br/>Последний стабильный релиз прошивки KV_Team_OSD можно скачать по адресу <br/>https://code.google.com/p/rush-osd-development/. Архив содержит исходный код <br/>прошивки для Arduino IDE, оболочку KV_Team_GUI и шрифт для загрузки в зна-<br/>когенератор микросхемы MAX7456. Видеомиксер не генерирует произвольные <br/>графические символы, а накладывает на изображение готовые из встроенного зна-<br/>когенератора. Память знакогенератора независимая и заполняется информацией <br/>через микроконтроллер модуля OSD; напрямую из файла компьютера через USB-<br/>адаптер этого сделать нельзя. <br/><br/>222 Часть II. Практика <br/>К сожалению, новая среда разработки Arduino IDE 1.6.1 выдает ошибку компиля-<br/>ции исходного кода, поэтому будем использовать Arduino IDE 1.0.5. В меню Сер-<br/>вис | Плата выберите Arduino Pro or Pro Mini (5V, 16MHz) with ATmega328, за-<br/>тем через меню Сервис | Порт укажите порт, к которому через адаптер подключен <br/>модуль. Теперь, как и в случае с полетным контроллером, перед записью новой <br/>прошивки обязательно следует очистить энергонезависимую память EEPROM.  <br/>В меню Файл | Примеры | EEPROM выберите пример "eeprom_clear". В строке <br/>for (int i = 0; i < 512; i++) <br/>исправьте параметр 512 на 1024, это объем памяти EEPROM микроконтроллера <br/>ATmega328. Скомпилируйте программу и запишите ее в микроконтроллер модуля <br/>OSD нажатием на круглую кнопку со стрелкой вправо. Дождитесь зажигания све-<br/>тодиода, расположенного над микроконтроллером. Теперь память EEPROM очи-<br/>щена и можно записывать основную прошивку. <br/>Откройте в Arduino IDE файл KV_Team_OSD.ino и скомпилируйте проект с  <br/>записью прошивки в модуль. Если компиляция и запись прошли успешно, сразу <br/>после перезагрузки вы, скорее всего, увидите на экране беспорядочный набор сим-<br/>волов, потому что таблица знакогенератора не соответствует версии прошивки. Для <br/>записи новой таблицы символов и дальнейшей настройки воспользуемся утилитой-<br/>конфигуратором. <br/>В папке KV_Team_GUI выберите подпапку, соответствующую операционной сис-<br/>теме вашего компьютера, и запустите конфигуратор (рис. 6.41). <br/> <br/>Рис. 6.41. Конфигуратор прошивки KV_Team_OSD <br/><br/>Глава 6. Подключение и настройка внешних модулей 223 <br/>В левой колонке выберите нужный порт, соединение на скорости 115 200 бод будет <br/>установлено автоматически. Теперь в секции FONT TOOLS нажмите кнопку <br/>Browse для выбора шрифта. Файлы шрифтов хранятся в папке Data и имеют рас-<br/>ширение mcm. На выбор предлагаются два варианта: крупный и мелкий шрифт. <br/>Какой из них выбрать — зависит от конкретного монитора, поэтому проверьте оба <br/>размера. Выбрав шрифт, дождитесь всплывающего окна с уведомлением, что <br/>шрифт загружен в буфер конфигуратора, и нажмите кнопку Upload. Через несколь-<br/>ко секунд шрифт будет загружен в знакогенератор микросхемы MAX7456. Если <br/>после окончания загрузки не произошел сброс и перезапуск модуля, нажмите кноп-<br/>ку сброса на плате. Теперь на экране появится заставка MultiWii и рабочий экран. <br/>Можно приступать к конфигурированию отображаемых данных. Отметим, что  <br/>запись прошивки, шрифта и все настройки можно выполнять при подключенном <br/>мониторе и визуально наблюдать все изменения в реальном времени. <br/>Вы можете самостоятельно редактировать символы знакогенератора по своему ус-<br/>мотрению. Для этого в конфигуратор встроен простой пиксельный редактор симво-<br/>лов, который вызывается кнопкой Edit Font. <br/>Рассмотрим детально секции конфигуратора, но перед этим следует пояснить, что <br/>для измерения напряжения батареи, потребляемого тока и уровня сигнала радио-<br/>управления можно использовать как аналоговые входы полетного контроллера,  <br/>с передачей обработанных значений в потоке данных, так и входы контроллера мо-<br/>дуля OSD. В этой главе далее будет рассказано, как подключить аналоговые сигна-<br/>лы к модулю. <br/>CALL SIGN — здесь вы можете ввести условное имя своего коптера, если их  <br/>несколько. В вашем распоряжении 10 латинских символов. Имя будет появляться <br/>на заставке при включении. <br/>OSD BOARD TYPE — конфигуратор может работать с платами двух проектов: <br/>Rushduino и MinimOSD. Различие этих плат только в выводах контроллера, управ-<br/>ляющих видеомиксером MAX7456. <br/>RSSI SETTINGS — секция контроля за уровнем сигнала на антенном входе при-<br/>емника. Если приемник не имеет выхода RSSI, эту секцию можно пропустить. <br/>Флажок ADC/MWii Input позволяет выбрать внутренний АЦП модуля или анало-<br/>говый вход полетного контроллера с прошивкой MultiWii. Переключатель Off/On <br/>PWM предназначен для выбора типа сигнала RSSI. В зависимости от приемника <br/>это может быть либо аналоговый уровень, либо широтно-модулированный сигнал, <br/>где длительность импульса пропорциональна уровню сигнала. Параметр PWM <br/>Divider требует настройки под конкретный приемник. Разработчик проекта не ре-<br/>комендует применять простой метод, когда передатчик расположен рядом с прием-<br/>ником, и при включенном передатчике уровень сигнала принимается за 100%, а <br/>при выключенном 0%. Рекомендуется минимальным уровнем считать сигнал с за-<br/>пасом 15–20% от реального сигнала. RSSI WARNING задает уровень сигнала, при <br/>котором срабатывает предупреждение. <br/>VOLUME FLIGHT WARNINGS — предельные параметры полета, при которых <br/>будет срабатывать предупреждение. Предельное удаление Dist Max может быть <br/><br/>224 Часть II. Практика <br/>задано в метрах от 0 до 25 000. По умолчанию задано 5 ⋅ 100 = 500 м. Максималь-<br/>ная высота Alt Max задается в метрах, умноженных на 10. По умолчанию задано <br/>25 ⋅ 10 = 250 м. Минимальная высота полета задается в диапазоне 0–50 м. Если  <br/>в этом поле установлено значение, большее ноля, то аварийная индикация сможет <br/>сработать только спустя 60 с полета. Этот интервал времени необходим для пре-<br/>дотвращения ложных срабатываний при наборе высоты. Сигнализация максималь-<br/>ной высоты готова к срабатыванию сразу после взлета. <br/>GPS SETTINGS — отображение информации GPS. Можно полностью выключить <br/>отображение переключателем Off/On GPS или убрать с экрана только координаты <br/>переключателем Off/On Coords. Переключатель 180º/360º Heading меняет вид <br/>компаса. <br/>MAIN VOLTAGE — индикация напряжения силовой батареи. По аналогии со <br/>входом RSSI, переключатель ADC/MWii Input выбирает источник информации  <br/>о напряжении. Минимальное напряжение Minim Volt WARNING отображается без <br/>десятичной точки, т. е. значение 105 соответствует напряжению 10,5 В. Параметр <br/>Divider Ratio используется для точной подстройки показаний под реальное напря-<br/>жение батареи и действует только при использовании встроенного АЦП модуля <br/>(ADC). <br/>VIDEO VOLTAGE — индикация напряжения батареи бортового видеопередатчи-<br/>ка. Обычно видеокамеру и видеопередатчик питают от отдельной батареи. Модуль <br/>OSD может питаться: <br/>� полностью от разъема порта полетного контроллера; <br/>� полностью от видеобатареи, через разъем для подключения видео и встроенный <br/>импульсный источник; <br/>� цифровая часть — от разъема порта, аналоговая — от видеобатареи через разъем <br/>видео. <br/>UNIT & VIDEO — единицы измерения и система видео. По умолчанию установ-<br/>лены метрическая система и PAL, поэтому менять ничего не надо. <br/>OTHER FUNCTIONS — здесь находятся настройки, для которых нет отдельной <br/>секции. Если вы хотите, чтобы при коротком перерыве между полетами, когда вы <br/>не отключаете питание, сохранялась статистика полета (время полета, потреблен-<br/>ный ток, максимальная достигнутая дистанция и т. д.), то выберите опцию <br/>Maintain. В противном случае статистика будет обнуляться при каждом отключе-<br/>нии моторов. <br/>Далее следуют частота мигания символов Blink Frequency, предупреждение о мак-<br/>симальной горизонтальной скорости V Speed WARNING и предупреждение о мак-<br/>симальном угле наклона по оси вперед-назад Pitch Angle WARNING. <br/>HARDWARE ADC'S — включение/отключение встроенных АЦП модуля. Это  <br/>зависит от того, куда вы подключаете датчики напряжения и тока. <br/>AMPERAGE — настройка датчика тока. На основании показаний датчика тока, <br/>напряжения и секундомера вычисляется потребленное количество энергии в мил-<br/><br/>Глава 6. Подключение и настройка внешних модулей 225 <br/>лиампер-часах. Здесь также может быть использован встроенный АЦП, на который <br/>подается сигнал с датчика тока. Параметр Sensitivity — это коэффициент пересчета <br/>для точной подстройки показаний под реальный потребляемый ток, больший нуля. <br/>Для настройки потребуется достаточно точный дополнительный амперметр, на-<br/>пример авиамодельный амперметр-ваттметр. Настройка параметров OffSet High и <br/>OffSet Low представляет собой довольно хлопотное занятие и зависит от типа <br/>применяемого сенсора тока. Эти параметры задают смещение точки ноля АЦП, по-<br/>скольку обычно при нулевом потребляемом токе с датчика приходит ненулевое <br/>значение напряжения. <br/>MULTIWII FLIGHT CONTROL DATA SIMULATOR — в этой секции конфигу-<br/>ратор симулирует данные (рис. 6.42), поступающие из полетного контроллера под <br/>управлением MultiWii. Очень удобная опция, позволяющая полностью настроить и <br/>проверить работу модуля OSD на столе, не используя пульт радиоуправления и по-<br/>летный контроллер. При помощи симулятора можно не только привыкнуть к ото-<br/>бражаемой информации перед взлетом. В прошивке KV_Team_OSD v.2.3 имеется <br/>возможность точной настройки расположения элементов экрана при помощи сти-<br/>ков пульта, и симулятор для этой цели вполне подходит. <br/>В любом случае, перед реальными полетами следует поработать с симулятором, <br/>чтобы довести до автоматизма чтение данных, отображаемых на экране. Во время <br/>полета у вас может не оказаться времени на поиск важной информации взглядом. <br/> <br/>Рис. 6.42. Секция симулятора данных MultiWii <br/>Секция MWI SENSORS & ADC’S управляет симуляцией данных с датчиков по-<br/>летного контроллера. <br/>� ALT — высота полета по показаниям барометра. Может изменяться от 0 до <br/>1000 метров. <br/>� VARIO — вариометр (скорость изменения высоты, скороподъемность). Измеря-<br/>ется в метрах в секунду. Отрицательная величина означает скорость снижения, <br/>положительная скорость — набора высоты. Доступен диапазон от –4 до +4 м/с. <br/>В симуляторе отображается в виде значения, умноженного на 10, т. е. значение  <br/>–25.0 означает снижение со скоростью 2,5 м/с. На экране OSD отображаются <br/>только целочисленные значения. <br/><br/>226 Часть II. Практика <br/>� VBAT — напряжение силовой батареи, доступны значения от 7 до 25 В. <br/>� RSSI — уровень сигнала на входе приемника. <br/>Секция MULTIWII GPS DATA симулирует данные GPS, прошедшие обработку <br/>в полетном контроллере. <br/>� GPS FIX — имитация режима удержания спутников 3D Fix. <br/>� SATS — количество доступных спутников. <br/>� SPEED — горизонтальная скорость по данным GPS. Отображается на экране, <br/>только если моторы активированы. В программе в этом месте небольшая ошиб-<br/>ка и данные в симуляторе не соответствуют отображаемой на экране OSD ско-<br/>рости. <br/>� DIST HOME — расстояние до точки взлета. <br/>Круговые движки HOME и HEADING симулируют изменение направления "до-<br/>мой" и реакцию компаса на поворот рамы. Соответственно, при повороте рамы на <br/>экране меняется положение стрелки, указывающей направление "домой". <br/>ATTITUDE — движок для имитации кренов коптера. Можно при помощи мыши <br/>имитировать крены и смотреть, как это влияет на положение авиагоризонта на эк-<br/>ране. <br/>RC RADIO CONTROL — два движка, имитирующих рукоятки пульта управления. <br/>Эти рукоятки никак не влияют на положение авиагоризонта, зато позволяют вхо-<br/>дить в служебное меню OSD. Между рукоятками расположен флажок, после уста-<br/>новки которого рукоятка газа перестает возвращаться в среднее положение после <br/>смещения при помощи мыши. <br/>FLIGHT MODES — флажки, имитирующие включение различных опций прошив-<br/>ки. Позволяют натренировать восприятие индикаторов на экране. Отдельно следует <br/>отметить опцию OSD SW. Она имитирует отключение вывода информации на  <br/>экран, кроме авиагоризонта, переключателем AUX на пульте, если такая опция <br/>предусмотрена в прошивке полетного контроллера. Не следует бояться, что вы <br/>пропустите тревожное предупреждение, когда вывод отключен. Соответствующая <br/>тревожная информация появится на экране в любом случае. Можете в симуляторе <br/>снизить напряжение батареи или увеличить высоту полета и посмотреть, как это <br/>работает. <br/>Структура экрана KV_Team_OSD v.2.3 <br/>Элементы экрана и система координат видеомиксера представлены на рис. 6.43 <br/>и 6.44 соответственно. <br/>Служебное меню прошивки KV_Team_OSD <br/>Служебное меню прошивки предназначено для настройки параметров полетного <br/>контроллера и модуля OSD в полевых условиях только при помощи пульта радио-<br/>управления. Для входа в служебное меню поместите левую рукоятку пульта в  <br/> <br/><br/>Глава 6. Подключение и настройка внешних модулей 227 <br/> <br/>Рис. 6.43. Элементы экрана OSD: <br/>1 — компас 180°/360°; 2 — режим стабилизации; 3 — уровень радиосигнала RSSI; 4 — количество <br/>спутников; 5 — состояние GPS и активные сенсоры: барометр, магнитометр, акселерометр;  <br/>6 — направление "домой"; 7 — высота в метрах, по барометру; 8 — скорость изменения высоты, м/с; <br/>9 — авиагоризонт; 10 — положение рукоятки газа в %; 11 — расстояние от точки взлета в метрах, <br/>  <br/>по данным GPS; 12 — координаты по GPS; 13 — потребленная от батареи энергия, мА ⋅ ч;  <br/>14 — горизонтальная скорость, м/с; 15 — напряжение видеобатареи, потребляемый ток,  <br/>напряжение силовой батареи; 16 — время полета <br/> <br/> <br/>Рис. 6.44. Система координат видеомиксера MAX7456 <br/><br/>228 Часть II. Практика <br/>положение среднего газа и до упора вправо, затем отклоните правую рукоятку до <br/>упора вверх. При использовании симулятора перемещайте левый движок в нужное <br/>положение при нажатой клавише <Ctrl>, или щелкните на флажке между движка-<br/>ми, чтобы зафиксировать положение движка при отпускании кнопки мыши. Про-<br/>должая удерживать клавишу <Ctrl>, передвиньте правый движок до упора вперед. <br/>Меню состоит из девяти страниц, которые можно перелистывать, отклоняя вправо <br/>или влево левую рукоятку пульта. Газ при этом должен оставаться в среднем поло-<br/>жении. Для перемещения курсора по экрану используйте правую рукоятку пульта. <br/>При помощи экранного меню можно изменить все основные настроечные коэффи-<br/>циенты полетного контроллера, включая PID, и запустить процедуры калибровки <br/>акселерометра, гироскопа и магнетометра. Особый интерес представляет возмож-<br/>ность точной настройки расположения элементов экрана OSD и включе-<br/>ние/выключение их индикации. <br/>Рассмотрим процесс настройки экранного элемента на примере включения индика-<br/>ции напряжения батареи видеоканала (рис. 6.45). По умолчанию индикация этого <br/>элемента отключена, и ее невозможно включить через конфигуратор. Перейдя  <br/>в служебное меню, пролистайте его до восьмой страницы. Это проще сделать дви-<br/>жением рукоятки газа влево. <br/>Под заголовком ITEM находится название настраиваемого элемента. DSP может <br/>иметь значения ON/OFF и управляет отображением элемента на экране. Значения <br/>LINE и COL означают номер строки и столбца в системе координат экрана. Эти <br/>значения можно менять. <br/> <br/>Рис. 6.45. Настройка позиции элемента на экране <br/><br/>Глава 6. Подключение и настройка внешних модулей 229 <br/>Переведите правой рукояткой курсор так, чтобы он указывал на название элемента. <br/>Теперь движением рукоятки газа вправо пролистывайте элементы. В прошивке есть <br/>ошибка: при достижении последнего элемента, а также при попытке пролистнуть <br/>элементы влево, чтобы сразу попасть на последний элемент, модуль иногда само-<br/>произвольно перезагружается. <br/>Когда доберетесь до элемента VIDEO BATT, переместите курсор на параметр <br/>DSP, по умолчанию равный OFF, и движением рукоятки газа вправо смените его <br/>на ON. Переместите курсор на пункт SAVE-EXIT и движением рукоятки газа со-<br/>храните настройку элемента. Программа перейдет в обычный режим и в правом <br/>нижнем углу экрана должен появиться символ видеобатареи и ее напряжение. Они <br/>будут мигать и показывать нулевое напряжение, т. к. пока мы не подключили дат-<br/>чик напряжения к модулю. Аналогичным образом можно включать и выключать <br/>отображение других элементов, а также располагать их на экране по своему вкусу. <br/>Если ваш приемник не оснащен выходом сигнала RSSI, отключите этот элемент, <br/>чтобы своим миганием он не отвлекал ваше внимание. <br/> <br/>Подключение датчиков тока и напряжения  <br/>к модулю OSD <br/>ПРИМЕЧАНИЕ <br/>Микроконтроллер ATMEGA328, на основе которого собран модуль, имеет встроенные <br/>аналого-цифровые преобразователи, способные измерять напряжение не выше, чем <br/>напряжение питания. В нашем случае это 5 В. Но батареи, особенно силовая, имеют <br/>существенно большее рабочее напряжение. Поэтому для измерения напряжения ба-<br/>тарей следует обязательно использовать резистивные делители. <br/>В продаже имеются модификации модуля OSD, уже оснащенные необходимыми <br/>делителями, как на рис. 6.46. К входам такого модуля достаточно присоединить <br/>провода в соответствии с надписями на плате и настроить коэффициенты в конфи-<br/>гураторе. Поэтому, если есть возможность, лучше приобрести модифицированный <br/>модуль. <br/> <br/>Рис. 6.46. Модифицированный модуль OSD со встроенными делителями <br/><br/>230 Часть II. Практика <br/>Стандартный модуль можно доработать самостоятельно, если вы обладаете необ-<br/>ходимыми навыками пайки. Потребуется припаять тонкие провода непосредствен-<br/>но к выводам микроконтроллера. Лучше всего подойдет тонкий провод МГТФ во <br/>фторопластовой оболочке, но можно использовать провода в виниловой изоляции, <br/>а также жилки из кабеля от наушников. Если нет миниатюрного паяльника, можно <br/>намотать несколько витков медного провода диаметром 2 мм на жало большого <br/>паяльника, оставив свободную часть длиной около 1 см, заточенную под клин и <br/>облуженную. Внешние резисторы делителей можно смонтировать на небольшом <br/>кусочке стеклотекстолита или припаять к проводам и затянуть в термоусадочные <br/>трубки. <br/>Схема подключения показана на рис. 6.47. Номиналы резисторов могут быть дру-<br/>гими, важно лишь, чтобы их соотношение было приблизительно 1:15, этого доста-<br/>точно для батарей с напряжением до 4S. На входах RSSI и датчика тока применя-<br/>ются не делители, а защитные токоограничительные резисторы, включенные по-<br/>следовательно, потому что на выходе измерителя тока, а также на выходе RSSI <br/>приемника присутствует напряжение, заведомо не превышающее напряжение пи-<br/>тания +5 В. <br/> <br/>Рис. 6.47. Подключение датчиков тока и напряжения к MinimOSD: <br/>BAT1 — батарея видеотракта; BAT2 — силовая батарея; V_CUR — напряжение с выхода датчика тока; <br/>RSSI — напряжение или импульсы ШИМ с выхода RSSI приемника <br/>Резисторы делителя напряжения для батареи видеотракта удобно припаивать непо-<br/>средственно к выводам питания аналоговой части модуля, как показано на <br/>рис. 6.48. Керамический конденсатор номиналом 0,1 мкФ снижает помехи в изме-<br/><br/>Глава 6. Подключение и настройка внешних модулей 231 <br/>рительной цепи, но использовать его не обязательно. После подключения делите-<br/>лей необходимо настроить калибровочные коэффициенты, чтобы отображаемое на <br/>экране напряжение соответствовало реальному напряжению батареи. Подключите <br/>плату к компьютеру через адаптер и на линии BAT1 и BAT2 подайте заведомо из-<br/>вестное напряжение в диапазоне 11–12 В, измеренное при помощи вольтметра. Ме-<br/>няя константы Divider Ratio, добейтесь, чтобы напряжение на экране максимально <br/>соответствовало реальному. Допускается периодическое мерцание значения после <br/>запятой. Это связано с тем, что в прошивке не фильтруются погрешности измере-<br/>ния и пересчета с плавающей точкой. <br/> <br/> <br/>Рис. 6.48. Монтаж делителя напряжения батареи видеотракта <br/>Отображение показаний датчика тока настраивается иначе. Если используется дву-<br/>направленный сенсор тока (обычно низкоомный шунт), то установите High в 0  <br/>и начните менять параметр Low c 0 и далее 1, 2, ... таким образом, чтобы при отсут-<br/>ствии нагрузки отображалось нулевое значение тока. Обычно значений 1 или 2 дос-<br/>таточно. <br/>Если используется однонаправленный сенсор тока (обычно на магниторезистив-<br/>ном датчике), установите High = 2 и Low = 0. Проверьте индикацию нулевого тока, <br/>отображаемое значение должно быть близким к нулю. Если это не так, установите <br/>High = 1 и Low = 255. Затем постепенно уменьшая Low = 254, 253, 252, ..., добей-<br/>тесь максимальной близости показаний к нулю при отсутствии нагрузки. <br/>Далее, используя дополнительный амперметр или амперметр/ваттметр, замеряют <br/>ток под нагрузкой и, меняя константу Sensitivity, добиваются правильных показа-<br/>ний. <br/>После настройки и калибровки OSD можно смонтировать модуль на коптере. По <br/>опыту автора, несмотря на довольно сильный нагрев микросхемы MAX7456, мо-<br/>дуль OSD можно затягивать в термоусадочную трубку, и это не приведет к пере-<br/>греву. Важно лишь, чтобы модуль был смонтирован на открытом месте с хорошим <br/>обдувом. Желательно сохранить возможность подключения адаптера USB-COM <br/>на случай настройки или перепрошивки "на борту". <br/><br/>232 Часть II. Практика <br/>При правильном подключении соединительных проводников между камерой, мо-<br/>дулем OSD, контроллером и передатчиком видеосистема начнет работать сразу. <br/>Если с контроллера не поступают данные на OSD, убедитесь, что модуль соединен <br/>с портом SERIAL3 по схеме Rx → Tx, Tx → Rx и в настройках прошивки полетно-<br/>го контроллера указана скорость этого порта 115 200 бод. При использовании неко-<br/>торых камер модуль неправильно определяет стандарт видеосигнала и переходит  <br/>в режим NTSC, хотя на самом деле поступает сигнал стандарта PAL. В этом случае <br/>следует запаять перемычку PAL с обратной стороны платы (см. рис. 6.40). <br/> <br/>Подключение датчиков тока и напряжения <br/>к контроллеру <br/>Подключение датчиков тока и напряжения непосредственно к полетному контрол-<br/>леру менее предпочтительно с точки зрения выхода контроллера из строя и слож-<br/>ности настройки. Но иногда необходимо это сделать, например, если для отобра-<br/>жения телеметрии используется не экран OSD, а другие средства. <br/>В случае использования готового измерительного модуля, аналогичного представ-<br/>ленному на рис. 3.8, сигналы с его выходов можно подавать непосредственно на <br/>аналоговые входы полетного контроллера. Если имеется только датчик тока, то <br/>схема входных цепей аналогична показанной на рис. 6.47. Измеряемое напряжение <br/>силовой батареи необходимо подавать только через резистивный делитель! В про-<br/>тивном случае аналоговый вход контроллера выйдет из строя. В стандартной схеме <br/>подключения измеряемое напряжение с выхода делителя или модуля подается на <br/>вход A1 полетного контроллера, а напряжение с выхода датчика тока — на вход <br/>А2. В комментарии внутри кода прошивки предлагается использовать иные номи-<br/>налы резисторов (33 и 51 кОм), с меньшим коэффициентом деления. Но при ука-<br/>занных номиналах на вход датчика нельзя подавать напряжение 12 В с батареи, <br/>т. к. на выходе делителя будет около 8 В. <br/>В прошивке контроллера необходимо сделать некоторые изменения. Включим из-<br/>мерение напряжения. В файле config.h найдите секцию battery voltage monitoring. <br/>Раскомментируйте строку //#Define VBAT. Далее необходимо подобрать опытным <br/>путем коэффициент деления в строке #define VBATSCALE таким образом, чтобы ото-<br/>бражаемое напряжение соответствовало реальному напряжению батареи, измерен-<br/>ному контрольным вольтметром. В отличие от удобного конфигуратора OSD, где <br/>настройки можно менять в режиме реального времени, в данном случае нам при-<br/>дется после каждого изменения параметра заново компилировать и загружать про-<br/>шивку. Чтобы работала звуковая сигнализация разряда батареи, необходимо рас-<br/>комментировать опцию #define BUZZER, расположенную немного выше по тексту <br/>кода. <br/>Параметр VBATNOMINAL нужен только для телеметрии на LCD-экране и соответствует <br/>напряжению заряженной силовой батареи без десятичной точки. Следующие пара-<br/>метры позволяют настроить трехуровневое предупреждение о разряде батареи: <br/><br/>Глава 6. Подключение и настройка внешних модулей 233 <br/>#define VBATLEVEL_WARN1 107 // (*) (**) 10,7V <br/>#define VBATLEVEL_WARN2  99 // (*) (**) 9.9V <br/>#define VBATLEVEL_CRIT   93 // (*) (**) 9.3V <br/>Параметр #define NO_VBAT необходим для отключения сигнализации разряда, если <br/>силовая батарея вообще не подключена. Такая ситуация возникает, например, при <br/>подключении полетного контроллера к разъему USB — контроллер работает и пы-<br/>тается измерить напряжение, но силовой батареи нет. <br/>Далее приступим к настройке измерителя тока. Во время регулярных полетов нас <br/>интересует не мгновенное значение потребляемого тока, а количество потреблен-<br/>ной энергии в миллиампер-часах. Мы можем приблизительно предположить, <br/>сколько еще энергии осталось для полета, а также оценить степень износа самой <br/>батареи, насколько ее реальная емкость соответствует заявленной. В прошивке <br/>MultiWii v.2.3 предусмотрены два способа оценки потребленной энергии: более <br/>точный аппаратный и приблизительный программный на случай, если аппаратный <br/>датчик тока отсутствует. <br/> <br/> <br/>Настройка аппаратного измерителя тока <br/>и потребленной энергии <br/>Раскомментируйте строку //#define POWERMETER_HARD. <br/>На выходе датчика тока присутствует постоянное напряжение, значение которого <br/>прямо пропорционально току, протекающему через измеритель. Полетный кон-<br/>троллер измеряет это напряжение и пересчитывает в ток. В режиме нулевого тока <br/>напряжение обычно не равно нулю. Подберите константу в строке #define <br/>PSENSORNULL таким образом, чтобы при выключенных моторах в GUI или показани-<br/>ях телеметрии отображалось нулевое значение тока. Теперь приступим к настройке <br/>коэффициента пересчета напряжения, поступающего с датчика тока, в отображае-<br/>мое значение тока. Вам понадобится ваттметр с функцией измерения тока или <br/>мощный амперметр, включенный в разрыв провода силовой батареи. <br/> <br/>ПРИМЕЧАНИЕ <br/>Дальнейшие действия потребуют от вас особой осторожности, поскольку измерения <br/>будем проводить в рабочем режиме, с установленными винтами. Надежно закрепите <br/>квадрокоптер на земле при помощи груза или растяжек. Позаботьтесь о том, чтобы <br/>провод USB и посторонние предметы не попали в плоскость вращения винтов. <br/> <br/>Активируйте моторы и дайте газ примерно 60–70%. Сравните показания контроль-<br/>ного прибора со значением тока в GUI или данных телеметрии. При необходимости <br/>измените значение параметра #define PINT2mA. Увеличение этого параметра приво-<br/>дит к увеличению отображаемых значений тока и потребленной энергии. По дос-<br/>тижении приемлемой для вас точности измерения тока настройку можно считать <br/>законченной. <br/><br/>234 Часть II. Практика <br/>Настройка программного измерителя  <br/>потребленной энергии <br/>При отсутствии датчика тока потребленная энергия рассчитывается приблизитель-<br/>но, через время полета и некую усредненную эмпирическую константу, значение <br/>которой имитирует потребляемый ток. Разумеется, в этом случае в данных теле-<br/>метрии мы видим только потребленную энергию. Точность расчета зависит от  <br/>аппаратной конфигурации коптера, условий и стиля полета. После настройки точ-<br/>ность составляет около 10%. Если совершить около десятка реальных полетов  <br/>с использованием ваттметра и после каждого полета корректировать поправочный <br/>коэффициент, то можно достичь точности около 5%. Но любое изменение аппарат-<br/>ной конфигурации, включая использование батарей разного веса и мощности, будет <br/>приводить к существенному ухудшению точности. <br/>Убедитесь, что напряжение батареи измеряется максимально точно. Раскомменти-<br/>руйте строку //#define POWERMETER_SOFT. "Залейте" прошивку в контроллер. Далее <br/>потребуется несколько раз совершить последовательность действий: <br/>1. Совершите обычный полет, в своем обычном стиле и с обычной продолжитель-<br/>ностью. <br/>2. После окончания полета не спешите обесточивать коптер. Сперва запишите зна-<br/>чение потребленной энергии с экрана LCD или из данных телеметрии. <br/>3. Подключите силовую батарею к зарядному устройству и зарядите в обычном <br/>режиме. Посмотрите, какое количество энергии в миллиамперчасах "залито" <br/>в батарею на самом деле. <br/>4. Подкорректируйте значение параметра #define PINT2mA. Увеличение значения <br/>повышает результат измерения и наоборот. <br/>5. Повторите полет и вновь сравните вычисленное значение и фактически загру-<br/>женное в батарею при зарядке. <br/>Для ускорения процедуры первые 1–2 оценочных полета можно проводить не  <br/>до полного разряда батарей, а лишь дождавшись, пока отображаемое значение по-<br/>  <br/>требленной энергии достигнет 100–200 мА⋅ч. Этого будет достаточно, чтобы оце-<br/>нить, в какую сторону изменять коэффициент PINT2mA и насколько существенно. <br/> <br/> <br/> <br/><br/>  <br/> <br/> <br/>ГЛАВА 7 <br/> <br/> <br/> <br/>   <br/> <br/>Обслуживание и ремонт <br/>квадрокоптера <br/>Предполетная проверка <br/>Даже если не было аварий в предыдущие полетные дни, квадрокоптер может полу-<br/>чить мелкие повреждения при транспортировке в автомобиле и просто вследствие <br/>естественного износа при эксплуатации. Перед полетом необходимо проверить, не <br/>повреждены ли антенны и их соединительные кабели, надежно ли подключены <br/>разъемы к приемнику и полетному контроллеру. Убедитесь, не деформированы ли <br/>воздушные винты при хранении и транспортировке, надежно ли они закреплены. <br/>Характерные неполадки <br/>Обсудим некоторые характерные неполадки, которые не проявляются при настрой-<br/>ке, либо не присутствуют постоянно, однако внезапно возникают при эксплуата-<br/>ции. Такие пропадающие неполадки бывает сложно выявить, поскольку они пропа-<br/>дают так же непредсказуемо, как и возникают. Но на самом деле причины боль-<br/>шинства из таких неполадок в авиамодельном сообществе хорошо известны. <br/>Поэтому начинать поиск лучше с очевидных причин и лишь затем углубляться <br/>в экзотику наподобие микротрещин печатной платы контроллера. <br/>Квадрокоптер изредка внезапно дергается по курсовому направлению и уров-<br/>ню, при этом в момент рывка слышен перепад звука вращения моторов. <br/>Вероятные причины: <br/>� плохой контакт в разъемном соединении типа "тюльпан" между мотором и регу-<br/>лятором или между регулятором и распределителем питания. Следует отказать-<br/>ся от разъемных соединений и использовать только пайку; <br/>� бракованный регулятор оборотов с непропаем на плате. Попробуйте поочередно <br/>заменять регуляторы запасным; <br/>� высокий уровень помех в цепи питания полетного контроллера. Попробуйте пи-<br/>тать контроллер от отдельного источника питания. <br/><br/>236 Часть II. Практика <br/>Квадрокоптер внезапно рывком теряет ориентацию в пространстве и терпит <br/>аварию во время ровного полета или висения, при этом моторы могут вклю-<br/>читься на максимальные обороты или отключиться. <br/>Вероятная причина: сниженное напряжение питания полетного контроллера. При <br/>2<br/>этом происходит либо перезагрузка контроллера, либо сбой шины I C с передачей <br/>хаотичных данных от акселерометра и гироскопа. Следует увеличить напряжение <br/>питания до 5,2–5,3 В. <br/>Квадрокоптер внезапно на некоторое время перестает слушаться команд <br/>управления, затем прием команд восстанавливается. <br/>Вероятные причины: <br/>� недалеко от зоны полетов включается мощный источник помех (охранная сиг-<br/>нализация, радиостанция и т. д.); <br/>� коптер попадает в створ луча радиосигнала релейной станции или радиоудлини-<br/>теля интернет-канала; <br/>� поврежден провод антенны приемника, и он периодически теряет сигнал; <br/>� находящийся в кармане мобильный телефон при служебном обмене с базовой <br/>станцией создает наводки на плату пульта управления; <br/>� предгрозовая погода с высоким уровнем электростатических помех. <br/>Постарайтесь внимательно изучить окрестности на предмет наличия потенциаль-<br/>ных источников помех. Мобильный телефон во время полета старайтесь держать на <br/>расстоянии не менее метра от пульта. Проверьте надежность соединения антенны  <br/>с платой приемника и убедитесь в отсутствии механических повреждений антенно-<br/>го кабеля и самой антенны. <br/>В режиме удержания высоты квадрокоптер внезапно совершает девиации по <br/>высоте порядка двух метров вверх и вниз. <br/>Вероятные причины: <br/>� барометр не защищен от завихрений воздуха при помощи кусочка поролона или <br/>чехла для полетного контроллера; <br/>� прямые солнечные лучи попадают на сенсор барометра через отверстия в корпусе; <br/>� высокая нестабильность плотности воздуха и давления перед грозой. <br/>При резком наборе высоты или энергичных маневрах коптер плавно закручи-<br/>вается по курсу или дергается по крену. <br/>Вероятные причины: <br/>� сильные магнитные наводки на компас; <br/>� срабатывает отсечка регулятора оборотов при перегрузке регуляторов по току; <br/>� просадка напряжения силовой батареи при пиковой нагрузке; <br/>� пропуск фаз вращения одного из моторов при пиковой нагрузке. <br/><br/>Глава 7. Обслуживание и ремонт квадрокоптера 237 <br/>Прежде всего, следует проверить реакцию компаса на максимальный ток в силовых <br/>цепях. Процедура проверки потребует большой осторожности и аккуратности. Не-<br/>обходимо надежно зафиксировать коптер так, чтобы он не взлетел при максималь-<br/>ной тяге. Для наблюдения за показаниями компаса желательно использовать бес-<br/>проводное соединение. Если при максимальной тяге показания компаса изменяют-<br/>ся больше, чем на 8–10 градусов, то необходимо принять меры для уменьшения <br/>магнитных наводок: укоротить и уложить по-другому силовые провода, изменить <br/>расположение батареи, поднять компас вверх на выносной плате. В случае, если <br/>под максимальной нагрузкой моторы начинают хрипеть и вращаться неравномерно, <br/>нужно использовать воздушные винты меньшего диаметра и/или шага. Возможно, <br/>придется провести повторный расчет силовой установки в онлайн-калькуляторе. <br/>Ремонт квадрокоптера после аварии <br/>ПРИМЕЧАНИЕ <br/>Первое, что нужно сделать при серьезной аварии, — деактивировать моторы и отклю-<br/>чить силовую батарею и батарею видеопередатчика. <br/>Динамические перегрузки, возникающие при ударе квадрокоптера о землю или  <br/>окружающие предметы, иногда проявляют себя весьма парадоксально, в неожи-<br/>данных местах конструкции. Например, простое падение коптера с работающими <br/>моторами с высоты 3 м может привести к изгибу валов двух моторов, порче трех <br/>пропеллеров и трещине рамы. Поэтому даже небольшая авария требует вашего <br/>пристального внимания! <br/>Осмотр и поиск дефектов <br/>Если удар о землю или поверхность был не слишком сильным (жесткая посадка, <br/>падение с небольшой высоты), то можно ограничиться внешним осмотром наибо-<br/>лее часто страдающих элементов: посадочных стоек шасси, антенн, пропеллеров, <br/>крепления камеры, нейлоновых элементов крепежа. Обратите особое внимание на <br/>воздушные винты. При кажущейся исправности у них может появиться дефор-<br/>мация лопастей, приводящая к расхождению плоскостей вращения (так называе-<br/>мая "бабочка"), или трещина бобышки винта. Второй дефект очень опасен, т. к. <br/>слабо заметен визуально, однако на больших оборотах приводит к сильной вибра-<br/>ции с возможностью отстрела лопастей и травмирования окружающих. Убедитесь, <br/>что внутри моторов не остались песок или трава, и они вращаются легко и все оди-<br/>наково. <br/>Если дефекты, влияющие на безопасный полет, не выявлены, попробуйте поднять <br/>коптер в воздух, осторожно добавляя обороты. Внимательно следите за звуком ра-<br/>боты моторов и поведением коптера. При появлении вибрации, необычных звуков <br/>или странном поведении коптера немедленно прекратите полет. Скорее всего, от <br/>удара лопастями винта о землю появился изгиб вала мотора. Этот изгиб редко за-<br/>метен визуально, однако приводит к сильной вибрации. Вообще, при использова-<br/>нии высокопрофильных моторов с длинным валом последствия удара винтом  <br/><br/>238 Часть II. Практика <br/>о землю непредсказуемы. Вал может остаться целым при разрушении винта и, на-<br/>оборот, погнуться при неповрежденном винте. В случае специальных низкопро-<br/>фильных моторов с коротким толстым валом обычно страдают только винты. <br/>После аварии с очевидными повреждениями конструкции начинайте проверку и <br/>ремонт по принципу "снаружи — внутрь". Снимите уцелевшие винты и проверьте <br/>их геометрию. Вращая моторы, проверьте их на визуально заметный изгиб валов. <br/>Если изгиб не просматривается, оставьте окончательную проверку на потом. При-<br/>кладывая усилия к лучам, проверьте детали рамы на наличие скрытых трещин. Об-<br/>ратите внимание на сохранность нейлоновых винтов и монтажных стоек. Они мо-<br/>гут продолжать удерживаться на месте, но при этом быть срезанными по резьбовой <br/>части, либо иметь сорванную резьбу. <br/>При помощи увеличительного стекла тщательно осмотрите керамическую антенну <br/>приемника GPS. Даже если приемник помещен в пластиковый корпус, при ударе  <br/>о камень или асфальт антенна может треснуть. Такая трещина иногда почти неза-<br/>метна невооруженным глазом, но приводит к значительному ухудшению качества <br/>приема спутников. Ремонт керамической антенны невозможен, склеивание беспо-<br/>лезно. Поврежденную антенну можно только заменить. <br/>Проверьте исправность и надежность подключения антенны приемника. Иногда <br/>антенный кабель внутри приемника не припаян, а присоединяется к плате миниа-<br/>тюрным разъемом типа "грибок". После удара и рывка за кабель "грибок" может <br/>частично соскочить с ответной части. Это существенно снижает дальность дейст-<br/>вия и стабильность работы приемника. <br/>Проверьте исправность и надежность подключения прочих разъемов и проводов. <br/>На этом стандартные проверки можно считать оконченными и приступать к ремон-<br/>ту и замене механических частей конструкции. Специфические повреждения, типа <br/>трещины платы полетного контроллера, случаются крайне редко. Если плата кон-<br/>троллера смонтирована правильно, на защитных нейлоновых стойках или аморти-<br/>заторах, то обычно остается исправной даже при очень серьезных авариях. <br/> <br/>Ремонт двигателей <br/>Поскольку двигатели расположены на концах лучей и являются точным механи- <br/>ческим устройством, они наиболее подвержены различным повреждениям при ава-<br/>рии. К обычным повреждениям относятся: <br/>� изгиб вала; <br/>� повреждение подшипников; <br/>� обрыв вывода обмотки; <br/>� отрыв магнита от корпуса ротора и/или трещина магнита. <br/>При ремонте двигателей могут быть допущены ошибки, приводящие к поврежде-<br/>нию двигателя или ухудшению его свойств, поэтому рассмотрим процесс ремонта <br/>более подробно. <br/><br/>Глава 7. Обслуживание и ремонт квадрокоптера 239 <br/>Разборка двигателя <br/>Для разборки двигателя вам понадобятся: тиски, пассатижи с длинными губками, <br/>иголка, качественный шестигранный ключ нужного размера и инструмент для  <br/>локального нагрева. Это может быть фен паяльной станции, миниатюрная газовая <br/>горелка или зажигалка. <br/>Используя пассатижи и иголку, аккуратно удалите стопорный замок с вала двига-<br/>теля, как показано на рис. 7.1, и снимите с вала ротор с магнитами. На вал могут <br/>быть надеты бронзовые шайбы и втулки, иногда с двух сторон. Не потеряйте их и <br/>запомните, где они находились. <br/> <br/>Рис. 7.1. Удаление замка для разборки двигателя <br/> <br/>Рис. 7.2. Удаление стопорных винтов <br/>Теперь при помощи шестигранного ключа нужно вывинтить стопорные винты, <br/>фиксирующие вал в роторе (рис. 7.2). Это очень ответственный момент, т. к. шес-<br/>тигранное гнездо головки винта можно очень легко испортить, после чего даль-<br/>нейший ремонт двигателя будет очень сложен или невозможен. Не экономьте на <br/>шестигранных ключах, используйте только качественные, хорошо закаленные клю-<br/>чи! Винты обычно бывают посажены на фиксатор резьбы, который размягчается  <br/><br/>240 Часть II. Практика <br/>при нагреве до 80–120 °C. Хорошо прогрейте место посадки винтов при помощи <br/>фена или горелки и только после этого приступайте к вывинчиванию винтов. Не <br/>прилагайте чрезмерные усилия, чтобы не сорвать насечку винта или ключа. Лучше <br/>прогрейте резьбу еще раз. Винты следует вывинтить полностью, т. к. понадобится <br/>очистить резьбу и нанести на нее свежий фиксатор. <br/>Во многих моторах вал имеет очень прочную "нулевую" посадку в гнездо и не вы-<br/>нимается даже после удаления стопорных винтов. Кроме того, вал иногда может <br/>быть также посажен на фиксирующую жидкость. Ни в коем случае не пытайтесь <br/>выбить его из отверстия ротора! Вообще избегайте любых ударов по ротору, чтобы <br/>не повредить магниты. Зажмите конец вала длиной около 5 мм в тиски и осторож-<br/>но, но сильно начните проворачивать статор на валу, избегая прикладывать боковое <br/>усилие, чтобы не погнуть вал, если он вдруг не испорчен. Если провернуть вал  <br/>в гнезде не удается, еще раз хорошо прогрейте посадочное место и вращайте вал, <br/>пока оно горячее. Постепенно стяните ротор с вала, совершая колебательное вра-<br/>щение. <br/>Проверка и замена вала <br/>Если вы не уверены, погнут ли вал, нужно его проверить. В быту доступны два не-<br/>сложных способа. Можно катать вал по гладкому стеклу, слегка прижимая пальца-<br/>ми. Ровный вал катается плавно, неоднородности при перекатывании не ощущают-<br/>ся. Подойдет поверхность зеркала или мебельного стекла. Обычное оконное стекло <br/>может иметь неровности. Во втором способе вал прикладывают к образцово ровной <br/>поверхности и смотрят зазор на свет. Можно прикладывать вал к стальной линейке. <br/>На рис. 7.3 видно, что вал слегка изогнут в области проточки для стопорного коль-<br/>ца. Обычно это самое слабое место вала. Проворачивая вал вокруг оси, нужно убе-<br/>диться, что он в любом положении прилегает к поверхности без зазора по всей <br/>длине. <br/>Если обнаружен хотя бы незначительный изгиб, то вал следует заменить новым.  <br/>В безвыходных ситуациях можно попытаться выправить вал (рис. 7.4). Для этого  <br/> <br/> <br/> <br/>Рис. 7.3. Обнаружение изгиба вала <br/><br/>Глава 7. Обслуживание и ремонт квадрокоптера 241 <br/> <br/>Рис. 7.4. Устранение изгиба вала <br/>пометьте маркером выступающую сторону изгиба на валу. Зажимая вал в тисках <br/>через проставки из сложенной в несколько слоев фольги, исправьте изгиб вала. <br/>Проставки нужны для того, чтобы скомпенсировать упругость вала, слегка выгибая <br/>его в противоположную сторону. Если просто зажать вал в тисках, он спружинит и <br/>не выпрямится до конца. Возможно, операцию придется повторить несколько раз, <br/>контролируя результат. Идеально выправить вал в домашних условиях вряд ли по-<br/>лучится, поэтому при первой же возможности его следует заменить. <br/>Очистите резьбу в гнездах под фиксирующие винты от остатков фиксатора резьбы <br/>при помощи метчика нужного размера. Желательно также очистить и сами винты, <br/>вворачивая их в плашку для нарезания резьбы или, хотя бы, в новую гайку. Зафик-<br/>сировав кончик вала в тисках, осторожно наденьте на него статор, совершая враща-<br/>тельные движения, аналогично тому, как вынимали вал. Обратите внимание: если <br/>на валу есть шлиц, проверните вал так, чтобы шлиц оказался напротив одного из <br/>винтов. Слегка увлажнив резьбу винтов фиксатором синего или красного цвета, <br/>плотно вверните их на место. <br/> <br/>Проверка и замена подшипников <br/>При ударе воздушного винта о препятствие и изгибе вала часто страдают миниа-<br/>тюрные шарикоподшипники. Дело в том, что при боковом ударе по валу шарики <br/>"впечатываются" в рабочую поверхность обоймы, создавая в ней вмятины, так на-<br/>зываемые питчи. Подшипник начинает гудеть, увеличивается сопротивление вра-<br/>щению. Эффективность двигателя с гудящим подшипником снижается на 15–20%. <br/>Это, в свою очередь, приводит к закручиванию коптера по оси направления и не-<br/>симметричной отработке кренов, а также к более быстрому разряду батареи. <br/>Кроме того, подшипники начинают гудеть вследствие попадания в них воды, а <br/>также естественного износа. Иногда достаточно одного сезона интенсивных поле-<br/>тов, чтобы подшипники потребовали замену даже без аварий. Гудящий подшипник <br/>легко обнаруживается при сравнении вращения валов разных двигателей от руки. <br/>При исправных подшипниках во время вращения вала ощущаются только толчки <br/>от взаимодействия магнитов ротора с железом статора. В случае неисправного <br/>подшипника ощущается высокочастотная вибрация в такт качению шариков. Что-<br/>бы эффект ощущался сильнее, рекомендуется при вращении вала пальцами слегка <br/>прижимать его вбок. Во время полета двигатель с неисправным подшипником из-<br/><br/>242 Часть II. Практика <br/>дает специфический неприятный скрипяще-гудящий звук и нагревается сильнее <br/>остальных. <br/>Разумеется, неисправный подшипник можно только заменить. При аварии обычно <br/>страдает один подшипник, расположенный ближе к воздушному винту. При обыч-<br/>ной эксплуатации он также быстрее изнашивается. В двигателях может использо-<br/>ваться как пара одинаковых подшипников, так и подшипники с разным диаметром <br/>внешней обоймы. Этот нюанс надо иметь в виду при покупке запасных подшип- <br/>ников. <br/>Специального инструмента для удаления подшипников из посадочных гнезд у лю-<br/>бителей обычно не бывает. Иногда подшипники посажены в своем ложе не слиш-<br/>ком прочно, и их удается вытащить при помощи зацепов из стальной проволоки. <br/>Если же подшипник посажен очень прочно, можно выбить его при помощи сталь-<br/>ного стержня диаметром меньше, чем толщина вала. Вставьте стержень с противо-<br/>положной стороны, слегка под углом, чтобы он уперся в обойму подшипника. <br/>Удерживая статор в руке и осторожно постукивая по стержню, выбейте подшип-<br/>ник. После этого он испортится окончательно, поэтому никогда не выбивайте  <br/>исправные подшипники. <br/>Чистка и смазка подшипников <br/>Иногда, при полетах в дождливую погоду или после падения коптера в воду, <br/>внутрь подшипников может попасть вода. Обычно во время полета двигатель на-<br/>гревается до 40–60 °C. Когда двигатель остывает, вода всасывается внутрь под-<br/>шипника. Не рекомендуется включать моторы и продолжать полет после попадания <br/>воды. Влага опасна не только тем, что может вызвать коррозию подшипника. Есть <br/>еще два негативных эффекта от попадания внутрь подшипника любой жидкости, не <br/>только воды. <br/>Во-первых, жидкость выдавливает из подшипника специальную консистентную <br/>смазку, после чего у рабочих поверхностей начинается масляное голодание и быст-<br/>рый износ. Во-вторых, при быстром вращении вала со скоростью несколько тысяч <br/>оборотов в минуту, при прокатывании шариков внутри обоймы подшипника, на-<br/>полненного водой, возникает кавитация и микроскопические гидроудары, которые <br/>приводят к нарушению целостности зеркала рабочей поверхности качения. Как <br/>только зеркало нарушено, износ подшипника резко ускоряется и последующая  <br/>чистка и смазка помогает мало. <br/>Сказанное выше объясняет, почему не рекомендуется использовать для промывки <br/>подшипников и чистки двигателя популярную жидкость WD-40. Состав этой жид-<br/>кости подобран таким образом, чтобы обеспечить максимальное проникание в лю-<br/>бые, даже микроскопические зазоры и трещины. Жидкость WD-40 не только пол-<br/>ностью заполняет подшипник, растворяя смазку. Она проникает в микротрещины <br/>зеркала обоймы и при скоростном вращении возникают гидроудары, сшелуши-<br/>вающие поверхностный слой и вызывающие появление каверн. <br/>Для очистки двигателя от грязи лучше применять механическую очистку и проду-<br/>вание сжатым воздухом. Подшипники после попадания в них влаги рекомендуется <br/><br/>Глава 7. Обслуживание и ремонт квадрокоптера 243 <br/>выварить в консистентной смазке. Лучше всего подойдет специальная вязкая поли-<br/>мерная смазка для скоростных подшипников, но можно использовать обычный <br/>"Циатим" или "Литол". В небольшой жестяной емкости нагрейте смазку до темпе-<br/>ратуры 110–120 °C и пять-десять минут выдержите в ней подшипники, чтобы влага <br/>выпарилась из подшипников. Затем дайте им остыть, находясь в смазке. В процессе <br/>остывания смазка, еще остающаяся жидкой, втянется в пустоты закрытой обоймы. <br/>Подшипники не смазывают жидким моторным маслом, т. к. при нагреве и больших <br/>оборотах оно быстро покидает обойму подшипника. <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/><br/>  <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/>ПРИЛОЖЕНИЯ <br/>Приложение 1. Управление коптером со смартфона <br/>Приложение 2. Сетка частот каналов видеотракта <br/>Приложение 3. Команды управления и конфигурирования  <br/>при помощи рукояток пульта <br/>Приложение 4. Описание электронного архива <br/>  <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/><br/>  <br/> <br/> <br/>ПРИЛОЖЕНИЕ 1 <br/> <br/> <br/> <br/>Управление коптером  <br/>со смартфона <br/>Некоторые выпускаемые промышленно модели квадрокоптеров поддерживают <br/>возможность управления при помощи смартфона. Но эта функция доступна и для <br/>самодельного коптера, причем не потребуется покупать дорогое оборудование. <br/>Достаточно иметь смартфон или планшет с ОС Android, на котором установлена <br/>уже известная вам программа EZ-GUI Ground Station, а также установленный на <br/>коптере модуль беспроводной связи Bluetooth или радиомодем. Один из вариантов <br/>этого оборудования, чаще всего Bluetooth, все равно используется на коптере, по-<br/>этому даже не придется докупать дополнительное оборудование. <br/>Следует сразу заметить, что управлять самодельным коптером при помощи сенсор-<br/>ного экрана, особенно с недорогим телефоном низкого качества, довольно сложно. <br/>Смартфон не заменит полностью пульт радиоуправления, прежде всего, потому что <br/>Bluetooth имеет очень ограниченный радиус действия. Радиомодем работает на <br/>большом расстоянии, но имеет ограничения по скорости передачи данных. <br/>С другой стороны, при помощи смартфона можно провести испытательные взлеты <br/>и поверить основные настройки контроллера и функционирование узлов, если <br/>пульт еще не куплен или задержался в дороге. Простые тренировочные полеты и <br/>висение также вполне доступны при управлении через смартфон или планшет. <br/>Благодаря наличию в современных гаджетах акселерометра, доступна такая инте-<br/>ресная функция, как управление коптером при помощи наклона гаджета в нужную <br/>сторону. Такой способ управления интуитивно понятен и эффектно выглядит со <br/>стороны, но, к сожалению, быстро вырабатывает вредную привычку непроизвольно <br/>наклонять пульт управления. При переходе к обычному пульту управления от этой <br/>привычки трудно избавиться. <br/>Установка и настройка программы EZ-GUI Ground Station описана в одноименном <br/>подразделе раздела "Программы для мобильных устройств" главы 5. Далее, долж-<br/>но быть настроено беспроводное соединение с полетным контроллером по <br/>Bluetooth или радиомодему. Подключение беспроводного оборудования описано в <br/>главе 6. Как показали испытания, проведенные автором, скорости радиомодема <br/>57 600 бод недостаточно, возникают "рывки" сигнала управления, поэтому в дан-<br/>ном случае модем надо настроить на скорость 115 200 бод. Это сокращает макси-<br/><br/>Управление коптером со смартфона 247 <br/>мальную дальность действия, но она остается вполне достаточной. Также установ-<br/>лено, что с некоторыми моделями мобильных гаджетов управление через радиомо-<br/>дем работает нестабильно. В частности, возникают периодические скачки оборотов <br/>двигателей. При использовании Bluetooth сбои не были замечены. <br/>Запустите EZ-GUI Ground Station и перейдите в раздел Конфигурации | Расши-<br/>ренные | Model Control. Рабочий экран показан на рис. П1.1. Он по умолчанию <br/>находится в вертикальной ориентации и не разворачивается. Четыре пункта выбора <br/>опций из ниспадающих списков в верхней строке предназначены для симуляции <br/>тумблеров AUX1–AUX4 на пульте и имитируют одно из трех значений управляю-<br/>щего сигнала: низкий, средний и высокий. Выбирая нужные значения в соответст-<br/>вии с конфигурацией прошивки контроллера, можно переключать режимы точно <br/>так же, как это делается с пульта. Органы управления расположены таким образом, <br/>что горизонтальный движок предназначен для управления по оси направления <br/>YAW, а движок управления газом расположен справа от джойстика управления <br/>кренами, т. е. соответствует варианту пульта Mode 1. Такое расположение движка <br/>газа неудобно для тех, кто привык к пульту Mode 2, а также вырабатывает непра-<br/>вильную моторику у тех, кто еще не начал пользоваться пультом. <br/>Рис. П1.1. Главный экран <br/>управления коптером <br/>программы  <br/>EZ-GUI Ground Station <br/> <br/>К счастью, назначение органов управления можно переназначить в настройках. Для <br/>этого нажмите опцию Настройки в правом верхнем углу экрана. Показанный на <br/>рис. П1.2 вариант настроек соответствует горизонтальному положению гаджета, <br/>когда короткий слайдер оказывается слева от джойстика и соответствует движку <br/>газа, а длинный слайдер сверху и соответствует управлению по оси направления <br/><br/>248 Приложение 1 <br/>YAW. Как и устроено в настоящем пульте, положение движка газа фиксируется, а <br/>остальные движки автоматически возвращаются в среднее положение. Кроме того, <br/>включен режим управления положением коптера при помощи наклонов гаджета <br/>Использовать датчик движения — Left-Right-Up-Down. При таких настройках <br/>активация моторов происходит обычным способом: поместите движок газа в ми-<br/>нимальное положение, затем переместите движок YAW в крайнее правое положе-<br/>ние. Для отключения моторов переместите движок YAW в крайнее левое положе-<br/>ние при минимальном газе. <br/>ВНИМАНИЕ! <br/>Все настройки и проверки проводите только при снятых воздушных винтах! <br/>Перед использованием функции управления наклоном может потребоваться калиб-<br/>ровка встроенного акселерометра телефона или планшета. Если функция калибров-<br/>ки не предусмотрена в прошивке, скачайте на Google Play приложение Bubble level <br/>и откалибруйте акселерометры, поочередно помещая гаджет на образцовую гори-<br/>зонтальную поверхность короткой стороной, длинной стороной и задней крышкой, <br/>каждый раз нажимая кнопку Меню и запуская калибровку. <br/> <br/> <br/>Рис. П1.2. Экран настроек для управления коптером <br/> <br/><br/>  <br/> <br/> <br/>ПРИЛОЖЕНИЕ 2 <br/> <br/> <br/> <br/>Сетка частот  <br/>каналов видеотракта <br/>Таблица П2.1 <br/>Диапазон Номер канала Частота, МГц <br/>FR1 / A CH1 5865 <br/>CH2 5845 <br/>CH3 5825 <br/>CH4 5805 <br/>CH5 5785 <br/>CH6 5765 <br/>CH7 5745 <br/>CH8 5725 <br/>FR2 / B CH1 5733 <br/>CH2 5752 <br/>CH3 5771 <br/>CH4 5790 <br/>CH5 5809 <br/>CH6 5828 <br/>CH7 5847 <br/>CH8 5866 <br/>FR3 / E CH1 5707 <br/>CH2 5685 <br/>CH3 5665 <br/>CH4 5645 <br/>CH5 5885 <br/>CH6 5905 <br/>CH7 5925 <br/>CH8 5945 <br/><br/>250 Приложение 2 <br/>Таблица П2.1 (продолжение) <br/>Диапазон Номер канала Частота, МГц <br/>FR4 / F CH1 5740 <br/>CH2 5760 <br/>CH3 5780 <br/>CH4 5800 <br/>CH5 5820 <br/>CH6 5840 <br/>CH7 5860 <br/>CH8 5880 <br/> <br/>Обратите внимание, что в связи с особенностями работы синтезатора частоты в не-<br/>которых поддиапазонах физические частоты каналов не идут подряд. <br/> <br/> <br/> <br/><br/>  <br/> <br/> <br/>ПРИЛОЖЕНИЕ 3 <br/> <br/> <br/> <br/>Команды управления <br/>и конфигурирования  <br/>при помощи рукояток пульта <br/> <br/><br/>  <br/> <br/> <br/>ПРИЛОЖЕНИЕ 4 <br/> <br/> <br/> <br/>Описание электронного архива <br/> <br/>По ссылке ftp://ftp.bhv.ru/9785977535861.zip можно скачать электронный архив  <br/>c чертежами простой платы квадрокоптера, утилитами для настройки и файлами, <br/>необходимыми для изготовления самодельного цветного дисплея. Эта ссылка дос-<br/>тупна также со страницы книги на сайте www.bhv.ru. <br/>Распаковав архив в любую рабочую папку, вы получите структуру папок, приве-<br/>денную в табл. П4.1. <br/>Таблица П4.1. Структура электронного архива <br/>Папка Описание <br/>display Схема и рисунок печатной платы цветного дисплея  <br/>в формате DipTrace, библиотеки исходного кода прошивки <br/>display\Adafruit_GFX * Библиотека графического ядра для Arduino IDE <br/>display\Adafruit_ST7735 * Библиотека для поддержки видеоконтроллера ST7735 <br/>display\Adafruit_QDTech * Библиотека для поддержки видеоконтроллера S6D02A1 <br/>display\MWIdisplay * Исходные коды прошивки дисплея <br/>drivers Драйверы для адаптеров USB-COM CH340/341, CP2102 <br/>frame Папка с чертежами деталей рамы коптера <br/>utils Утилиты для настройки приемников GPS  <br/>и радиомодемов 3DR Radio <br/>utils\3drradioconfig Утилита настройки радиомодема <br/>utils\GPS_Viewer_v1.8 Универсальная утилита для тестирования приемников GPS <br/>производства Global Top и аналогичных им <br/> <br/>ВНИМАНИЕ! <br/>Папки, помеченные символом *, переименовывать нельзя. <br/> <br/><br/>  <br/>  <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/>Предметный указатель <br/> <br/> <br/>3 <br/>M <br/>MahoWii 146 <br/>3DRRadio Config 188 <br/>MultiWii Configuration Tool 159 <br/> <br/>MultiWii EZ-GUI 157 <br/> <br/>MULTIWII WINGUI 154 <br/>MultiWiiConf 150 <br/>A <br/>N <br/>AssistNow 195 <br/>NAZE32 Configurator 158 <br/>B <br/>P <br/>Battery Elimination Circuit (BEC) 68 <br/>Bluetooth: <br/>Pulse Code Modulation (PCM) 39 <br/>◊ настройка модуля 181 <br/>Pulse Position Modulation (PPM) 37 <br/>◊ подключение модуля 181 <br/>Pulse Width Modulation (PWM) 38 <br/>E <br/>T <br/>EZ-GUI Ground Station 157, 190, 217 <br/>Termite 3.0 156, 182 <br/>G <br/>U <br/>GPS-трекер 100 <br/>u-Center 193 <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/><br/>254 Предметный указатель <br/>Двигатель: <br/>А <br/>◊ бесколлекторный 56 <br/>Адаптер Bluetooth 88 ◊ коллекторный 56 <br/>Аккумулятор 62 Диаграмма направленности 46 <br/>Древесина 113 <br/>◊ зарядка 64 <br/>Акселерометр 24, 92 <br/>◊ калибровка 25 <br/>И <br/>Альманах 83 <br/>Индикатор разряда батареи 72 <br/>Антенна 46 <br/>Инраннер 57 <br/>◊ направленная 52 <br/>Источник бортового питания 68 <br/>◊ поломка 238 <br/>◊ пространственная диверсификация 55 <br/>К <br/>◊ типа "клевер" 51 <br/>◊ штыревая 49 <br/>Калибровка регуляторов оборотов 159 <br/>Аутраннер 56 <br/>Камера: <br/>◊ курсовая 75 <br/>◊ основная 75 <br/>Б <br/>Канал радиоуправления, настройка 160 <br/>Балансир 130 <br/>Карбон 114 <br/>Балансировка: <br/>◊ листовой 115 <br/>◊ винтов 129 <br/>Компас 92 <br/>◊ моторов 131 <br/>◊ интегральный См. Магнитометр <br/>Барометр 92 <br/>Контроллер полетный 92 <br/>◊ интегральный 28 Коэффициент усиления 48 <br/>Батарея См. Аккумулятор <br/>Биндинг 41 <br/>М <br/>Бипер 99, 171 <br/>Магнитоизоляция 124 <br/>Бустер 95 <br/>Магнитометр 26 <br/>◊ калибровка 28 <br/>В <br/>Модуляция: <br/>◊ импульсно-кодовая 39 <br/>Вибрация 118 <br/>◊ фазово-импульсная 37 <br/>Видеокоммутатор 75 <br/>◊ широтно-импульсная 38 <br/>Видеомонитор 79 <br/>Мощность рабочая 48 <br/>Видеоочки 79 <br/>Мультикоптер 165 <br/>Видеопередатчик 78 <br/>Видеоточка 215 <br/>Винт 58 <br/>П <br/>Пакет 39 <br/>Г <br/>Пластик 117 <br/>Подвес стабилизированный 76 <br/>Гироскоп 26 <br/>Подсветка светодиодная 175 <br/>Полоса частот 48 <br/>Д Поляризация 48 <br/>Приемники GPS 80 <br/>Датчик: <br/>Принцип обратимости антенн 48 <br/>◊ напряжения 91 <br/>Протокол: <br/>◊ расстояния См. Сонар ультразвуковой <br/>◊ DSM2 40 <br/>◊ температуры 92 <br/>◊ DSMX 40 <br/>◊ тока 91 Профиль экструдированный 115 <br/><br/>Предметный указатель 255 <br/>Стеклотекстолит радиотехнический 114 <br/>Р <br/>Субтриммер 42 <br/>Радиомаячок 100 Сэндвич: <br/>Радиомодем 94, 186 ◊ алюминиевый 116 <br/>Радиоприемник 92 <br/>◊ карбоновый 116 <br/>Репитер 96 <br/>Т <br/>С <br/>Текстолит конструкционный 114 <br/>Светодиод 175 <br/>Ткань карбоновая 115 <br/>Сервомашинка 101 <br/>Трекер 53 <br/>Система слежения за направлением, <br/>Триммер 42 <br/>автоматическая 53 <br/>Трубка карбоновая 115 <br/>Склонение магнитное 28 <br/>Сонар ультразвуковой 30, 173 <br/>Ч <br/>Сплавы алюминия 117 <br/>Стабилизатор последовательный  <br/>Частота рабочая 48 <br/>линейный 69 <br/>Старт: <br/>Э <br/>◊ "горячий" 84 <br/>◊ "теплый" 84 <br/>Экспонента 43 <br/>◊ "холодный" 84 <br/>Эфемериды 84 <br/> <br/> <br/> <br/> <br/> <br/><br/></div>
<div class='notice'>Веб-страница создана автоматически на основе <a href='https://t.me/techuav/1665' target='blank'>поста</a> пользователя <b>S.L.G.R</b></div></div>
        </div>    
    </div>
    <div class="row">
        <div class="footer col-xs-12">
            <b>Ни одна страница сайта не содержит исполняемого кода.</b> По всем вопросам писать в <a href='https://t.me/techuav/344'>Чат (флудилка)</a>.
        </div>
    </div>

</div>
</body>
</html>